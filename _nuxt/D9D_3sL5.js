import{a_ as ke,b6 as he,a$ as ge,bk as ve,bx as xe,bn as se,b7 as Ie,b0 as Se,b8 as C,b9 as L,ba as le,b1 as we,b3 as c,aX as a,bo as Ce,bW as Ee,bX as W,aT as r,br as R,aS as G,b4 as e,bs as Te,bi as re,aW as l,bt as Ue,bF as N,aY as V,aV as E,bu as $e,aU as _,bY as Be,bg as Le,bV as Re,bf as Ne}from"./QxK_I3gi.js";import{_ as ze}from"./CAzzC2B-.js";import{_ as De}from"./BJ1ENjzX.js";import{_ as Pe}from"./Dk-qhQ1X.js";import{_ as Ve}from"./f4ioq4IM.js";import{_ as Ae}from"./B9jMEh-9.js";import{u as Oe}from"./BpvkJY7_.js";import{u as He}from"./Czjw8vXH.js";import"./B_6mHhFI.js";import"./CUiJuOdN.js";import"./UwgYfZC9.js";(function(){try{var g=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},z=new g.Error().stack;z&&(g._sentryDebugIds=g._sentryDebugIds||{},g._sentryDebugIds[z]="be161659-9881-476b-b667-4122d7a67607",g._sentryDebugIdIdentifier="sentry-dbid-be161659-9881-476b-b667-4122d7a67607")}catch{}})();const Fe={class:"text-center font-bold font-mono"},je={key:1},Ke={class:"text-center font-bold font-mono"},We={class:"flex items-center gap-2"},Ge=["href"],Me=["href"],it=ke({__name:"index",setup(g){const{LIKER_LAND_URL:z,LIKE_CO_API:y,BOOK3_URL:A}=he().public,{t:n}=ge(),M=He(),Y=ve(),O=xe(),D=Oe(),{token:v,wallet:ce}=se(Y),{bookUser:m,isUpdatingBookUserProfile:ue,userLikerInfo:T,isFetchingUserLikerInfo:de}=se(D),X=Ie(),fe=Se(),p=C(""),u=C(!1),x=C({}),P=C([]),q=C([]),I=C(!0),J=L(()=>{var t,o;return(t=T.value)!=null&&t.user?Ce((o=T.value)==null?void 0:o.user):""});le(m,t=>{I.value=(t==null?void 0:t.isEnableNotificationEmails)||!1}),le(u,t=>{t&&(p.value="")});const H=L(()=>{var t,o;return!!((t=m.value)!=null&&t.notificationEmail&&((o=m.value)!=null&&o.isEmailVerified))});we(async()=>{await Promise.all([Q(),ee(),te(),D.lazyFetchBookUserProfile()]),k.value&&await Z()});const k=L(()=>{var t;return(t=x.value)==null?void 0:t.isReady}),me=L(()=>P.value.map(t=>{let o=t.type;switch(o){case"connectedWallet":o="royalties";break;case"channelCommission":o="channel";break}return{...t,type:o,amount:W(t.amount,t.currency),amountTotal:W(t.amountTotal,t.currency),currency:Ee(t.currency),timestamp:new Date(t.timestamp).toLocaleString()}})),pe=L(()=>q.value.map(t=>{const{id:o,amount:h,currency:s,status:S,arrivalTs:U,createdTs:F}=t;return{id:o,amount:W(h,s),status:S,createdTs:new Date(F*1e3).toLocaleString(),arrivalTs:U?new Date(U*1e3).toLocaleString():""}}));async function Q(){try{u.value=!0;const t=await $fetch(`${y}/likernft/book/user/commissions/list`,{headers:{authorization:`Bearer ${v.value}`}});P.value=(t==null?void 0:t.commissions)||[],new Set(P.value.filter(s=>s.classId).map(s=>s.classId)).forEach(s=>M.lazyFetchClassMetadataById(s)),new Set(P.value.filter(s=>s.collectionId).map(s=>s.collectionId)).forEach(s=>O.lazyFetchCollectionById(s))}catch(t){console.error(t),p.value=t.toString()}finally{u.value=!1}}async function Z(){try{u.value=!0;const t=await $fetch(`${y}/likernft/book/user/payouts/list`,{headers:{authorization:`Bearer ${v.value}`}});q.value=(t==null?void 0:t.payouts)||[]}catch(t){console.error(t),p.value=t.toString()}finally{u.value=!1}}async function ee(){try{await D.fetchUserLikerInfo({nocache:!0})}catch(t){console.error(t),p.value=t.toString()}}async function te(){var t;try{await oe(),(t=x.value)!=null&&t.hasAccount&&!k.value&&(await $fetch(`${y}/likernft/book/user/connect/refresh`,{method:"POST",headers:{authorization:`Bearer ${v.value}`}})).isReady&&(x.value.isReady=!0,await oe())}catch(o){console.error(o),p.value=o.toString()}finally{u.value=!1}}async function oe(){try{u.value=!0;const t=await $fetch(`${y}/likernft/book/user/connect/status?wallet=${ce.value}`,{headers:{authorization:`Bearer ${v.value}`}});x.value=t||{}}catch(t){console.error(t),p.value=t.toString()}finally{u.value=!1}}async function ae(){try{u.value=!0;const o=(await $fetch(`${y}/likernft/book/user/connect/login`,{method:"POST",headers:{authorization:`Bearer ${v.value}`}})).url;if(o)window.open(o);else throw new Error("CANNOT_GET_STRIPE_CONNECT_RUL")}catch(t){console.error(t),p.value=t.toString()}finally{u.value=!1}}async function _e(){try{u.value=!0;const o=(await $fetch(`${y}/likernft/book/user/connect/new`,{method:"POST",headers:{authorization:`Bearer ${v.value}`}})).url;if(o)window.open(o);else throw new Error("CANNOT_GET_STRIPE_CONNECT_RUL")}catch(t){console.error(t),p.value=t.toString()}finally{u.value=!1}}async function be(){if(H.value)try{await D.updateBookUserProfile({isEnableNotificationEmails:I.value}),X.add({icon:"i-heroicons-check-circle",title:"User profile updated"})}catch(t){console.error(t),X.add({icon:"i-heroicons-exclamation-circle",title:"Unable to update user profile",description:t.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}})}}return(t,o)=>{const h=Te,s=Le,S=Be,U=ze,F=$e,j=De,$=Ue,w=Re,K=Pe,ne=Ve,ye=Ae;return r(),c(ye,null,{default:a(()=>{var ie;return[e(p)?(r(),c(h,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${e(p)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:o[0]||(o[0]=i=>p.value="")},null,8,["title"])):R("",!0),e(k)?R("",!0):(r(),c(h,{key:1,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"soft",title:e(n)("user_settings.stripe_express_notice"),description:e(n)("user_settings.stripe_express_description")},null,8,["title","description"])),e(Y).isAuthenticated?(r(),G(re,{key:2},[l($,{ui:{header:{base:"flex justify-between items-center"},footer:{base:"text-center"}}},N({header:a(()=>[_("h1",Fe,E(e(n)("user_settings.affiliation_program")),1),l(S,{text:e(n)("user_settings.refresh_liker_id"),popper:{placement:"left"}},{default:a(()=>[l(s,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:e(de),onClick:ee},null,8,["disabled"])]),_:1},8,["text"])]),default:a(()=>{var i;return[(i=e(T))!=null&&i.user?(r(),c(j,{key:0,label:e(n)("user_settings.affiliation_channel_id"),size:"xl"},N({default:a(()=>[l(U,{placeholder:e(n)("user.affiliation_id_placeholder"),"model-value":e(J),disabled:""},null,8,["placeholder","model-value"])]),_:2},[e(k)?{name:"help",fn:a(()=>[o[2]||(o[2]=V(" Append ")),l(F,{class:"font-mono"},{default:a(()=>[V(" ?from="+E(e(J)),1)]),_:1}),o[3]||(o[3]=V(" in any bookstore page to earn commission from book sales. "))]),key:"1"}:{name:"help",fn:a(()=>[V(E(e(n)("user_settings.setup_stripe_notice")),1)]),key:"0"}]),1032,["label"])):(r(),G("p",je," You have not setup your channel ID yet. "))]}),_:2},[(ie=e(T))!=null&&ie.user?void 0:{name:"footer",fn:a(()=>[l(s,{label:"Setup your ID",size:"lg",rel:"noopener",target:"_blank",to:`${e(A)}/account`},null,8,["to"])]),key:"0"}]),1024),l($,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{header:a(()=>[_("h1",Ke,E(e(n)("user_settings.stripe_payout_status")),1),l(S,{text:"Refresh Status",popper:{placement:"left"}},{default:a(()=>[l(s,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:e(u),onClick:te},null,8,["disabled"])]),_:1})]),footer:a(()=>{var i;return[e(u)?(r(),c(s,{key:0,label:"Loading",size:"lg",loading:!0,onClick:ae})):e(k)?(r(),c(s,{key:1,label:"Login to Stripe account",size:"lg",onClick:ae})):(i=e(T))!=null&&i.user?(r(),c(s,{key:3,label:"Setup Stripe Payment Recipient Account",size:"lg",onClick:_e})):(r(),c(s,{key:2,label:"Setup your ID",size:"lg",rel:"noopener",target:"_blank",to:`${e(A)}/account`},null,8,["to"]))]}),default:a(()=>{var i;return[l(K,{columns:[{key:"initiated",label:e(n)("user_settings.setup_initiated")},{key:"completed",label:e(n)("user_settings.setup_completed")}],rows:[{initiated:((i=e(x))==null?void 0:i.hasAccount)||!1,completed:e(k)||!1}],ui:{th:{base:"text-center"},td:{base:"text-center"}}},{"initiated-data":a(({row:f})=>[f.initiated?(r(),c(w,{key:0,label:e(n)("user.yes"),color:"green",variant:"outline"},null,8,["label"])):(r(),c(w,{key:1,label:e(n)("user.no"),color:"red",variant:"outline"},null,8,["label"]))]),"completed-data":a(({row:f})=>{var d;return[f.completed?(r(),c(w,{key:0,label:((d=e(x))==null?void 0:d.notificationEmail)||e(n)("user.yes"),color:"green",variant:"outline"},null,8,["label"])):(r(),c(w,{key:1,label:e(n)("user.no"),color:"red",variant:"outline"},null,8,["label"]))]}),_:1},8,["columns","rows"])]}),_:1}),e(k)?(r(),G(re,{key:0},[l($,{ui:{header:{base:"flex justify-between items-center"},body:{base:"flex flex-col gap-6"},footer:{base:"text-center"}}},N({header:a(()=>[o[4]||(o[4]=_("h1",{class:"text-center font-bold font-mono"}," User Setting ",-1))]),default:a(()=>{var i,f;return[l(j,{label:"Liker ID Email"},{default:a(()=>{var d,b;return[l(U,{"model-value":(d=e(m))==null?void 0:d.notificationEmail,label:"Liker ID Email",disabled:"",ui:{base:"font-mono"}},N({_:2},[(b=e(m))!=null&&b.notificationEmail?{name:"trailing",fn:a(()=>{var B;return[(B=e(m))!=null&&B.isEmailVerified?(r(),c(w,{key:0,label:"Verified",color:"green",size:"xs",ui:{rounded:"rounded-full"}})):(r(),c(w,{key:1,label:"Unverified",color:"amber",variant:"outline",size:"xs",ui:{rounded:"rounded-full"}}))]}),key:"0"}:void 0]),1032,["model-value"])]}),_:1}),l(j,{label:"Email Notification Settings"},N({default:a(()=>[_("div",We,[e(H)?(r(),c(ne,{key:0,modelValue:e(I),"onUpdate:modelValue":o[1]||(o[1]=d=>Ne(I)?I.value=d:null)},null,8,["modelValue"])):(r(),c(ne,{key:1,"model-value":!1,disabled:!0})),o[5]||(o[5]=_("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-200"}," Receive email notifications about commissions ",-1))])]),_:2},[!((i=e(m))!=null&&i.notificationEmail)||!((f=e(m))!=null&&f.isEmailVerified)?{name:"help",fn:a(()=>{var d,b;return[(d=e(m))!=null&&d.notificationEmail?(b=e(m))!=null&&b.isEmailVerified?R("",!0):(r(),c(h,{key:1,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"subtle",title:"Email is not verified.",description:"To enable email notifications, please verify your Liker ID email."})):(r(),c(h,{key:0,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"subtle",title:"Email is not setup yet.",description:"To enable email notifications, please setup your Liker ID email."}))]}),key:"0"}:void 0]),1024)]}),_:2},[e(H)?{name:"footer",fn:a(()=>{var i;return[l(s,{label:"Update",disabled:((i=e(m))==null?void 0:i.isEnableNotificationEmails)===e(I),loading:e(ue),onClick:be},null,8,["disabled","loading"])]}),key:"0"}:void 0]),1024),l($,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{header:a(()=>[o[6]||(o[6]=_("h1",{class:"text-center font-bold font-mono"}," Book Sales Commission History ",-1)),l(S,{text:"Refresh Status",popper:{placement:"left"}},{default:a(()=>[l(s,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:e(u),onClick:Q},null,8,["disabled"])]),_:1})]),default:a(()=>[l(K,{columns:[{key:"timestamp",label:e(n)("user_settings.timestamp")},{key:"type",label:e(n)("user_settings.commission_type")},{key:"amount",label:e(n)("user_settings.commission")},{key:"classId",label:e(n)("user_settings.book_id")},{key:"collectionId",label:e(n)("user_settings.book_collection_id")},{key:"currency",label:e(n)("user_settings.currency")},{key:"amountTotal",label:e(n)("user_settings.sale_amount")}],rows:e(me),ui:{th:{base:"text-center"},td:{base:"text-center"}}},{"classId-data":a(({row:i})=>{var f;return[_("a",{href:`${e(A)}/store/${i.classId}`,target:"_blank"},E(((f=e(M).getClassMetadataById(i.classId))==null?void 0:f.name)||i.classId),9,Ge)]}),"collectionId-data":a(({row:i})=>{var f,d,b,B;return[_("a",{href:`${e(z)}/nft/collection/${i.collectionId}`,target:"_blank"},E(((d=(f=e(O).getCollectionById(i.collectionId))==null?void 0:f.name)==null?void 0:d.zh)||((B=(b=e(O).getCollectionById(i.collectionId))==null?void 0:b.name)==null?void 0:B.en)||i.collectionId),9,Me)]}),_:1},8,["columns","rows"])]),_:1}),l($,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{header:a(()=>[o[7]||(o[7]=_("h1",{class:"text-center font-bold font-mono"}," Commission Payout History ",-1)),l(S,{text:"Refresh Status",popper:{placement:"left"}},{default:a(()=>[l(s,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:e(u),onClick:Z},null,8,["disabled"])]),_:1})]),default:a(()=>[l(K,{columns:[{key:"createdTs",label:e(n)("user_settings.created")},{key:"amount",label:e(n)("user_settings.payout_amount")},{key:"status",label:e(n)("user_settings.status")},{key:"arrivalTs",label:e(n)("user_settings.arrived")},{key:"details",label:e(n)("user_settings.details")}],rows:e(pe),ui:{th:{base:"text-center"},td:{base:"text-center"}}},{"details-data":a(({row:i})=>[l(s,{label:"Details",size:"sm",color:"gray",to:e(fe)({name:"nft-book-store-user-payouts-payoutId",params:{payoutId:i.id}})},null,8,["to"])]),_:1},8,["columns","rows"])]),_:1})],64)):R("",!0)],64)):R("",!0)]}),_:1})}}});export{it as default};
