import{n as ge,T as he,q as we,s as ee,v as be,a2 as xe,u as Ie,M as Ce,r,C as z,h as te,z as Ne,aa as Se,o as _,B as U,w as v,ab as ae,W as ke,a,t as c,F as t,N as B,d as oe,b as d,G as Fe,c as R,I as Te,H as ne,D as $e,ac as Be,ad as Ee,ae as De,Z as Ue,a3 as Re,Q as qe,K as Ve,J as Ae}from"./D6SWFTK-.js";import{_ as Pe}from"./D4Z_PGOe.js";import{_ as Le}from"./DvoYa4fO.js";import{_ as Me}from"./BEp4rydo.js";import{u as ze,_ as He}from"./DVmRMho8.js";import{_ as Oe}from"./CblZZMOj.js";import{u as We}from"./DSW8pRRf.js";import"./BIJ64lMo.js";(function(){try{var C=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},N=new Error().stack;N&&(C._sentryDebugIds=C._sentryDebugIds||{},C._sentryDebugIds[N]="f5ea903f-1435-45dc-bbae-977e2a3e8406",C._sentryDebugIdIdentifier="sentry-dbid-f5ea903f-1435-45dc-bbae-977e2a3e8406")}catch{}})();const je={class:"text-lg font-bold font-mono"},Ge={class:"divide-y w-full"},Ke={class:"px-4 py-3"},Qe={class:"px-4 py-3"},Je={class:"px-4 py-3"},Ze={class:"px-4 py-3"},Xe={class:"px-4 py-3"},Ye={class:"text-left px-4 py-3"},et={class:"px-4 py-3"},tt={class:"px-4 py-3"},at={class:"flex flex-wrap items-center justify-center gap-2"},ot=["src"],ft=ge({__name:"[collectionId]",setup(C){const{LIKE_CO_API:N,LCD_URL:H}=he().public,O=we(),{wallet:S,signer:k}=ee(O),{initIfNecessary:W}=O,j=be(),{token:G}=ee(j),K=We(),q=xe(),{lazyFetchClassMetadataById:le}=K,{lazyFetchCollectionById:se}=q,V=Ie(),re=Ce(),g=r(""),h=r(!1),w=r(V.params.collectionId),Q=r(V.query.payment_id),E=r(V.query.owner_wallet||S.value),F=r(""),{messageCharCount:ie,isLimitReached:J}=ze(F,ae),f=r([]),A=r([]),x=r(!1),I=r(!1),T=r(""),p=r(!1),Z=r(void 0),l=r({}),$=r([]),X=z(()=>p.value||h.value||x.value||I.value||!!T.value||J.value),ue=z(()=>{var o;return(o=q.getCollectionById(w.value))==null?void 0:o.name}),b=z(()=>{var o;return(o=q.getCollectionById(w.value))==null?void 0:o.classIds});te(h,o=>{o&&(g.value="")}),te(p,o=>{o||f.value.forEach(async(e,n)=>{e?$.value[n]=await Y(b.value[n],e):$.value[n]=""})}),Ne(async()=>{const o=await $fetch(`${N}/likernft/book/collection/purchase/${w.value}/status/${Q.value}`,{headers:{authorization:`Bearer ${G.value}`}});l.value=o,await se(w.value),await Promise.all(b.value.map(e=>le(e))),P(l.value.quantity||1)});function ce(o){var e;return(e=K.getClassMetadataById(o))==null?void 0:e.name}function de(){p.value=!p.value,T.value="",$e(()=>{var o,e,n;p.value&&((n=(e=(o=Z.value)==null?void 0:o.$refs)==null?void 0:e.input)==null||n.focus())})}async function Y(o,e){var n,u,i;try{x.value=!0;const s=await $fetch(`${H}/cosmos/nft/v1beta1/nfts/${o}/${e}`),y=((i=(u=(n=s==null?void 0:s.nft)==null?void 0:n.data)==null?void 0:u.metadata)==null?void 0:i.image)||"";return ke(y)}catch(s){return g.value=s.toString(),""}finally{x.value=!1}}async function P(o=1){try{if(T.value="",I.value=!0,(!S.value||!k.value)&&await W(),!E.value)return;await Promise.all(b.value.map(async(e,n)=>{if(!A.value[n]){const{nfts:u}=await Se({classId:e,owner:E.value,needCount:o});if(u.length)A.value[n]=u.map(i=>i.id),f.value[n]=u[0].id,$.value[n]=await Y(e,f.value[n]);else throw new Error(`${E.value} does not hold any NFT of class ${e}`)}}))}catch(e){g.value=e.toString()}finally{I.value=!1}}function fe(){P(l.value.quantity||1)}async function pe(){if(!X.value)try{if(h.value=!0,(!S.value||!k.value)&&await W(),!S.value||!k.value)return;if(await P(l.value.quantity),await Promise.all(b.value.map(async(s,y)=>{if(f.value[y]){const{owner:L}=await Be(s,f.value[y]);if(L!==E.value)throw new Error(`NFT classId: ${s} nftId:${f.value[y]} is not owned by sender!`)}})),b.value.find(s=>!s))throw new Error("Please specify NFT class ID");if(f.value.find(s=>!s))throw new Error("Please specify NFT ID");if(!(await Ee(k.value)).getSigningStargateClient())throw new Error("Signing client not exists");const n=b.value.map(s=>new Array(l.value.quantity).fill(s)).flat(),u=A.value.flat(),i=await De(l.value.wallet,n,u,k.value,S.value,F.value);i.transactionHash&&i.code===0&&(await $fetch(`${N}/likernft/book/collection/purchase/${w.value}/sent/${Q.value}`,{method:"POST",body:{txHash:i.transactionHash,quantity:l.value.quantity||1},headers:{authorization:`Bearer ${G.value}`}}),re.push({name:"nft-book-store-collection-status-collectionId",params:{collectionId:w.value}}))}catch(o){console.error(o),g.value=o.toString()}finally{h.value=!1}}return(o,e)=>{const n=Ue,u=Re,i=qe,s=Pe,y=Le,L=Me,M=Ve,me=Ae,ve=He,ye=Oe;return _(),U(ye,null,{default:v(()=>[a("h1",je,' Deliver NFT Book Collection "'+c(t(ue)||t(w))+'" ',1),t(g)?(_(),U(n,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${t(g)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:e[0]||(e[0]=m=>g.value="")},null,8,["title"])):B("",!0),t(h)?(_(),U(u,{key:1,animation:"carousel"},{indicator:v(()=>e[2]||(e[2]=[oe(" Loading... ")])),_:1})):B("",!0),t(j).isAuthenticated?(_(),U(i,{key:2,ui:{body:{base:"space-y-4"},footer:{base:"flex justify-center gap-2"}}},{footer:v(()=>[d(M,{label:"Sign and Send",disabled:t(X),size:"xl",onClick:pe},null,8,["disabled"])]),default:v(()=>[d(i,{ui:{body:{padding:""}}},{default:v(()=>{var m;return[a("table",Ge,[a("tbody",null,[a("tr",null,[e[3]||(e[3]=a("th",{class:"text-left px-4 py-3"}," Buyer Email ",-1)),a("td",Ke,c(t(l).email),1)]),a("tr",null,[e[4]||(e[4]=a("th",{class:"text-left px-4 py-3"}," Reader Email ",-1)),a("td",Qe,c(((m=t(l).giftInfo)==null?void 0:m.toEmail)||t(l).email),1)]),a("tr",null,[e[5]||(e[5]=a("th",{class:"text-left px-4 py-3"}," Status ",-1)),a("td",Je,c(t(l).status),1)]),a("tr",null,[e[6]||(e[6]=a("th",{class:"text-left px-4 py-3"}," Buyer Wallet ",-1)),a("td",Ze,c(t(l).wallet),1)]),a("tr",null,[e[7]||(e[7]=a("th",{class:"text-left px-4 py-3"}," Price ",-1)),a("td",Xe,c(t(l).price),1)]),a("tr",null,[e[8]||(e[8]=a("th",{class:"text-left px-4 py-3"}," Quantity ",-1)),a("td",Ye,c(t(l).quantity),1)]),a("tr",null,[e[9]||(e[9]=a("th",{class:"text-left px-4 py-3"}," Buyer message ",-1)),a("td",et,c(t(l).message),1)]),a("tr",null,[e[10]||(e[10]=a("th",{class:"text-left px-4 py-3"}," Sales channel ",-1)),a("td",tt,c(t(l).from),1)])])])]}),_:1}),d(y,{label:"Enter Author's Message",error:t(J),hint:`${t(ie)} / ${t(ae)}`},{default:v(()=>[d(s,{modelValue:t(F),"onUpdate:modelValue":e[1]||(e[1]=m=>Fe(F)?F.value=m:null),placeholder:"default memo"},null,8,["modelValue"])]),_:1},8,["error","hint"]),d(y,{label:"Specify NFT ID",error:t(T)},{default:v(()=>[(_(!0),R(ne,null,Te(t(b),(m,D)=>(_(),R("div",{key:m},[a("label",null,c(ce(m)+": "+m),1),a("div",at,[t(l).quantity===1?(_(),R(ne,{key:0},[d(L,{ref_for:!0,ref_key:"nftIdInputRef",ref:Z,modelValue:t(f)[D],"onUpdate:modelValue":_e=>t(f)[D]=_e,class:"font-mono flex-grow",readonly:!t(p),disabled:!t(p),placeholder:"Leave empty to auto-fetch NFT ID","trailing-icon":t(T)?"i-heroicons-exclamation-triangle-20-solid":void 0},null,8,["modelValue","onUpdate:modelValue","readonly","disabled","trailing-icon"]),d(M,{label:t(p)||t(x)&&!t(I)?"Confirm":"Edit",disabled:t(h)||t(x),variant:"outline",loading:t(x)&&!t(I),color:"gray",onClick:de},null,8,["label","disabled","loading"]),d(me,{class:"text-sm text-gray-600 sm:w-min"},{default:v(()=>e[11]||(e[11]=[oe(" OR ")])),_:1})],64)):B("",!0),d(M,{label:`Auto-fetch NFT ID for ${t(l).quantity} orders`,disabled:t(h)||t(p),loading:t(I),variant:"outline",onClick:fe},null,8,["label","disabled","loading"])]),d(ve,{class:"h-[300px]"},{default:v(()=>[t($)[D]?(_(),R("img",{key:0,class:"max-w-[180px] w-full h-full object-contain",src:t($)[D]},null,8,ot)):B("",!0)]),_:2},1024)]))),128))]),_:1},8,["error"])]),_:1})):B("",!0)]),_:1})}}});export{ft as default};
//# sourceMappingURL=DvhtPGKw.js.map
