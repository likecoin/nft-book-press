import{a_ as Oe,a$ as Ge,b6 as Xe,bl as He,bk as Ke,bn as G,b9 as I,b8 as c,ba as j,bb as Ye,b1 as Je,aS as U,aT as h,b3 as z,br as w,aW as a,b4 as t,bs as Qe,bi as oe,aU as r,aX as d,bj as Ze,bt as et,bJ as ne,ct as tt,bB as ot,aV as y,aY as ae,bg as nt,bf as X,bT as at,by as lt,bh as st,aQ as it}from"./Dq4rT-N9.js";import{_ as rt}from"./C3NAEjXn.js";import{p as ut,c as ct,_ as dt,E as mt,a as _t,b as ft,d as pt,v as bt}from"./BLCzEds-.js";import{_ as gt}from"./BGIFM7r1.js";import{_ as vt}from"./BJQ_GiCR.js";import{_ as ht}from"./B4gIQhUf.js";import{_ as yt}from"./CcViUbx4.js";import{D as le,U as xt,M as se,b as kt}from"./BcKtDNBz.js";import{u as wt}from"./C_-oF2IU.js";import{u as Ct}from"./BMBfczuj.js";import{g as Mt}from"./7GLMvuOc.js";import{u as Ut}from"./u5jSbuzZ.js";(function(){try{var p=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},A=new p.Error().stack;A&&(p._sentryDebugIds=p._sentryDebugIds||{},p._sentryDebugIds[A]="a09af363-c9ad-40ca-9a0a-0fb550a65c74",p._sentryDebugIdIdentifier="sentry-dbid-a09af363-c9ad-40ca-9a0a-0fb550a65c74")}catch{}})();function F(p=""){return p.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function Pt(p){return ut.sanitize(p)}const St={class:"pb-[40px]"},Et={class:"flex flex-col gap-[12px]"},Vt={class:"flex items-center justify-between"},It=["textContent"],At={class:"flex items-center gap-2"},Nt=["textContent"],Dt=["textContent"],$t={class:"flex flex-col gap-2"},Lt=["onClick"],Tt=["onClick"],Bt={class:"flex items-center gap-2 mb-3"},jt={class:"space-y-3"},zt={class:"space-y-3 w-full"},Ft={key:0,class:"grid grid-cols-2 gap-4 w-full"},Wt=["textContent"],Rt=["textContent"],qt=["textContent"],Ot={class:"flex justify-center items-center mt-2"},Gt={class:"flex justify-center items-center"},Xt={class:"flex justify-between items-center w-full"},Ht=["textContent"],Kt={key:0,class:"mt-[24px] flex flex-col gap-[12px]"},Yt={class:"w-full flex justify-center"},Jt={class:"space-y-3"},Qt={class:"flex justify-between items-center"},Zt=["textContent"],eo=1*1024*1024,to=Oe({__name:"NewNFTBook",props:{isNewClassPage:{type:Boolean,default:!1},classId:{type:String,default:""},editionIndex:{type:[String,Number],default:void 0},isEditMode:{type:Boolean,default:!1}},emits:["submit"],setup(p,{emit:A}){const{t:n}=Ge(),{LIKE_CO_API:H}=Xe().public,ie=He(),N=Ke(),K=wt(),{wallet:x}=G(ie),{newBookListing:re,updateEditionPrice:ue,uploadSignImages:ce}=N,{fetchStripeConnectStatusByWallet:de}=K,{getStripeConnectStatusByWallet:me}=G(K),{token:_e}=G(N),fe=Ct(),{getBalanceOf:pe}=Ut(),be=A,k=I(()=>V.editionIndex),{lazyFetchClassMetadataById:Y}=fe,b=c(""),_=c(!1),ge=c({en:"e.g.: This edition includes EPUB and PDF ebook files.",zh:"例：此版本包含 EPUB 及 PDF 電子書檔"}),g=I(()=>V.classId),ve=c(1),J=c(!1),C=c(!0),m=c([{price:-1,deliveryMethod:"auto",autoMemo:"",stock:100,name:n("prices.standard_edition"),description:"",isAllowCustomPrice:C.value,isListed:!0,enableCustomMessagePage:!1}]),he=I(()=>m.value.length>1),ye=c(["like1rclg677y2jqt8x4ylj0kjlqjjmnn6w63uflpgr"]),xe=c([]),ke=c(""),we=c(""),P=c(!1),S=c(""),W=c(!1),R=c(!0),D=c(null),Ce=c(Number(kt)),Me=c(0),Ue=c(0),Pe=c(0),Se=c(["bold","italic","strikeThrough","title","-","unorderedList","orderedList","-","code","link","=","preview"]),E=I(()=>V.isEditMode),Ee=I(()=>E.value?n("common.save"):n("common.submit")),$=c(!0);j(_,o=>{o&&(b.value="")},{immediate:!0}),ct({markdownItConfig(o){o.options.html=!1}});const V=p;Ye({title:()=>n("seo_titles.new_book_listing"),ogTitle:()=>n("seo_titles.new_book_listing")}),Je(async()=>{var o;try{_.value=!0;const e=x.value?await pe(g.value,x.value):0;if(Pe.value=Number(e)||0,E.value||k.value!==void 0){if(x.value)try{await de(x.value),me.value(x.value).isReady&&(P.value=!0,S.value=x.value)}catch(i){console.error(i)}const s=await $fetch(`${H}/likernft/book/store/${g.value}`,{headers:{authorization:`Bearer ${_e.value}`}});if(s){if((s==null?void 0:s.ownerWallet)!==x.value)throw new Error("NOT_OWNER_OF_NFT_CLASS");if(k.value!==void 0)if(s.prices.length){const i=s.prices.find(f=>f.index.toString()===k.value);if(!i)throw new Error("Edition not found");m.value=[{price:(o=i.price)==null?void 0:o.toString(),deliveryMethod:i.isAutoDeliver?"auto":"manual",autoMemo:i.autoMemo,stock:i.stock,name:i.name.zh,description:i.description.zh,isAllowCustomPrice:i.isAllowCustomPrice,isListed:!i.isUnlisted,oldIsAutoDeliver:i.isAutoDeliver,oldStock:i.stock,enableCustomMessagePage:i.enableCustomMessagePage||!1}],C.value=i.isAllowCustomPrice}else throw new Error("No prices found");else m.value[0].price=le;Me.value=s.prices.reduce((i,f)=>f.index.toString()!==k.value?i+f.stock:i,0),Ue.value=s.prices.reduce((i,f)=>f.index.toString()!==k.value&&!f.isAutoDeliver?i+f.stock:i,0)}else throw new Error(n("errors.nft_class_not_found"))}}catch(e){console.error(e)}finally{_.value=!1}}),j(C,o=>{m.value.forEach(e=>{e.isAllowCustomPrice=o})}),j(_,o=>{o&&(b.value="")}),j(g,async o=>{if(o){const e=await Y(o),s=e==null?void 0:e.contentFingerprints;s&&Ve(s)&&(J.value=!0)}},{immediate:!0});function Ve(o){const s=Mt().API_GET_ARWEAVE_V2_LINK;return o.some(i=>!!i.startsWith(s)||i.includes("?key="))}function Ie(o,e="signatureImage"){if(!(o!=null&&o.length))return;const s=o[0];if(s.type!=="image/png"){b.value=n("errors.png_only");return}if(s.size>eo){b.value=n("errors.file_size_limit");return}e==="signatureImage"?D.value=s:console.warn(`Unknown upload key: ${e}`)}function Ae(){ve.value+=1,m.value.push({index:bt(),price:le,deliveryMethod:"auto",autoMemo:"",stock:100,name:"增訂版",description:"",isAllowCustomPrice:!0,isListed:!0,enableCustomMessagePage:!1})}function Ne(o){m.value.splice(o,1)}function De(o){S.value=o,W.value=!0}function L(o){return o.map(e=>({name:{en:F(e.name),zh:F(e.name)},description:{en:F(e.description),zh:F(e.description)},priceInDecimal:Math.round(Number(e.price)*100),price:Number(e.price),stock:e.deliveryMethod==="auto"?0:Number(e.stock),isAutoDeliver:e.deliveryMethod==="auto",isAllowCustomPrice:e.isAllowCustomPrice,isUnlisted:!e.isListed,autoMemo:e.deliveryMethod==="auto"&&e.autoMemo||"",enableCustomMessagePage:e.enableCustomMessagePage||!1}))}function $e(o){const e=[];return o.forEach(s=>{s.price!==0&&s.price<se&&e.push({path:"price",message:n("errors.price_validation",{minPrice:se})}),(!s.name.en||!s.name.zh)&&e.push({path:"name",message:n("errors.product_name_required")})}),e.length>0?(b.value=e.map(s=>s.message).join(`
`),!1):!0}async function Le(){try{const o=L(m.value);if(!$e(o))return;if(E.value?await Te():V.isNewClassPage?await Q():(await fetch(`${H}/likernft/book/store/${g.value}`)).ok?await Be():await Q(),D.value){const e=new FormData;D.value&&e.append("signImage",D.value),await ce(e,g.value)}be("submit")}catch{}}async function Q(){try{if(!g.value)throw new Error(n("errors.nft_class_id_required"));if(ke.value)throw new Error(n("errors.add_moderator_wallet"));if(we.value)throw new Error(n("errors.add_notification_email"));_.value=!0;const o=await Y(g.value),e=(o==null?void 0:o.nft_meta_collection_id)||"";if(!e.includes("nft_book")&&!e.includes("book_nft"))throw new Error(n("errors.not_nft_book_collection"));const s=L(m.value),i=P.value&&S.value?{[S.value]:100}:null,f=m.value.some(v=>v.enableCustomMessagePage);await re(g.value,{defaultPaymentCurrency:"USD",connectedWallets:i,moderatorWallets:ye.value,notificationEmails:xe.value,prices:s,mustClaimToView:!0,enableCustomMessagePage:f,hideDownload:J.value})}catch(o){const e=o.data||o;console.error(e),b.value=e}finally{W.value=!1,_.value=!1}}async function Te(){try{if(!E.value)throw new Error(n("errors.missing_edition_data"));const e=L(m.value)[0];_.value=!0,await ue(g.value,k.value,{price:e})}catch(o){const e=o.data||o;console.error(e),b.value=e}finally{_.value=!1}}async function Be(){try{_.value=!0;const e=L(m.value)[0];await N.addEditionPrice(g.value.toString(),(k.value||0).toString(),{price:e})}catch(o){console.error(o)}finally{_.value=!1}}function je(o){const e=m.value[o];e.deliveryMethod="manual",e.enableCustomMessagePage=!0}return(o,e)=>{const s=Qe,i=rt,f=dt,v=gt,Z=vt,q=ot,ee=tt,T=ht,te=yt,ze=_t,O=et,B=nt,Fe=pt,We=at,Re=lt,qe=st;return h(),U("div",St,[t(b)?(h(),z(s,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${t(b)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:e[0]||(e[0]=l=>b.value="")},null,8,["title"])):w("",!0),t(N).isAuthenticated?(h(),U(oe,{key:1},[r("ul",Et,[a(O,{ui:{body:{base:"space-y-5 relative"},base:"overflow-visible border-none !border-transparent"}},{default:d(()=>[(h(!0),U(oe,null,Ze(t(m),(l,M)=>(h(),U("li",{key:l.index},[a(O,{ui:{body:{base:"flex flex-col gap-[20px]"},base:"overflow-visible border-[4px]"}},{header:d(()=>[r("div",Vt,[r("h3",{class:"font-bold font-mono",textContent:y(`${t(n)("nft_book_form.edition_number",{number:M+1})} - ${l.name||t(n)("nft_book_form.product_name_placeholder")}`)},null,8,It),r("div",At,[r("p",{class:"text-sm",textContent:y(t(n)("nft_book_form.pause_selling"))},null,8,Nt),a(i,{modelValue:l.isListed,"onUpdate:modelValue":u=>l.isListed=u},null,8,["modelValue","onUpdate:modelValue"]),r("p",{class:"text-sm",textContent:y(t(n)("nft_book_form.selling"))},null,8,Dt)])])]),default:d(()=>[a(v,{label:t(n)("nft_book_form.unit_price_label")},{default:d(()=>[a(f,{modelValue:l.price,"onUpdate:modelValue":u=>l.price=u,options:t(xt),"value-attribute":"value"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:2},1032,["label"]),a(v,{label:t(n)("nft_book_form.copies_label")},{default:d(()=>[r("div",$t,[r("div",{class:ne(["border-2 rounded-lg p-4 cursor-pointer transition-all duration-200",l.deliveryMethod==="auto"?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"]),onClick:u=>l.deliveryMethod="auto"},[a(Z,{modelValue:l.deliveryMethod,"onUpdate:modelValue":u=>l.deliveryMethod=u,value:"auto",name:`deliveryMethod-${M}`,label:t(n)("nft_book_form.unlimited")},null,8,["modelValue","onUpdate:modelValue","name","label"])],10,Lt),r("div",{class:ne(["border-2 rounded-lg p-4 cursor-pointer transition-all duration-200",l.deliveryMethod==="manual"?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"]),onClick:u=>je(M)},[r("div",Bt,[a(Z,{modelValue:l.deliveryMethod,"onUpdate:modelValue":u=>l.deliveryMethod=u,value:"manual",name:`deliveryMethod-${M}`,label:t(n)("nft_book_form.limited")},null,8,["modelValue","onUpdate:modelValue","name","label"]),a(ee,{text:t(n)("nft_book_form.manual_delivery_tooltip")},{default:d(()=>[a(q,{name:"i-heroicons-question-mark-circle"})]),_:1},8,["text"])]),r("div",jt,[a(v,{label:t(n)("nft_book_form.stock")},{default:d(()=>[a(T,{modelValue:l.stock,"onUpdate:modelValue":u=>l.stock=u,type:"number",step:"1",min:1,max:t(Ce),placeholder:"100"},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1032,["label"])])],10,Tt)])]),_:2},1032,["label"]),a(v,{label:t(n)("nft_book_form.enable_custom_message_page")},{default:d(()=>[r("div",zt,[a(te,{modelValue:l.enableCustomMessagePage,"onUpdate:modelValue":u=>l.enableCustomMessagePage=u,label:t(n)("nft_book_form.add_custom_message_page")},null,8,["modelValue","onUpdate:modelValue","label"]),l.enableCustomMessagePage?(h(),U("div",Ft,[a(v,{label:t(n)("nft_book_form.auto_delivery_memo")},{default:d(()=>[a(T,{modelValue:l.autoMemo,"onUpdate:modelValue":u=>l.autoMemo=u,placeholder:t(n)("nft_book_form.memo_placeholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"]),a(v,{ui:{label:{base:"w-full flex justify-between items-center"}}},{label:d(()=>[r("p",{class:"block",textContent:y(t(n)("nft_book_form.autograph_image"))},null,8,Wt),r("span",{class:"text-gray-500 text-[12px] block",textContent:y(t(n)("nft_book_form.image_requirements"))},null,8,Rt)]),default:d(()=>[a(T,{type:"file",accept:"image/png",onChange:e[1]||(e[1]=u=>Ie(u,"signatureImage"))})]),_:1})])):w("",!0)])]),_:2},1032,["label"]),a(v,{ui:{container:"space-y-2"}},{label:d(()=>[ae(y(t(n)("nft_book_form.product_name"))+" ",1),a(ze,{"image-style":{width:"250px"}},{image:d(()=>e[6]||(e[6]=[r("img",{src:ft,class:"object-cover",alt:""},null,-1)])),default:d(()=>[a(q,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:d(()=>[a(T,{modelValue:l.name,"onUpdate:modelValue":u=>l.name=u,placeholder:t(n)("nft_book_form.product_name_placeholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),r("span",{class:"block text-[14px] text-[#374151] mt-[8px]",textContent:y(t(n)("nft_book_form.description_optional"))},null,8,qt),a(t(mt),{modelValue:l.description,"onUpdate:modelValue":u=>l.description=u,language:"en-US","editor-id":`en-${M}`,placeholder:t(ge).en,toolbars:t(Se),sanitize:t(Pt),style:{height:"200px",width:"100%",marginTop:"0px"}},null,8,["modelValue","onUpdate:modelValue","editor-id","placeholder","toolbars","sanitize"])]),_:2},1024)]),_:2},1024),r("div",Ot,[t(he)?(h(),z(B,{key:0,label:t(n)("common.delete"),color:"gray","leading-icon":"i-heroicons-trash",onClick:u=>Ne(M)},null,8,["label","onClick"])):w("",!0)])]))),128))]),_:1})]),r("div",Gt,[V.isNewClassPage&&t(m).length<2?(h(),z(B,{key:0,ui:{rounded:"rounded-full"},color:"gray",icon:"i-heroicons-plus-solid",label:t(n)("nft_book_form.add_edition"),onClick:Ae},null,8,["label"])):w("",!0)]),a(O,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"12px"}}},{default:d(()=>[r("div",Xt,[r("h3",{class:"font-bold font-mono",textContent:y(t(n)("nft_book_form.settings"))},null,8,Ht),a(B,{color:"gray",variant:"ghost",icon:t($)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",onClick:e[2]||(e[2]=()=>{$.value=!t($)})},null,8,["icon"])]),t($)?(h(),U("div",Kt,[a(v,{class:"flex items-center"},{default:d(()=>[a(ee,{class:"flex items-center gap-2",text:t(n)("nft_book_form.accept_tipping_tooltip")},{default:d(()=>[a(te,{modelValue:t(C),"onUpdate:modelValue":e[3]||(e[3]=l=>X(C)?C.value=l:null),name:"isAllowCustomPrice",label:t(n)("nft_book_form.accept_tipping")},null,8,["modelValue","label"]),a(q,{name:"i-heroicons-question-mark-circle"})]),_:1},8,["text"])]),_:1}),t(E)?(h(),z(Fe,{key:0,"is-stripe-connect-checked":t(P),"onUpdate:isStripeConnectChecked":e[4]||(e[4]=l=>X(P)?P.value=l:null),"is-using-default-account":t(R),"onUpdate:isUsingDefaultAccount":e[5]||(e[5]=l=>X(R)?R.value=l:null),"stripe-connect-wallet":t(S),"should-disable-setting":t(W),"login-address":t(x),onSave:De},null,8,["is-stripe-connect-checked","is-using-default-account","stripe-connect-wallet","should-disable-setting","login-address"])):w("",!0)])):w("",!0)]),_:1}),r("div",Yt,[a(B,{label:t(Ee),loading:t(_),size:"lg",disabled:t(_),onClick:Le},null,8,["label","loading","disabled"])])],64)):w("",!0),a(qe,{"model-value":!!t(_),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:d(()=>[r("div",Jt,[r("div",Qt,[a(We,{variant:"soft"},{default:d(()=>[ae(y(t(n)("common.loading")),1)]),_:1}),r("p",{class:"text-xs text-gray-500",textContent:y(t(n)("nft_book_form.loading_progress_text"))},null,8,Zt)]),a(Re,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),po=it(to,[["__scopeId","data-v-9096cb05"]]);export{po as _};
