import{_ as ee}from"./UvuWqIKb.js";import{_ as te}from"./BGIFM7r1.js";import{a_ as ae,b6 as oe,b7 as le,bk as ne,bn as se,bm as re,b0 as ue,b8 as n,b9 as k,ba as D,b1 as ie,b3 as C,aX as l,aT as I,aU as L,aW as a,br as O,aV as q,b4 as o,bf as w,by as ce,aY as V,bt as de,bg as me,bT as fe,cv as pe,cw as _e,b2 as be}from"./Dq4rT-N9.js";import{_ as ve}from"./CmdfCXs7.js";import{_ as ge}from"./B4gIQhUf.js";import{_ as ye}from"./B1WyV98J.js";import{_ as ke}from"./CxQjuV1Y.js";import{p as $e}from"./CUxdmJDi.js";import{u as he}from"./BMBfczuj.js";import"./DUA9JB9s.js";import"./CcViUbx4.js";import"./u5jSbuzZ.js";(function(){try{var c=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},p=new c.Error().stack;p&&(c._sentryDebugIds=c._sentryDebugIds||{},c._sentryDebugIds[p]="c0f14668-488f-4ce1-af67-90c5b544ade5",c._sentryDebugIdIdentifier="sentry-dbid-c0f14668-488f-4ce1-af67-90c5b544ade5")}catch{}})();const we={class:"text-lg font-bold font-mono"},De=ae({__name:"[classId]",setup(c){const{LIKE_CO_API:p}=oe().public,N=le(),T=ne(),{token:U}=se(T),B=he(),{lazyFetchClassMetadataById:z}=B,G=re(),M=ue(),_=n(""),d=n(!1),m=n(G.params.classId),x=n({}),S=n([]),f=n(0),E=k(()=>{var e;return(e=x.value.prices)==null?void 0:e.map((t,r)=>({label:`${t.name.en||t.name} - $${t.price}`,value:r,disabled:r===f.value}))}),b=n(""),v=n(""),g=n(""),R=k(()=>!!b.value&&!!v.value&&!!g.value&&!!y.value.length),y=n([]),F=k(()=>{var e;return((e=y.value)==null?void 0:e.length)||0}),P=k(()=>{var e;return(e=B.getClassMetadataById(m.value))==null?void 0:e.name});D(d,e=>{e&&(_.value="")});const K=["wallet","email","toName","message"],W=k(()=>[{label:"Email (required)",key:"email"},{label:"Wallet (optional)",key:"wallet"},{label:"Recipient name (optional)",key:"toName"},{label:"Message (optional)",key:"message"}]);ie(async()=>{d.value=!0;try{const e=await $fetch(`${p}/likernft/book/store/${m.value}`,{headers:{authorization:`Bearer ${U.value}`}});x.value=e,S.value=x.value.prices,z(m.value)}catch(e){console.error(e),_.value=e.toString()}finally{d.value=!1}}),D(_,e=>{e&&N.add({icon:"i-heroicons-exclamation-circle",title:e,timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}})});function H(){pe(_e([K.reduce((e,t)=>(e[t]="",e),{})],{header:!0}),"gift_list.csv","text/csv;charset=utf-8;")}function X(e){if(!e)return;const[t]=e,r=new FileReader;r.onload=u=>{var $;try{const s=($=u.target)==null?void 0:$.result;if(typeof s!="string")return;const h=$e(s,{columns:!0});y.value=h}catch(s){console.error(s),_.value=s.toString()}},r.readAsText(t)}async function Y(){if(R.value)try{if(d.value=!0,S.value[f.value].stock<=F.value)throw new Error("NOT_ENOUGH_STOCK");await $fetch(`${p}/likernft/book/store/class/${m.value}/price/${f.value}/gift`,{method:"POST",body:{receivers:y.value,giftInfo:{toName:b.value,fromName:v.value,message:g.value}},headers:{authorization:`Bearer ${U.value}`}}),await be(M({name:"my-books-status-classId",params:{classId:m.value}}))}catch(e){console.error(e),_.value=e.toString()}finally{d.value=!1}}return(e,t)=>{const r=ee,u=te,$=ce,s=ve,h=me,j=ge,J=fe,Q=ye,A=de,Z=ke;return I(),C(Z,null,{default:l(()=>[L("h1",we,' Gift NFT Book "'+q(o(P)||o(m))+'" ',1),a(u,{label:"Gift edition",required:!0},{default:l(()=>[a(r,{modelValue:o(f),"onUpdate:modelValue":t[0]||(t[0]=i=>w(f)?f.value=i:null),options:o(E)},null,8,["modelValue","options"])]),_:1}),o(d)?(I(),C($,{key:0,animation:"carousel"},{indicator:l(()=>t[4]||(t[4]=[V(" Loading... ")])),_:1})):O("",!0),o(T).isAuthenticated?(I(),C(A,{key:1,ui:{body:{base:"space-y-4"},footer:{base:"flex justify-center gap-2"}}},{footer:l(()=>[a(h,{label:"Confirm",disabled:!o(R),size:"xl",onClick:Y},null,8,["disabled"])]),default:l(()=>[a(u,{label:e.$t("gift.default_recipient_name"),required:!0},{default:l(()=>[a(s,{modelValue:o(b),"onUpdate:modelValue":t[1]||(t[1]=i=>w(b)?b.value=i:null),placeholder:e.$t("gift.fellow_reader")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(u,{label:e.$t("gift.default_gift_message"),required:!0},{default:l(()=>[a(s,{modelValue:o(g),"onUpdate:modelValue":t[2]||(t[2]=i=>w(g)?g.value=i:null),placeholder:e.$t("gift.thank_you_support")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(u,{label:e.$t("gift.gift_giver_name"),required:!0},{default:l(()=>[a(s,{modelValue:o(v),"onUpdate:modelValue":t[3]||(t[3]=i=>w(v)?v.value=i:null),placeholder:e.$t("gift.your_name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(u,null,{label:l(()=>[V(q(e.$t("gift.upload_recipient_list"))+" (",1),a(h,{label:e.$t("gift.download_csv_template"),variant:"link",padded:!1,size:"xs",onClick:H},null,8,["label"]),t[5]||(t[5]=V(") "))]),default:l(()=>[a(j,{class:"mt-1",type:"file",accept:".csv",onChange:X})]),_:1}),a(A,{ui:{header:{base:"flex gap-4 items-center"},body:{padding:""}}},{header:l(()=>[t[6]||(t[6]=L("h2",{class:"text-lg font-bold font-mono"}," Recipients ",-1)),a(J,{label:`${o(F)}`,ui:{rounded:"rounded-full"}},null,8,["label"])]),default:l(()=>[a(Q,{columns:o(W),rows:o(y)},null,8,["columns","rows"])]),_:1})]),_:1})):O("",!0)]),_:1})}}});export{De as default};
