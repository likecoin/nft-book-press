import{_ as le}from"./PZnptNIo.js";import{n as re,O as ie,P as ce,Q as ue,I as me,u as de,R as I,r,s as l,v as fe,x as _e,h as pe,o as i,A as p,w as s,S as ke,T as be,U as ye,y as ve,b as c,B as a,J as P,d as x,t as E,a as q,C as K,c as ge,V as C,W as he,X as we,Y as Se,M as Le,G as Ie}from"./CXvzJBqc.js";import{_ as xe}from"./CE2iqjx2.js";import{_ as Ce}from"./Bl9mAokz.js";import{_ as Be}from"./CcEgir4l.js";import{_ as Ue}from"./CwmTlS9R.js";import{u as Re}from"./BsrrKtEN.js";import{u as $e}from"./BNze_SQn.js";import"./B6tRnKpl.js";import"./DgMIOc01.js";(function(){try{var u=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},m=new Error().stack;m&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[m]="0160f2d6-e068-4aec-9e93-95df1d9704e9",u._sentryDebugIdIdentifier="sentry-dbid-0160f2d6-e068-4aec-9e93-95df1d9704e9")}catch{}})();const Ae={class:"flex px-3 py-3.5 border-b border-gray-200"},Te=["src","alt"],Ne=["textContent"],Fe=re({__name:"latest-books",setup(u){const{LIKER_LAND_URL:m,LIKE_CO_API:B}=ie().public,M=Re(),O=$e(),W=ce(),j=ue(),F=me(),J=de(),{wallet:U}=I(j),{userLikerInfo:R}=I(M),{isAuthenticated:w}=I(W),$=[{label:"Latest Releases",key:"latest"},{label:"Best Sellers",key:"bestselling"}],d=r(""),k=r(!1),A=r([]),T=r([]),b=r(0),f=r(J.query.q||""),S=l(()=>{var e,t;return(e=R.value)!=null&&e.user?ke((t=R.value)==null?void 0:t.user):""}),L=l(()=>k.value&&S.value),z=l(()=>[{key:"image",label:"Cover",sortable:!1},{key:"className",label:"Book Name",sortable:!0},{key:"author",label:"Author",sortable:!0},{key:"priceInUSD",label:"Price",sortable:!0},{key:"url",label:L.value?"Affiliation Link":"Link",sortable:!1}]),N=l(()=>$[b.value].key),G=l(()=>N.value==="latest"?A.value:T.value),V=l(()=>G.value.map(e=>{var v,_,g;const t=e.name||e.title,n=e.thumbnailUrl||e.imageUrl,y=((v=e.author)==null?void 0:v.name)||e.author;return{className:t,image:n?be(ye(n)):void 0,author:y,priceInUSD:`US$${e.minPrice||((g=(_=e.prices)==null?void 0:_[0])==null?void 0:g.price)||0}`,url:`${m}/nft/class/${e.classId}?from=${S.value}&utm_source=bookpress&utm_medium=list_${N.value}`}})),H=l(()=>{if(!f.value)return V.value;const e=f.value.toLowerCase();return V.value.filter(t=>[t.className,t.author].some(n=>n&&n.toLowerCase().includes(e)))});fe({title:"Latest Books",ogTitle:"Latest Books"}),_e(async()=>{if(await Promise.all([Q().catch(e=>{d.value=e}),X().catch(e=>{d.value=e})]),w.value)try{await D()}catch(e){console.error(e)}});async function Q(){const e=await $fetch(`${B}/likernft/book/store/list?limit=100`);A.value=(e==null?void 0:e.list)||[]}async function X(){const e=await $fetch(`${m}/api/bookstore/products?tag=bestselling`);T.value=(e==null?void 0:e.records)||[]}async function D(){if(!U.value){k.value=!1;return}try{const e=await O.fetchStripeConnectStatusByWallet(U.value);k.value=e==null?void 0:e.isReady}catch(e){console.error(e),k.value=!1}}function Y(){C("latest_books_click_affiliation_setup"),F.push({name:"nft-book-store-user"})}function Z(e){C("latest_books_click_table_row"),window.open(e.url,"_blank")}function ee(e,t){e.stopPropagation(),C("latest_books_click_copy_button"),he(t)}return pe(w,()=>{w.value&&ve(()=>{D()})}),(e,t)=>{const n=le,y=we,v=Se,_=Le,g=xe,te=Ie,oe=Ce,ae=Be,se=Ue;return i(),p(se,null,{default:s(()=>[c(n,{title:"Latest Books on Liker Land Bookstore"}),a(d)?(i(),p(y,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${a(d)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:t[0]||(t[0]=h=>d.value="")},null,8,["title"])):P("",!0),a(L)?(i(),p(_,{key:2},{default:s(()=>[t[3]||(t[3]=x(" Append ")),c(v,{class:"font-mono"},{default:s(()=>[x(" ?from="+E(a(S)),1)]),_:1}),t[4]||(t[4]=x(" in any bookstore page to earn commission from book sales. "))]),_:1})):(i(),p(y,{key:1,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"soft",title:"Join Our Affiliation Program!",description:"Setup your Liker ID and Stripe Connect Account to participate in sales affiliation program on Liker Land Bookstore.",actions:[{label:"Setup",color:"orange",variant:"outline",click:Y}]},null,8,["actions"])),c(ae,{modelValue:a(b),"onUpdate:modelValue":t[2]||(t[2]=h=>K(b)?b.value=h:null),class:"w-full",items:$},{item:s(({item:h})=>[(i(),p(_,{key:h.key,ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{default:s(()=>[q("div",Ae,[c(g,{modelValue:a(f),"onUpdate:modelValue":t[1]||(t[1]=o=>K(f)?f.value=o:null),placeholder:"Filter books by name or author"},null,8,["modelValue"])]),c(oe,{columns:a(z),rows:a(H),onSelect:Z},{"image-data":s(({row:o})=>[o.image?(i(),ge("img",{key:0,src:o.image,alt:o.className,class:"w-12 h-12 object-cover rounded-lg"},null,8,Te)):P("",!0)]),"className-data":s(({row:o})=>[q("div",{class:"max-w-[20vw] whitespace-normal",textContent:E(o.className)},null,8,Ne)]),"url-data":s(({row:o})=>[c(te,{label:"Copy",disabled:!a(L),onClick:ne=>ee(ne,o.url)},null,8,["disabled","onClick"])]),_:1},8,["columns","rows"])]),_:2},1024))]),_:1},8,["modelValue"])]),_:1})}}});export{Fe as default};
//# sourceMappingURL=D5MMVMwS.js.map
