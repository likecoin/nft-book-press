import{d$ as F,e0 as S,e1 as J,e2 as j,e3 as L,e4 as q,e5 as P,e6 as Q,dB as k,e7 as V,e8 as Y,e9 as A,ea as z,eb as K,dH as R,dJ as U,dN as X,ec as Z,dP as W,dQ as tt,dR as et}from"./WyIghNlr.js";import{e as nt}from"./BHv8MdEE.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},n=new Error().stack;n&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[n]="0b5b9a42-87e1-4781-a846-da7eb26e13f5",t._sentryDebugIdIdentifier="sentry-dbid-0b5b9a42-87e1-4781-a846-da7eb26e13f5")}catch{}})();const rt=new Map,at=new Map;function ot(t){const n=(r,a)=>({clear:()=>a.delete(r),get:()=>a.get(r),set:c=>a.set(r,c)}),e=n(t,rt),o=n(t,at);return{clear:()=>{e.clear(),o.clear()},promise:e,response:o}}async function st(t,{cacheKey:n,cacheTime:e=Number.POSITIVE_INFINITY}){const o=ot(n),r=o.response.get();if(r&&e>0&&new Date().getTime()-r.created.getTime()<e)return r.data;let a=o.promise.get();a||(a=t(),o.promise.set(a));try{const c=await a;return o.response.set({created:new Date,data:c}),c}finally{o.promise.clear()}}const ct=t=>`blockNumber.${t}`;async function it(t,{cacheTime:n=t.cacheTime}={}){const e=await st(()=>t.request({method:"eth_blockNumber"}),{cacheKey:ct(t.uid),cacheTime:n});return BigInt(e)}async function E(t,{blockHash:n,blockNumber:e,blockTag:o,hash:r,index:a}){var p,s,u;const c=o||"latest",f=e!==void 0?F(e):void 0;let i=null;if(r?i=await t.request({method:"eth_getTransactionByHash",params:[r]},{dedupe:!0}):n?i=await t.request({method:"eth_getTransactionByBlockHashAndIndex",params:[n,F(a)]},{dedupe:!0}):(f||c)&&(i=await t.request({method:"eth_getTransactionByBlockNumberAndIndex",params:[f||c,F(a)]},{dedupe:!!f})),!i)throw new S({blockHash:n,blockNumber:e,blockTag:c,hash:r,index:a});return(((u=(s=(p=t.chain)==null?void 0:p.formatters)==null?void 0:s.transaction)==null?void 0:u.format)||J)(i)}async function D(t,{hash:n}){var r,a,c;const e=await t.request({method:"eth_getTransactionReceipt",params:[n]},{dedupe:!0});if(!e)throw new j({hash:n});return(((c=(a=(r=t.chain)==null?void 0:r.formatters)==null?void 0:a.transactionReceipt)==null?void 0:c.format)||L)(e)}const x=new Map,H=new Map;let ut=0;function $(t,n,e){const o=++ut,r=()=>x.get(t)||[],a=()=>{const p=r();x.set(t,p.filter(s=>s.id!==o))},c=()=>{const p=r();if(!p.some(u=>u.id===o))return;const s=H.get(t);p.length===1&&s&&s(),a()},f=r();if(x.set(t,[...f,{id:o,fns:n}]),f&&f.length>0)return c;const i={};for(const p in n)i[p]=(...s)=>{var g,d;const u=r();if(u.length!==0)for(const w of u)(d=(g=w.fns)[p])==null||d.call(g,...s)};const l=e(i);return typeof l=="function"&&H.set(t,l),c}function lt(t,{emitOnBegin:n,initialWaitTime:e,interval:o}){let r=!0;const a=()=>r=!1;return(async()=>{let f;n&&(f=await t({unpoll:a}));const i=await(e==null?void 0:e(f))??o;await q(i);const l=async()=>{r&&(await t({unpoll:a}),await q(o),l())};l()})(),a}function ft(t,{emitOnBegin:n=!1,emitMissed:e=!1,onBlockNumber:o,onError:r,poll:a,pollingInterval:c=t.pollingInterval}){const f=typeof a<"u"?a:!(t.transport.type==="webSocket"||t.transport.type==="fallback"&&t.transport.transports[0].config.type==="webSocket");let i;return f?(()=>{const s=P(["watchBlockNumber",t.uid,n,e,c]);return $(s,{onBlockNumber:o,onError:r},u=>lt(async()=>{var g;try{const d=await k(t,it,"getBlockNumber")({cacheTime:0});if(i){if(d===i)return;if(d-i>1&&e)for(let w=i+1n;w<d;w++)u.onBlockNumber(w,i),i=w}(!i||d>i)&&(u.onBlockNumber(d,i),i=d)}catch(d){(g=u.onError)==null||g.call(u,d)}},{emitOnBegin:n,interval:c}))})():(()=>{const s=P(["watchBlockNumber",t.uid,n,e]);return $(s,{onBlockNumber:o,onError:r},u=>{let g=!0,d=()=>g=!1;return(async()=>{try{const w=(()=>{if(t.transport.type==="fallback"){const m=t.transport.transports.find(b=>b.config.type==="webSocket");return m?m.value:t.transport}return t.transport})(),{unsubscribe:I}=await w.subscribe({params:["newHeads"],onData(m){var C;if(!g)return;const b=Q((C=m.result)==null?void 0:C.number);u.onBlockNumber(b,i),i=b},onError(m){var b;(b=u.onError)==null||b.call(u,m)}});d=I,g||d()}catch(w){r==null||r(w)}})(),()=>d()})})()}async function pt(t,{confirmations:n=1,hash:e,onReplaced:o,pollingInterval:r=t.pollingInterval,retryCount:a=6,retryDelay:c=({count:i})=>~~(1<<i)*200,timeout:f=18e4}){const i=P(["waitForTransactionReceipt",t.uid,e]);let l,p,s,u=!1;const{promise:g,resolve:d,reject:w}=V(),I=f?setTimeout(()=>w(new Y({hash:e})),f):void 0,m=$(i,{onReplaced:o,resolve:d,reject:w},b=>{const C=k(t,ft,"watchBlockNumber")({emitMissed:!0,emitOnBegin:!0,poll:!0,pollingInterval:r,async onBlockNumber(G){const N=B=>{clearTimeout(I),C(),B(),m()};let T=G;if(!u)try{if(s){if(n>1&&(!s.blockNumber||T-s.blockNumber+1n<n))return;N(()=>b.resolve(s));return}if(l||(u=!0,await A(async()=>{l=await k(t,E,"getTransaction")({hash:e}),l.blockNumber&&(T=l.blockNumber)},{delay:c,retryCount:a}),u=!1),s=await k(t,D,"getTransactionReceipt")({hash:e}),n>1&&(!s.blockNumber||T-s.blockNumber+1n<n))return;N(()=>b.resolve(s))}catch(B){if(B instanceof S||B instanceof j){if(!l){u=!1;return}try{p=l,u=!0;const _=await A(()=>k(t,z,"getBlock")({blockNumber:T,includeTransactions:!0}),{delay:c,retryCount:a,shouldRetry:({error:h})=>h instanceof K});u=!1;const y=_.transactions.find(({from:h,nonce:O})=>h===p.from&&O===p.nonce);if(!y||(s=await k(t,D,"getTransactionReceipt")({hash:y.hash}),n>1&&(!s.blockNumber||T-s.blockNumber+1n<n)))return;let v="replaced";y.to===p.to&&y.value===p.value&&y.input===p.input?v="repriced":y.from===y.to&&y.value===0n&&(v="cancelled"),N(()=>{var h;(h=b.onReplaced)==null||h.call(b,{reason:v,replacedTransaction:p,transaction:y,transactionReceipt:s}),b.resolve(s)})}catch(_){N(()=>b.reject(_))}}else N(()=>b.reject(B))}}})});return g}async function M(t,n){const{chainId:e,timeout:o=0,...r}=n,a=t.getClient({chainId:e}),f=await R(a,pt,"waitForTransactionReceipt")({...r,timeout:o});if(f.status==="reverted"){const l=await R(a,E,"getTransaction")({hash:f.transactionHash}),s=await R(a,nt,"call")({...l,data:l.input,gasPrice:l.type!=="eip1559"?l.gasPrice:void 0,maxFeePerGas:l.type==="eip1559"?l.maxFeePerGas:void 0,maxPriorityFeePerGas:l.type==="eip1559"?l.maxPriorityFeePerGas:void 0}),u=s!=null&&s.data?U(`0x${s.data.substring(138)}`):"unknown reason";throw new Error(u)}return{...f,chainId:a.chain.id}}async function dt(t,n){const{account:e,chainId:o,connector:r,...a}=n;let c;return typeof e=="object"&&(e==null?void 0:e.type)==="local"?c=t.getClient({chainId:o}):c=await X(t,{account:e??void 0,chainId:o,connector:r}),await R(c,Z,"writeContract")({...a,...e?{account:e}:{},chain:o?{id:o}:null})}function bt(t){return{mutationFn(n){return dt(t,n)},mutationKey:["writeContract"]}}function yt(t={}){const{mutation:n}=t,e=W(t),o=bt(e),{mutate:r,mutateAsync:a,...c}=tt({...n,...o});return{...c,writeContract:r,writeContractAsync:a}}async function mt(t,n){let e;try{e=await M(t,n)}catch{await et(3e3),e=await M(t,n)}return e}export{M as a,yt as u,mt as w};
//# sourceMappingURL=D9rvdW7R.js.map
