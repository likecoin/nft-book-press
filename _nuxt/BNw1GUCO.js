import{n as Y,Q as le,O as Z,R as ie,r as s,s as $,h as Q,x as re,dd as ye,o as f,c as U,b as l,B as n,C as ee,w as N,a as p,d as G,t as X,a5 as we,aa as Ne,af as Se,a1 as xe,H as Ce,_ as Fe,A as q,J as V,b5 as he,G as ue,M as ke,v as Te,X as Re,u as Ue,I as De,de as Me,df as Le,y as oe,D as Ee,F as $e,dg as Be,aT as Ve}from"./7W2dTFM9.js";import{u as ce,b as Ae,v as Oe,c as se,f as Pe,d as Ke,a as ze,_ as Ge,e as qe}from"./D_Iqgd0i.js";import{a as je,b as He,u as We}from"./BELORIs0.js";import{u as Je,a as Qe}from"./CT1Q1fXd.js";import{_ as Xe}from"./Cr9amE6a.js";import{_ as de}from"./q_AchKhl.js";import{_ as Ye}from"./CKhUHxvu.js";import{_ as Ze}from"./CiAUNY_4.js";import"./rd8ij3Ji.js";import"./CFvGhW1g.js";import"./DzQlvhXC.js";import"./DcCKZ0gr.js";import"./DA79aZ09.js";import"./Bj8pnEYy.js";import"./CbHf2xqi.js";import"./BEWBTp-T.js";import"./CiR6rCLI.js";import"./CWtRyVT2.js";import"./Ce3nixNH.js";import"./D4BM82id.js";import"./CD1bk2vG.js";import"./sSpWtsdi.js";import"./BgK8xkYH.js";(function(){try{var D=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},x=new Error().stack;x&&(D._sentryDebugIds=D._sentryDebugIds||{},D._sentryDebugIds[x]="e66bb2f4-3774-4e4a-a7c3-73d2059d2df2",D._sentryDebugIdIdentifier="sentry-dbid-e66bb2f4-3774-4e4a-a7c3-73d2059d2df2")}catch{}})();const et={class:"space-y-3"},tt={class:"flex justify-between items-center"},at=Y({__name:"RegisterISCN",emits:["handleSubmit","submit","formValidChange"],setup(D,{expose:x,emit:T}){const c=le(),{getFileType:R}=se(),{LIKE_EVM_NFT_TARGET_ADDRESS:C}=Z().public,{wallet:_,signer:S}=ie(c),{initIfNecessary:F}=c,{stripHtmlTags:a,formatLanguage:m}=se(),{showErrorToast:M}=ce(),w=s({type:"Book",title:"",description:"",isbn:"",publisher:"",publicationDate:"",author:{name:"",description:""},license:"All Rights Reserved",customLicense:"",contentFingerprints:[{url:""}],downloadableUrls:[{url:"",type:"",fileName:""}],language:"",bookInfoUrl:"",tags:[],coverUrl:""}),v=s(""),b=s(""),L=T,{payload:h}=Ae({iscnFormData:w}),{writeContractAsync:E}=Je(),A=$(()=>Oe(w.value)),O=$(()=>{var e;return!((e=A.value)!=null&&e.length)});Q(O,e=>{L("formValidChange",e)},{immediate:!0}),re(()=>{const e=K();e&&(w.value=e)});const K=()=>{var k,I,y,z,P,H;const e=ye();if(!e)return null;const d={type:"Book",title:((k=e.epubMetadata)==null?void 0:k.title)||"",description:a(((I=e.epubMetadata)==null?void 0:I.description)||""),isbn:"",publisher:"",publicationDate:new Date().toISOString().split("T")[0],author:{name:((y=e.epubMetadata)==null?void 0:y.author)||"",description:""},license:"All Rights Reserved",contentFingerprints:[],downloadableUrls:[],coverUrl:(z=e.epubMetadata)!=null&&z.thumbnailArweaveId?`ar://${e.epubMetadata.thumbnailArweaveId}`:"",language:m(((P=e.epubMetadata)==null?void 0:P.language)||"zh"),tags:((H=e.epubMetadata)==null?void 0:H.tags)||[]};return d.downloadableUrls=e.fileRecords.filter(u=>u.fileType==="application/pdf"||u.fileType==="application/epub+zip").map(u=>({url:u.arweaveKey?u.arweaveLink:`ar://${u.arweaveId}`,type:R(u.fileType),fileName:u.fileName})),d.contentFingerprints=[...new Set(e.fileRecords.map(u=>{const j=u.arweaveKey?u.arweaveLink:`ar://${u.arweaveId}`;return u.fileType==="application/epub+zip"||u.fileType==="application/pdf"?j:`ar://${u.arweaveId}`}).filter(Boolean))].map(u=>({url:u})),d},o=async()=>{if(v.value="checking",!O.value){M(A.value.join(", "));return}w.value.contentFingerprints.length&&await r()},r=async()=>{if(v.value="loading",await F(),!_.value||!S.value){b.value="MISSING_SIGNER",v.value="";return}try{v.value="signing";const e=Pe(h.value),d={name:e.name,description:e.description,...e,symbol:"BOOK",image:(e==null?void 0:e.thumbnailUrl)||"",external_link:(e==null?void 0:e.url)||"",nft_meta_collection_id:"nft_book",nft_meta_collection_name:"NFT Book",nft_meta_collection_description:"NFT Book by Liker Land",recordTimestamp:new Date().toISOString()},k=await E({address:je,abi:He,functionName:"newBookNFTWithRoyalty",args:[{creator:_.value,updaters:[_.value,C],minters:[_.value,C],config:{name:d.name,symbol:"BOOK",metadata:JSON.stringify(d),max_supply:we}},500]}),I=await Qe(Ne,{hash:k});if(console.log(I),!I||I.status!=="success")throw new Error("INVALID_RECEIPT");if(!I.logs[0].address)throw new Error("INVALID_CLASS_ID");const y=I.logs[0].address;v.value="success",L("submit",{iscnId:y,txHash:k})}catch(e){console.error(e),M(`'SIGNING_ERROR':${e}`),v.value=""}finally{v.value=""}};return x({onSubmit:o}),(e,d)=>{const k=Ke,I=Se,y=xe,z=Ce;return f(),U("div",null,[l(k,{modelValue:n(w),"onUpdate:modelValue":d[0]||(d[0]=P=>ee(w)?w.value=P:null)},null,8,["modelValue"]),l(z,{"model-value":!!n(v),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:N(()=>[p("div",et,[p("div",tt,[l(I,{color:"Badge",variant:"soft"},{default:N(()=>[G(X(n(v)),1)]),_:1}),d[1]||(d[1]=p("p",{class:"text-xs text-gray-500"}," 請勿關閉此視窗，直到 ISCN 註冊完成。 ",-1))]),l(y,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),nt=Fe(at,[["__scopeId","data-v-aa223f23"]]),ot=Y({__name:"ISCNInfoCard",props:{iscnId:{},iscnOwner:{},iscnData:{},showEditButton:{type:Boolean}},emits:["edit"],setup(D){const{APP_LIKE_CO_URL:x,LIKER_LAND_URL:T}=Z().public;return(c,R)=>{const C=ue,_=Xe,S=de,F=ke;return f(),q(F,{ui:{body:{base:"space-y-4"}}},{header:N(()=>R[1]||(R[1]=[p("h2",{class:"font-bold font-mono"}," ISCN Information ",-1)])),default:N(()=>[c.iscnId?(f(),q(_,{key:0,label:"ISCN ID",class:"text-left"},{default:N(()=>[l(C,{class:"font-mono",label:c.iscnId,to:`${n(x)}/view/${encodeURIComponent(c.iscnId)}`,target:"_blank",variant:"link",padded:!1},null,8,["label","to"])]),_:1})):V("",!0),l(_,{label:"Owner",class:"text-left"},{default:N(()=>[l(C,{label:c.iscnOwner,to:`${n(T)}/${encodeURIComponent(c.iscnOwner)}`,target:"_blank",variant:"link",padded:!1},null,8,["label","to"])]),_:1}),l(_,{label:"Title"},{default:N(()=>{var a,m;return[l(S,{value:(m=(a=c.iscnData)==null?void 0:a.contentMetadata)==null?void 0:m.name,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1}),l(_,{label:"Description"},{default:N(()=>{var a,m;return[l(S,{value:(m=(a=c.iscnData)==null?void 0:a.contentMetadata)==null?void 0:m.description,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1}),he(c.$slots,"actions",{},()=>[c.showEditButton?(f(),q(C,{key:0,label:"Edit ISCN Metadata",onClick:R[0]||(R[0]=a=>c.$emit("edit"))})):V("",!0)])]),_:3})}}}),st={class:"flex flex-col items-stretch grow space-y-4"},lt=Y({__name:"MintNFT",props:{iscnId:{type:String,default:""}},emits:["submit","formValidChange","loadingChange"],setup(D,{expose:x,emit:T}){const{getClassOwner:c,getClassMetadata:R,checkNFTClassIsBookNFT:C}=We(),_=s(1),S=s(""),F=s(!1),a=s(""),m=s(null),M=s(""),w=s(null),v=$(()=>{var o;return(o=m.value)==null?void 0:o["@id"]}),b=s(!1),L=s(!1),h=T;Q(F,o=>{h("loadingChange",o),o&&(S.value="")},{immediate:!0}),Q(L,o=>{h("formValidChange",o)},{immediate:!0}),Te({title:"Mint Liker Land NFT Book",ogTitle:"Mint Liker Land NFT Book"});const E=D;Q(()=>E.iscnId,async o=>{o&&await A(E.iscnId)},{immediate:!0});async function A(o){if(o)try{if(F.value=!0,o.startsWith("0x")){if(!await C(o))throw new Error("Invalid NFT Class ID");const[e,d]=await Promise.all([R(o),c(o)]);if(!e)throw new Error("Invalid NFT Class ID");m.value={contentMetadata:e,owner:d,"@id":o},a.value=d,M.value=o,_.value=3}}catch(r){console.error(r),S.value=r.toString()}finally{F.value=!1}}function O(){var o;(o=w.value)==null||o.startNFTMintFlow()}function K({classId:o,nftMintCount:r}={}){M.value=o||"",h("submit",{classId:o||"",nftMintCount:r})}return x({startNFTMintFlow:O}),(o,r)=>{const e=Re,d=ot,k=ze,I=Ge;return f(),U("div",st,[n(S)?(f(),q(e,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${n(S)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:r[0]||(r[0]=y=>S.value="")},null,8,["title"])):V("",!0),l(d,{"iscn-id":n(v),"iscn-owner":n(a),"iscn-data":n(m),"show-edit-button":!0,onEdit:r[1]||(r[1]=y=>b.value=!0)},null,8,["iscn-id","iscn-owner","iscn-data"]),l(k,{ref_key:"liteMintNFTRef",ref:w,"iscn-data":n(m),"should-show-submit":!1,onFormValidChange:r[2]||(r[2]=y=>L.value=y),onSubmit:K},null,8,["iscn-data"]),l(I,{modelValue:n(b),"onUpdate:modelValue":r[3]||(r[3]=y=>ee(b)?b.value=y:null),"class-id":n(M)},null,8,["modelValue","class-id"])])}}}),it={class:"w-full"},rt={class:"justify-evenly items-center flex space-x-4 relative"},ut={class:"text-sm font-semibold"},ct={class:"mt-6 p-4 border rounded-lg bg-gray-100 text-center flex flex-col gap-[24px]"},dt={key:0},pt={key:1},mt={key:2},ft={key:3},_t={class:"flex gap-2 justify-center mt-4"},vt={key:0,class:"flex flex-col justify-center px-[12px] mt-[16px]"},gt={class:"flex flex-col items-center gap-4 py-4"},bt={class:"flex flex-col items-center"},It={key:0},yt={class:"flex items-center"},wt={key:0,class:"flex flex-col items-center gap-2 w-full max-w-md"},Nt=["href"],jt=Y({__name:"index",setup(D){var ae,ne;const x=le(),{wallet:T,signer:c}=ie(x),{initIfNecessary:R}=x,C=Ue(),_=De(),{APP_LIKE_CO_URL:S}=Z().public,{showErrorToast:F}=ce(),a=s(0),m=s(),M=s(),w=s(),v=s(!1),b=s(""),L=s(""),h=s(((ae=C.query.iscn_id)==null?void 0:ae.toString())||""),E=s(((ne=C.query.class_id)==null?void 0:ne.toString())||""),A=s([]),O=s(""),K=s(!1),o=s(!1),r=s(!1),e=$(()=>!!L.value),d=$(()=>{switch(a.value){case 0:return"Start Upload";case 1:return"Register ISCN";case 2:return"Mint NFT";default:return"Next"}}),k=$(()=>{var i;return((i=A.value)==null?void 0:i.length)>0}),I=$(()=>a.value===0?k.value:a.value<3),y=$(()=>a.value===0?O.value!=="":a.value===2?r.value:!1),z=$(()=>`${S}/search?owner=${T.value}`),P=[{title:"上傳檔案",description:"Upload your book file"},{title:"註冊 ISCN",description:"Register ISCN"},{title:"鑄造區塊鏈書",description:"Mint NFT"},{title:"新書發佈",description:"Publish new book"}];re(()=>{var t;let i=null;try{const B=sessionStorage.getItem(Me);B&&(i=JSON.parse(B))}catch(B){console.error(B)}h.value?(b.value=h.value,j({iscnId:h.value,txHash:""})):E.value?te({classId:E.value}):i!=null&&i.epubMetadata&&(i!=null&&i.fileRecords)&&(L.value=(t=i==null?void 0:i.epubMetadata)==null?void 0:t.title)});const H=async()=>{if((!T.value||!c.value)&&await R(),!T.value||!c.value){F("Please login first");return}try{if(a.value===0&&m.value){await m.value.onSubmit();return}if(a.value===1){if(!K.value){F("Please fill in all required fields");return}await M.value.onSubmit();return}if(a.value===2){if(!o.value){F("Please fill in all required fields");return}await w.value.startNFTMintFlow();return}a.value<P.length-1&&a.value++}catch(i){console.error("Error during form submission:",i)}},u=i=>{Be(i),a.value=1},j=async i=>{const{iscnId:t}=i;t&&_.replace({query:{iscn_id:t}}),Le(),a.value=2,await oe(),h.value=t},te=async i=>{const{classId:t,nftMintCount:B}=i;t&&(E.value=t,_.replace({query:{class_id:t,count:B}}),a.value=3,await oe())},pe=()=>{_.push({name:"nft-book-store"})},me=async()=>{b.value&&await j({iscnId:b.value,txHash:""})};return(i,t)=>{const B=Ve,fe=qe,_e=nt,ve=lt,ge=Ye,W=ue,be=de,Ie=Ze;return f(),q(Ie,{class:"flex flex-col items-stretch grow space-y-4"},{default:N(()=>[p("div",it,[p("div",rt,[t[8]||(t[8]=p("div",{class:"absolute w-full h-[1px] bg-gray-300 top-[50%] left-0 z-[-1]"},null,-1)),(f(),U($e,null,Ee(P,(g,J)=>p("div",{key:J,class:"flex items-center space-x-2 bg-white p-2 rounded-lg"},[l(B,{size:J===n(a)?"lg":"md",text:(J+1).toString(),ui:{background:J===n(a)?"bg-primary-100":"bg-gray-200"}},null,8,["size","text","ui"]),p("p",ut,X(g.title),1)])),64))]),p("div",ct,[n(a)===0?(f(),U("div",dt,[l(fe,{ref_key:"uploadFormRef",ref:m,onFileUploadStatus:t[0]||(t[0]=g=>O.value=g),onFileReady:t[1]||(t[1]=g=>A.value=g),onSubmit:u},null,512)])):n(a)===1?(f(),U("div",pt,[l(_e,{ref_key:"registerISCN",ref:M,onFormValidChange:t[2]||(t[2]=g=>K.value=g),onSubmit:j},null,512)])):n(a)===2?(f(),U("div",mt,[l(ve,{ref_key:"mintNFT",ref:w,"iscn-id":n(h),onLoadingChange:t[3]||(t[3]=g=>r.value=g),onFormValidChange:t[4]||(t[4]=g=>o.value=g),onSubmit:te},null,8,["iscn-id"])])):n(a)===3?(f(),U("div",ft,[l(ge,{ref:"newNFTBook",class:"p-0 flex flex-col text-left gap-[24px]","is-new-class-page":!0,"class-id":n(E),onSubmit:pe},null,8,["class-id"])])):V("",!0),p("div",_t,[n(I)?(f(),q(W,{key:0,disabled:n(y),onClick:H},{default:N(()=>[G(X(n(d)),1)]),_:1},8,["disabled"])):V("",!0)])]),n(a)===0?(f(),U("div",vt,[t[13]||(t[13]=p("div",{class:"w-full bg-gray-300 h-[1px]"},null,-1)),p("div",gt,[p("div",bt,[n(e)?(f(),U("div",It,[t[9]||(t[9]=G(" 繼續上次的註冊: ")),l(W,{variant:"ghost",class:"text-primary-500 font-semibold",onClick:t[5]||(t[5]=g=>a.value=1)},{default:N(()=>[G(X(n(L)),1)]),_:1})])):V("",!0),p("div",yt,[t[11]||(t[11]=p("span",null,"已經有 ISCN ID 了？ 按",-1)),l(W,{variant:"ghost",onClick:t[6]||(t[6]=g=>v.value=!n(v))},{default:N(()=>t[10]||(t[10]=[G(" 這裡 ")])),_:1})])]),n(v)?(f(),U("div",wt,[l(be,{modelValue:n(b),"onUpdate:modelValue":t[7]||(t[7]=g=>ee(b)?b.value=g:null),placeholder:"輸入 ISCN ID"},null,8,["modelValue"]),l(W,{disabled:!n(b),onClick:me},{default:N(()=>t[12]||(t[12]=[G(" 確認 ")])),_:1},8,["disabled"]),p("a",{href:n(z),target:"_blank",class:"text-primary-500"}," or 找到你的 ISCN ",8,Nt)])):V("",!0)])])):V("",!0)])]),_:1})}}});export{jt as default};
//# sourceMappingURL=BNw1GUCO.js.map
