import{T as v,dy as L,r as h,C as k,dM as B,v as g,s as p,h as b}from"./CQCxTdTH.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new Error().stack;o&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[o]="6a5323e1-2f42-43a2-8fed-9f9982cec066",t._sentryDebugIdIdentifier="sentry-dbid-6a5323e1-2f42-43a2-8fed-9f9982cec066")}catch{}})();async function $(t){const{LIKE_CO_API:o}=v().public,a=`${o}/users/id/${t}/min`;return await $fetch(a)}async function U(t,{nocache:o=!1}={}){const{LIKE_CO_API:a}=v().public,s=o?`?ts=${Math.round(new Date().getTime()/1e3)}`:"",i=`${a}/users/addr/${t}/min${s}`;return await $fetch(i)}const _=L("liker",()=>{const t=h({}),o=k(()=>Object.entries(t.value).reduce((e,[n,u])=>(e[u.likeWallet]=n,e),{})),a=k(()=>e=>t.value[e]||null),s=k(()=>e=>a.value(o.value[e])),i=k(()=>e=>{const n=B(e);return a.value(n)});async function f(e){try{const u=await $(e);if(!u)throw new Error("Missing data in `fetchLikerInfoById`");return t.value[e]=u,u}catch{return null}}async function r(e){return t.value[e]?t.value[e]:await f(e)}async function I(e,{nocache:n=!1}={}){try{const c=await U(e,{nocache:n});if(!c)throw new Error("Missing data in `fetchLikerInfoByWallet`");return t.value[c.user]=c,c}catch{return null}}async function y(e){const n=o.value[e];return n?r(n):await I(e)}async function d(e){const n=B(e);return await r(n)}return{likerInfoMapById:t,likerIdMapByWallet:o,getLikerInfoById:a,getLikerInfoByWallet:s,getChannelInfoById:i,fetchLikerInfoById:f,lazyFetchLikerInfoById:r,fetchLikerInfoByWallet:I,lazyFetchLikerInfoByWallet:y,lazyFetchChannelInfoById:d}}),F=L("user",()=>{const{LIKE_CO_API:t}=v().public,o=g(),{token:a,isAuthenticated:s,wallet:i}=p(o),f=_(),r=h(null),I=h(!1),y=k(()=>s.value&&i.value?f.getLikerInfoByWallet(i.value):null),d=h(!1);async function e(){const l=await $fetch(`${t}/likernft/book/user/profile`,{headers:{authorization:`Bearer ${a.value}`}});return r.value=l,r.value}async function n(){if(r.value)return r.value;try{return await e()}catch(l){l.message!=="USER_NOT_FOUND"&&console.error(l)}}async function u(l){try{return I.value=!0,await $fetch(`${t}/likernft/book/user/profile`,{method:"POST",body:l,headers:{authorization:`Bearer ${a.value}`}}),r.value={...r.value,...l},r.value}finally{I.value=!1}}async function c({nocache:l=!1}={}){if(!s.value)return null;try{return d.value=!0,await f.fetchLikerInfoByWallet(i.value,{nocache:l})}finally{d.value=!1}}async function w(){return s.value?y.value?y.value:await c():null}return b(s,()=>{s.value?(w(),n()):r.value=null}),{bookUser:r,isUpdatingBookUserProfile:I,userLikerInfo:y,isFetchingUserLikerInfo:d,fetchBookUserProfile:e,lazyFetchBookUserProfile:n,updateBookUserProfile:u,fetchUserLikerInfo:c,lazyFetchUserLikerInfo:w}});export{_ as a,F as u};
//# sourceMappingURL=CsgbR_DO.js.map
