import{_ as gt}from"./WnC6mHIO.js";import{n as ht,T as bt,q as wt,s as tt,v as xt,a1 as It,u as Ct,M as Nt,r,C as z,h as et,z as St,a9 as kt,o as y,B as U,w as _,aa as at,W as Ft,a,t as c,F as e,N as B,d as ot,b as d,G as Tt,c as R,I as $t,H as nt,D as Bt,ab as Et,ac as Dt,ad as Ut,a2 as Rt,Q as qt,K as Vt,J as At}from"./Cgediu4u.js";import{_ as Pt}from"./BIHWGLqc.js";import{_ as Lt}from"./B_ksZk6k.js";import{_ as Mt}from"./D9BEK66i.js";import{u as zt,_ as Ht}from"./CRbVhcBH.js";import{_ as Ot}from"./BcZA52h8.js";import{u as Wt}from"./9pdoRT3m.js";import"./qFdIC1qG.js";(function(){try{var C=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},N=new Error().stack;N&&(C._sentryDebugIds=C._sentryDebugIds||{},C._sentryDebugIds[N]="a340b1d8-4674-4129-b158-f5686dbbaed1",C._sentryDebugIdIdentifier="sentry-dbid-a340b1d8-4674-4129-b158-f5686dbbaed1")}catch{}})();const jt={class:"text-lg font-bold font-mono"},Gt={class:"divide-y w-full"},Kt={class:"px-4 py-3"},Qt={class:"px-4 py-3"},Jt={class:"px-4 py-3"},Xt={class:"px-4 py-3"},Yt={class:"px-4 py-3"},Zt={class:"text-left px-4 py-3"},te={class:"px-4 py-3"},ee={class:"px-4 py-3"},ae={class:"flex flex-wrap items-center justify-center gap-2"},oe=["src"],pe=ht({__name:"[collectionId]",setup(C){const{LIKE_CO_API:N,LCD_URL:H}=bt().public,O=wt(),{wallet:S,signer:k}=tt(O),{initIfNecessary:W}=O,j=xt(),{token:G}=tt(j),K=Wt(),q=It(),{lazyFetchClassMetadataById:lt}=K,{lazyFetchCollectionById:st}=q,V=Ct(),rt=Nt(),g=r(""),h=r(!1),b=r(V.params.collectionId),Q=r(V.query.payment_id),E=r(V.query.owner_wallet||S.value),F=r(""),{messageCharCount:it,isLimitReached:J}=zt(F,at),f=r([]),A=r([]),x=r(!1),I=r(!1),T=r(""),p=r(!1),X=r(void 0),l=r({}),$=r([]),Y=z(()=>p.value||h.value||x.value||I.value||!!T.value||J.value),ut=z(()=>{var o;return(o=q.getCollectionById(b.value))==null?void 0:o.name}),w=z(()=>{var o;return(o=q.getCollectionById(b.value))==null?void 0:o.classIds});et(h,o=>{o&&(g.value="")}),et(p,o=>{o||f.value.forEach(async(t,n)=>{t?$.value[n]=await Z(w.value[n],t):$.value[n]=""})}),St(async()=>{const o=await $fetch(`${N}/likernft/book/collection/purchase/${b.value}/status/${Q.value}`,{headers:{authorization:`Bearer ${G.value}`}});l.value=o,await st(b.value),await Promise.all(w.value.map(t=>lt(t))),P(l.value.quantity||1)});function ct(o){var t;return(t=K.getClassMetadataById(o))==null?void 0:t.name}function dt(){p.value=!p.value,T.value="",Bt(()=>{var o,t,n;p.value&&((n=(t=(o=X.value)==null?void 0:o.$refs)==null?void 0:t.input)==null||n.focus())})}async function Z(o,t){var n,u,i;try{x.value=!0;const s=await $fetch(`${H}/cosmos/nft/v1beta1/nfts/${o}/${t}`),v=((i=(u=(n=s==null?void 0:s.nft)==null?void 0:n.data)==null?void 0:u.metadata)==null?void 0:i.image)||"";return Ft(v)}catch(s){return g.value=s.toString(),""}finally{x.value=!1}}async function P(o=1){try{if(T.value="",I.value=!0,(!S.value||!k.value)&&await W(),!E.value)return;await Promise.all(w.value.map(async(t,n)=>{if(!A.value[n]){const{nfts:u}=await kt({classId:t,owner:E.value,needCount:o});if(u.length)A.value[n]=u.map(i=>i.id),f.value[n]=u[0].id,$.value[n]=await Z(t,f.value[n]);else throw new Error(`${E.value} does not hold any NFT of class ${t}`)}}))}catch(t){g.value=t.toString()}finally{I.value=!1}}function ft(){P(l.value.quantity||1)}async function pt(){if(!Y.value)try{if(h.value=!0,(!S.value||!k.value)&&await W(),!S.value||!k.value)return;if(await P(l.value.quantity),await Promise.all(w.value.map(async(s,v)=>{if(f.value[v]){const{owner:L}=await Et(s,f.value[v]);if(L!==E.value)throw new Error(`NFT classId: ${s} nftId:${f.value[v]} is not owned by sender!`)}})),w.value.find(s=>!s))throw new Error("Please specify NFT class ID");if(f.value.find(s=>!s))throw new Error("Please specify NFT ID");if(!(await Dt(k.value)).getSigningStargateClient())throw new Error("Signing client not exists");const n=w.value.map(s=>new Array(l.value.quantity).fill(s)).flat(),u=A.value.flat(),i=await Ut(l.value.wallet,n,u,k.value,S.value,F.value);i.transactionHash&&i.code===0&&(await $fetch(`${N}/likernft/book/collection/purchase/${b.value}/sent/${Q.value}`,{method:"POST",body:{txHash:i.transactionHash,quantity:l.value.quantity||1},headers:{authorization:`Bearer ${G.value}`}}),rt.push({name:"nft-book-store-collection-status-collectionId",params:{collectionId:b.value}}))}catch(o){console.error(o),g.value=o.toString()}finally{h.value=!1}}return(o,t)=>{const n=gt,u=Rt,i=qt,s=Pt,v=Lt,L=Mt,M=Vt,mt=At,_t=Ht,vt=Ot;return y(),U(vt,null,{default:_(()=>[a("h1",jt,' Deliver NFT Book Collection "'+c(e(ut)||e(b))+'" ',1),e(g)?(y(),U(n,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${e(g)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:t[0]||(t[0]=m=>g.value="")},null,8,["title"])):B("",!0),e(h)?(y(),U(u,{key:1,animation:"carousel"},{indicator:_(()=>t[2]||(t[2]=[ot(" Loading... ")])),_:1})):B("",!0),e(j).isAuthenticated?(y(),U(i,{key:2,ui:{body:{base:"space-y-4"},footer:{base:"flex justify-center gap-2"}}},{footer:_(()=>[d(M,{label:"Sign and Send",disabled:e(Y),size:"xl",onClick:pt},null,8,["disabled"])]),default:_(()=>[d(i,{ui:{body:{padding:""}}},{default:_(()=>{var m;return[a("table",Gt,[a("tbody",null,[a("tr",null,[t[3]||(t[3]=a("th",{class:"text-left px-4 py-3"}," Buyer Email ",-1)),a("td",Kt,c(e(l).email),1)]),a("tr",null,[t[4]||(t[4]=a("th",{class:"text-left px-4 py-3"}," Reader Email ",-1)),a("td",Qt,c(((m=e(l).giftInfo)==null?void 0:m.toEmail)||e(l).email),1)]),a("tr",null,[t[5]||(t[5]=a("th",{class:"text-left px-4 py-3"}," Status ",-1)),a("td",Jt,c(e(l).status),1)]),a("tr",null,[t[6]||(t[6]=a("th",{class:"text-left px-4 py-3"}," Buyer Wallet ",-1)),a("td",Xt,c(e(l).wallet),1)]),a("tr",null,[t[7]||(t[7]=a("th",{class:"text-left px-4 py-3"}," Price ",-1)),a("td",Yt,c(e(l).price),1)]),a("tr",null,[t[8]||(t[8]=a("th",{class:"text-left px-4 py-3"}," Quantity ",-1)),a("td",Zt,c(e(l).quantity),1)]),a("tr",null,[t[9]||(t[9]=a("th",{class:"text-left px-4 py-3"}," Buyer message ",-1)),a("td",te,c(e(l).message),1)]),a("tr",null,[t[10]||(t[10]=a("th",{class:"text-left px-4 py-3"}," Sales channel ",-1)),a("td",ee,c(e(l).from),1)])])])]}),_:1}),d(v,{label:"Enter Author's Message",error:e(J),hint:`${e(it)} / ${e(at)}`},{default:_(()=>[d(s,{modelValue:e(F),"onUpdate:modelValue":t[1]||(t[1]=m=>Tt(F)?F.value=m:null),placeholder:"default memo"},null,8,["modelValue"])]),_:1},8,["error","hint"]),d(v,{label:"Specify NFT ID",error:e(T)},{default:_(()=>[(y(!0),R(nt,null,$t(e(w),(m,D)=>(y(),R("div",{key:m},[a("label",null,c(ct(m)+": "+m),1),a("div",ae,[e(l).quantity===1?(y(),R(nt,{key:0},[d(L,{ref_for:!0,ref_key:"nftIdInputRef",ref:X,modelValue:e(f)[D],"onUpdate:modelValue":yt=>e(f)[D]=yt,class:"font-mono flex-grow",readonly:!e(p),disabled:!e(p),placeholder:"Leave empty to auto-fetch NFT ID","trailing-icon":e(T)?"i-heroicons-exclamation-triangle-20-solid":void 0},null,8,["modelValue","onUpdate:modelValue","readonly","disabled","trailing-icon"]),d(M,{label:e(p)||e(x)&&!e(I)?"Confirm":"Edit",disabled:e(h)||e(x),variant:"outline",loading:e(x)&&!e(I),color:"gray",onClick:dt},null,8,["label","disabled","loading"]),d(mt,{class:"text-sm text-gray-600 sm:w-min"},{default:_(()=>t[11]||(t[11]=[ot(" OR ")])),_:1})],64)):B("",!0),d(M,{label:`Auto-fetch NFT ID for ${e(l).quantity} orders`,disabled:e(h)||e(p),loading:e(I),variant:"outline",onClick:ft},null,8,["label","disabled","loading"])]),d(_t,{class:"h-[300px]"},{default:_(()=>[e($)[D]?(y(),R("img",{key:0,class:"max-w-[180px] w-full h-full object-contain",src:e($)[D]},null,8,oe)):B("",!0)]),_:2},1024)]))),128))]),_:1},8,["error"])]),_:1})):B("",!0)]),_:1})}}});export{pe as default};
//# sourceMappingURL=D0-vaW-Q.js.map
