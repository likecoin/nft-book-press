import{n as te,Q as pe,R as me,r as s,df as H,s as M,h as Z,x as fe,dg as Fe,dh as ie,o as g,c as T,b as l,B as a,C as ae,w,a as m,d as J,t as ee,di as re,ah as he,a1 as ke,H as Ue,_ as Te,O as oe,A as W,b7 as Me,J as j,G as _e,M as Re,I as ve,u as ge,v as $e,X as Le,dj as De,dk as Be,y as ue,D as Ve,F as Ee,dl as Ae,aV as Pe}from"./DBE1DAG7.js";import{u as be,b as Oe,v as Ge,e as qe,f as ce,c as de,s as ze,d as je,a as Ke,_ as He,g as Je}from"./CQKIYdEt.js";import{_ as Qe}from"./BARo-uas.js";import{_ as Ie}from"./DFyQwwX-.js";import{_ as We}from"./D1faNYIX.js";import{_ as Xe}from"./RnWDTU7B.js";import"./CLvjVGaU.js";import"./8mvRbGEp.js";import"./C1ufFlX3.js";import"./Qb8-O-5m.js";import"./DA79aZ09.js";import"./Cx1UhQWq.js";import"./CaIMtus0.js";import"./yR1_PQ2j.js";import"./C8PVuK-v.js";import"./O1MvlxzO.js";import"./DLFF0UqR.js";import"./DpG5Vkwv.js";import"./DOMtwFUf.js";import"./DMwVDBUQ.js";import"./Cj0hY7aC.js";(function(){try{var R=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},x=new Error().stack;x&&(R._sentryDebugIds=R._sentryDebugIds||{},R._sentryDebugIds[x]="abb7ca03-c806-4bb1-a13b-35ba516ac417",R._sentryDebugIdIdentifier="sentry-dbid-abb7ca03-c806-4bb1-a13b-35ba516ac417")}catch{}})();const Ye={class:"space-y-3"},Ze={class:"flex justify-between items-center"},et=te({__name:"RegisterISCN",emits:["handleSubmit","submit","formValidChange"],setup(R,{expose:x,emit:h}){const d=pe(),{getFileType:k}=de(),{wallet:S,signer:I}=me(d),{initIfNecessary:N}=d,{stripHtmlTags:C,formatLanguage:t}=de(),{showErrorToast:u}=be(),y=s({type:"Book",title:"",description:"",isbn:"",publisher:"",publicationDate:"",author:{name:"",description:""},license:"All Rights Reserved",customLicense:"",contentFingerprints:[{url:""}],downloadableUrls:[{url:"",type:"",fileName:""}],language:"",bookInfoUrl:"",tags:[],coverUrl:""}),$=s(new H(0)),B=s(new H(0)),f=s("0"),p=s(""),F=s(""),U=h,O=M(()=>B.value||new H(0)),{payload:G}=Oe({iscnFormData:y}),q=M(()=>Ge(y.value)),z=M(()=>{var n;return!((n=q.value)!=null&&n.length)});Z(z,n=>{U("formValidChange",n)},{immediate:!0}),fe(()=>{const n=o();n&&(y.value=n),r()});const o=()=>{var _,D,E,K,A,Q;const n=Fe();if(!n)return null;const b={type:"Book",title:((_=n.epubMetadata)==null?void 0:_.title)||"",description:C(((D=n.epubMetadata)==null?void 0:D.description)||""),isbn:"",publisher:"",publicationDate:new Date().toISOString().split("T")[0],author:{name:((E=n.epubMetadata)==null?void 0:E.author)||"",description:""},license:"All Rights Reserved",contentFingerprints:[],downloadableUrls:[],coverUrl:(K=n.epubMetadata)!=null&&K.thumbnailArweaveId?`ar://${n.epubMetadata.thumbnailArweaveId}`:"",language:t(((A=n.epubMetadata)==null?void 0:A.language)||"zh"),tags:((Q=n.epubMetadata)==null?void 0:Q.tags)||[]};return b.downloadableUrls=n.fileRecords.filter(c=>c.fileType==="application/pdf"||c.fileType==="application/epub+zip").map(c=>({url:c.arweaveKey?c.arweaveLink:`ar://${c.arweaveId}`,type:k(c.fileType),fileName:c.fileName})),b.contentFingerprints=[...new Set(n.fileRecords.map(c=>{const ne=c.arweaveKey?c.arweaveLink:`ar://${c.arweaveId}`;return c.fileType==="application/epub+zip"||c.fileType==="application/pdf"?ne:`ar://${c.arweaveId}`}).filter(Boolean))].map(c=>({url:c})),b},r=async()=>{const n=await qe(ce(G.value)),{iscnFee:b,gas:_}=n,D=new H(_.fee.amount[0].amount).times(ie),E=b.amount;B.value=new H(E).plus(D).shiftedBy(-9),f.value=new H(_.fee.gas).times(ie).toFixed(0)},L=async()=>{var n;if(p.value="checking",!z.value){u(q.value.join(", "));return}if(await r(),$.value=await re(S.value),(n=$.value)!=null&&n.lt(O.value)){u("INSUFFICIENT_BALANCE"),p.value="";return}y.value.contentFingerprints.length&&await V()},V=async()=>{if(p.value="loading",await N(),!I.value){F.value="MISSING_SIGNER",p.value="";return}try{p.value="signing";const n=await ze(ce(G.value),I.value,S.value,{gas:f.value});p.value="success",U("submit",n)}catch(n){console.error(n),u(`'SIGNING_ERROR':${n}`),p.value=""}finally{$.value=await re(S.value),p.value=""}};return x({onSubmit:L}),(n,b)=>{const _=je,D=he,E=ke,K=Ue;return g(),T("div",null,[l(_,{modelValue:a(y),"onUpdate:modelValue":b[0]||(b[0]=A=>ae(y)?y.value=A:null)},null,8,["modelValue"]),l(K,{"model-value":!!a(p),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:w(()=>[m("div",Ye,[m("div",Ze,[l(D,{color:"Badge",variant:"soft"},{default:w(()=>[J(ee(a(p)),1)]),_:1}),b[1]||(b[1]=m("p",{class:"text-xs text-gray-500"}," 請勿關閉此視窗，直到 ISCN 註冊完成。 ",-1))]),l(E,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),tt=Te(et,[["__scopeId","data-v-2c84a10d"]]),nt=te({__name:"ISCNInfoCard",props:{iscnId:{},iscnOwner:{},iscnData:{},showEditButton:{type:Boolean}},emits:["edit"],setup(R){const{APP_LIKE_CO_URL:x,LIKER_LAND_URL:h}=oe().public;return(d,k)=>{const S=_e,I=Qe,N=Ie,C=Re;return g(),W(C,{ui:{body:{base:"space-y-4"}}},{header:w(()=>k[1]||(k[1]=[m("h2",{class:"font-bold font-mono"}," ISCN Information ",-1)])),default:w(()=>[l(I,{label:"ISCN ID",class:"text-left"},{default:w(()=>[l(S,{class:"font-mono",label:d.iscnId,to:`${a(x)}/view/${encodeURIComponent(d.iscnId)}`,target:"_blank",variant:"link",padded:!1},null,8,["label","to"])]),_:1}),l(I,{label:"ISCN Owner",class:"text-left"},{default:w(()=>[l(S,{label:d.iscnOwner,to:`${a(h)}/${encodeURIComponent(d.iscnOwner)}`,target:"_blank",variant:"link",padded:!1},null,8,["label","to"])]),_:1}),l(I,{label:"ISCN Title"},{default:w(()=>{var t,u;return[l(N,{value:(u=(t=d.iscnData)==null?void 0:t.contentMetadata)==null?void 0:u.name,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1}),l(I,{label:"ISCN Description"},{default:w(()=>{var t,u;return[l(N,{value:(u=(t=d.iscnData)==null?void 0:t.contentMetadata)==null?void 0:u.description,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1}),Me(d.$slots,"actions",{},()=>[d.showEditButton?(g(),W(S,{key:0,label:"Edit ISCN Metadata",onClick:k[0]||(k[0]=t=>d.$emit("edit"))})):j("",!0)])]),_:3})}}}),at={class:"flex flex-col items-stretch grow space-y-4"},ot=te({__name:"MintNFT",props:{iscnId:{type:String,default:""}},emits:["submit","formValidChange","loadingChange"],setup(R,{expose:x,emit:h}){const{LCD_URL:d}=oe().public,k=ve(),S=ge(),I=s(1),N=s(""),C=s(!1),t=s(""),u=s(null),y=s(""),$=s(null),B=M(()=>{var o;return(o=u.value)==null?void 0:o["@id"]}),f=s(!1),p=s(!1),F=h;Z(C,o=>{F("loadingChange",o),o&&(N.value="")},{immediate:!0}),Z(p,o=>{F("formValidChange",o)},{immediate:!0}),$e({title:"Mint Liker Land NFT Book",ogTitle:"Mint Liker Land NFT Book"});const U=R;Z(()=>U.iscnId,async o=>{o&&await O(U.iscnId)},{immediate:!0});async function O(o){if(o)try{if(C.value=!0,o.startsWith("iscn://")){const r=await $fetch(`${d}/iscn/records/id?iscn_id=${encodeURIComponent(o)}`),{records:L,owner:V}=r;u.value=L[0].data,t.value=V,u.value.owner=V,I.value=2}}catch(r){console.error(r),N.value=r.toString()}finally{C.value=!1}}function G(){var o;(o=$.value)==null||o.startNFTMintFlow()}function q(o){o?(k.replace({query:{...S.query,iscn_id:o}}),O(o)):window.location.reload()}function z({classId:o,nftMintCount:r,prefix:L}={}){y.value=o||"",F("submit",{classId:o||"",nftMintCount:r,prefix:L})}return x({startNFTMintFlow:G}),(o,r)=>{const L=Le,V=nt,n=Ke,b=He;return g(),T("div",at,[a(N)?(g(),W(L,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${a(N)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:r[0]||(r[0]=_=>N.value="")},null,8,["title"])):j("",!0),l(V,{"iscn-id":a(B),"iscn-owner":a(t),"iscn-data":a(u),"show-edit-button":!0,onEdit:r[1]||(r[1]=_=>f.value=!0)},null,8,["iscn-id","iscn-owner","iscn-data"]),l(n,{ref_key:"liteMintNFTRef",ref:$,"iscn-data":a(u),"should-show-submit":!1,onFormValidChange:r[2]||(r[2]=_=>p.value=_),onSubmit:z},null,8,["iscn-data"]),l(b,{modelValue:a(f),"onUpdate:modelValue":r[3]||(r[3]=_=>ae(f)?f.value=_:null),"class-id":a(y),onSave:q},null,8,["modelValue","class-id"])])}}}),st={class:"w-full"},lt={class:"justify-evenly items-center flex space-x-4 relative"},it={class:"text-sm font-semibold"},rt={class:"mt-6 p-4 border rounded-lg bg-gray-100 text-center flex flex-col gap-[24px]"},ut={key:0},ct={key:1},dt={key:2},pt={key:3},mt={class:"flex gap-2 justify-center mt-4"},ft={key:0,class:"flex flex-col justify-center px-[12px] mt-[16px]"},_t={class:"flex flex-col items-center gap-4 py-4"},vt={class:"flex flex-col items-center"},gt={key:0},bt={class:"flex items-center"},It={key:0,class:"flex flex-col items-center gap-2 w-full max-w-md"},yt=["href"],Gt=te({__name:"index",setup(R){var se,le;const x=pe(),{wallet:h,signer:d}=me(x),{initIfNecessary:k}=x,S=ge(),I=ve(),{APP_LIKE_CO_URL:N}=oe().public,{showErrorToast:C}=be(),t=s(0),u=s(),y=s(),$=s(),B=s(!1),f=s(""),p=s(""),F=s(((se=S.query.iscn_id)==null?void 0:se.toString())||""),U=s(((le=S.query.class_id)==null?void 0:le.toString())||""),O=s([]),G=s(""),q=s(!1),z=s(!1),o=s(!1),r=M(()=>!!p.value),L=M(()=>{switch(t.value){case 0:return"Start Upload";case 1:return"Register ISCN";case 2:return"Mint NFT";default:return"Next"}}),V=M(()=>{var i;return((i=O.value)==null?void 0:i.length)>0}),n=M(()=>t.value===0?V.value:t.value<3),b=M(()=>t.value===0?G.value!=="":t.value===2?o.value:!1),_=M(()=>`${N}/search?owner=${h.value}`),D=[{title:"上傳檔案",description:"Upload your book file"},{title:"註冊 ISCN",description:"Register ISCN"},{title:"鑄造區塊鏈書",description:"Mint NFT"},{title:"新書發佈",description:"Publish new book"}];fe(()=>{var e;let i=null;try{const P=sessionStorage.getItem(De);P&&(i=JSON.parse(P))}catch(P){console.error(P)}F.value?(f.value=F.value,A({iscnId:F.value,txHash:""})):U.value?Q({classId:U.value}):i!=null&&i.epubMetadata&&(i!=null&&i.fileRecords)&&(p.value=(e=i==null?void 0:i.epubMetadata)==null?void 0:e.title)});const E=async()=>{if((!h.value||!d.value)&&await k(),!h.value||!d.value){C("Please login first");return}try{if(t.value===0&&u.value){await u.value.onSubmit();return}if(t.value===1){if(!q.value){C("Please fill in all required fields");return}await y.value.onSubmit();return}if(t.value===2){if(!z.value){C("Please fill in all required fields");return}await $.value.startNFTMintFlow();return}t.value<D.length-1&&t.value++}catch(i){console.error("Error during form submission:",i)}},K=i=>{Ae(i),t.value=1},A=async i=>{const{iscnId:e}=i;e&&I.replace({query:{iscn_id:e}}),Be(),t.value=2,await ue(),F.value=e},Q=async i=>{const{classId:e,nftMintCount:P}=i;e&&(U.value=e,I.replace({query:{class_id:e,count:P}}),t.value=3,await ue())},c=()=>{I.push({name:"nft-book-store"})},ne=async()=>{f.value&&await A({iscnId:f.value,txHash:""})};return(i,e)=>{const P=Pe,ye=Je,we=tt,Se=ot,Ne=We,X=_e,xe=Ie,Ce=Xe;return g(),W(Ce,{class:"flex flex-col items-stretch grow space-y-4"},{default:w(()=>[m("div",st,[m("div",lt,[e[8]||(e[8]=m("div",{class:"absolute w-full h-[1px] bg-gray-300 top-[50%] left-0 z-[-1]"},null,-1)),(g(),T(Ee,null,Ve(D,(v,Y)=>m("div",{key:Y,class:"flex items-center space-x-2 bg-white p-2 rounded-lg"},[l(P,{size:Y===a(t)?"lg":"md",text:(Y+1).toString(),ui:{background:Y===a(t)?"bg-primary-100":"bg-gray-200"}},null,8,["size","text","ui"]),m("p",it,ee(v.title),1)])),64))]),m("div",rt,[a(t)===0?(g(),T("div",ut,[l(ye,{ref_key:"uploadFormRef",ref:u,onFileUploadStatus:e[0]||(e[0]=v=>G.value=v),onFileReady:e[1]||(e[1]=v=>O.value=v),onSubmit:K},null,512)])):a(t)===1?(g(),T("div",ct,[l(we,{ref_key:"registerISCN",ref:y,onFormValidChange:e[2]||(e[2]=v=>q.value=v),onSubmit:A},null,512)])):a(t)===2?(g(),T("div",dt,[l(Se,{ref_key:"mintNFT",ref:$,"iscn-id":a(F),onLoadingChange:e[3]||(e[3]=v=>o.value=v),onFormValidChange:e[4]||(e[4]=v=>z.value=v),onSubmit:Q},null,8,["iscn-id"])])):a(t)===3?(g(),T("div",pt,[l(Ne,{ref:"newNFTBook",class:"p-0 flex flex-col text-left gap-[24px]","is-new-class-page":!0,"class-id":a(U),onSubmit:c},null,8,["class-id"])])):j("",!0),m("div",mt,[a(n)?(g(),W(X,{key:0,disabled:a(b),onClick:E},{default:w(()=>[J(ee(a(L)),1)]),_:1},8,["disabled"])):j("",!0)])]),a(t)===0?(g(),T("div",ft,[e[13]||(e[13]=m("div",{class:"w-full bg-gray-300 h-[1px]"},null,-1)),m("div",_t,[m("div",vt,[a(r)?(g(),T("div",gt,[e[9]||(e[9]=J(" 繼續上次的註冊: ")),l(X,{variant:"ghost",class:"text-primary-500 font-semibold",onClick:e[5]||(e[5]=v=>t.value=1)},{default:w(()=>[J(ee(a(p)),1)]),_:1})])):j("",!0),m("div",bt,[e[11]||(e[11]=m("span",null,"已經有 ISCN ID 了？ 按",-1)),l(X,{variant:"ghost",onClick:e[6]||(e[6]=v=>B.value=!a(B))},{default:w(()=>e[10]||(e[10]=[J(" 這裡 ")])),_:1})])]),a(B)?(g(),T("div",It,[l(xe,{modelValue:a(f),"onUpdate:modelValue":e[7]||(e[7]=v=>ae(f)?f.value=v:null),placeholder:"輸入 ISCN ID"},null,8,["modelValue"]),l(X,{disabled:!a(f),onClick:ne},{default:w(()=>e[12]||(e[12]=[J(" 確認 ")])),_:1},8,["disabled"]),m("a",{href:a(_),target:"_blank",class:"text-primary-500"}," or 找到你的 ISCN ",8,yt)])):j("",!0)])])):j("",!0)])]),_:1})}}});export{Gt as default};
//# sourceMappingURL=CgFHpb2X.js.map
