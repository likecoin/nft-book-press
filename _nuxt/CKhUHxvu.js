import{n as at,O as lt,Q as nt,P as it,R as ee,s as h,r,a2 as ce,a3 as st,a5 as me,a4 as rt,h as K,v as ut,x as dt,o as p,c as A,B as l,A as U,J as S,F as pe,b as n,w as s,a as u,t as fe,C as D,D as ct,b4 as ve,ba as mt,a6 as te,d as he,X as pt,M as ft,a8 as vt,G as ht,af as gt,a1 as _t,H as yt,_ as bt}from"./7W2dTFM9.js";import{_ as wt}from"./q_AchKhl.js";import{_ as xt}from"./Cr9amE6a.js";import{a as kt,_ as St}from"./DcCKZ0gr.js";import{p as Ct,j as Et,u as Ut,_ as Pt}from"./BEWBTp-T.js";import{_ as Vt}from"./CiR6rCLI.js";import{v as Mt,_ as It}from"./CWtRyVT2.js";import{_ as At}from"./Ce3nixNH.js";import{_ as Dt}from"./BgK8xkYH.js";import{u as Nt}from"./sSpWtsdi.js";import{u as Tt}from"./CbHf2xqi.js";import{g as $t}from"./Bj8pnEYy.js";import{u as Lt}from"./BELORIs0.js";(function(){try{var _=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},F=new Error().stack;F&&(_._sentryDebugIds=_._sentryDebugIds||{},_._sentryDebugIds[F]="8780d406-3fd4-4f61-afff-c27e01948ead",_._sentryDebugIdIdentifier="sentry-dbid-8780d406-3fd4-4f61-afff-c27e01948ead")}catch{}})();function H(_=""){return _.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function Bt(_){return Ct.sanitize(_)}const Ft={class:"pb-[40px]"},zt={class:"font-bold font-mono"},Ot={class:"font-bold font-mono"},Rt={class:"flex flex-col gap-2"},jt={class:"space-y-2"},Wt={key:0,class:"pl-8 space-y-2"},Zt={class:"space-y-2"},qt={key:0,class:"pl-8 space-y-2"},Gt={class:"flex flex-col gap-2"},Kt={class:"flex justify-center items-center"},Ht={class:"flex justify-center items-center"},Xt={class:"flex justify-between items-center w-full"},Jt={key:0,class:"mt-[24px] flex flex-col gap-[12px]"},Qt={class:"flex gap-2"},Yt={class:"flex justify-end items-center"},eo={class:"flex gap-2"},to={class:"flex justify-end items-center"},oo={class:"w-full flex justify-center"},ao={class:"space-y-3"},lo={class:"flex justify-between items-center"},no=1*1024*1024,io=at({__name:"NewNFTBook",props:{isNewClassPage:{type:Boolean,default:!1},classId:{type:String,default:""},editionIndex:{type:[String,Number],default:void 0},isEditMode:{type:Boolean,default:!1}},emits:["submit"],setup(_,{emit:F}){const{LIKE_CO_API:X}=lt().public,ge=nt(),z=it(),oe=Nt(),{wallet:C}=ee(ge),{newBookListing:_e,updateEditionPrice:ye,uploadSignImages:be}=z,{fetchStripeConnectStatusByWallet:we}=oe,{getStripeConnectStatusByWallet:xe}=ee(oe),{token:ke}=ee(z),Se=Tt(),{getNFTClassConfig:Ce,getBalanceOf:Ee}=Lt(),Ue=F,E=h(()=>B.editionIndex),{lazyFetchClassMetadataById:ae}=Se,y=r(""),m=r(!1),Pe=r({en:"e.g.: This edition includes EPUB and PDF ebook files.",zh:"例：此版本包含 EPUB 及 PDF 電子書檔"}),f=h(()=>B.classId),N=r(1),T=r(!1),P=r(!0),g=r([{price:ce,deliveryMethod:"auto",autoMemo:"Thank you for your support. It means a lot to me.",stock:st,name:"標準版",nameEn:"Standard Edition",nameZh:"標準版",descriptionEn:"",descriptionZh:"",hasShipping:!1,isPhysicalOnly:!1,isAllowCustomPrice:P.value,isUnlisted:!1}]),V=r([]),O=h(()=>g.value.length>1),R=r(["like1rclg677y2jqt8x4ylj0kjlqjjmnn6w63uflpgr"]),j=r([]),b=r(""),w=r(""),$=r(!1),L=r(""),J=r(!1),Q=r(!0),Ve=r(null),W=r(null),Me=h(()=>x.value||E.value!==void 0?Y.value-le.value:Y.value),Ie=h(()=>Math.max(ie.value-ne.value,0)),le=r(0),ne=r(0),Y=r(me),ie=r(0),Ae=r(["bold","italic","strikeThrough","title","-","unorderedList","orderedList","-","code","link","=","preview"]),x=h(()=>B.isEditMode),De=h(()=>x.value?"Edit Current Edition":"General settings / 一般選項"),Ne=h(()=>x.value?"Save Changes":"Submit"),Z=r(!1),Te=h(()=>[{key:"wallet",label:"Wallet",sortable:!0},{key:"remove",label:"",sortable:!1}]),$e=h(()=>R.value.map((t,e)=>({index:e,wallet:t,walletLink:rt(t)}))),Le=h(()=>j.value.map((t,e)=>({index:e,email:t}))),se=h(()=>{var t,e;return(e=(t=Ve.value)==null?void 0:t.contentMetadata)==null?void 0:e.inLanguage});K(m,t=>{t&&(y.value="")},{immediate:!0}),Et({markdownItConfig(t){t.options.html=!1}});const B=_;ut({title:"New Book Listing",ogTitle:"New Book Listing"}),dt(async()=>{try{m.value=!0;const[t,e]=await Promise.all([Ce(f.value),C.value?Ee(f.value,C.value):0]);if(Y.value=Number(t==null?void 0:t.max_supply)||me,ie.value=Number(e)||0,x.value||E.value!==void 0){if(C.value)try{await we(C.value),xe.value(C.value).isReady&&($.value=!0,L.value=C.value)}catch(i){console.error(i)}const o=await $fetch(`${X}/likernft/book/store/${f.value}`,{headers:{authorization:`Bearer ${ke.value}`}});if(o){if(V.value=(o==null?void 0:o.shippingRates)||[],(o==null?void 0:o.ownerWallet)!==C.value)throw new Error("NOT_OWNER_OF_NFT_CLASS");if(E.value!==void 0)if(o.prices.length){const i=o.prices.find(c=>c.index.toString()===E.value);if(!i)throw new Error("Edition not found");g.value=[{price:i.price,deliveryMethod:i.isAutoDeliver?"auto":"manual",autoMemo:i.autoMemo,stock:i.stock,name:o.inLanguage==="en"?i.name.en:i.name.zh,nameEn:i.name.en,nameZh:i.name.zh,descriptionEn:i.description.en,descriptionZh:i.description.zh,hasShipping:i.hasShipping,isPhysicalOnly:i.isPhysicalOnly,isAllowCustomPrice:i.isAllowCustomPrice,isUnlisted:i.isUnlisted,oldIsAutoDeliver:i.isAutoDeliver,oldStock:i.stock}],P.value=i.isAllowCustomPrice}else throw new Error("No prices found");le.value=o.prices.reduce((i,c)=>c.index.toString()!==E.value?i+c.stock:i,0),ne.value=o.prices.reduce((i,c)=>c.index.toString()!==E.value&&!c.isAutoDeliver?i+c.stock:i,0)}else throw new Error("NFT Class not found")}}catch(t){console.error(t)}finally{m.value=!1}}),K(P,t=>{g.value.forEach(e=>{e.isAllowCustomPrice=t})}),K(m,t=>{t&&(y.value="")}),K(f,async t=>{if(t){const e=await ae(t),o=e==null?void 0:e.contentFingerprints;o&&Be(o)&&(T.value=!0)}},{immediate:!0});function Be(t){const o=$t().API_GET_ARWEAVE_V2_LINK;return t.some(i=>!!i.startsWith(o)||i.includes("?key="))}function Fe(t,e="signatureImage"){if(!(t!=null&&t.length))return;const o=t[0];if(o.type!=="image/png"){y.value="僅支援 PNG 檔案";return}if(o.size>no){y.value="檔案超過 1MB 限制";return}e==="signatureImage"?W.value=o:console.warn(`Unknown upload key: ${e}`)}function ze(t){t.stock=Math.min(Ie.value,t.stock)}function Oe(){N.value+=1,g.value.push({index:Mt(),price:ce,deliveryMethod:"auto",autoMemo:"",stock:1,name:se.value==="en"?`Tier ${N.value}`:`級別 ${N.value}`,nameEn:`Tier ${N.value}`,nameZh:`級別 ${N.value}`,descriptionEn:"",descriptionZh:"",hasShipping:!1,isPhysicalOnly:!1,isAllowCustomPrice:!0,isUnlisted:!1})}function Re(t){g.value.splice(t,1)}function je(t){V.value=t}function We(){b.value&&(R.value.push(b.value),b.value="")}function Ze(){w.value&&(j.value.push(w.value),w.value="")}function qe(t){L.value=t,J.value=!0}function q(t){const e=se.value==="en";return t.map(o=>({name:e?{en:o.name,zh:o.nameZh}:{en:o.nameEn,zh:o.name},description:e?{en:H(o.description),zh:H(o.descriptionZh)}:{en:H(o.descriptionEn),zh:H(o.description)},priceInDecimal:Math.round(Number(o.price)*100),price:Number(o.price),stock:Number(o.stock),isAutoDeliver:!o.isPhysicalOnly&&o.deliveryMethod==="auto",isAllowCustomPrice:o.isAllowCustomPrice,isUnlisted:o.isUnlisted??!1,autoMemo:o.deliveryMethod==="auto"&&o.autoMemo||"",hasShipping:o.hasShipping||!1,isPhysicalOnly:o.isPhysicalOnly||!1}))}function Ge(t){const e=[];return t.forEach(o=>{(!o.name.en||!o.name.zh)&&e.push({path:"name",message:"Please input product name"}),o.hasShipping&&!V.value.length&&e.push({path:"shipping",message:"Please input shipping rates"})}),e.length>0?(y.value=e.map(o=>o.message).join(`
`),!1):!0}async function Ke(){try{const t=q(g.value);if(!Ge(t))return;if(x.value?await He():B.isNewClassPage?await re():(await fetch(`${X}/likernft/book/store/${f.value}`)).ok?await Xe():await re(),W.value){const e=new FormData;W.value&&e.append("signImage",W.value),await be(e,f.value)}Ue("submit")}catch{}}async function re(){try{if(!f.value)throw new Error("Please input NFT class ID");if(b.value)throw new Error('Please press "Add" button to add moderator wallet');if(w.value)throw new Error('Please press "Add" button to add notification email');m.value=!0;const t=await ae(f.value),e=(t==null?void 0:t.nft_meta_collection_id)||"";if(!e.includes("nft_book")&&!e.includes("book_nft"))throw new Error("NFT Class not in NFT BOOK meta collection");const o=q(g.value);if(o.find(v=>v.price!==0&&v.price<te))throw new Error(`Price of each edition must be at least $${te} or $0 (free)`);const i=$.value&&L.value?{[L.value]:100}:null,c=V.value.length?V.value.map(v=>({name:{en:v.name.en,zh:v.name.zh},priceInDecimal:v.priceInDecimal,price:v.priceInDecimal/100})):void 0,M=g.value.some(v=>v.deliveryMethod==="manual");await _e(f.value,{defaultPaymentCurrency:"USD",connectedWallets:i,moderatorWallets:R.value,notificationEmails:j.value,prices:o,shippingRates:c,mustClaimToView:!0,enableCustomMessagePage:M,hideDownload:T.value})}catch(t){const e=t.data||t;console.error(e),y.value=e}finally{J.value=!1,m.value=!1}}async function He(){try{if(!x.value)throw new Error("Unable to submit edit: Missing edition index or class ID");const e=q(g.value)[0];m.value=!0,await ye(f.value,E.value,{price:e})}catch(t){const e=t.data||t;console.error(e),y.value=e}finally{m.value=!1}}async function Xe(){try{m.value=!0;const e=q(g.value)[0];await z.addEditionPrice(f.value.toString(),(E.value||0).toString(),{price:e})}catch(t){console.error(t)}finally{m.value=!1}}return(t,e)=>{const o=pt,i=wt,c=xt,M=kt,v=Pt,I=ft,Je=vt,ue=Vt,Qe=It,k=ht,de=St,Ye=At,et=gt,tt=_t,ot=yt;return p(),A("div",Ft,[l(y)?(p(),U(o,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${l(y)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:e[0]||(e[0]=a=>y.value="")},null,8,["title"])):S("",!0),l(z).isAuthenticated?(p(),A(pe,{key:1},[n(I,{ui:{body:{base:"space-y-4"}}},{header:s(()=>[u("h2",zt,fe(l(De)),1)]),default:s(()=>[n(c,{label:"NFT Class ID"},{default:s(()=>[n(i,{value:l(f),disabled:"",class:"font-mono"},null,8,["value"])]),_:1}),n(c,{class:"flex items-center"},{default:s(()=>[n(v,{"tool-tip-text":"This option is only available when uploading files / 僅能在上傳檔案時決定"},{default:s(()=>[n(M,{modelValue:l(T),"onUpdate:modelValue":e[1]||(e[1]=a=>D(T)?T.value=a:null),name:"hideDownload",disabled:!0,label:"DRM: encrypt content & disable download / 加密文本、禁止下載"},null,8,["modelValue"])]),_:1})]),_:1}),n(c,null,{default:s(()=>[n(M,{modelValue:l(P),"onUpdate:modelValue":e[2]||(e[2]=a=>D(P)?P.value=a:null),name:"isAllowCustomPrice",label:"Accept tipping / 接受打賞"},null,8,["modelValue"])]),_:1})]),_:1}),(p(),U(ve(l(O)?"ul":"div"),{class:"flex flex-col gap-[12px]"},{default:s(()=>[n(I,{ui:{body:{base:"space-y-5 relative"},base:"overflow-visible border-none !border-transparent"}},{default:s(()=>[(p(!0),A(pe,null,ct(l(g),(a,G)=>(p(),U(ve(l(O)?"li":"div"),{key:a.index},{default:s(()=>[n(I,{ui:{body:{base:"flex flex-col gap-[20px]"},base:"overflow-visible border-[4px]"}},mt({default:s(()=>[n(c,{label:`Unit Price in USD (Minimum ${l(te)}, or 0 for free) / 版本定價（美元）`},{default:s(()=>[n(i,{modelValue:a.price,"onUpdate:modelValue":d=>a.price=d,type:"number",step:"0.01",min:0},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),n(c,{label:"No of copies / 數量"},{default:s(()=>[n(i,{modelValue:a.stock,"onUpdate:modelValue":d=>a.stock=d,type:"number",step:"1",min:0,max:l(Me)},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024),n(c,{label:"Product Name",ui:{container:"space-y-2"}},{label:s(()=>[e[10]||(e[10]=he(" Product Name / 產品名稱 ")),n(v,{"image-style":{width:"250px"}},{image:s(()=>e[9]||(e[9]=[u("img",{src:Dt,class:"object-cover",alt:""},null,-1)])),default:s(()=>[n(Je,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:s(()=>[n(i,{modelValue:a.name,"onUpdate:modelValue":d=>a.name=d,placeholder:"Product name"},null,8,["modelValue","onUpdate:modelValue"]),e[11]||(e[11]=u("span",{class:"block text-[14px] text-[#374151] mt-[8px]"},"Description (Optional) / 描述（選填）",-1)),n(l(Ut),{modelValue:a.descriptionEn,"onUpdate:modelValue":d=>a.descriptionEn=d,language:"en-US","editor-id":`en-${G}`,placeholder:l(Pe).en,toolbars:l(Ae),sanitize:l(Bt),style:{height:"200px",width:"100%",marginTop:"0px"}},null,8,["modelValue","onUpdate:modelValue","editor-id","placeholder","toolbars","sanitize"])]),_:2},1024),u("div",Rt,[u("div",jt,[n(ue,{modelValue:a.deliveryMethod,"onUpdate:modelValue":d=>a.deliveryMethod=d,value:"auto",disabled:l(x)&&a.oldIsAutoDeliver,name:"deliveryMethod",label:"Auto delivery / 自動發書"},null,8,["modelValue","onUpdate:modelValue","disabled"]),a.deliveryMethod==="auto"?(p(),A("div",Wt,[n(c,{label:"Memo / 發書留言"},{default:s(()=>[n(i,{modelValue:a.autoMemo,"onUpdate:modelValue":d=>a.autoMemo=d,placeholder:"Thank you for your support. It means a lot to me."},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)])):S("",!0)]),u("div",Zt,[n(ue,{modelValue:a.deliveryMethod,"onUpdate:modelValue":d=>a.deliveryMethod=d,value:"manual",disabled:l(x)&&a.oldIsAutoDeliver,name:"deliveryMethod",label:"Manual delivery / 手動發書",onClick:d=>ze(a)},null,8,["modelValue","onUpdate:modelValue","disabled","onClick"]),a.deliveryMethod==="manual"?(p(),A("div",qt,[n(c,null,{label:s(()=>e[12]||(e[12]=[u("p",null,"Autograph image / 簽名圖",-1),u("span",{class:"text-gray-500 text-[12px]"},"僅限 png 圖檔，檔案大小不超過 1MB，建議尺寸為 600 x 200 ",-1)])),default:s(()=>[n(i,{type:"file",accept:"image/png",onChange:e[3]||(e[3]=d=>Fe(d,"signatureImage"))})]),_:1})])):S("",!0)])]),n(c,null,{default:s(()=>[n(M,{modelValue:a.isUnlisted,"onUpdate:modelValue":d=>a.isUnlisted=d,name:"isUnlisted",label:"Pause selling of this Edition / 暫停此版本的銷售"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),u("div",Gt,[n(M,{modelValue:a.hasShipping,"onUpdate:modelValue":d=>a.hasShipping=d,name:"hasShipping",disabled:l(x)&&!a.hasShipping,label:"Includes physical good that requires shipping / 包含需要運送的實體商品"},null,8,["modelValue","onUpdate:modelValue","disabled"]),a.hasShipping?(p(),U(Qe,{key:0,"is-show-physical-goods-checkbox":!1,"is-show-setting-modal-button":!0,"shipping-info":l(V),onUpdateShippingRates:je},null,8,["shipping-info"])):S("",!0)])]),_:2},[l(O)?{name:"header",fn:s(()=>[u("h3",Ot,fe(`Edition #${G+1} / 版本 #${G+1}`),1)]),key:"0"}:void 0]),1024),u("div",Kt,[l(O)?(p(),U(k,{key:0,label:"Delete",color:"red",onClick:d=>Re(G)},null,8,["onClick"])):S("",!0)])]),_:2},1024))),128))]),_:1})]),_:1})),u("div",Ht,[B.isNewClassPage?(p(),U(k,{key:0,ui:{rounded:"rounded-full"},color:"gray",icon:"i-heroicons-plus-solid",label:"Add Edition",onClick:Oe})):S("",!0)]),n(I,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"12px"}}},{default:s(()=>[u("div",Xt,[e[13]||(e[13]=u("h3",{class:"font-bold font-mono"}," Advanced Settings ",-1)),n(k,{color:"gray",variant:"ghost",icon:l(Z)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",onClick:e[4]||(e[4]=()=>{Z.value=!l(Z)})},null,8,["icon"])]),l(Z)?(p(),A("div",Jt,[n(I,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""}}},{header:s(()=>[e[14]||(e[14]=u("h4",{class:"text-sm font-bold font-mono"}," Email to receive sales notifications / 欲收到銷售通知的電郵 ",-1)),u("div",Qt,[n(i,{modelValue:l(w),"onUpdate:modelValue":e[5]||(e[5]=a=>D(w)?w.value=a:null),placeholder:"abc@example.com"},null,8,["modelValue"]),n(k,{label:"Add",variant:l(w)?"outline":"solid",color:l(w)?"primary":"gray",disabled:!l(w),onClick:Ze},null,8,["variant","color","disabled"])])]),default:s(()=>[n(de,{columns:[{key:"email",label:"Email",sortable:!0},{key:"action"}],rows:l(Le)},{"email-data":s(({row:a})=>[n(k,{label:a.email,to:`mailto:${a.email}`,variant:"link",padded:!1},null,8,["label","to"])]),"action-data":s(({row:a})=>[u("div",Yt,[n(k,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>l(j).splice(a.index,1)},null,8,["onClick"])])]),_:1},8,["rows"])]),_:1}),l(x)?(p(),U(Ye,{key:0,"is-stripe-connect-checked":l($),"onUpdate:isStripeConnectChecked":e[6]||(e[6]=a=>D($)?$.value=a:null),"is-using-default-account":l(Q),"onUpdate:isUsingDefaultAccount":e[7]||(e[7]=a=>D(Q)?Q.value=a:null),"stripe-connect-wallet":l(L),"should-disable-setting":l(J),"login-address":l(C),onSave:qe},null,8,["is-stripe-connect-checked","is-using-default-account","stripe-connect-wallet","should-disable-setting","login-address"])):S("",!0),n(I,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"",base:"space-y-8"}}},{header:s(()=>[e[15]||(e[15]=u("h4",{class:"text-sm font-bold font-mono"}," Share sales data to wallets / 分享銷售數據給特定地址 ",-1)),u("div",eo,[n(i,{modelValue:l(b),"onUpdate:modelValue":e[8]||(e[8]=a=>D(b)?b.value=a:null),class:"font-mono",placeholder:"like1..."},null,8,["modelValue"]),n(k,{label:"Add",variant:l(b)?"outline":"solid",color:l(b)?"primary":"gray",disabled:!l(b),onClick:We},null,8,["variant","color","disabled"])])]),default:s(()=>[n(de,{columns:l(Te),rows:l($e)},{"wallet-data":s(({row:a})=>[n(k,{class:"font-mono",label:a.wallet,to:a.walletLink,variant:"link",padded:!1},null,8,["label","to"])]),"remove-data":s(({row:a})=>[u("div",to,[n(k,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>l(R).splice(a.index,1)},null,8,["onClick"])])]),_:1},8,["columns","rows"])]),_:1})])):S("",!0)]),_:1}),u("div",oo,[n(k,{label:l(Ne),loading:l(m),size:"lg",disabled:l(m),onClick:Ke},null,8,["label","loading","disabled"])])],64)):S("",!0),n(ot,{"model-value":!!l(m),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:s(()=>[u("div",ao,[u("div",lo,[n(et,{color:"Badge",variant:"soft"},{default:s(()=>e[16]||(e[16]=[he(" Loading... ")])),_:1}),e[17]||(e[17]=u("p",{class:"text-xs text-gray-500"}," 請勿關閉此視窗，直到操作完成。 ",-1))]),n(tt,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),wo=bt(io,[["__scopeId","data-v-a28d563f"]]);export{wo as _};
//# sourceMappingURL=CKhUHxvu.js.map
