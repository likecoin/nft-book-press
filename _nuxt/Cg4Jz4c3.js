import{_ as ke}from"./CdyLJFp0.js";import{a_ as we,a$ as Ue,bk as Ve,bt as Se,b7 as $e,b9 as r,bb as te,ba as S,bh as Ne,b1 as Re,b3 as M,aX as s,b4 as l,bC as Me,aT as v,aW as t,bD as Oe,bd as b,br as Pe,aU as d,b_ as Be,aS as G,bi as O,aV as ne,bx as Le,bo as le,bv as Ae,bw as De,bg as Ee,bp as Te}from"./C7FAJvts.js";import{_ as je}from"./wfSdpmFI.js";import{_ as ze}from"./WPwyWc_n.js";import{_ as Fe}from"./CdgG4lLc.js";import{_ as Je}from"./yuovjFBe.js";import{_ as Qe}from"./CSyAC7Qx.js";import{_ as qe}from"./B06g3z0f.js";import{_ as Ge}from"./lsNv6EQc.js";import{a as We}from"./BWbjILKN.js";import"./BvRpnvqr.js";import"./BRQIwwpv.js";import"./C-4yEyj4.js";import"./BnGd89K2.js";import"./BvQolC-c.js";import"./BfQThsOE.js";(function(){try{var I=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},f=new I.Error().stack;f&&(I._sentryDebugIds=I._sentryDebugIds||{},I._sentryDebugIds[f]="a112a521-c1ed-458c-a1ca-7bfca2c2265a",I._sentryDebugIdIdentifier="sentry-dbid-a112a521-c1ed-458c-a1ca-7bfca2c2265a")}catch{}})();const He={class:"flex items-center gap-2"},Ke=["textContent"],Xe={class:"flex items-start gap-4"},Ye=["src"],Ze={class:"flex flex-col justify-start"},eo=["textContent"],oo={class:"text-center"},to={class:"flex items-center gap-2 px-4 sm:px-6"},no={class:"flex items-center gap-2"},lo={class:"flex justify-center items-center gap-4"},ao={class:"flex items-center gap-2"},so={class:"flex justify-center gap-4"},ko=we({__name:"index",setup(I){const{t:f}=Ue(),W=Ve(),j=Se(),{BOOK3_URL:ae}=$e().public,P=We(),{lazyFetchClassMetadataById:H,lazyFetchClassListingInfoById:K}=P,c=r([{id:0,value:""}]),X=r(1),g=r(!1),h=r(""),C=r(""),y=r([]),_=r(""),m=r([]),x=r(!1),$=r(!1),k=r(!1);te(x,o=>{o||(c.value=[{id:0,value:""}],X.value=1)});const se=S(()=>{const o=[{key:"name",label:f("common.name"),class:""}];return k.value&&o.push({key:"delete-action",label:"",class:"w-12"}),o}),ie=S(()=>{const o=[];return z.value.length&&o.push([{label:k.value?"Exit Edit Items":"Edit Items",icon:k.value?"i-heroicons-pencil-solid":"i-heroicons-pencil",click:fe}]),o.push([{label:"New Coupon",icon:"i-heroicons-tag",click:()=>{g.value=!g.value}},{class:"text-red-500",label:"Clear All Coupons",icon:"i-heroicons-trash",iconClass:"text-red-500",disabled:!y.value.length,click:ve}]),o}),z=S(()=>{var o;return(o=m.value)==null?void 0:o.map((e,i)=>{var a,L,N,A,D,E;return{classId:e.classId,name:(a=P.getClassMetadataById(e.classId))==null?void 0:a.name,prices:(N=(L=P.getClassListingInfoById(e.classId))==null?void 0:L.prices)==null?void 0:N.map(V=>({...V})),image:Me((E=(D=(A=P.getClassMetadataById(e.classId))==null?void 0:A.data)==null?void 0:D.metadata)==null?void 0:E.image),index:i}})}),w=r([]),B=S(()=>w.value.map(e=>m.value[e.index]).sort((e,i)=>(e==null?void 0:e.priceIndex)!==void 0&&!(i!=null&&i.priceIndex)?-1:!(e!=null&&e.priceIndex)&&(i==null?void 0:i.priceIndex)!==void 0?1:0));te(z,o=>{o.length||(k.value=!1)});const U=S(()=>{const o=new URLSearchParams({utm_source:"direct-checkout",utm_medium:"pos"}),e=B.value.map(({classId:i,priceIndex:a})=>`${i}${a?`:${a}`:""}`).join(",");return o.append("products",e),_.value&&o.append("coupon",_.value),`${ae}/checkout?${o.toString()}`}),F=S(()=>"3ook Point Of Sale");Ne({title:()=>F.value,ogTitle:()=>F.value}),Re(()=>{try{const o=window.localStorage.getItem("nft_book_store_pos_items");if(o){const i=JSON.parse(o);m.value=i.map(a=>({classId:a.classId,priceIndex:a.priceIndex}))}const e=window.localStorage.getItem("nft_book_store_pos_coupons");if(e){const i=JSON.parse(e);y.value=i.map(a=>({name:a.name,code:a.code}))}}catch(o){console.error(o)}m.value.forEach(o=>{o.classId&&(H(o.classId),K(o.classId))})});function de(){c.value.length&&c.value.push({id:X.value++,value:""})}function re(o){c.value.splice(o,1)}function ue(o,e){c.value[o].error=void 0,c.value[o].value=e}function ce(){c.value.forEach(o=>{o.error=void 0;let e=o.value.trim();e.startsWith("http")&&(e=new URL(e).pathname.split("/").pop()||""),e.startsWith("0x")?(m.value.push({classId:e,priceIndex:0}),H(e),K(e)):o.error=new Error("Invalid product ID")}),c.value.every(o=>!o.error)&&(x.value=!1,J())}function me(o,{index:e}){m.value[e].priceIndex=Number(o),J()}function pe({index:o}){m.value.splice(o,1),w.value=w.value.filter(e=>e.index!==o),J()}function Y(){x.value=!x.value}function fe(){k.value=!k.value}function _e(){y.value.push({name:h.value,code:C.value}),h.value="",C.value="",Z(),j.add({title:"Added coupon",timeout:2e3,color:"green"}),g.value=!1}function ve(){window.confirm("Are you sure you want to clear all coupons?")&&(y.value=[],_.value="",Z(),j.add({title:"Cleared all coupons",timeout:2e3,color:"red"}))}function J(){window.localStorage.setItem("nft_book_store_pos_items",JSON.stringify(m.value))}function Z(){window.localStorage.setItem("nft_book_store_pos_coupons",JSON.stringify(y.value))}function be(){j.add({title:"Copied URL to clipboard",timeout:2e3}),navigator.clipboard.writeText(U.value)}function ge(){window.open(U.value)}function xe(){$.value=!0}return(o,e)=>{const i=ke,a=Pe,L=je,N=ze,A=Be,D=Fe,E=Le,V=De,T=Ae,Ie=Je,Q=Ee,he=Qe,q=Oe,Ce=qe,ye=Ge;return v(),M(ye,{key:l(W).path},{default:s(()=>[t(i,{title:l(F)},null,8,["title"]),t(Ce,{ui:{base:"flex flex-col items-stretch grow space-y-4",padding:"max-md:!px-0 max-md:py-0"}},{default:s(()=>[t(q,{ui:{base:"flex flex-col grow",rounded:"max-md:rounded-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"grow",padding:""},footer:{base:"sticky bottom-0 bg-white dark:bg-gray-900 rounded-b-[inherit]",padding:"px-0 sm:px-0 space-y-4"}}},{header:s(()=>[d("div",He,[d("h2",{class:"text-xl font-bold",textContent:ne(l(f)("sales_pos.sales_items")+(l(B).length>0?l(f)("sales_pos.selected_count",{count:l(B).length}):""))},null,8,Ke),t(a,{icon:"i-heroicons-plus-circle",variant:"soft",onClick:Y})]),t(L,{items:l(ie),popper:{placement:"bottom-end"}},{default:s(()=>[t(a,{color:"white",icon:"i-heroicons-ellipsis-horizontal-circle"})]),_:1},8,["items"])]),footer:s(()=>[d("div",to,[t(N,{modelValue:l(_),"onUpdate:modelValue":e[1]||(e[1]=n=>b(_)?_.value=n:null),class:"grow",options:l(y).map(n=>({label:n.name,value:n.code})),placeholder:"Select Coupon"},null,8,["modelValue","options"]),l(_)?(v(),M(a,{key:0,icon:"i-heroicons-x-mark-16-solid",size:"sm",color:"gray",variant:"outline",onClick:e[2]||(e[2]=()=>{_.value=""})})):O("",!0)]),t(E),t(he,{class:"w-full",items:[{key:"direct",label:l(f)("sales_pos.direct_checkout")}],ui:{wrapper:"px-4 sm:px-6",base:"flex flex-col space-y-4"}},{item:s(({item:n})=>[n.key==="direct"?(v(),G(le,{key:0},[t(T,{label:l(f)("sales_pos.checkout_url")},{default:s(()=>[d("div",no,[t(V,{modelValue:l(U),"onUpdate:modelValue":e[3]||(e[3]=u=>b(U)?U.value=u:null),class:"grow font-mono",readonly:""},null,8,["modelValue"]),t(a,{icon:"i-heroicons-clipboard-document",variant:"soft",color:"gray",onClick:be})])]),_:1},8,["label"]),d("div",lo,[t(a,{label:"View Cart",size:"lg",onClick:ge}),t(a,{label:"Generate QR Code",disabled:!l(B).length,size:"lg",onClick:xe},null,8,["disabled"]),t(Q,{modelValue:l($),"onUpdate:modelValue":e[5]||(e[5]=u=>b($)?$.value=u:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:s(()=>[t(Ie,{data:l(U),mode:"readonly","file-name":"likerland_checkout",width:280,height:280},{header:s(()=>[e[11]||(e[11]=d("h3",{class:"font-bold font-mono",textContent:"Scan to buy"},null,-1)),t(a,{icon:"i-heroicons-x-mark",color:"gray",variant:"ghost",onClick:e[4]||(e[4]=u=>$.value=!1)})]),_:1},8,["data"])]),_:1},8,["modelValue"])])],64)):O("",!0)]),_:1},8,["items"])]),default:s(()=>[t(D,{modelValue:l(w),"onUpdate:modelValue":e[0]||(e[0]=n=>b(w)?w.value=n:null),columns:l(se),rows:l(z),ui:{wrapper:"static h-full",thead:"sticky top-0"}},{"name-data":s(({row:n})=>{var u,R;return[d("div",Xe,[n.image?(v(),G("img",{key:0,class:"w-[64px] object-contain rounded-sm",src:n.image,alt:"Item image"},null,8,Ye)):O("",!0),d("div",Ze,[d("div",{class:"whitespace-break-spaces",textContent:ne(n.name)},null,8,eo),n.classId&&((u=n.prices)==null?void 0:u.length)>1?(v(),M(N,{key:0,class:"mt-2","model-value":l(m)[n.index].priceIndex||0,options:(R=n.prices)==null?void 0:R.map(p=>{var ee,oe;return{label:((ee=p.name)==null?void 0:ee.zh)||((oe=p.name)==null?void 0:oe.en)||p.name,value:p.index}}),"onUpdate:modelValue":p=>me(p,n)},null,8,["model-value","options","onUpdate:modelValue"])):O("",!0)])])]}),"delete-action-header":s(()=>[d("div",oo,[t(A,{name:"i-heroicons-trash-solid"})])]),"delete-action-data":s(({row:n})=>[t(a,{icon:"i-heroicons-x-mark",color:"red",variant:"link",onClick:u=>pe(n)},null,8,["onClick"])]),_:1},8,["modelValue","columns","rows"])]),_:1}),t(Q,{modelValue:l(x),"onUpdate:modelValue":e[6]||(e[6]=n=>b(x)?x.value=n:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:s(()=>[t(q,{ui:{rounded:"max-sm:rounded-b-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"space-y-4"},footer:{base:"flex justify-center items-center"}}},{header:s(()=>[e[12]||(e[12]=d("h3",{class:"font-bold font-mono",textContent:"Add Item(s)"},null,-1)),t(a,{icon:"i-heroicons-x-mark",color:"gray",variant:"link",onClick:Y})]),footer:s(()=>[t(a,{label:"Confirm",onClick:ce})]),default:s(()=>[(v(!0),G(le,null,Te(l(c),(n,u)=>{var R;return v(),M(T,{key:`input-${n.id}`,label:"Enter Product ID/URL(s)",required:!0,error:(R=n.error)==null?void 0:R.message},{default:s(()=>[d("div",ao,[t(V,{class:"grow font-mono","model-value":n.value,placeholder:"https://3ook.com/store/0x....","onUpdate:modelValue":p=>ue(u,p)},null,8,["model-value","onUpdate:modelValue"]),l(c).length>1?(v(),M(a,{key:0,icon:"i-heroicons-x-circle",variant:"link",onClick:p=>re(u)},null,8,["onClick"])):O("",!0)])]),_:2},1032,["error"])}),128)),d("div",so,[t(a,{icon:"i-heroicons-plus-circle",label:"Add",variant:"outline",onClick:de})])]),_:1})]),_:1},8,["modelValue"]),t(Q,{modelValue:l(g),"onUpdate:modelValue":e[10]||(e[10]=n=>b(g)?g.value=n:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:s(()=>[t(q,{ui:{rounded:"max-sm:rounded-b-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"space-y-4"},footer:{base:"flex justify-end items-center gap-4"}}},{header:s(()=>[e[13]||(e[13]=d("h3",{class:"font-bold",textContent:"Add Coupon"},null,-1)),t(a,{icon:"i-heroicons-x-mark-16-solid",color:"gray",size:"xl",padded:!1,variant:"link",onClick:e[7]||(e[7]=n=>g.value=!1)})]),footer:s(()=>[t(a,{icon:"i-heroicons-plus-circle",label:"Add Coupon",disabled:!l(h)||!l(C),onClick:_e},null,8,["disabled"])]),default:s(()=>[t(T,{label:"Coupon Name",help:"For POS Display Only",required:!0},{default:s(()=>[t(V,{modelValue:l(h),"onUpdate:modelValue":e[8]||(e[8]=n=>b(h)?h.value=n:null),placeholder:"Fall Promotion"},null,8,["modelValue"])]),_:1}),t(T,{label:"Coupon Code",required:!0},{default:s(()=>[t(V,{modelValue:l(C),"onUpdate:modelValue":e[9]||(e[9]=n=>b(C)?C.value=n:null),class:"font-mono",placeholder:"FALLPROMO"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}});export{ko as default};
