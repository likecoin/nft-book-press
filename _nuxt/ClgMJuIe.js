import{a_ as Qe,a$ as eo,b6 as oo,bl as to,bk as lo,bn as J,b9 as h,b8 as r,bJ as no,ba as K,bb as ao,b1 as so,aS as P,aT as _,b3 as A,br as S,aW as s,b4 as e,bs as io,bi as de,aU as u,aX as i,bf as D,aV as g,bt as ro,bL as ce,bj as uo,bE as co,aY as me,bA as mo,bg as _o,bU as fo,bK as po,bh as vo,aQ as bo}from"./WNE9bIA0.js";import{_ as ho}from"./Cjq0uDqV.js";import{_ as go}from"./D3DkCDbL.js";import{a as yo,_ as ko}from"./C-6BtS0x.js";import{p as wo,c as xo,_ as Eo,E as Co,a as Uo,v as So}from"./CC0-7M4A.js";import{_ as Vo}from"./BxtxvorN.js";import{_ as Mo}from"./Bp6wtMO7.js";import{_ as Io}from"./BCepBI9L.js";import{f as Po,D as _e,M as Q,U as Ao,c as Do}from"./YIQy1S0I.js";import{u as To}from"./AP_zfSk8.js";import{u as No}from"./CVZCu2JQ.js";import{g as $o}from"./BtIb796b.js";import{u as Lo}from"./DLy6siok.js";(function(){try{var f=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},j=new f.Error().stack;j&&(f._sentryDebugIds=f._sentryDebugIds||{},f._sentryDebugIds[j]="d1496cc6-60b4-4ff1-867f-f2ac4c0866ca",f._sentryDebugIdIdentifier="sentry-dbid-d1496cc6-60b4-4ff1-867f-f2ac4c0866ca")}catch{}})();function G(f=""){return f.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function Bo(f){return wo.sanitize(f)}const jo={class:"pb-[40px]"},zo={class:"font-bold font-mono"},Wo={class:"font-bold font-mono"},Fo={class:"block text-[14px] text-[#374151] mt-[8px]"},Ro={class:"flex flex-col gap-2"},Oo={class:"space-y-2"},Zo={key:0,class:"pl-8 space-y-2"},qo={class:"space-y-2"},Ko={key:0,class:"pl-8 space-y-2"},Go={class:"text-gray-500 text-[12px]"},Xo={class:"flex justify-center items-center"},Ho={class:"flex justify-center items-center"},Yo={class:"flex justify-between items-center w-full"},Jo={class:"font-bold font-mono"},Qo={key:0,class:"mt-[24px] flex flex-col gap-[12px]"},et={class:"text-sm font-bold font-mono"},ot={class:"flex gap-2"},tt={class:"flex justify-end items-center"},lt={class:"text-sm font-bold font-mono"},nt={class:"flex gap-2"},at={class:"flex justify-end items-center"},st={class:"w-full flex justify-center"},it={class:"space-y-3"},rt={class:"flex justify-between items-center"},ut={class:"text-xs text-gray-500"},dt=1*1024*1024,ct=Qe({__name:"NewNFTBook",props:{isNewClassPage:{type:Boolean,default:!1},classId:{type:String,default:""},editionIndex:{type:[String,Number],default:void 0},isEditMode:{type:Boolean,default:!1}},emits:["submit"],setup(f,{emit:j}){const{t:n}=eo(),{LIKE_CO_API:ee}=oo().public,fe=to(),z=lo(),oe=To(),{wallet:E}=J(fe),{newBookListing:pe,updateEditionPrice:ve,uploadSignImages:be}=z,{fetchStripeConnectStatusByWallet:he}=oe,{getStripeConnectStatusByWallet:ge}=J(oe),{token:ye}=J(z),ke=No(),{getBalanceOf:we}=Lo(),xe=j,V=h(()=>B.editionIndex),{lazyFetchClassMetadataById:te}=ke,y=r(""),m=r(!1),Ee=r({en:"e.g.: This edition includes EPUB and PDF ebook files.",zh:"例：此版本包含 EPUB 及 PDF 電子書檔"}),p=h(()=>B.classId),T=r(1),N=r(!1),M=r(!0),v=r([{price:_e,deliveryMethod:"auto",autoMemo:"Thank you for your support. It means a lot to me.",stock:Po,name:n("prices.standard_edition"),nameEn:"Standard Edition",nameZh:"標準版",descriptionEn:"",descriptionZh:"",isAllowCustomPrice:M.value,isUnlisted:!1}]),W=h(()=>v.value.length>1),F=r(["like1rclg677y2jqt8x4ylj0kjlqjjmnn6w63uflpgr"]),R=r([]),k=r(""),w=r(""),$=r(!1),L=r(""),X=r(!1),H=r(!0),Ce=r(null),O=r(null),Ue=r(Number(Do)),Se=h(()=>Math.max(ne.value-le.value,0)),Ve=r(0),le=r(0),ne=r(0),Me=r(["bold","italic","strikeThrough","title","-","unorderedList","orderedList","-","code","link","=","preview"]),C=h(()=>B.isEditMode),Ie=h(()=>C.value?n("nft_book_form.edit_title"):n("nft_book_form.page_title")),Pe=h(()=>C.value?n("common.save"):n("common.submit")),Z=r(!1),Ae=h(()=>[{key:"wallet",label:n("common.wallet"),sortable:!0},{key:"remove",label:"",sortable:!1}]),De=h(()=>F.value.map((l,o)=>({index:o,wallet:l,walletLink:no(l)}))),Te=h(()=>R.value.map((l,o)=>({index:o,email:l}))),ae=h(()=>{var l,o;return(o=(l=Ce.value)==null?void 0:l.contentMetadata)==null?void 0:o.inLanguage});K(m,l=>{l&&(y.value="")},{immediate:!0}),xo({markdownItConfig(l){l.options.html=!1}});const B=f;ao({title:()=>n("seo_titles.new_book_listing"),ogTitle:()=>n("seo_titles.new_book_listing")}),so(async()=>{try{m.value=!0;const l=E.value?await we(p.value,E.value):0;if(ne.value=Number(l)||0,C.value||V.value!==void 0){if(E.value)try{await he(E.value),ge.value(E.value).isReady&&($.value=!0,L.value=E.value)}catch(t){console.error(t)}const o=await $fetch(`${ee}/likernft/book/store/${p.value}`,{headers:{authorization:`Bearer ${ye.value}`}});if(o){if((o==null?void 0:o.ownerWallet)!==E.value)throw new Error("NOT_OWNER_OF_NFT_CLASS");if(V.value!==void 0)if(o.prices.length){const t=o.prices.find(d=>d.index.toString()===V.value);if(!t)throw new Error("Edition not found");v.value=[{price:t.price,deliveryMethod:t.isAutoDeliver?"auto":"manual",autoMemo:t.autoMemo,stock:t.stock,name:o.inLanguage==="en"?t.name.en:t.name.zh,nameEn:t.name.en,nameZh:t.name.zh,descriptionEn:t.description.en,descriptionZh:t.description.zh,isAllowCustomPrice:t.isAllowCustomPrice,isUnlisted:t.isUnlisted,oldIsAutoDeliver:t.isAutoDeliver,oldStock:t.stock}],M.value=t.isAllowCustomPrice}else throw new Error("No prices found");Ve.value=o.prices.reduce((t,d)=>d.index.toString()!==V.value?t+d.stock:t,0),le.value=o.prices.reduce((t,d)=>d.index.toString()!==V.value&&!d.isAutoDeliver?t+d.stock:t,0)}else throw new Error(n("errors.nft_class_not_found"))}}catch(l){console.error(l)}finally{m.value=!1}}),K(M,l=>{v.value.forEach(o=>{o.isAllowCustomPrice=l})}),K(m,l=>{l&&(y.value="")}),K(p,async l=>{if(l){const o=await te(l),t=o==null?void 0:o.contentFingerprints;t&&Ne(t)&&(N.value=!0)}},{immediate:!0});function Ne(l){const t=$o().API_GET_ARWEAVE_V2_LINK;return l.some(d=>!!d.startsWith(t)||d.includes("?key="))}function $e(l,o="signatureImage"){if(!(l!=null&&l.length))return;const t=l[0];if(t.type!=="image/png"){y.value=n("errors.png_only");return}if(t.size>dt){y.value=n("errors.file_size_limit");return}o==="signatureImage"?O.value=t:console.warn(`Unknown upload key: ${o}`)}function Le(l){l.stock=Math.min(Se.value,l.stock)}function Be(){T.value+=1,v.value.push({index:So(),price:_e,deliveryMethod:"auto",autoMemo:"",stock:1,name:ae.value==="en"?`Tier ${T.value}`:`級別 ${T.value}`,nameEn:`Tier ${T.value}`,nameZh:`級別 ${T.value}`,descriptionEn:"",descriptionZh:"",isAllowCustomPrice:!0,isUnlisted:!1})}function je(l){v.value.splice(l,1)}function ze(){k.value&&(F.value.push(k.value),k.value="")}function We(){w.value&&(R.value.push(w.value),w.value="")}function Fe(l){L.value=l,X.value=!0}function q(l){const o=ae.value==="en";return l.map(t=>({name:o?{en:t.name,zh:t.nameZh}:{en:t.nameEn,zh:t.name},description:o?{en:G(t.description),zh:G(t.descriptionZh)}:{en:G(t.descriptionEn),zh:G(t.description)},priceInDecimal:Math.round(Number(t.price)*100),price:Number(t.price),stock:Number(t.stock),isAutoDeliver:t.deliveryMethod==="auto",isAllowCustomPrice:t.isAllowCustomPrice,isUnlisted:t.isUnlisted??!1,autoMemo:t.deliveryMethod==="auto"&&t.autoMemo||""}))}function Re(l){const o=[];return l.forEach(t=>{(!t.name.en||!t.name.zh)&&o.push({path:"name",message:n("errors.product_name_required")})}),o.length>0?(y.value=o.map(t=>t.message).join(`
`),!1):!0}async function Oe(){try{const l=q(v.value);if(!Re(l))return;if(C.value?await Ze():B.isNewClassPage?await se():(await fetch(`${ee}/likernft/book/store/${p.value}`)).ok?await qe():await se(),O.value){const o=new FormData;O.value&&o.append("signImage",O.value),await be(o,p.value)}xe("submit")}catch{}}async function se(){try{if(!p.value)throw new Error(n("errors.nft_class_id_required"));if(k.value)throw new Error(n("errors.add_moderator_wallet"));if(w.value)throw new Error(n("errors.add_notification_email"));m.value=!0;const l=await te(p.value),o=(l==null?void 0:l.nft_meta_collection_id)||"";if(!o.includes("nft_book")&&!o.includes("book_nft"))throw new Error(n("errors.not_nft_book_collection"));const t=q(v.value);if(t.find(U=>U.price!==0&&U.price<Q))throw new Error(n("errors.price_validation",{minPrice:Q}));const d=$.value&&L.value?{[L.value]:100}:null,b=v.value.some(U=>U.deliveryMethod==="manual");await pe(p.value,{defaultPaymentCurrency:"USD",connectedWallets:d,moderatorWallets:F.value,notificationEmails:R.value,prices:t,mustClaimToView:!0,enableCustomMessagePage:b,hideDownload:N.value})}catch(l){const o=l.data||l;console.error(o),y.value=o}finally{X.value=!1,m.value=!1}}async function Ze(){try{if(!C.value)throw new Error(n("errors.missing_edition_data"));const o=q(v.value)[0];m.value=!0,await ve(p.value,V.value,{price:o})}catch(l){const o=l.data||l;console.error(o),y.value=o}finally{m.value=!1}}async function qe(){try{m.value=!0;const o=q(v.value)[0];await z.addEditionPrice(p.value.toString(),(V.value||0).toString(),{price:o})}catch(l){console.error(l)}finally{m.value=!1}}return(l,o)=>{const t=io,d=ho,b=go,U=yo,ie=Eo,I=ro,Ke=Vo,Ge=mo,re=Mo,x=_o,ue=ko,Xe=Io,He=fo,Ye=po,Je=vo;return _(),P("div",jo,[e(y)?(_(),A(t,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${e(y)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:o[0]||(o[0]=a=>y.value="")},null,8,["title"])):S("",!0),e(z).isAuthenticated?(_(),P(de,{key:1},[s(I,{ui:{body:{base:"space-y-4"}}},{header:i(()=>[u("h2",zo,g(e(Ie)),1)]),default:i(()=>[s(b,{label:e(n)("nft_book_form.nft_class_id")},{default:i(()=>[s(d,{"model-value":e(p),disabled:"",class:"font-mono"},null,8,["model-value"])]),_:1},8,["label"]),s(b,{class:"flex items-center"},{default:i(()=>[s(ie,{"tool-tip-text":e(n)("nft_book_form.drm_tooltip")},{default:i(()=>[s(U,{modelValue:e(N),"onUpdate:modelValue":o[1]||(o[1]=a=>D(N)?N.value=a:null),name:"hideDownload",disabled:!0,label:e(n)("nft_book_form.drm_label")},null,8,["modelValue","label"])]),_:1},8,["tool-tip-text"])]),_:1}),s(b,null,{default:i(()=>[s(U,{modelValue:e(M),"onUpdate:modelValue":o[2]||(o[2]=a=>D(M)?M.value=a:null),name:"isAllowCustomPrice",label:e(n)("nft_book_form.accept_tipping")},null,8,["modelValue","label"])]),_:1})]),_:1}),(_(),A(ce(e(W)?"ul":"div"),{class:"flex flex-col gap-[12px]"},{default:i(()=>[s(I,{ui:{body:{base:"space-y-5 relative"},base:"overflow-visible border-none !border-transparent"}},{default:i(()=>[(_(!0),P(de,null,uo(e(v),(a,Y)=>(_(),A(ce(e(W)?"li":"div"),{key:a.index},{default:i(()=>[s(I,{ui:{body:{base:"flex flex-col gap-[20px]"},base:"overflow-visible border-[4px]"}},co({default:i(()=>[s(b,{label:e(n)("nft_book_form.unit_price_label",{minPrice:e(Q)})},{default:i(()=>[s(Ke,{modelValue:a.price,"onUpdate:modelValue":c=>a.price=c,options:e(Ao),"value-attribute":"value"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:2},1032,["label"]),s(b,{label:e(n)("nft_book_form.copies_label")},{default:i(()=>[s(d,{modelValue:a.stock,"onUpdate:modelValue":c=>a.stock=c,type:"number",step:"1",min:0,max:e(Ue)},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1032,["label"]),s(b,{label:e(n)("new_nft_book.product_name"),ui:{container:"space-y-2"}},{label:i(()=>[me(g(e(n)("nft_book_form.product_name"))+" ",1),s(ie,{"image-style":{width:"250px"}},{image:i(()=>o[9]||(o[9]=[u("img",{src:Uo,class:"object-cover",alt:""},null,-1)])),default:i(()=>[s(Ge,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:i(()=>[s(d,{modelValue:a.name,"onUpdate:modelValue":c=>a.name=c,placeholder:e(n)("nft_book_form.product_name_placeholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),u("span",Fo,g(e(n)("nft_book_form.description_optional")),1),s(e(Co),{modelValue:a.descriptionEn,"onUpdate:modelValue":c=>a.descriptionEn=c,language:"en-US","editor-id":`en-${Y}`,placeholder:e(Ee).en,toolbars:e(Me),sanitize:e(Bo),style:{height:"200px",width:"100%",marginTop:"0px"}},null,8,["modelValue","onUpdate:modelValue","editor-id","placeholder","toolbars","sanitize"])]),_:2},1032,["label"]),u("div",Ro,[u("div",Oo,[s(re,{modelValue:a.deliveryMethod,"onUpdate:modelValue":c=>a.deliveryMethod=c,value:"auto",disabled:e(C)&&a.oldIsAutoDeliver,name:"deliveryMethod",label:e(n)("nft_book_form.auto_delivery")},null,8,["modelValue","onUpdate:modelValue","disabled","label"]),a.deliveryMethod==="auto"?(_(),P("div",Zo,[s(b,{label:e(n)("nft_book_form.delivery_memo")},{default:i(()=>[s(d,{modelValue:a.autoMemo,"onUpdate:modelValue":c=>a.autoMemo=c,placeholder:e(n)("nft_book_form.memo_placeholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"])])):S("",!0)]),u("div",qo,[s(re,{modelValue:a.deliveryMethod,"onUpdate:modelValue":c=>a.deliveryMethod=c,value:"manual",disabled:e(C)&&a.oldIsAutoDeliver,name:"deliveryMethod",label:e(n)("nft_book_form.manual_delivery"),onClick:c=>Le(a)},null,8,["modelValue","onUpdate:modelValue","disabled","label","onClick"]),a.deliveryMethod==="manual"?(_(),P("div",Ko,[s(b,null,{label:i(()=>[u("p",null,g(e(n)("nft_book_form.autograph_image")),1),u("span",Go,g(e(n)("nft_book_form.image_requirements")),1)]),default:i(()=>[s(d,{type:"file",accept:"image/png",onChange:o[3]||(o[3]=c=>$e(c,"signatureImage"))})]),_:1})])):S("",!0)])]),s(b,null,{default:i(()=>[s(U,{modelValue:a.isUnlisted,"onUpdate:modelValue":c=>a.isUnlisted=c,name:"isUnlisted",label:e(n)("nft_book_form.pause_selling")},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024)]),_:2},[e(W)?{name:"header",fn:i(()=>[u("h3",Wo,g(e(n)("nft_book_form.edition_number",{number:Y+1})),1)]),key:"0"}:void 0]),1024),u("div",Xo,[e(W)?(_(),A(x,{key:0,label:e(n)("common.delete"),color:"red",onClick:c=>je(Y)},null,8,["label","onClick"])):S("",!0)])]),_:2},1024))),128))]),_:1})]),_:1})),u("div",Ho,[B.isNewClassPage?(_(),A(x,{key:0,ui:{rounded:"rounded-full"},color:"gray",icon:"i-heroicons-plus-solid",label:e(n)("nft_book_form.add_edition"),onClick:Be},null,8,["label"])):S("",!0)]),s(I,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"12px"}}},{default:i(()=>[u("div",Yo,[u("h3",Jo,g(e(n)("nft_book_form.advanced_settings")),1),s(x,{color:"gray",variant:"ghost",icon:e(Z)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",onClick:o[4]||(o[4]=()=>{Z.value=!e(Z)})},null,8,["icon"])]),e(Z)?(_(),P("div",Qo,[s(I,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""}}},{header:i(()=>[u("h4",et,g(e(n)("nft_book_form.notification_email_header")),1),u("div",ot,[s(d,{modelValue:e(w),"onUpdate:modelValue":o[5]||(o[5]=a=>D(w)?w.value=a:null),placeholder:"abc@example.com"},null,8,["modelValue"]),s(x,{label:e(n)("common.add"),variant:e(w)?"outline":"solid",color:e(w)?"primary":"gray",disabled:!e(w),onClick:We},null,8,["label","variant","color","disabled"])])]),default:i(()=>[s(ue,{columns:[{key:"email",label:e(n)("common.email"),sortable:!0},{key:"action"}],rows:e(Te)},{"email-data":i(({row:a})=>[s(x,{label:a.email,to:`mailto:${a.email}`,variant:"link",padded:!1},null,8,["label","to"])]),"action-data":i(({row:a})=>[u("div",tt,[s(x,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>e(R).splice(a.index,1)},null,8,["onClick"])])]),_:1},8,["columns","rows"])]),_:1}),e(C)?(_(),A(Xe,{key:0,"is-stripe-connect-checked":e($),"onUpdate:isStripeConnectChecked":o[6]||(o[6]=a=>D($)?$.value=a:null),"is-using-default-account":e(H),"onUpdate:isUsingDefaultAccount":o[7]||(o[7]=a=>D(H)?H.value=a:null),"stripe-connect-wallet":e(L),"should-disable-setting":e(X),"login-address":e(E),onSave:Fe},null,8,["is-stripe-connect-checked","is-using-default-account","stripe-connect-wallet","should-disable-setting","login-address"])):S("",!0),s(I,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"",base:"space-y-8"}}},{header:i(()=>[u("h4",lt,g(e(n)("nft_book_form.share_sales_data")),1),u("div",nt,[s(d,{modelValue:e(k),"onUpdate:modelValue":o[8]||(o[8]=a=>D(k)?k.value=a:null),class:"font-mono",placeholder:"0x..."},null,8,["modelValue"]),s(x,{label:e(n)("common.add"),variant:e(k)?"outline":"solid",color:e(k)?"primary":"gray",disabled:!e(k),onClick:ze},null,8,["label","variant","color","disabled"])])]),default:i(()=>[s(ue,{columns:e(Ae),rows:e(De)},{"wallet-data":i(({row:a})=>[s(x,{class:"font-mono",label:a.wallet,to:a.walletLink,variant:"link",padded:!1},null,8,["label","to"])]),"remove-data":i(({row:a})=>[u("div",at,[s(x,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>e(F).splice(a.index,1)},null,8,["onClick"])])]),_:1},8,["columns","rows"])]),_:1})])):S("",!0)]),_:1}),u("div",st,[s(x,{label:e(Pe),loading:e(m),size:"lg",disabled:e(m),onClick:Oe},null,8,["label","loading","disabled"])])],64)):S("",!0),s(Je,{"model-value":!!e(m),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:i(()=>[u("div",it,[u("div",rt,[s(He,{variant:"soft"},{default:i(()=>[me(g(e(n)("common.loading")),1)]),_:1}),u("p",ut,g(e(n)("nft_book_form.loading_progress_text")),1)]),s(Ye,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),Ct=bo(ct,[["__scopeId","data-v-1c5f68f7"]]);export{Ct as _};
