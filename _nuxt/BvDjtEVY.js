import{_ as ce}from"./DQA7KcMa.js";import{a_ as ue,b7 as de,a$ as fe,bw as me,bv as _e,b8 as ee,b0 as pe,b9 as T,ba as B,bb as be,b1 as ye,b3 as c,aX as a,bx as he,cq as ke,cr as V,aT as r,bi as E,aS as H,b4 as e,bn as te,aW as s,bA as ge,c9 as R,aY as z,aV as L,aU as S,bq as ve,be as xe}from"./DKQfXkmP.js";import{_ as Se}from"./CkmEsEx1.js";import{_ as we}from"./BUZ_eXdg.js";import{_ as Ie}from"./Cmasbhyi.js";import{_ as Ce}from"./CLRWOvdN.js";import{_ as $e}from"./Dfk8Yp3t.js";import{_ as Te}from"./C9oTDVtx.js";import{a as Ee}from"./CBAIrppT.js";import"./BzhPE6u9.js";import"./KfUHJoSC.js";import"./Qp-aIGUz.js";(function(){try{var h=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},m=new h.Error().stack;m&&(h._sentryDebugIds=h._sentryDebugIds||{},h._sentryDebugIds[m]="b55e9847-abca-4286-86d3-fe5ad4830f64",h._sentryDebugIdIdentifier="sentry-dbid-b55e9847-abca-4286-86d3-fe5ad4830f64")}catch{}})();const Le={class:"text-center font-bold font-mono"},Ue={key:1},Be={class:"text-center font-bold font-mono"},Re=["href"],Me=ue({__name:"index",setup(h){const{LIKE_CO_API:m,BOOK3_URL:U}=de().public,{t:n}=fe(),j=Ee(),F=me(),D=_e(),{token:k,wallet:oe}=ee(F),{bookUser:b,userLikerInfo:w,isFetchingUserLikerInfo:ae}=ee(D),ne=pe(),f=T(""),l=T(!1),g=T({}),N=T([]),G=T([]),K=B(()=>{var t,o;return(t=w.value)!=null&&t.user?he((o=w.value)==null?void 0:o.user):""});be(l,t=>{t&&(f.value="")}),ye(async()=>{await Promise.all([M(),q(),Y(),D.lazyFetchBookUserProfile()]),y.value&&await W()});const y=B(()=>{var t;return(t=g.value)==null?void 0:t.isReady}),se=B(()=>N.value.map(t=>{let o=t.type;switch(o){case"connectedWallet":o="royalties";break;case"channelCommission":o="channel";break}return{...t,type:o,amount:V(t.amount,t.currency),amountTotal:V(t.amountTotal,t.currency),currency:ke(t.currency),timestamp:new Date(t.timestamp).toLocaleString()}})),re=B(()=>G.value.map(t=>{const{id:o,amount:u,currency:d,status:v,arrivalTs:I,createdTs:A}=t;return{id:o,amount:V(u,d),status:v,createdTs:new Date(A*1e3).toLocaleString(),arrivalTs:I?new Date(I*1e3).toLocaleString():""}}));async function M(){try{l.value=!0;const t=await $fetch(`${m}/likernft/book/user/commissions/list`,{headers:{authorization:`Bearer ${k.value}`}});N.value=(t==null?void 0:t.commissions)||[],new Set(N.value.filter(u=>u.classId).map(u=>u.classId)).forEach(u=>j.lazyFetchClassMetadataById(u))}catch(t){console.error(t),f.value=t.toString()}finally{l.value=!1}}async function W(){try{l.value=!0;const t=await $fetch(`${m}/likernft/book/user/payouts/list`,{headers:{authorization:`Bearer ${k.value}`}});G.value=(t==null?void 0:t.payouts)||[]}catch(t){console.error(t),f.value=t.toString()}finally{l.value=!1}}async function q(){try{await D.fetchUserLikerInfo({nocache:!0})}catch(t){console.error(t),f.value=t.toString()}}async function Y(){var t;try{await X(),(t=g.value)!=null&&t.hasAccount&&!y.value&&(await $fetch(`${m}/likernft/book/user/connect/refresh`,{method:"POST",headers:{authorization:`Bearer ${k.value}`}})).isReady&&(g.value.isReady=!0,await X())}catch(o){console.error(o),f.value=o.toString()}finally{l.value=!1}}async function X(){try{l.value=!0;const t=await $fetch(`${m}/likernft/book/user/connect/status?wallet=${oe.value}`,{headers:{authorization:`Bearer ${k.value}`}});g.value=t||{}}catch(t){console.error(t),f.value=t.toString()}finally{l.value=!1}}async function J(){try{l.value=!0;const o=(await $fetch(`${m}/likernft/book/user/connect/login`,{method:"POST",headers:{authorization:`Bearer ${k.value}`}})).url;if(o)window.open(o);else throw new Error("CANNOT_GET_STRIPE_CONNECT_RUL")}catch(t){console.error(t),f.value=t.toString()}finally{l.value=!1}}async function ie(){try{l.value=!0;const o=(await $fetch(`${m}/likernft/book/user/connect/new`,{method:"POST",headers:{authorization:`Bearer ${k.value}`}})).url;if(o)window.open(o);else throw new Error("CANNOT_GET_STRIPE_CONNECT_RUL")}catch(t){console.error(t),f.value=t.toString()}finally{l.value=!1}}return(t,o)=>{const u=ce,d=ve,v=Se,I=we,A=Ie,P=Ce,C=ge,x=xe,O=$e,le=Te;return r(),c(le,null,{default:a(()=>{var Q;return[e(f)?(r(),c(u,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${e(f)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:o[0]||(o[0]=i=>f.value="")},null,8,["title"])):E("",!0),e(y)?E("",!0):(r(),c(u,{key:1,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"soft",title:e(n)("user_settings.stripe_express_notice"),description:e(n)("user_settings.stripe_express_description")},null,8,["title","description"])),e(F).isAuthenticated?(r(),H(te,{key:2},[s(C,{ui:{header:{base:"flex justify-between items-center"},footer:{base:"text-center"}}},R({header:a(()=>[S("h1",Le,L(e(n)("user_settings.affiliation_program")),1),s(v,{text:e(n)("user_settings.refresh_liker_id"),popper:{placement:"left"}},{default:a(()=>[s(d,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:e(ae),onClick:q},null,8,["disabled"])]),_:1},8,["text"])]),default:a(()=>{var i;return[(i=e(w))!=null&&i.user?(r(),c(P,{key:0,label:e(n)("user_settings.affiliation_channel_id"),size:"xl"},R({default:a(()=>[s(I,{placeholder:e(n)("user.affiliation_id_placeholder"),"model-value":e(K),disabled:""},null,8,["placeholder","model-value"])]),_:2},[e(y)?{name:"help",fn:a(()=>[o[1]||(o[1]=z(" Append ")),s(A,{class:"font-mono"},{default:a(()=>[z(" ?from="+L(e(K)),1)]),_:1}),o[2]||(o[2]=z(" in any bookstore page to earn commission from book sales. "))]),key:"1"}:{name:"help",fn:a(()=>[z(L(e(n)("user_settings.setup_stripe_notice")),1)]),key:"0"}]),1032,["label"])):(r(),H("p",Ue," You have not setup your channel ID yet. "))]}),_:2},[(Q=e(w))!=null&&Q.user?void 0:{name:"footer",fn:a(()=>[s(d,{label:"Setup your ID",size:"lg",rel:"noopener",target:"_blank",to:`${e(U)}/account`},null,8,["to"])]),key:"0"}]),1024),s(C,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{header:a(()=>[S("h1",Be,L(e(n)("user_settings.stripe_payout_status")),1),s(v,{text:"Refresh Status",popper:{placement:"left"}},{default:a(()=>[s(d,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:e(l),onClick:Y},null,8,["disabled"])]),_:1})]),footer:a(()=>{var i;return[e(l)?(r(),c(d,{key:0,label:"Loading",size:"lg",loading:!0,onClick:J})):e(y)?(r(),c(d,{key:1,label:"Login to Stripe account",size:"lg",onClick:J})):(i=e(w))!=null&&i.user?(r(),c(d,{key:3,label:"Setup Stripe Payment Recipient Account",size:"lg",onClick:ie})):(r(),c(d,{key:2,label:"Setup your ID",size:"lg",rel:"noopener",target:"_blank",to:`${e(U)}/account`},null,8,["to"]))]}),default:a(()=>{var i;return[s(O,{columns:[{key:"initiated",label:e(n)("user_settings.setup_initiated")},{key:"completed",label:e(n)("user_settings.setup_completed")}],rows:[{initiated:((i=e(g))==null?void 0:i.hasAccount)||!1,completed:e(y)||!1}],ui:{th:{base:"text-center"},td:{base:"text-center"}}},{"initiated-data":a(({row:_})=>[_.initiated?(r(),c(x,{key:0,label:e(n)("user.yes"),color:"green",variant:"outline"},null,8,["label"])):(r(),c(x,{key:1,label:e(n)("user.no"),color:"red",variant:"outline"},null,8,["label"]))]),"completed-data":a(({row:_})=>{var p;return[_.completed?(r(),c(x,{key:0,label:((p=e(g))==null?void 0:p.notificationEmail)||e(n)("user.yes"),color:"green",variant:"outline"},null,8,["label"])):(r(),c(x,{key:1,label:e(n)("user.no"),color:"red",variant:"outline"},null,8,["label"]))]}),_:1},8,["columns","rows"])]}),_:1}),e(y)?(r(),H(te,{key:0},[s(C,{ui:{header:{base:"flex justify-between items-center"},body:{base:"flex flex-col gap-6"},footer:{base:"text-center"}}},{header:a(()=>o[3]||(o[3]=[S("h1",{class:"text-center font-bold font-mono"}," User Setting ",-1)])),default:a(()=>{var i,_;return[s(P,{label:"Liker ID Email"},{default:a(()=>{var p,$;return[s(I,{"model-value":(p=e(b))==null?void 0:p.notificationEmail,label:"Liker ID Email",disabled:"",ui:{base:"font-mono"}},R({_:2},[($=e(b))!=null&&$.notificationEmail?{name:"trailing",fn:a(()=>{var Z;return[(Z=e(b))!=null&&Z.isEmailVerified?(r(),c(x,{key:0,label:"Verified",color:"green",size:"xs",ui:{rounded:"rounded-full"}})):(r(),c(x,{key:1,label:"Unverified",color:"amber",variant:"outline",size:"xs",ui:{rounded:"rounded-full"}}))]}),key:"0"}:void 0]),1032,["model-value"])]}),_:1}),s(P,{label:"Email Notification Settings"},R({_:2},[!((i=e(b))!=null&&i.notificationEmail)||!((_=e(b))!=null&&_.isEmailVerified)?{name:"help",fn:a(()=>{var p,$;return[(p=e(b))!=null&&p.notificationEmail?($=e(b))!=null&&$.isEmailVerified?E("",!0):(r(),c(u,{key:1,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"subtle",title:"Email is not verified.",description:"To enable email notifications, please verify your Liker ID email."})):(r(),c(u,{key:0,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"subtle",title:"Email is not setup yet.",description:"To enable email notifications, please setup your Liker ID email."}))]}),key:"0"}:void 0]),1024)]}),_:1}),s(C,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{header:a(()=>[o[4]||(o[4]=S("h1",{class:"text-center font-bold font-mono"}," Book Sales Commission History ",-1)),s(v,{text:"Refresh Status",popper:{placement:"left"}},{default:a(()=>[s(d,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:e(l),onClick:M},null,8,["disabled"])]),_:1})]),default:a(()=>[s(O,{columns:[{key:"timestamp",label:e(n)("user_settings.timestamp")},{key:"type",label:e(n)("user_settings.commission_type")},{key:"amount",label:e(n)("user_settings.commission")},{key:"classId",label:e(n)("user_settings.book_id")},{key:"currency",label:e(n)("user_settings.currency")},{key:"amountTotal",label:e(n)("user_settings.sale_amount")}],rows:e(se),ui:{th:{base:"text-center"},td:{base:"text-center"}}},{"classId-data":a(({row:i})=>{var _;return[S("a",{href:`${e(U)}/store/${i.classId}`,target:"_blank"},L(((_=e(j).getClassMetadataById(i.classId))==null?void 0:_.name)||i.classId),9,Re)]}),_:1},8,["columns","rows"])]),_:1}),s(C,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{header:a(()=>[o[5]||(o[5]=S("h1",{class:"text-center font-bold font-mono"}," Commission Payout History ",-1)),s(v,{text:"Refresh Status",popper:{placement:"left"}},{default:a(()=>[s(d,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:e(l),onClick:W},null,8,["disabled"])]),_:1})]),default:a(()=>[s(O,{columns:[{key:"createdTs",label:e(n)("user_settings.created")},{key:"amount",label:e(n)("user_settings.payout_amount")},{key:"status",label:e(n)("user_settings.status")},{key:"arrivalTs",label:e(n)("user_settings.arrived")},{key:"details",label:e(n)("user_settings.details")}],rows:e(re),ui:{th:{base:"text-center"},td:{base:"text-center"}}},{"details-data":a(({row:i})=>[s(d,{label:"Details",size:"sm",color:"gray",to:e(ne)({name:"my-books-user-payouts-payoutId",params:{payoutId:i.id}})},null,8,["to"])]),_:1},8,["columns","rows"])]),_:1})],64)):E("",!0)],64)):E("",!0)]}),_:1})}}});export{Me as default};
