import{a_ as te,bl as re,b6 as ne,bn as ue,b8 as o,b9 as O,ba as ee,b1 as ce,dv as ye,aS as k,aT as b,aW as i,b4 as t,bf as se,aX as S,aU as _,cL as Ie,aY as W,aV as A,bO as he,bh as Ne,cQ as Se,aQ as Fe,b3 as H,bt as xe,cs as Te,bg as de,br as j,bb as Ce,bs as ke,a$ as Me,bm as Re,b0 as Ue,dw as De,b2 as ae,dx as Ee,bc as le,bi as $e,bj as Be,cv as Ve,dy as Le}from"./C7XQIrPM.js";import{u as pe,b as Ae,v as Oe,c as ie,d as Pe,f as Ke,a as ze,_ as je,e as qe}from"./D9D2MXB0.js";import{a as Ge,u as We}from"./BRjOu1Ku.js";import{a as Ye,u as He}from"./B0xlgrh7.js";import{_ as Je}from"./CROjSDN2.js";import{_ as me}from"./DvV_81yL.js";import{_ as Qe}from"./BYHpLKh4.js";import{_ as Xe}from"./DAsO9jpg.js";import"./C-xXY3k_.js";import"./D_LCcsEc.js";import"./DjLNcy8s.js";import"./CZhspGV5.js";import"./D5P7yXPC.js";import"./C6NCxhyU.js";import"./BN5PBCdi.js";import"./BimtM7Sk.js";import"./ciiQ9bXN.js";import"./DHzo0BjK.js";import"./Bc0j_xCf.js";import"./DYq6x77p.js";import"./mc_zd3Xm.js";import"./CjYJqPtf.js";(function(){try{var F=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},p=new F.Error().stack;p&&(F._sentryDebugIds=F._sentryDebugIds||{},F._sentryDebugIds[p]="5a4a86ed-7ee5-4c4b-bd4e-5423160de827",F._sentryDebugIdIdentifier="sentry-dbid-5a4a86ed-7ee5-4c4b-bd4e-5423160de827")}catch{}})();const Ze={class:"space-y-3"},et={class:"flex justify-between items-center"},tt=te({__name:"RegisterISCN",emits:["handleSubmit","submit","formValidChange"],setup(F,{expose:p,emit:f}){const h=re(),{getFileType:M}=ie(),{LIKE_EVM_NFT_TARGET_ADDRESS:x}=ne().public,{wallet:y,signer:I}=ue(h),{initIfNecessary:m}=h,{assertPositiveWalletBalance:a,waitForTransactionReceipt:T}=Ye(),{stripHtmlTags:U,formatLanguage:P}=ie(),{showErrorToast:D}=pe(),{LIKE_NFT_CONTRACT_ADDRESS:g}=ne().public,w=o({type:"Book",title:"",description:"",isbn:"",publisher:"",publicationDate:"",author:{name:"",description:""},license:"All Rights Reserved",customLicense:"",contentFingerprints:[{url:""}],downloadableUrls:[{url:"",type:"",fileName:""}],language:"",bookInfoUrl:"",tags:[],coverUrl:""}),u=o(""),R=o(""),K=f,{payload:q}=Ae({iscnFormData:w}),{writeContractAsync:G}=He(),s=O(()=>Oe(w.value)),r=O(()=>{var e;return!((e=s.value)!=null&&e.length)});ee(r,e=>{K("formValidChange",e)},{immediate:!0}),ce(()=>{const e=E();e&&(w.value=e)});const E=()=>{var C,N,B,V,z,J;const e=ye();if(!e)return null;const c={type:"Book",title:((C=e.epubMetadata)==null?void 0:C.title)||"",description:U(((N=e.epubMetadata)==null?void 0:N.description)||""),isbn:"",publisher:"",publicationDate:new Date().toISOString().split("T")[0],author:{name:((B=e.epubMetadata)==null?void 0:B.author)||"",description:""},license:"All Rights Reserved",contentFingerprints:[],downloadableUrls:[],coverUrl:(V=e.epubMetadata)!=null&&V.thumbnailArweaveId?`ar://${e.epubMetadata.thumbnailArweaveId}`:"",language:P(((z=e.epubMetadata)==null?void 0:z.language)||"zh"),tags:((J=e.epubMetadata)==null?void 0:J.tags)||[]};return c.downloadableUrls=e.fileRecords.filter(d=>d.fileType==="application/pdf"||d.fileType==="application/epub+zip").map(d=>({url:d.arweaveKey?d.arweaveLink:`ar://${d.arweaveId}`,type:M(d.fileType),fileName:d.fileName})),c.contentFingerprints=[...new Set(e.fileRecords.map(d=>{const Q=d.arweaveKey?d.arweaveLink:`ar://${d.arweaveId}`;return d.fileType==="application/epub+zip"||d.fileType==="application/pdf"?Q:`ar://${d.arweaveId}`}).filter(Boolean))].map(d=>({url:d})),c},$=async()=>{if(u.value="checking",!r.value){D(s.value.join(", "));return}w.value.contentFingerprints.length&&await Y()},Y=async()=>{if(u.value="loading",await m(),!y.value||!I.value){R.value="MISSING_SIGNER",u.value="";return}try{u.value="signing";const e=Ke(q.value),c={name:e.name,description:e.description,...e,symbol:"BOOK",image:(e==null?void 0:e.thumbnailUrl)||"",external_link:(e==null?void 0:e.url)||"",nft_meta_collection_id:"nft_book",nft_meta_collection_name:"NFT Book",nft_meta_collection_description:"NFT Book by Liker Land",recordTimestamp:new Date().toISOString()};await a({wallet:y.value});const C=await G({address:g,abi:Ge,functionName:"newBookNFTWithRoyalty",args:[{creator:y.value,updaters:[y.value,x],minters:[y.value,x],config:{name:c.name,symbol:"BOOK",metadata:JSON.stringify(c),max_supply:Se}},500]}),N=await T({hash:C});if(console.log(N),!N||N.status!=="success")throw new Error("INVALID_RECEIPT");if(!N.logs[0].address)throw new Error("INVALID_CLASS_ID");const B=N.logs[0].address;u.value="success",K("submit",{iscnId:B,txHash:C})}catch(e){console.error(e),D(`'SIGNING_ERROR':${e}`),u.value=""}finally{u.value=""}};return p({onSubmit:$}),(e,c)=>{const C=Pe,N=Ie,B=he,V=Ne;return b(),k("div",null,[i(C,{modelValue:t(w),"onUpdate:modelValue":c[0]||(c[0]=z=>se(w)?w.value=z:null)},null,8,["modelValue"]),i(V,{"model-value":!!t(u),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:S(()=>[_("div",Ze,[_("div",et,[i(N,{variant:"soft"},{default:S(()=>[W(A(t(u)),1)]),_:1}),c[1]||(c[1]=_("p",{class:"text-xs text-gray-500"}," 請勿關閉此視窗，直到 ISCN 註冊完成。 ",-1))]),i(B,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),at=Fe(tt,[["__scopeId","data-v-f0d388f9"]]),nt=te({__name:"ISCNInfoCard",props:{iscnId:{},iscnOwner:{},iscnData:{},showEditButton:{type:Boolean}},emits:["edit"],setup(F){const{OPENSEA_URL:p}=ne().public;return(f,h)=>{const M=de,x=Je,y=me,I=xe;return b(),H(I,{ui:{body:{base:"space-y-4"}}},{header:S(()=>h[1]||(h[1]=[_("h2",{class:"font-bold font-mono"}," ISCN Information ",-1)])),default:S(()=>[i(x,{label:"Owner",class:"text-left"},{default:S(()=>[i(M,{label:f.iscnOwner,to:`${t(p)}/${encodeURIComponent(f.iscnOwner)}`,target:"_blank",variant:"link",padded:!1},null,8,["label","to"])]),_:1}),i(x,{label:"Title"},{default:S(()=>{var m,a;return[i(y,{value:(a=(m=f.iscnData)==null?void 0:m.contentMetadata)==null?void 0:a.name,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1}),i(x,{label:"Description"},{default:S(()=>{var m,a;return[i(y,{value:(a=(m=f.iscnData)==null?void 0:m.contentMetadata)==null?void 0:a.description,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1}),Te(f.$slots,"actions",{},()=>[f.showEditButton?(b(),H(M,{key:0,label:"Edit ISCN Metadata",onClick:h[0]||(h[0]=m=>f.$emit("edit"))})):j("",!0)])]),_:3})}}}),st={class:"flex flex-col items-stretch grow space-y-4"},ot=te({__name:"MintNFT",props:{iscnId:{type:String,default:""}},emits:["submit","formValidChange","loadingChange"],setup(F,{expose:p,emit:f}){const{getClassOwner:h,getClassMetadata:M,checkNFTClassIsBookNFT:x}=We(),y=o(1),I=o(""),m=o(!1),a=o(""),T=o(null),U=o(""),P=o(null),D=O(()=>{var s;return(s=T.value)==null?void 0:s["@id"]}),g=o(!1),w=o(!1),u=f;ee(m,s=>{u("loadingChange",s),s&&(I.value="")},{immediate:!0}),ee(w,s=>{u("formValidChange",s)},{immediate:!0}),Ce({title:"Mint Liker Land NFT Book",ogTitle:"Mint Liker Land NFT Book"});const R=F;ee(()=>R.iscnId,async s=>{s&&await K(R.iscnId)},{immediate:!0});async function K(s){if(s)try{if(m.value=!0,!await x(s))throw new Error("Invalid NFT Class ID");const[E,$]=await Promise.all([M(s),h(s)]);if(!E)throw new Error("Invalid NFT Class ID");T.value={contentMetadata:E,owner:$,"@id":s},a.value=$,U.value=s,y.value=3}catch(r){console.error(r),I.value=r.toString()}finally{m.value=!1}}function q(){var s;(s=P.value)==null||s.startNFTMintFlow()}function G({classId:s,nftMintCount:r}={}){U.value=s||"",u("submit",{classId:s||"",nftMintCount:r})}return p({startNFTMintFlow:q}),(s,r)=>{const E=ke,$=nt,Y=ze,e=je;return b(),k("div",st,[t(I)?(b(),H(E,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${t(I)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:r[0]||(r[0]=c=>I.value="")},null,8,["title"])):j("",!0),i($,{"iscn-id":t(D),"iscn-owner":t(a),"iscn-data":t(T),"show-edit-button":!0,onEdit:r[1]||(r[1]=c=>g.value=!0)},null,8,["iscn-id","iscn-owner","iscn-data"]),i(Y,{ref_key:"liteMintNFTRef",ref:P,"iscn-data":t(T),"should-show-submit":!1,onFormValidChange:r[2]||(r[2]=c=>w.value=c),onSubmit:G},null,8,["iscn-data"]),i(e,{modelValue:t(g),"onUpdate:modelValue":r[3]||(r[3]=c=>se(g)?g.value=c:null),"class-id":t(U)},null,8,["modelValue","class-id"])])}}}),lt={class:"w-full"},it={class:"justify-evenly items-center flex space-x-4 relative"},rt={class:"text-sm font-semibold"},ut={class:"mt-6 p-4 border rounded-lg bg-gray-100 text-center flex flex-col gap-[24px]"},ct={key:0},dt={key:1},pt={key:2},mt={key:3},_t={class:"flex gap-2 justify-center mt-4"},ft={key:0,class:"flex flex-col justify-center px-[12px] mt-[16px]"},vt={class:"flex flex-col items-center gap-4 py-4"},bt={class:"flex flex-col items-center"},gt={key:0},wt={class:"flex items-center"},yt={key:0,class:"flex flex-col items-center gap-2 w-full max-w-md"},zt=te({__name:"index",setup(F){var Q,oe;const{t:p}=Me(),f=re(),{wallet:h,signer:M}=ue(f),{initIfNecessary:x}=f,y=Re(),I=Ue(),{showErrorToast:m}=pe(),a=o(0),T=o(),U=o(),P=o(),D=o(!1),g=o(""),w=o(""),u=o(((Q=y.query.iscn_id)==null?void 0:Q.toString())||""),R=o(((oe=y.query.class_id)==null?void 0:oe.toString())||""),K=o([]),q=o(""),G=o(!1),s=o(!1),r=o(!1),E=O(()=>!!w.value),$=O(()=>{switch(a.value){case 0:return"Start Upload";case 1:return"Register ISCN";case 2:return"Mint NFT";default:return"Next"}}),Y=O(()=>{var l;return((l=K.value)==null?void 0:l.length)>0}),e=O(()=>a.value===0?Y.value:a.value<3),c=O(()=>a.value===0?q.value!=="":a.value===2?r.value:!1),C=[{title:p("publish_steps.upload_files"),description:"Upload your book file"},{title:p("publish_steps.register_iscn"),description:"Register ISCN"},{title:p("publish_steps.mint_nft"),description:"Mint NFT"},{title:p("publish_steps.new_book_publish"),description:"Publish new book"}];ce(()=>{var n;let l=null;try{const L=sessionStorage.getItem(De);L&&(l=JSON.parse(L))}catch(L){console.error(L)}u.value?(g.value=u.value,V({iscnId:u.value})):R.value?z({classId:R.value}):l!=null&&l.epubMetadata&&(l!=null&&l.fileRecords)&&(w.value=(n=l==null?void 0:l.epubMetadata)==null?void 0:n.title)});const N=async()=>{if((!h.value||!M.value)&&await x(),!h.value||!M.value){m("Please login first");return}try{if(a.value===0&&T.value){await T.value.onSubmit();return}if(a.value===1){if(!G.value){m("Please fill in all required fields");return}await U.value.onSubmit();return}if(a.value===2){if(!s.value){m("Please fill in all required fields");return}await P.value.startNFTMintFlow();return}a.value<C.length-1&&a.value++}catch(l){console.error("Error during form submission:",l)}},B=l=>{Le(l),a.value=1},V=async l=>{const{iscnId:n}=l;n&&await ae(I({query:{iscn_id:n}}),{replace:!0}),Ee(),a.value=2,await le(),u.value=n},z=async l=>{const{classId:n,nftMintCount:L}=l;n&&(R.value=n,await ae(I({query:{class_id:n,count:L}}),{replace:!0}),a.value=3,await le())},J=async()=>{await ae(I({name:"nft-book-store"}))},d=async()=>{g.value&&await V({iscnId:g.value})};return(l,n)=>{const L=Ve,_e=qe,fe=at,ve=ot,be=Qe,X=de,ge=me,we=Xe;return b(),H(we,{class:"flex flex-col items-stretch grow space-y-4"},{default:S(()=>[_("div",lt,[_("div",it,[n[8]||(n[8]=_("div",{class:"absolute w-full h-[1px] bg-gray-300 top-[50%] left-0 z-[-1]"},null,-1)),(b(),k($e,null,Be(C,(v,Z)=>_("div",{key:Z,class:"flex items-center space-x-2 bg-white p-2 rounded-lg"},[i(L,{size:Z===t(a)?"lg":"md",text:(Z+1).toString(),ui:{background:Z===t(a)?"bg-primary-100":"bg-gray-200"}},null,8,["size","text","ui"]),_("p",rt,A(v.title),1)])),64))]),_("div",ut,[t(a)===0?(b(),k("div",ct,[i(_e,{ref_key:"uploadFormRef",ref:T,onFileUploadStatus:n[0]||(n[0]=v=>q.value=v),onFileReady:n[1]||(n[1]=v=>K.value=v),onSubmit:B},null,512)])):t(a)===1?(b(),k("div",dt,[i(fe,{ref_key:"registerISCN",ref:U,onFormValidChange:n[2]||(n[2]=v=>G.value=v),onSubmit:V},null,512)])):t(a)===2?(b(),k("div",pt,[i(ve,{ref_key:"mintNFT",ref:P,"iscn-id":t(u),onLoadingChange:n[3]||(n[3]=v=>r.value=v),onFormValidChange:n[4]||(n[4]=v=>s.value=v),onSubmit:z},null,8,["iscn-id"])])):t(a)===3?(b(),k("div",mt,[i(be,{ref:"newNFTBook",class:"p-0 flex flex-col text-left gap-[24px]","is-new-class-page":!0,"class-id":t(R),onSubmit:J},null,8,["class-id"])])):j("",!0),_("div",_t,[t(e)?(b(),H(X,{key:0,disabled:t(c),onClick:N},{default:S(()=>[W(A(t($)),1)]),_:1},8,["disabled"])):j("",!0)])]),t(a)===0?(b(),k("div",ft,[n[9]||(n[9]=_("div",{class:"w-full bg-gray-300 h-[1px]"},null,-1)),_("div",vt,[_("div",bt,[t(E)?(b(),k("div",gt,[W(A(t(p)("publish_steps.continue_last_register"))+" ",1),i(X,{variant:"ghost",class:"text-primary-500 font-semibold",onClick:n[5]||(n[5]=v=>a.value=1)},{default:S(()=>[W(A(t(w)),1)]),_:1})])):j("",!0),_("div",wt,[_("span",null,A(t(p)("publish_steps.already_have_iscn")),1),i(X,{variant:"ghost",onClick:n[6]||(n[6]=v=>D.value=!t(D))},{default:S(()=>[W(A(t(p)("publish_steps.here")),1)]),_:1})])]),t(D)?(b(),k("div",yt,[i(ge,{modelValue:t(g),"onUpdate:modelValue":n[7]||(n[7]=v=>se(g)?g.value=v:null),placeholder:t(p)("publish_steps.enter_iscn_id")},null,8,["modelValue","placeholder"]),i(X,{disabled:!t(g),onClick:d},{default:S(()=>[W(A(t(p)("common.confirm")),1)]),_:1},8,["disabled"])])):j("",!0)])])):j("",!0)])]),_:1})}}});export{zt as default};
