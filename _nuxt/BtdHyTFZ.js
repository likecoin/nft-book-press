import{_ as O}from"./B9CPVQH-.js";import{a_ as j,b7 as q,a$ as K,bw as F,b8 as U,b0 as X,b9 as f,bb as G,b1 as J,ba as b,b3 as g,aX as n,cq as Q,cr as k,aT as v,bi as A,aW as r,b4 as t,bA as Y,aU as x,aV as C,bq as Z}from"./Bpv-nJtS.js";import{_ as ee}from"./0fPjfmQB.js";import{_ as te}from"./DxdXqKd0.js";import{_ as se}from"./CiIWcoTJ.js";import{a as oe}from"./t_hhOFMN.js";import{u as ae}from"./BSVs2JFV.js";import"./C5ceEQzY.js";import"./DqPXOpHU.js";import"./G4kmRT7V.js";import"./daq8aZJ1.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},d=new l.Error().stack;d&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[d]="256fe26e-3a73-4002-ba28-f459da425622",l._sentryDebugIdIdentifier="sentry-dbid-256fe26e-3a73-4002-ba28-f459da425622")}catch{}})();const ne=["textContent"],re=["href"],ie=["textContent"],ge=j({__name:"index",setup(l){const{LIKE_CO_API:d,BOOK3_URL:S}=q().public,{t:s}=K(),I=oe(),H=F(),{token:w,wallet:$}=U(H),N=X(),T=ae(),{getStripeConnectStatusByWallet:z}=U(T),c=f(""),i=f(!1),h=f([]),B=f([]);G(i,e=>{e&&(c.value="")}),J(async()=>{await Promise.all([R(),D(),T.refreshStripeConnectStatus($.value)])});const P=b(()=>z.value($.value)),V=b(()=>{var e;return(e=P.value)==null?void 0:e.isReady}),W=b(()=>h.value.map(e=>{let o=e.type;switch(o){case"connectedWallet":o="royalties";break;case"channelCommission":o="channel";break}return{...e,type:o,amount:k(e.amount,e.currency),amountTotal:k(e.amountTotal,e.currency),currency:Q(e.currency),timestamp:new Date(e.timestamp).toLocaleString()}})),E=b(()=>B.value.map(e=>{const{id:o,amount:a,currency:m,status:p,arrivalTs:_,createdTs:y}=e;return{id:o,amount:k(a,m),status:p,createdTs:new Date(y*1e3).toLocaleString(),arrivalTs:_?new Date(_*1e3).toLocaleString():""}}));async function R(){try{i.value=!0;const e=await $fetch(`${d}/likernft/book/user/commissions/list`,{headers:{authorization:`Bearer ${w.value}`}});h.value=(e==null?void 0:e.commissions)||[],new Set(h.value.filter(a=>a.classId).map(a=>a.classId)).forEach(a=>I.lazyFetchClassMetadataById(a))}catch(e){console.error(e),c.value=e.toString()}finally{i.value=!1}}async function D(){try{i.value=!0;const e=await $fetch(`${d}/likernft/book/user/payouts/list`,{headers:{authorization:`Bearer ${w.value}`}});B.value=(e==null?void 0:e.payouts)||[]}catch(e){c.value=e.toString()}finally{i.value=!1}}return(e,o)=>{const a=O,m=Z,p=ee,_=te,y=Y,M=se;return v(),g(M,null,{default:n(()=>[t(c)?(v(),g(a,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${t(c)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:o[0]||(o[0]=u=>c.value="")},null,8,["title"])):A("",!0),t(V)?A("",!0):(v(),g(a,{key:1,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"soft",title:t(s)("user_settings.stripe_express_notice"),description:t(s)("user_settings.stripe_express_description")},null,8,["title","description"])),r(y,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{header:n(()=>[x("h1",{class:"text-center font-bold font-mono",textContent:C(t(s)("user_settings.commission_history"))},null,8,ne),r(p,{text:"Refresh Status",popper:{placement:"left"}},{default:n(()=>[r(m,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:t(i),onClick:R},null,8,["disabled"])]),_:1})]),default:n(()=>[r(_,{columns:[{key:"timestamp",label:t(s)("user_settings.timestamp")},{key:"type",label:t(s)("user_settings.commission_type")},{key:"amount",label:t(s)("user_settings.commission")},{key:"classId",label:t(s)("user_settings.book_id")},{key:"currency",label:t(s)("user_settings.currency")},{key:"amountTotal",label:t(s)("user_settings.sale_amount")}],rows:t(W),ui:{th:{base:"text-center"},td:{base:"text-center"}}},{"classId-data":n(({row:u})=>{var L;return[x("a",{href:`${t(S)}/store/${u.classId}`,target:"_blank"},C(((L=t(I).getClassMetadataById(u.classId))==null?void 0:L.name)||u.classId),9,re)]}),_:1},8,["columns","rows"])]),_:1}),r(y,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{header:n(()=>[x("h1",{class:"text-center font-bold font-mono",textContent:C(t(s)("user_settings.payout_history"))},null,8,ie),r(p,{text:"Refresh Status",popper:{placement:"left"}},{default:n(()=>[r(m,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:t(i),onClick:D},null,8,["disabled"])]),_:1})]),default:n(()=>[r(_,{columns:[{key:"createdTs",label:t(s)("user_settings.created")},{key:"amount",label:t(s)("user_settings.payout_amount")},{key:"status",label:t(s)("user_settings.status")},{key:"arrivalTs",label:t(s)("user_settings.arrived")},{key:"details",label:t(s)("user_settings.details")}],rows:t(E),ui:{th:{base:"text-center"},td:{base:"text-center"}}},{"details-data":n(({row:u})=>[r(m,{label:"Details",size:"sm",color:"gray",to:t(N)({name:"sales-report-payouts-payoutId",params:{payoutId:u.id}})},null,8,["to"])]),_:1},8,["columns","rows"])]),_:1})]),_:1})}}});export{ge as default};
