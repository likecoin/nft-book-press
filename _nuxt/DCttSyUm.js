import{g as J,r as V,m as X,d as Z,c as D,e as Q,b as E}from"./BYnq6ai5.js";import{dk as P,dl as z,dm as tt,dn as L,dp as et,dq as at,dr as G,ds as I,dt as nt,du as rt,cv as st,dv as $,dw as S,dx as ot,dy as ct,dz as it,dA as ut,dB as M,dC as lt,dD as dt,dE as ft,cy as F,dF as bt,dG as U,dH as pt,dI as W,dJ as mt,cx as ht,dK as wt,cX as yt,cY as gt,dL as kt,d0 as Tt}from"./Di6Vh2zx.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},n=new t.Error().stack;n&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[n]="f95a3b44-d1ef-4749-834a-14d87031d302",t._sentryDebugIdIdentifier="sentry-dbid-f95a3b44-d1ef-4749-834a-14d87031d302")}catch{}})();const Nt=new Map,Ct=new Map;function vt(t){const n=(c,s)=>({clear:()=>s.delete(c),get:()=>s.get(c),set:i=>s.set(c,i)}),a=n(t,Nt),o=n(t,Ct);return{clear:()=>{a.clear(),o.clear()},promise:a,response:o}}async function Rt(t,{cacheKey:n,cacheTime:a=Number.POSITIVE_INFINITY}){const o=vt(n),c=o.response.get();if(c&&a>0&&new Date().getTime()-c.created.getTime()<a)return c.data;let s=o.promise.get();s||(s=t(),o.promise.set(s));try{const i=await s;return o.response.set({created:new Date,data:i}),i}finally{o.promise.clear()}}const Bt=t=>`blockNumber.${t}`;async function It(t,{cacheTime:n=t.cacheTime}={}){const a=await Rt(()=>t.request({method:"eth_blockNumber"}),{cacheKey:Bt(t.uid),cacheTime:n});return BigInt(a)}async function K(t,{blockHash:n,blockNumber:a,blockTag:o,hash:c,index:s}){var f,l,r;const i=o||"latest",u=a!==void 0?P(a):void 0;let e=null;if(c?e=await t.request({method:"eth_getTransactionByHash",params:[c]},{dedupe:!0}):n?e=await t.request({method:"eth_getTransactionByBlockHashAndIndex",params:[n,P(s)]},{dedupe:!0}):e=await t.request({method:"eth_getTransactionByBlockNumberAndIndex",params:[u||i,P(s)]},{dedupe:!!u}),!e)throw new z({blockHash:n,blockNumber:a,blockTag:i,hash:c,index:s});return(((r=(l=(f=t.chain)==null?void 0:f.formatters)==null?void 0:l.transaction)==null?void 0:r.format)||tt)(e)}async function O(t,{hash:n}){var c,s,i;const a=await t.request({method:"eth_getTransactionReceipt",params:[n]},{dedupe:!0});if(!a)throw new L({hash:n});return(((i=(s=(c=t.chain)==null?void 0:c.formatters)==null?void 0:s.transactionReceipt)==null?void 0:i.format)||et)(a)}async function Ft(t,n){var k;const{account:a,allowFailure:o=!0,batchSize:c,blockNumber:s,blockTag:i,multicallAddress:u,stateOverride:e}=n,d=n.contracts,f=c??(typeof((k=t.batch)==null?void 0:k.multicall)=="object"&&t.batch.multicall.batchSize||1024);let l=u;if(!l){if(!t.chain)throw new Error("client chain not configured. multicallAddress is required.");l=J({blockNumber:s,chain:t.chain,contract:"multicall3"})}const r=[[]];let b=0,p=0;for(let m=0;m<d.length;m++){const{abi:h,address:R,args:w,functionName:N}=d[m];try{const g=at({abi:h,args:w,functionName:N});p+=(g.length-2)/2,f>0&&p>f&&r[b].length>0&&(b++,p=(g.length-2)/2,r[b]=[]),r[b]=[...r[b],{allowFailure:!0,callData:g,target:R}]}catch(g){const B=G(g,{abi:h,address:R,args:w,docsPath:"/docs/contract/multicall",functionName:N,sender:a});if(!o)throw B;r[b]=[...r[b],{allowFailure:!0,callData:"0x",target:R}]}}const y=await Promise.allSettled(r.map(m=>I(t,V,"readContract")({abi:X,account:a,address:l,args:[m],blockNumber:s,blockTag:i,functionName:"aggregate3",stateOverride:e}))),C=[];for(let m=0;m<y.length;m++){const h=y[m];if(h.status==="rejected"){if(!o)throw h.reason;for(let w=0;w<r[m].length;w++)C.push({status:"failure",error:h.reason,result:void 0});continue}const R=h.value;for(let w=0;w<R.length;w++){const{returnData:N,success:g}=R[w],{callData:B}=r[m][w],{abi:T,address:A,functionName:v,args:_}=d[C.length];try{if(B==="0x")throw new nt;if(!g)throw new rt({data:N});const x=Z({abi:T,args:_,data:N,functionName:v});C.push(o?{result:x,status:"success"}:x)}catch(x){const j=G(x,{abi:T,address:A,args:_,docsPath:"/docs/contract/multicall",functionName:v});if(!o)throw j;C.push({error:j,result:void 0,status:"failure"})}}}if(C.length!==d.length)throw new st("multicall results mismatch");return C}function At(t,{emitOnBegin:n=!1,emitMissed:a=!1,onBlockNumber:o,onError:c,poll:s,pollingInterval:i=t.pollingInterval}){const u=typeof s<"u"?s:!(t.transport.type==="webSocket"||t.transport.type==="ipc"||t.transport.type==="fallback"&&(t.transport.transports[0].config.type==="webSocket"||t.transport.transports[0].config.type==="ipc"));let e;return u?(()=>{const l=$(["watchBlockNumber",t.uid,n,a,i]);return S(l,{onBlockNumber:o,onError:c},r=>ot(async()=>{var b;try{const p=await I(t,It,"getBlockNumber")({cacheTime:0});if(e){if(p===e)return;if(p-e>1&&a)for(let y=e+1n;y<p;y++)r.onBlockNumber(y,e),e=y}(!e||p>e)&&(r.onBlockNumber(p,e),e=p)}catch(p){(b=r.onError)==null||b.call(r,p)}},{emitOnBegin:n,interval:i}))})():(()=>{const l=$(["watchBlockNumber",t.uid,n,a]);return S(l,{onBlockNumber:o,onError:c},r=>{let b=!0,p=()=>b=!1;return(async()=>{try{const y=(()=>{if(t.transport.type==="fallback"){const k=t.transport.transports.find(m=>m.config.type==="webSocket"||m.config.type==="ipc");return k?k.value:t.transport}return t.transport})(),{unsubscribe:C}=await y.subscribe({params:["newHeads"],onData(k){var h;if(!b)return;const m=ct((h=k.result)==null?void 0:h.number);r.onBlockNumber(m,e),e=m},onError(k){var m;(m=r.onError)==null||m.call(r,k)}});p=C,b||p()}catch(y){c==null||c(y)}})(),()=>p()})})()}async function _t(t,{confirmations:n=1,hash:a,onReplaced:o,pollingInterval:c=t.pollingInterval,retryCount:s=6,retryDelay:i=({count:e})=>~~(1<<e)*200,timeout:u=18e4}){const e=$(["waitForTransactionReceipt",t.uid,a]);let d,f,l,r=!1,b,p;const{promise:y,resolve:C,reject:k}=it(),m=u?setTimeout(()=>{p(),b(),k(new ut({hash:a}))},u):void 0;return b=S(e,{onReplaced:o,resolve:C,reject:k},h=>{p=I(t,At,"watchBlockNumber")({emitMissed:!0,emitOnBegin:!0,poll:!0,pollingInterval:c,async onBlockNumber(R){const w=g=>{clearTimeout(m),p(),g(),b()};let N=R;if(!r)try{if(l){if(n>1&&(!l.blockNumber||N-l.blockNumber+1n<n))return;w(()=>h.resolve(l));return}if(d||(r=!0,await M(async()=>{d=await I(t,K,"getTransaction")({hash:a}),d.blockNumber&&(N=d.blockNumber)},{delay:i,retryCount:s}),r=!1),l=await I(t,O,"getTransactionReceipt")({hash:a}),n>1&&(!l.blockNumber||N-l.blockNumber+1n<n))return;w(()=>h.resolve(l))}catch(g){if(g instanceof z||g instanceof L){if(!d){r=!1;return}try{f=d,r=!0;const B=await M(()=>I(t,lt,"getBlock")({blockNumber:N,includeTransactions:!0}),{delay:i,retryCount:s,shouldRetry:({error:v})=>v instanceof dt});r=!1;const T=B.transactions.find(({from:v,nonce:_})=>v===f.from&&_===f.nonce);if(!T||(l=await I(t,O,"getTransactionReceipt")({hash:T.hash}),n>1&&(!l.blockNumber||N-l.blockNumber+1n<n)))return;let A="replaced";T.to===f.to&&T.value===f.value&&T.input===f.input?A="repriced":T.from===T.to&&T.value===0n&&(A="cancelled"),w(()=>{var v;(v=h.onReplaced)==null||v.call(h,{reason:A,replacedTransaction:f,transaction:T,transactionReceipt:l}),h.resolve(l)})}catch(B){w(()=>h.reject(B))}}else w(()=>h.reject(g))}}})}),y}function Y(t){return typeof t=="number"?t:t==="wei"?0:Math.abs(ft[t])}async function xt(t,n){const{allowFailure:a=!0,chainId:o,contracts:c,...s}=n,i=t.getClient({chainId:o});return F(i,Ft,"multicall")({allowFailure:a,contracts:c,...s})}async function Et(t,n){var u;const{allowFailure:a=!0,blockNumber:o,blockTag:c,...s}=n,i=n.contracts;try{const e={};for(const[r,b]of i.entries()){const p=b.chainId??t.state.chainId;e[p]||(e[p]=[]),(u=e[p])==null||u.push({contract:b,index:r})}const d=()=>Object.entries(e).map(([r,b])=>xt(t,{...s,allowFailure:a,blockNumber:o,blockTag:c,chainId:Number.parseInt(r),contracts:b.map(({contract:p})=>p)})),f=(await Promise.all(d())).flat(),l=Object.values(e).flatMap(r=>r.map(({index:b})=>b));return f.reduce((r,b,p)=>(r&&(r[l[p]]=b),r),[])}catch(e){if(e instanceof bt)throw e;const d=()=>i.map(f=>D(t,{...f,blockNumber:o,blockTag:c}));return a?(await Promise.allSettled(d())).map(f=>f.status==="fulfilled"?{result:f.value,status:"success"}:{error:f.reason,result:void 0,status:"failure"}):await Promise.all(d())}}async function Pt(t,n){const{address:a,blockNumber:o,blockTag:c,chainId:s,token:i,unit:u="ether"}=n;if(i)try{return await q(t,{balanceAddress:a,chainId:s,symbolType:"string",tokenAddress:i})}catch(r){if(r.name==="ContractFunctionExecutionError"){const b=await q(t,{balanceAddress:a,chainId:s,symbolType:"bytes32",tokenAddress:i}),p=U(pt(b.symbol,{dir:"right"}));return{...b,symbol:p}}throw r}const e=t.getClient({chainId:s}),f=await F(e,mt,"getBalance")(o?{address:a,blockNumber:o}:{address:a,blockTag:c}),l=t.chains.find(r=>r.id===s)??e.chain;return{decimals:l.nativeCurrency.decimals,formatted:W(f,Y(u)),symbol:l.nativeCurrency.symbol,value:f}}async function q(t,n){const{balanceAddress:a,chainId:o,symbolType:c,tokenAddress:s,unit:i}=n,u={abi:[{type:"function",name:"balanceOf",stateMutability:"view",inputs:[{type:"address"}],outputs:[{type:"uint256"}]},{type:"function",name:"decimals",stateMutability:"view",inputs:[],outputs:[{type:"uint8"}]},{type:"function",name:"symbol",stateMutability:"view",inputs:[],outputs:[{type:c}]}],address:s},[e,d,f]=await Et(t,{allowFailure:!1,contracts:[{...u,functionName:"balanceOf",args:[a],chainId:o},{...u,functionName:"decimals",chainId:o},{...u,functionName:"symbol",chainId:o}]}),l=W(e??"0",Y(i??d));return{decimals:d,formatted:l,symbol:f,value:e}}async function H(t,n){const{chainId:a,timeout:o=0,...c}=n,s=t.getClient({chainId:a}),u=await F(s,_t,"waitForTransactionReceipt")({...c,timeout:o});if(u.status==="reverted"){const d=await F(s,K,"getTransaction")({hash:u.transactionHash}),l=await F(s,Q,"call")({...d,data:d.input,gasPrice:d.type!=="eip1559"?d.gasPrice:void 0,maxFeePerGas:d.type==="eip1559"?d.maxFeePerGas:void 0,maxPriorityFeePerGas:d.type==="eip1559"?d.maxPriorityFeePerGas:void 0}),r=l!=null&&l.data?U(`0x${l.data.substring(138)}`):"unknown reason";throw new Error(r)}return{...u,chainId:s.chain.id}}async function Dt(t,n){const{account:a,chainId:o,connector:c,...s}=n;let i;return typeof a=="object"&&(a==null?void 0:a.type)==="local"?i=t.getClient({chainId:o}):i=await ht(t,{account:a??void 0,chainId:o,connector:c}),await F(i,wt,"writeContract")({...s,...a?{account:a}:{},chain:o?{id:o}:null})}function $t(t){return{mutationFn(n){return Dt(t,n)},mutationKey:["writeContract"]}}function St(t={}){const{mutation:n}=t,a=yt(t),o=$t(a),{mutate:c,mutateAsync:s,...i}=gt({...n,...o});return{...i,writeContract:c,writeContractAsync:s}}const Mt=()=>{const{writeContractAsync:t}=St(),{$wagmiConfig:n}=kt(),a=async({classId:u,wallet:e},d)=>{const f=await D(n,{abi:E,address:u,functionName:d});if(!await D(n,{abi:E,address:u,functionName:"hasRole",args:[f,e]})){const r=await t({abi:E,address:u,functionName:"ownerGrantRole",args:[f,e]});console.log(`Granted ${d} to ${e} in class ${u}. Transaction hash: ${r}`)}},o=async({classId:u,wallet:e})=>(await s({wallet:e}),a({classId:u,wallet:e},"UPDATER_ROLE")),c=async({classId:u,wallet:e})=>(await s({wallet:e}),a({classId:u,wallet:e},"MINTER_ROLE")),s=async({wallet:u})=>{const e=await Pt(n,{address:u});if(e.value<=0n)throw new Error("Insufficient OP-ETH balance");return e};return{checkAndGrantUpdater:o,checkAndGrantMinter:c,assertPositiveWalletBalance:s,waitForTransactionReceipt:async u=>{let e;try{e=await H(n,u)}catch{await Tt(3e3),e=await H(n,u)}return e}}};export{St as a,Pt as g,Mt as u};
