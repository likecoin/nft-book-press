import{a_ as ze,bj as We,bi as qe,bl as fe,a$ as Ze,bk as Ge,b5 as s,bK as be,b6 as x,b8 as He,b0 as Ke,b7 as Ye,b1 as p,aX as a,bL as Qe,aT as c,bp as D,aS as ee,bd as l,bq as Xe,bM as Je,aY as F,bg as ve,aW as o,aU as r,br as eo,bc as g,aV as he,bN as ge,bh as oo,bO as R,bP as lo,bB as to,be as ao,aQ as no}from"./Dtf-ga44.js";import{_ as io}from"./DsCSTb_O.js";import{_ as so}from"./CsRVLSQl.js";import{_ as ro}from"./rtGnzj6w.js";import{_ as uo}from"./Ciftl9_4.js";import{c as co,_ as mo,E as _e,p as po}from"./Bro5MX7b.js";import{a as fo,_ as bo}from"./DoQBQjeU.js";import{_ as vo,v as ho}from"./DdBE4DPO.js";import{_ as go}from"./B0VlwNm9.js";import{_ as _o}from"./BNebj5Ib.js";import{_ as yo,a as wo,b as ko}from"./DAOtKHOn.js";import{_ as xo}from"./PLO2PEGQ.js";import{u as Co}from"./cjfvGueO.js";import{u as Po}from"./D9sSpG7K.js";import"./CvG8K_Ye.js";import"./BfHeFr7X.js";import"./BmGYPcUG.js";import"./C-CJE1Rt.js";(function(){try{var V=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},j=new V.Error().stack;j&&(V._sentryDebugIds=V._sentryDebugIds||{},V._sentryDebugIds[j]="086f3788-fd87-4a57-a00b-0669a5925d7a",V._sentryDebugIdIdentifier="sentry-dbid-086f3788-fd87-4a57-a00b-0669a5925d7a")}catch{}})();const Vo={class:"font-bold font-mono"},Uo={class:"flex justify-center items-center"},Eo={class:"flex justify-center items-center"},Io={class:"flex gap-2"},So={class:"flex justify-end items-center"},To={class:"flex justify-between items-center w-full"},Do={key:0,class:"mt-[24px] flex flex-col gap-[12px]"},Mo={class:"flex gap-2"},No={class:"flex justify-end items-center"},Ao={class:"grid md:grid-cols-2 gap-4"},$o=ze({__name:"new",setup(V){const{getClassOwner:j,getClassMetadata:oe}=Po(),ye=We(),le=qe(),te=Co(),{wallet:U}=fe(ye),{newBookListing:we,updateEditionPrice:ke}=le,{fetchStripeConnectStatusByWallet:xe}=te,{getStripeConnectStatusByWallet:Ce}=fe(te),ae=Ze(),E=Ge(),Y=s(E.params.editingClassId||E.query.class_id||""),ne=s(E.params.editionIndex),I=s(""),f=s(!1),ie=s({en:"e.g.: This edition includes EPUB and PDF ebook files.",zh:"例：此版本包含 EPUB 及 PDF 電子書檔"}),C=s(Y||""),Q=s(1),L=s(""),z=s(!0),M=s(!1),W=s(!1),_=s([{price:be,deliveryMethod:"auto",autoMemo:"Thank you for your support. It means a lot to me.",stock:Number(E.query.count||1),nameEn:"Standard Edition",nameZh:"標準版",descriptionEn:"",descriptionZh:"",hasShipping:!1,isPhysicalOnly:!1,isAllowCustomPrice:!1,isUnlisted:!1}]),N=s([]),A=x(()=>_.value.length>1),se=x(()=>A.value?"edition":"book"),q=s(["like1rclg677y2jqt8x4ylj0kjlqjjmnn6w63uflpgr"]),Z=s([]),b=s(""),v=s(""),$=s(!1),B=s(""),X=s(!1),J=s(!0),re=s(["bold","italic","strikeThrough","title","-","unorderedList","orderedList","-","code","link","=","preview"]),S=x(()=>!!(E.params.editingClassId&&ne.value)),Pe=x(()=>S.value?"Edit Current Edition":"New NFT Book Listing"),Ve=x(()=>S.value?"Save Changes":"Submit"),G=s(!1),Ue=x(()=>[{key:"wallet",label:"Wallet",sortable:!0},{key:"remove",label:"",sortable:!1}]),Ee=x(()=>q.value.map((n,e)=>({index:e,wallet:n,walletLink:Qe(n)}))),Ie=x(()=>Z.value.map((n,e)=>({index:e,email:n})));co({markdownItConfig(n){n.options.html=!1}}),He({title:"New Book Listing",ogTitle:"New Book Listing"}),Ke(async()=>{try{if(f.value=!0,U.value){try{await xe(U.value)}catch(n){console.error(n)}Ce.value(U.value).isReady&&($.value=!0,B.value=U.value)}}catch(n){console.error(n)}finally{f.value=!1}}),Ye(f,n=>{n&&(I.value="")});function O(n,e,P){var y,d;_.value[P][e]=(y=n.target)==null?void 0:y.value,e==="price"&&Number((d=n.target)==null?void 0:d.value)===0&&(_.value[P].isAllowCustomPrice=!0)}function Se(){Q.value+=1,_.value.push({index:ho(),price:be,deliveryMethod:"auto",autoMemo:"",stock:1,nameEn:`Tier ${Q.value}`,nameZh:`級別 ${Q.value}`,descriptionEn:"",descriptionZh:"",hasShipping:!1,isPhysicalOnly:!1,isAllowCustomPrice:!0,isUnlisted:!1})}function Te(n){_.value.splice(n,1)}function De(n){N.value=n}function Me(){b.value&&(q.value.push(b.value),b.value="")}function Ne(){v.value&&(Z.value.push(v.value),v.value="")}function Ae(n){B.value=n,X.value=!0}function ue(n=""){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function de(n){return po.sanitize(n)}function ce(n){return n.map(e=>({name:{en:e.nameEn,zh:e.nameZh},description:{en:ue(e.descriptionEn),zh:ue(e.descriptionZh)},priceInDecimal:Math.round(Number(e.price)*100),price:Number(e.price),stock:Number(e.stock),isAutoDeliver:!e.isPhysicalOnly&&e.deliveryMethod==="auto",isAllowCustomPrice:e.isAllowCustomPrice??!0,isUnlisted:e.isUnlisted??!1,autoMemo:e.deliveryMethod==="auto"&&e.autoMemo||"",hasShipping:e.hasShipping||!1,isPhysicalOnly:e.isPhysicalOnly||!1}))}async function $e(){try{if(!C.value)throw new Error("Please input NFT class ID");if(b.value)throw new Error('Please press "Add" button to add moderator wallet');if(v.value)throw new Error('Please press "Add" button to add notification email');f.value=!0;const[n,e]=await Promise.all([oe(C.value),j(C.value)]);if(e!==U.value)throw new Error("You are not the owner of this NFT Class");if(!n)throw new Error("Invalid NFT Class ID");const P=n.nft_meta_collection_id||"";if(!P.includes("nft_book")&&!P.includes("book_nft"))throw new Error("NFT Class not in NFT BOOK meta collection");const y=ce(_.value);if(y.find(m=>m.price!==0&&m.price<R))throw new Error(`Price of each edition must be at least $${R} or $0 (free)`);const d=$.value&&B.value?{[B.value]:100}:null,u=N.value.length?N.value.map(m=>({name:{en:m.name.en,zh:m.name.zh},priceInDecimal:m.priceInDecimal,price:m.priceInDecimal/100})):void 0;if(y.some(m=>m.isAutoDeliver)&&!confirm(`NFT Book Press - Reminder
Once you choose automatic delivery, you can't switch it back to manual delivery.  Are you sure?`))return;await we(C.value,{tableOfContents:L.value,defaultPaymentCurrency:"USD",connectedWallets:d,moderatorWallets:q.value,notificationEmails:Z.value,prices:y,shippingRates:u,mustClaimToView:z.value,enableCustomMessagePage:M.value,hideDownload:W.value}),ae.push({name:"nft-book-store"})}catch(n){const e=n.data||n;console.error(e),I.value=e}finally{X.value=!1,f.value=!1}}async function Be(){try{if(!S.value)throw new Error("Unable to submit edit: Missing edition index or class ID");const e=ce(_.value)[0];if(!e||e.price===void 0)throw new Error("Please input price of edition");if(e.price!==0&&e.price<R)throw new Error(`Price of each edition must be at least $${R} or $0 (free)`);if(!e.stock&&e.stock!==0)throw new Error("Please input stock of edition");if(e.stock<0)throw new Error("Stock cannot be negative");if(!e.name.en||!e.name.zh)throw new Error("Please input product name");f.value=!0,await ke(Y.value,ne.value,{price:e}),ae.push({name:"nft-book-store"})}catch(n){const e=n.data||n;console.error(e),I.value=e}finally{f.value=!1}}function Oe(){return S.value?Be():$e()}function Fe(n){n==="manual"&&(M.value=!0)}return(n,e)=>{const P=Xe,y=Je,d=io,u=so,m=ro,w=eo,Re=uo,H=to,K=mo,T=fo,me=vo,h=ao,je=go,pe=bo,Le=_o;return c(),p(Le,{class:"pb-[40px]"},{default:a(()=>[l(I)?(c(),p(P,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${l(I)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:e[0]||(e[0]=t=>I.value="")},null,8,["title"])):D("",!0),l(f)?(c(),p(y,{key:1,animation:"carousel"},{indicator:a(()=>e[11]||(e[11]=[F(" Loading... ")])),_:1})):D("",!0),l(le).isAuthenticated?(c(),ee(ve,{key:2},[o(w,{ui:{body:{base:"space-y-4"}}},{header:a(()=>[r("h2",Vo,he(l(Pe)),1)]),default:a(()=>[o(u,{label:"NFT Class ID"},{default:a(()=>[l(S)?(c(),p(d,{key:1,value:l(Y),readonly:!0},null,8,["value"])):(c(),p(d,{key:0,modelValue:l(C),"onUpdate:modelValue":e[1]||(e[1]=t=>g(C)?C.value=t:null),class:"font-mono",placeholder:"likenft...."},null,8,["modelValue"]))]),_:1}),o(u,{label:"Table Of Content / 章節目錄"},{default:a(()=>[o(m,{modelValue:l(L),"onUpdate:modelValue":e[2]||(e[2]=t=>g(L)?L.value=t:null)},null,8,["modelValue"])]),_:1})]),_:1}),(c(),p(ge(l(A)?"ul":"div"),{class:"flex flex-col gap-[12px]"},{default:a(()=>[(c(!0),ee(ve,null,oo(l(_),(t,k)=>(c(),p(ge(l(A)?"li":"div"),{key:t.index},{default:a(()=>[o(w,{ui:{body:{base:"space-y-5 border-[4px] relative"},base:"overflow-visible border-[2px]"}},{default:a(()=>[o(w,{ui:{body:{base:"flex flex-col gap-[20px]"},base:"overflow-visible"}},{header:a(()=>e[12]||(e[12]=[r("h3",{class:"font-bold font-mono"}," Pricing and Availability ",-1)])),default:a(()=>[o(u,{label:`Unit Price in USD (Minimum ${l(R)}, or 0 for free) / 版本定價（美金）`},{default:a(()=>[o(d,{value:t.price,type:"number",step:"0.01",min:0,onInput:i=>O(i,"price",k)},null,8,["value","onInput"])]),_:2},1032,["label"]),o(u,{label:`Total number of NFT ${l(A)?"edition":"ebook"} for sale / 此定價的銷售數量`},{default:a(()=>[o(d,{value:t.stock,type:"number",step:"1",min:0,max:Number(l(E).query.count)||void 0,onInput:i=>O(i,"stock",k)},null,8,["value","max","onInput"])]),_:2},1032,["label"]),o(Re,{modelValue:t.deliveryMethod,"onUpdate:modelValue":i=>t.deliveryMethod=i,disabled:t.isPhysicalOnly,legend:`Delivery method of this ${l(se)} / 自動或手動發書`,options:l(lo),onChange:Fe},null,8,["modelValue","onUpdate:modelValue","disabled","legend","options"]),t.deliveryMethod==="auto"?(c(),p(u,{key:0},{label:a(()=>[F(he(`Memo of this ${l(se)} / 自動發書留言`)+" ",1),o(K,null,{image:a(()=>e[13]||(e[13]=[r("img",{src:yo,class:"object-cover",alt:""},null,-1)])),default:a(()=>[o(H,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:a(()=>[o(d,{value:t.autoMemo,onInput:i=>O(i,"autoMemo",k)},null,8,["value","onInput"])]),_:2},1024)):(c(),p(u,{key:1,label:"Is Physical only good / 只含實體書"},{default:a(()=>[o(T,{modelValue:t.isPhysicalOnly,"onUpdate:modelValue":i=>t.isPhysicalOnly=i,name:"isPhysicalOnly",label:"This edition does not contain digital file/NFT"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)),o(u,null,{label:a(()=>[e[15]||(e[15]=F(" Allow custom price / 開啟打賞功能 ")),o(K,{"image-style":{width:"300px"}},{image:a(()=>e[14]||(e[14]=[r("img",{src:wo,class:"object-cover",alt:""},null,-1)])),default:a(()=>[o(H,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:a(()=>[o(T,{modelValue:t.isAllowCustomPrice,"onUpdate:modelValue":i=>t.isAllowCustomPrice=i,name:"isAllowCustomPrice",label:"Allow user to pay more than defined price"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(u,{label:"Unlist Edition / 暫時下架"},{default:a(()=>[o(T,{modelValue:t.isUnlisted,"onUpdate:modelValue":i=>t.isUnlisted=i,name:"isUnlisted",label:"Pause selling of this Edition"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(w,{ui:{body:{base:"flex flex-col gap-[20px]"},base:"overflow-visible"}},{header:a(()=>e[16]||(e[16]=[r("h3",{class:"font-bold font-mono"}," Product Information ",-1)])),default:a(()=>[o(u,{label:"Product Name",ui:{container:"space-y-2"}},{label:a(()=>[e[18]||(e[18]=F(" Product Name / 產品名稱（英文） ")),o(K,{"image-style":{width:"250px"}},{image:a(()=>e[17]||(e[17]=[r("img",{src:xo,class:"object-cover",alt:""},null,-1)])),default:a(()=>[o(H,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:a(()=>[o(d,{placeholder:"Product name in English",value:t.nameEn,onInput:i=>O(i,"nameEn",k)},null,8,["value","onInput"]),e[19]||(e[19]=r("span",{class:"block text-[14px] text-[#374151] mt-[8px]"},"Description (Optional) / 描述（選填）",-1)),o(l(_e),{modelValue:t.descriptionEn,"onUpdate:modelValue":i=>t.descriptionEn=i,language:"en-US","editor-id":`en-${k}`,placeholder:l(ie).en,toolbars:l(re),sanitize:de,style:{height:"200px",width:"100%",marginTop:"0px"}},null,8,["modelValue","onUpdate:modelValue","editor-id","placeholder","toolbars"])]),_:2,__:[19]},1024),o(u,{ui:{container:"space-y-2 my-[20px]"}},{label:a(()=>[e[21]||(e[21]=F(" 產品名稱（中文） ")),o(K,{"image-style":{width:"250px"}},{image:a(()=>e[20]||(e[20]=[r("img",{src:ko,class:"object-cover",alt:""},null,-1)])),default:a(()=>[o(H,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:a(()=>[o(d,{placeholder:"產品中文名字",value:t.nameZh,onInput:i=>O(i,"nameZh",k)},null,8,["value","onInput"]),e[22]||(e[22]=r("span",{class:"block text-[14px] text-[#374151] mt-[8px]"},"描述 (選填)",-1)),o(l(_e),{modelValue:t.descriptionZh,"onUpdate:modelValue":i=>t.descriptionZh=i,language:"en-US","editor-id":`zh-${k}`,placeholder:l(ie).zh,toolbars:l(re),sanitize:de,style:{height:"200px",width:"100%",marginTop:"0px"}},null,8,["modelValue","onUpdate:modelValue","editor-id","placeholder","toolbars"])]),_:2,__:[22]},1024)]),_:2},1024),o(me,{modelValue:t.hasShipping,"onUpdate:modelValue":i=>t.hasShipping=i,"is-show-physical-goods-checkbox":!0,"is-show-setting-modal-button":!0,"shipping-info":l(N)},null,8,["modelValue","onUpdate:modelValue","shipping-info"]),r("div",Uo,[l(A)?(c(),p(h,{key:0,label:"Delete",color:"red",onClick:i=>Te(k)},null,8,["onClick"])):D("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:1})),r("div",Eo,[l(S)?D("",!0):(c(),p(h,{key:0,ui:{rounded:"rounded-full"},color:"gray",icon:"i-heroicons-plus-solid",label:"Add Edition",onClick:Se}))]),o(je,{"is-stripe-connect-checked":l($),"onUpdate:isStripeConnectChecked":e[3]||(e[3]=t=>g($)?$.value=t:null),"is-using-default-account":l(J),"onUpdate:isUsingDefaultAccount":e[4]||(e[4]=t=>g(J)?J.value=t:null),"stripe-connect-wallet":l(B),"should-disable-setting":l(X),"login-address":l(U),onSave:Ae},null,8,["is-stripe-connect-checked","is-using-default-account","stripe-connect-wallet","should-disable-setting","login-address"]),o(w,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""}}},{header:a(()=>[e[23]||(e[23]=r("h4",{class:"text-sm font-bold font-mono"}," Email to receive sales notifications / 欲收到銷售通知的電郵 ",-1)),r("div",Io,[o(d,{modelValue:l(v),"onUpdate:modelValue":e[5]||(e[5]=t=>g(v)?v.value=t:null),placeholder:"abc@example.com"},null,8,["modelValue"]),o(h,{label:"Add",variant:l(v)?"outline":"solid",color:l(v)?"primary":"gray",disabled:!l(v),onClick:Ne},null,8,["variant","color","disabled"])])]),default:a(()=>[o(pe,{columns:[{key:"email",label:"Email",sortable:!0},{key:"action"}],rows:l(Ie)},{"email-data":a(({row:t})=>[o(h,{label:t.email,to:`mailto:${t.email}`,variant:"link",padded:!1},null,8,["label","to"])]),"action-data":a(({row:t})=>[r("div",So,[o(h,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>l(Z).splice(t.index,1)},null,8,["onClick"])])]),_:1},8,["rows"])]),_:1}),o(w,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"12px"}}},{default:a(()=>[r("div",To,[e[24]||(e[24]=r("h3",{class:"font-bold font-mono"}," Advanced Settings ",-1)),o(h,{color:"gray",variant:"ghost",icon:l(G)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",onClick:e[6]||(e[6]=()=>{G.value=!l(G)})},null,8,["icon"])]),l(G)?(c(),ee("div",Do,[o(me,{"is-show-physical-goods-checkbox":!1,"is-show-setting-modal-button":!0,"shipping-info":l(N),onUpdateShippingRates:De},null,8,["shipping-info"]),o(w,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"",base:"space-y-8"}}},{header:a(()=>[e[25]||(e[25]=r("h4",{class:"text-sm font-bold font-mono"}," Share sales data to wallets / 分享銷售數據給特定地址 ",-1)),r("div",Mo,[o(d,{modelValue:l(b),"onUpdate:modelValue":e[7]||(e[7]=t=>g(b)?b.value=t:null),class:"font-mono",placeholder:"like1..."},null,8,["modelValue"]),o(h,{label:"Add",variant:l(b)?"outline":"solid",color:l(b)?"primary":"gray",disabled:!l(b),onClick:Me},null,8,["variant","color","disabled"])])]),default:a(()=>[o(pe,{columns:l(Ue),rows:l(Ee)},{"wallet-data":a(({row:t})=>[o(h,{class:"font-mono",label:t.wallet,to:t.walletLink,variant:"link",padded:!1},null,8,["label","to"])]),"remove-data":a(({row:t})=>[r("div",No,[o(h,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>l(q).splice(t.index,1)},null,8,["onClick"])])]),_:1},8,["columns","rows"])]),_:1}),o(w,{ui:{body:{base:"space-y-8"}}},{header:a(()=>e[26]||(e[26]=[r("h3",{class:"font-bold font-mono"}," DRM Options / 數位版權管理選項 ",-1)])),default:a(()=>[r("div",Ao,[o(u,{label:"Force NFT claim before view",ui:{label:{base:"font-mono font-bold"}}},{default:a(()=>[o(T,{modelValue:l(z),"onUpdate:modelValue":e[8]||(e[8]=t=>g(z)?z.value=t:null),name:"mustClaimToView",label:"Must claim NFT to view"},null,8,["modelValue"])]),_:1}),o(u,{label:"Disable File Download",ui:{label:{base:"font-mono font-bold"}}},{default:a(()=>[o(T,{modelValue:l(W),"onUpdate:modelValue":e[9]||(e[9]=t=>g(W)?W.value=t:null),name:"hideDownload",label:"Disable Download"},null,8,["modelValue"])]),_:1}),o(u,{label:"Insert cutomized message page in eBook",ui:{label:{base:"font-mono font-bold"}}},{default:a(()=>[o(T,{modelValue:l(M),"onUpdate:modelValue":e[10]||(e[10]=t=>g(M)?M.value=t:null),name:"enableCustomMessagePage",label:"Enable custom message page"},null,8,["modelValue"])]),_:1})])]),_:1})])):D("",!0)]),_:1}),o(h,{label:l(Ve),loading:l(f),size:"lg",disabled:l(f),onClick:Oe},null,8,["label","loading","disabled"])],64)):D("",!0)]),_:1})}}}),ol=no($o,[["__scopeId","data-v-0cd2f778"]]);export{ol as default};
