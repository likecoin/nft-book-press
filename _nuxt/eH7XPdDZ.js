import{_ as Ie}from"./DgLfHven.js";import{a_ as ye,a$ as Ce,bk as ke,bt as we,b7 as Ue,b9 as c,bb as H,ba as U,bh as Ve,b1 as Se,b3 as S,aX as a,b4 as n,bC as $e,aT as f,aW as t,bD as Ne,bd as b,br as Me,aU as d,b_ as Re,aS as D,bi as $,aV as K,bx as Oe,bo as X,bv as Be,bw as Pe,bg as Le,bp as Te}from"./BVgQfaNN.js";import{_ as je}from"./CYSedqVX.js";import{_ as Ae}from"./CZf5DMS8.js";import{_ as De}from"./DkEM-FlO.js";import{_ as Ee}from"./CwvQAX3y.js";import{_ as ze}from"./D2YwAVrx.js";import{_ as Fe}from"./B7Q4iAhT.js";import{_ as qe}from"./PVDgsdc0.js";import{a as Je}from"./mJZnu1Sy.js";import"./B235-UCu.js";import"./CKjq_wLR.js";import"./Ob-Xc3PG.js";import"./D6QEFKpq.js";import"./Tkb2MnXN.js";import"./BCqzyNmh.js";import"./CiYhumtk.js";(function(){try{var x=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},r=new x.Error().stack;r&&(x._sentryDebugIds=x._sentryDebugIds||{},x._sentryDebugIds[r]="e8cdf908-0fc6-490c-b80c-dbb867972b85",x._sentryDebugIdIdentifier="sentry-dbid-e8cdf908-0fc6-490c-b80c-dbb867972b85")}catch{}})();const Qe={class:"flex items-center gap-2"},We=["textContent"],Ge={class:"flex items-start gap-4"},He=["src"],Ke={class:"flex flex-col justify-start"},Xe=["textContent"],Ye={class:"text-center"},Ze={class:"flex items-center gap-2 px-4 sm:px-6"},eo={class:"flex items-center gap-2"},oo={class:"flex justify-center items-center gap-4"},to={class:"flex items-center gap-2"},no={class:"flex justify-center gap-4"},yo=ye({__name:"index",setup(x){const{t:r}=Ce(),E=ke(),B=we(),{BOOK3_URL:Y}=Ue().public,N=Je(),{lazyFetchClassMetadataById:z,lazyFetchClassListingInfoById:F}=N,m=c([{id:0,value:""}]),q=c(1),v=c(!1),h=c(""),I=c(""),y=c([]),_=c(""),p=c([]),g=c(!1),V=c(!1),C=c(!1);H(g,o=>{o||(m.value=[{id:0,value:""}],q.value=1)});const Z=U(()=>{const o=[{key:"name",label:r("common.name"),class:""}];return C.value&&o.push({key:"delete-action",label:"",class:"w-12"}),o}),ee=U(()=>{const o=[];return P.value.length&&o.push([{label:C.value?"Exit Edit Items":"Edit Items",icon:C.value?"i-heroicons-pencil-solid":"i-heroicons-pencil",click:ie}]),o.push([{label:"New Coupon",icon:"i-heroicons-tag",click:()=>{v.value=!v.value}},{class:"text-red-500",label:"Clear All Coupons",icon:"i-heroicons-trash",iconClass:"text-red-500",disabled:!y.value.length,click:re}]),o}),P=U(()=>p.value?.map((o,e)=>({classId:o.classId,name:N.getClassMetadataById(o.classId)?.name,prices:N.getClassListingInfoById(o.classId)?.prices?.map(u=>({...u})),image:$e(N.getClassMetadataById(o.classId)?.data?.metadata?.image),index:e}))),k=c([]),M=U(()=>k.value.map(e=>p.value[e.index]).sort((e,u)=>e?.priceIndex!==void 0&&!u?.priceIndex?-1:!e?.priceIndex&&u?.priceIndex!==void 0?1:0));H(P,o=>{o.length||(C.value=!1)});const w=U(()=>{const o=new URLSearchParams({utm_source:"direct-checkout",utm_medium:"pos"}),e=M.value.map(({classId:u,priceIndex:s})=>`${u}${s?`:${s}`:""}`).join(",");return o.append("products",e),_.value&&o.append("coupon",_.value),`${Y}/checkout?${o.toString()}`}),L=U(()=>"3ook Point Of Sale");Ve({title:()=>L.value,ogTitle:()=>L.value}),Se(()=>{try{const o=window.localStorage.getItem("nft_book_store_pos_items");if(o){const u=JSON.parse(o);p.value=u.map(s=>({classId:s.classId,priceIndex:s.priceIndex}))}const e=window.localStorage.getItem("nft_book_store_pos_coupons");if(e){const u=JSON.parse(e);y.value=u.map(s=>({name:s.name,code:s.code}))}}catch(o){console.error(o)}p.value.forEach(o=>{o.classId&&(z(o.classId),F(o.classId))})});function oe(){m.value.length&&m.value.push({id:q.value++,value:""})}function te(o){m.value.splice(o,1)}function ne(o,e){m.value[o].error=void 0,m.value[o].value=e}function le(){m.value.forEach(o=>{o.error=void 0;let e=o.value.trim();e.startsWith("http")&&(e=new URL(e).pathname.split("/").pop()||""),e.startsWith("0x")?(p.value.push({classId:e,priceIndex:0}),z(e),F(e)):o.error=new Error("Invalid product ID")}),m.value.every(o=>!o.error)&&(g.value=!1,T())}function ae(o,{index:e}){p.value[e].priceIndex=Number(o),T()}function se({index:o}){p.value.splice(o,1),k.value=k.value.filter(e=>e.index!==o),T()}function J(){g.value=!g.value}function ie(){C.value=!C.value}function de(){y.value.push({name:h.value,code:I.value}),h.value="",I.value="",Q(),B.add({title:"Added coupon",timeout:2e3,color:"green"}),v.value=!1}function re(){window.confirm("Are you sure you want to clear all coupons?")&&(y.value=[],_.value="",Q(),B.add({title:"Cleared all coupons",timeout:2e3,color:"red"}))}function T(){window.localStorage.setItem("nft_book_store_pos_items",JSON.stringify(p.value))}function Q(){window.localStorage.setItem("nft_book_store_pos_coupons",JSON.stringify(y.value))}function ue(){B.add({title:"Copied URL to clipboard",timeout:2e3}),navigator.clipboard.writeText(w.value)}function ce(){window.open(w.value)}function me(){V.value=!0}return(o,e)=>{const u=Ie,s=Me,pe=je,W=Ae,_e=Re,fe=De,be=Oe,R=Pe,O=Be,ve=Ee,j=Le,ge=ze,A=Ne,xe=Fe,he=qe;return f(),S(he,{key:n(E).path},{default:a(()=>[t(u,{title:n(L)},null,8,["title"]),t(xe,{ui:{base:"flex flex-col items-stretch grow space-y-4",padding:"max-md:!px-0 max-md:py-0"}},{default:a(()=>[t(A,{ui:{base:"flex flex-col grow",rounded:"max-md:rounded-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"grow",padding:""},footer:{base:"sticky bottom-0 bg-white dark:bg-gray-900 rounded-b-[inherit]",padding:"px-0 sm:px-0 space-y-4"}}},{header:a(()=>[d("div",Qe,[d("h2",{class:"text-xl font-bold",textContent:K(n(r)("sales_pos.sales_items")+(n(M).length>0?n(r)("sales_pos.selected_count",{count:n(M).length}):""))},null,8,We),t(s,{icon:"i-heroicons-plus-circle",variant:"soft",onClick:J})]),t(pe,{items:n(ee),popper:{placement:"bottom-end"}},{default:a(()=>[t(s,{color:"white",icon:"i-heroicons-ellipsis-horizontal-circle"})]),_:1},8,["items"])]),footer:a(()=>[d("div",Ze,[t(W,{modelValue:n(_),"onUpdate:modelValue":e[1]||(e[1]=l=>b(_)?_.value=l:null),class:"grow",options:n(y).map(l=>({label:l.name,value:l.code})),placeholder:n(r)("sales_pos.select_coupon")},null,8,["modelValue","options","placeholder"]),n(_)?(f(),S(s,{key:0,icon:"i-heroicons-x-mark-16-solid",size:"sm",color:"gray",variant:"outline",onClick:e[2]||(e[2]=()=>{_.value=""})})):$("",!0)]),t(be),t(ge,{class:"w-full",items:[{key:"direct",label:n(r)("sales_pos.direct_checkout")}],ui:{wrapper:"px-4 sm:px-6",base:"flex flex-col space-y-4"}},{item:a(({item:l})=>[l.key==="direct"?(f(),D(X,{key:0},[t(O,{label:n(r)("sales_pos.checkout_url")},{default:a(()=>[d("div",eo,[t(R,{modelValue:n(w),"onUpdate:modelValue":e[3]||(e[3]=i=>b(w)?w.value=i:null),class:"grow font-mono",readonly:""},null,8,["modelValue"]),t(s,{icon:"i-heroicons-clipboard-document",variant:"soft",color:"gray",onClick:ue})])]),_:1},8,["label"]),d("div",oo,[t(s,{label:n(r)("sales_pos.view_cart"),size:"lg",onClick:ce},null,8,["label"]),t(s,{label:n(r)("sales_pos.generate_qr_code"),disabled:!n(M).length,size:"lg",onClick:me},null,8,["label","disabled"]),t(j,{modelValue:n(V),"onUpdate:modelValue":e[5]||(e[5]=i=>b(V)?V.value=i:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:a(()=>[t(ve,{data:n(w),mode:"readonly","file-name":"likerland_checkout",width:280,height:280},{header:a(()=>[e[11]||(e[11]=d("h3",{class:"font-bold font-mono",textContent:"Scan to buy"},null,-1)),t(s,{icon:"i-heroicons-x-mark",color:"gray",variant:"ghost",onClick:e[4]||(e[4]=i=>V.value=!1)})]),_:1},8,["data"])]),_:1},8,["modelValue"])])],64)):$("",!0)]),_:1},8,["items"])]),default:a(()=>[t(fe,{modelValue:n(k),"onUpdate:modelValue":e[0]||(e[0]=l=>b(k)?k.value=l:null),columns:n(Z),rows:n(P),ui:{wrapper:"static h-full",thead:"sticky top-0"}},{"name-data":a(({row:l})=>[d("div",Ge,[l.image?(f(),D("img",{key:0,class:"w-[64px] object-contain rounded-sm",src:l.image,alt:"Item image"},null,8,He)):$("",!0),d("div",Ke,[d("div",{class:"whitespace-break-spaces",textContent:K(l.name)},null,8,Xe),l.classId&&l.prices?.length>1?(f(),S(W,{key:0,class:"mt-2","model-value":n(p)[l.index].priceIndex||0,options:l.prices?.map(i=>({label:i.name?.zh||i.name?.en||i.name,value:i.index})),"onUpdate:modelValue":i=>ae(i,l)},null,8,["model-value","options","onUpdate:modelValue"])):$("",!0)])])]),"delete-action-header":a(()=>[d("div",Ye,[t(_e,{name:"i-heroicons-trash-solid"})])]),"delete-action-data":a(({row:l})=>[t(s,{icon:"i-heroicons-x-mark",color:"red",variant:"link",onClick:i=>se(l)},null,8,["onClick"])]),_:1},8,["modelValue","columns","rows"])]),_:1}),t(j,{modelValue:n(g),"onUpdate:modelValue":e[6]||(e[6]=l=>b(g)?g.value=l:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:a(()=>[t(A,{ui:{rounded:"max-sm:rounded-b-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"space-y-4"},footer:{base:"flex justify-center items-center"}}},{header:a(()=>[e[12]||(e[12]=d("h3",{class:"font-bold font-mono",textContent:"Add Item(s)"},null,-1)),t(s,{icon:"i-heroicons-x-mark",color:"gray",variant:"link",onClick:J})]),footer:a(()=>[t(s,{label:"Confirm",onClick:le})]),default:a(()=>[(f(!0),D(X,null,Te(n(m),(l,i)=>(f(),S(O,{key:`input-${l.id}`,label:n(r)("sales_pos.enter_product_id_urls"),required:!0,error:l.error?.message},{default:a(()=>[d("div",to,[t(R,{class:"grow font-mono","model-value":l.value,placeholder:"https://3ook.com/store/0x....","onUpdate:modelValue":G=>ne(i,G)},null,8,["model-value","onUpdate:modelValue"]),n(m).length>1?(f(),S(s,{key:0,icon:"i-heroicons-x-circle",variant:"link",onClick:G=>te(i)},null,8,["onClick"])):$("",!0)])]),_:2},1032,["label","error"]))),128)),d("div",no,[t(s,{icon:"i-heroicons-plus-circle",label:n(r)("sales_pos.add"),variant:"outline",onClick:oe},null,8,["label"])])]),_:1})]),_:1},8,["modelValue"]),t(j,{modelValue:n(v),"onUpdate:modelValue":e[10]||(e[10]=l=>b(v)?v.value=l:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:a(()=>[t(A,{ui:{rounded:"max-sm:rounded-b-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"space-y-4"},footer:{base:"flex justify-end items-center gap-4"}}},{header:a(()=>[e[13]||(e[13]=d("h3",{class:"font-bold",textContent:"Add Coupon"},null,-1)),t(s,{icon:"i-heroicons-x-mark-16-solid",color:"gray",size:"xl",padded:!1,variant:"link",onClick:e[7]||(e[7]=l=>v.value=!1)})]),footer:a(()=>[t(s,{icon:"i-heroicons-plus-circle",label:"Add Coupon",disabled:!n(h)||!n(I),onClick:de},null,8,["disabled"])]),default:a(()=>[t(O,{label:"Coupon Name",help:"For POS Display Only",required:!0},{default:a(()=>[t(R,{modelValue:n(h),"onUpdate:modelValue":e[8]||(e[8]=l=>b(h)?h.value=l:null),placeholder:"Fall Promotion"},null,8,["modelValue"])]),_:1}),t(O,{label:"Coupon Code",required:!0},{default:a(()=>[t(R,{modelValue:n(I),"onUpdate:modelValue":e[9]||(e[9]=l=>b(I)?I.value=l:null),class:"font-mono",placeholder:"FALLPROMO"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}});export{yo as default};
