import{a_ as Ye,b6 as Ge,bl as Ke,bk as Je,bx as Ze,bn as de,bm as et,b0 as tt,b7 as at,a$ as ot,b8 as m,b9 as h,ba as lt,b1 as nt,b3 as N,aX as i,bC as st,di as me,bN as pe,dj as it,cr as rt,aT as g,aU as p,br as A,aS as U,aW as n,aV as f,b4 as a,bs as ct,bO as ut,aY as ee,bi as te,bt as dt,cL as mt,bg as pt,bI as bt,cO as ft,bf as S,bj as _t,bL as ht,b2 as yt}from"./DWNVpWgR.js";import{_ as gt}from"./c7ZsW5Kt.js";import{_ as vt}from"./s5lkZ4NP.js";import{_ as kt}from"./hKaQwOB7.js";import{_ as wt}from"./D0mU-GCM.js";import{_ as Ct}from"./CzrHh2Hj.js";import{_ as xt}from"./IVgaZRFJ.js";import{_ as St}from"./BlAlNDJY.js";import{_ as $t}from"./B8nVVVgr.js";import{u as Dt}from"./Cqph52cW.js";import{u as Tt}from"./CY4ku8D4.js";import"./DYjdvaJ2.js";import"./DYPQx93_.js";import"./C7bKQsf5.js";import"./DoAjuVVw.js";import"./4DDr4pfj.js";(function(){try{var $=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},B=new $.Error().stack;B&&($._sentryDebugIds=$._sentryDebugIds||{},$._sentryDebugIds[B]="572bd52f-86b9-40ce-9dc2-c74d5a6649df",$._sentryDebugIdIdentifier="sentry-dbid-572bd52f-86b9-40ce-9dc2-c74d5a6649df")}catch{}})();const Nt={class:"text-lg font-bold font-mono"},Ut={class:"font-bold font-mono"},Lt={class:"font-bold font-mono"},Et={class:"font-bold font-mono"},Rt={class:"flex flex-col gap-[8px] items-start"},Wt={class:"text-center"},It={class:"text-sm font-bold font-mono"},Pt={class:"flex gap-2"},At={class:"flex justify-end items-center"},Bt={key:0,class:"font-bold font-mono"},Vt={class:"flex justify-between items-center w-full"},Ft={class:"font-bold font-mono"},Ot={key:0,class:"mt-[24px] flex flex-col gap-[12px]"},jt={class:"text-sm font-bold font-mono"},zt={class:"flex gap-2"},qt={class:"flex justify-end items-center"},Mt={class:"font-bold font-mono"},Ht={class:"font-bold font-mono"},ca=Ye({__name:"[collectionId]",setup($){const{CHAIN_EXPLORER_URL:B,LIKE_CO_API:V}=Ge().public,be=Ke(),ae=Je(),fe=Dt(),F=Ze(),_e=Tt(),{token:Q}=de(ae),{wallet:D}=de(be),{updateNFTBookCollectionById:X,reduceListingPendingNFTCountById:he}=F,{getClassMetadataById:ye,lazyFetchClassMetadataById:ge}=fe,{fetchStripeConnectStatusByWallet:oe}=_e,ve=et(),Y=tt(),le=at(),{t:l}=ot(),w=m(""),C=m(!1),y=m(ve.params.collectionId),L=m(void 0),u=m({}),E=m({}),G=m(!1),R=m(""),T=m([]),W=m([]),v=m(""),k=m(""),I=m(!1),O=m(""),j=m({}),P=m(!0),z=m(!1),K=m(!1),q=m(!0),ne=h(()=>{var t;return(t=F.getCollectionById(y.value))==null?void 0:t.name}),se=h(()=>{var t;return(t=u==null?void 0:u.value)==null?void 0:t.ownerWallet}),ie=h(()=>H.value.find(t=>!!t.shippingStatus)),J=h(()=>D.value&&se.value===D.value),ke=h(()=>J.value),M=h(()=>st({collectionId:y.value,channel:L.value,isUseLikerLandLink:P.value})),we=h(()=>H.value.length?H.value.reduce((e,s)=>{const r=s.from||"empty";return e[r]||(e[r]={count:0,totalUSD:0}),e[r].count+=1,e[r].totalUSD+=s.price,e},{}):{}),H=h(()=>{var t;return(t=E.value)!=null&&t.orders?E.value.orders.map(e=>{const s=e.timestamp,r=new Date(s),d=`${r.getDate()}/${r.getMonth()+1}/${r.getFullYear()}`;return{...e,formattedDate:d}}).sort((e,s)=>s.timestamp-e.timestamp):[]}),Ce=h(()=>{const t=[{key:"actions",label:l("table.actions"),sortable:!1},{key:"orderDate",label:l("table.order_date"),sortable:!0},{key:"status",label:l("table.status"),sortable:!0}];return ie.value&&t.push({key:"shippingStatus",label:l("table.shipping_status"),sortable:!0}),t.push({key:"from",label:l("table.sales_channel"),sortable:!0},{key:"price",label:l("form.price"),sortable:!0},{key:"quantity",label:l("table.quantity"),sortable:!0},{key:"coupon",label:l("table.coupon_applied"),sortable:!1},{key:"buyerEmail",label:l("table.buyer_email"),sortable:!0},{key:"readerEmail",label:l("table.reader_email"),sortable:!0},{key:"wallet",label:l("table.reader_wallet"),sortable:!0},{key:"message",label:l("table.reader_message"),sortable:!1}),ie.value&&(t.push({key:"buyerPhone",label:l("table.buyer_phone"),sortable:!0}),t.push({key:"shippingName",label:l("table.shipping_name"),sortable:!0}),t.push({key:"shippingAddress",label:l("table.shipping_address"),sortable:!0}),t.push({key:"shippingCountry",label:l("table.shipping_country"),sortable:!0})),t});function xe(t){const e=[];return t.status==="completed"&&t.txHash?e.push([{label:l("collection.view_transaction"),icon:"i-heroicons-magnifying-glass",to:`${B}/${t.txHash}`,target:"_blank"}]):t.status==="pendingNFT"&&ke.value&&e.push([{label:"Send NFT",icon:"i-heroicons-paper-airplane",to:Y({name:"nft-book-store-collection-send-collectionId",params:{collectionId:t.collectionId},query:{owner_wallet:se.value,payment_id:t.id}})}]),t.status==="paid"&&e.push([{label:l("collection.send_reminder_email"),icon:"i-heroicons-envelope",click:()=>{We(t)}}]),["pendingNFT","paid"].includes(t.status)&&e.push([{label:l("collection.mark_complete"),icon:"i-heroicons-check-circle",click:()=>{Ie(t)}}]),e}function Se(t){switch(t.status){case"paid":return"Paid";case"pendingNFT":return"Pending NFT";case"completed":return t.shippingStatus==="pending"?l("collection.pending_shipping"):l("status.completed");default:return t.status}}function $e(t){switch(t.status){case"paid":return"blue";case"pendingNFT":return"amber";case"completed":return t.shippingStatus==="pending"?"amber":"green";default:return"gray"}}const De=h(()=>{var t;return(t=H.value)==null?void 0:t.map((e,s)=>{var r,d,b,c;return{index:s,buyerEmail:e.email,buyerPhone:e.phone||"",readerEmail:((r=e.giftInfo)==null?void 0:r.toEmail)||e.email,status:e.status,statusLabel:Se(e),statusLabelColor:$e(e),orderDate:e.formattedDate,shippingStatus:e.shippingStatus,shippingCountry:((b=(d=e.shippingDetails)==null?void 0:d.address)==null?void 0:b.country)||"",shippingAddress:it(e.shippingDetails)||"",shippingName:((c=e.shippingDetails)==null?void 0:c.name)||"",wallet:e.wallet||"",walletLink:pe(e.wallet),shortenWallet:me(e.wallet),priceName:e.priceName,price:e.price||0,quantity:e.quantity||1,coupon:e.coupon||"",message:e.message||"",from:e.from||"",actions:xe(e)}}).filter(e=>{var r,d,b,c,x;if(!R.value)return!0;const s=R.value.toLowerCase();return e.buyerEmail.toLowerCase().includes(s)||e.buyerPhone.toLowerCase().includes(s)||e.readerEmail.toLowerCase().includes(s)||((r=e.wallet)==null?void 0:r.toLowerCase().includes(s))||((d=e.priceName)==null?void 0:d.toLowerCase().includes(s))||((b=e.statusLabel)==null?void 0:b.toLowerCase().includes(s))||((c=e.orderDate)==null?void 0:c.toLowerCase().includes(s))||((x=e.from)==null?void 0:x.toLowerCase().includes(s))})}),Te=h(()=>{const t=[{key:"wallet",label:l("table.wallet"),sortable:!0}];return J.value&&t.push({key:"remove",label:"",sortable:!1}),t}),Ne=h(()=>T.value?T.value.map((t,e)=>({index:e,wallet:t,shortenWallet:me(t),walletLink:pe(t)})):[]),Ue=h(()=>{var t;return(t=W.value)==null?void 0:t.map((e,s)=>({index:s,email:e}))}),Le=h(()=>{var e,s,r;const t=(e=u.value)==null?void 0:e.classIds;return t!=null&&t.length?[{index:1,books:(s=u.value)==null?void 0:s.classIds,price:((r=u.value)==null?void 0:r.priceInDecimal)/100,action:y.value}]:[]});function Ee(t){switch(t){case"empty":return"Not set";default:return t}}const Re=h(()=>{var t;return(t=Object.entries(we.value))==null?void 0:t.map(([e,s])=>({id:e,idLabel:Ee(e),count:s.count||0,totalUSD:s.totalUSD||0}))});lt(C,t=>{t&&(w.value="")}),nt(async()=>{C.value=!0;try{u.value=await F.fetchCollectionById(y.value);const t=u.value.typePayload;t&&(u.value={...u.value,...t});const{moderatorWallets:e,notificationEmails:s,connectedWallets:r}=u.value;T.value=e,W.value=s,I.value=!!(r&&Object.keys(r).length),j.value=r;const d=r&&Object.keys(r)[0];if(d&&(O.value=d,d!==D.value)){q.value=!1;try{await oe(d)}catch(c){console.error(c)}}const b=await $fetch(`${V}/likernft/book/collection/purchase/${y.value}/orders`,{headers:{authorization:`Bearer ${Q.value}`}});if(E.value=b,D.value)try{await oe(D.value)}catch(c){console.error(c)}u.value.classIds.forEach(c=>ge(c))}catch(t){console.error(t),w.value=t.toString()}finally{C.value=!1}});async function We(t){var s,r;if(!((r=(s=E.value)==null?void 0:s.orders)==null?void 0:r.find(d=>d.id===t.id)))throw new Error("ORDER_NOT_FOUND");await $fetch(`${V}/likernft/book/collection/purchase/${y.value}/status/${t.id}/remind`,{method:"POST",headers:{authorization:`Bearer ${Q.value}`}}),le.add({icon:"i-heroicons-check-circle",title:l("collection.send_reminder_email"),timeout:2e3,color:"green"})}async function Ie(t){var d,b;if(!confirm("Do you want to skip the 'Send NFT' action and override this payment status to 'completed'?"))return;const s=(b=(d=E.value)==null?void 0:d.orders)==null?void 0:b.find(c=>c.id===t.id);if(!s)throw new Error("ORDER_NOT_FOUND");const r=s.status;s.status="completed";try{await $fetch(`${V}/likernft/book/collection/purchase/${y.value}/sent/${t.id}`,{method:"POST",body:{txHash:null,quantity:t.quantity||1},headers:{authorization:`Bearer ${Q.value}`}})}catch(c){throw s.status=r,c}r==="pendingNFT"&&(u.value.pendingNFTCount-=11,he(y.value,1))}function Pe(){v.value&&(T.value.push(v.value),v.value="")}function Ae(){k.value&&(W.value.push(k.value),k.value="")}async function Be(t){j.value={[t]:100},O.value=t;try{await X(y.value,{connectedWallets:j.value})}catch(e){const s=e.data||e;w.value=s}finally{K.value=!0}}async function Ve(){try{if(v.value)throw new Error(l("errors.add_moderator_wallet"));if(k.value)throw new Error(l("errors.add_notification_email"));C.value=!0;const t=I.value&&O.value?j.value:null;await X(y.value,{moderatorWallets:T,notificationEmails:W,connectedWallets:t}),await yt(Y({name:"nft-book-store-collection"}))}catch(t){const e=t.data||t;console.error(e),w.value=e}finally{C.value=!1,K.value=!1}}async function Fe(t){G.value=!0;try{await X(y.value,{shippingRates:t}),u.value=await F.fetchCollectionById(y.value);const e=u.value.typePayload;e&&(u.value={...u.value,...e})}catch(e){const s=e.data||e;w.value=s}finally{G.value=!1}}async function Oe(){await navigator.clipboard.writeText(M.value),le.add({icon:"i-heroicons-check-circle",title:l("purchase_link.copied_to_clipboard"),timeout:2e3,color:"green"})}return(t,e)=>{const s=ct,r=ut,d=mt,b=gt,c=dt,x=vt,_=pt,re=ft,je=kt,ce=wt,ze=Ct,qe=xt,Me=St,He=rt("QRCode"),Qe=ht,Xe=$t;return g(),N(Xe,{class:"space-y-10 pb-10"},{default:i(()=>[p("h1",Nt,f(a(l)("collection.nft_collection_status"))+' "'+f(a(ne))+'" ',1),a(w)?(g(),N(s,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${a(w)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:e[0]||(e[0]=o=>w.value="")},null,8,["title"])):A("",!0),a(C)?(g(),N(r,{key:1,animation:"carousel"},{indicator:i(()=>[ee(f(a(l)("common.loading")),1)]),_:1})):A("",!0),a(ae).isAuthenticated?(g(),U(te,{key:2},[n(c,{ui:{body:{padding:""}}},{header:i(()=>[p("h3",Ut,f(a(l)("table.status")),1)]),default:i(()=>[n(b,{columns:[{key:"pendingAction",label:a(l)("table.pending_action")},{key:"sold",label:a(l)("table.sold")},{key:"stock",label:a(l)("table.stock")}],rows:[{pendingAction:a(u).pendingNFTCount||0,sold:a(u).sold||0,stock:a(u).stock||0}]},{"pendingAction-data":i(({row:o})=>[o.pendingAction?(g(),N(d,{key:0,label:`${o.pendingAction}`,color:"red",ui:{rounded:"rounded-full"}},null,8,["label"])):(g(),U(te,{key:1},[ee(f(o.pendingAction),1)],64))]),_:1},8,["columns","rows"])]),_:1}),n(c,{ui:{header:{base:"flex justify-between items-center gap-4"},body:{padding:""}}},{header:i(()=>[p("h3",Lt,f(a(l)("pages.orders")),1),n(x,{modelValue:a(R),"onUpdate:modelValue":e[1]||(e[1]=o=>S(R)?R.value=o:null),icon:"i-heroicons-magnifying-glass-20-solid",placeholder:a(l)("status_page.search_placeholder")},null,8,["modelValue","placeholder"])]),default:i(()=>[n(b,{columns:a(Ce),rows:a(De)},{"buyerEmail-data":i(({row:o})=>[n(_,{label:o.buyerEmail,to:`mailto:${o.buyerEmail}`,variant:"link",padded:!1},null,8,["label","to"])]),"readerEmail-data":i(({row:o})=>[n(_,{label:o.readerEmail,to:`mailto:${o.readerEmail}`,variant:"link",padded:!1},null,8,["label","to"])]),"wallet-data":i(({row:o})=>[n(re,{text:o.wallet},{default:i(()=>[n(_,{class:"font-mono",label:o.shortenWallet,to:o.walletLink,variant:"link",padded:!1,size:"xs",target:"_blank"},null,8,["label","to"])]),_:2},1032,["text"])]),"status-data":i(({row:o})=>[n(d,{color:o.statusLabelColor,label:o.statusLabel,variant:"outline",ui:{rounded:"rounded-full"}},null,8,["color","label"])]),"actions-data":i(({row:o})=>[n(je,{items:o.actions},{default:i(()=>[n(_,{class:bt({hidden:!o.actions.length}),icon:"i-heroicons-ellipsis-horizontal-20-solid",color:"gray",variant:"ghost"},null,8,["class"])]),_:2},1032,["items"])]),_:1},8,["columns","rows"])]),_:1}),n(c,{ui:{body:{padding:""}}},{header:i(()=>[p("h3",Et,f(a(l)("form.books_in_collection")),1)]),default:i(()=>[n(ce,null,{default:i(()=>[n(b,{columns:[{key:"index",label:""},{key:"books",label:a(l)("collection.book_name")},{key:"price",label:a(l)("table.price_usd")},{key:"action",label:a(l)("common.edit")}],rows:a(Le)},{"books-data":i(({row:o})=>[p("div",Rt,[(g(!0),U(te,null,_t(o==null?void 0:o.books,Z=>{var ue;return g(),U("span",{key:Z,class:"text-left whitespace-pre-line"},f(`${(ue=a(ye)(Z))==null?void 0:ue.name}
 class id: ${Z} 
`),1)}),128))])]),"price-data":i(({row:o})=>[p("span",Wt,f(o.price),1)]),"action-data":i(({row:o})=>[n(_,{icon:"i-heroicons-document-magnifying-glass",to:a(Y)({name:"nft-book-store-collection-status-collectionId-edit",params:{collectionId:o.collectionId}}),variant:"soft",color:"gray"},null,8,["to"])]),_:1},8,["columns","rows"])]),_:1})]),_:1}),a(J)?(g(),N(ze,{key:0,"is-stripe-connect-checked":a(I),"onUpdate:isStripeConnectChecked":e[2]||(e[2]=o=>S(I)?I.value=o:null),"is-using-default-account":a(q),"onUpdate:isUsingDefaultAccount":e[3]||(e[3]=o=>S(q)?q.value=o:null),"stripe-connect-wallet":a(O),"should-disable-setting":a(K),"login-address":a(D),onSave:Be},null,8,["is-stripe-connect-checked","is-using-default-account","stripe-connect-wallet","should-disable-setting","login-address"])):A("",!0),n(c,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""}}},{header:i(()=>[p("h4",It,f(a(l)("form.email_notifications")),1),p("div",Pt,[n(x,{modelValue:a(k),"onUpdate:modelValue":e[4]||(e[4]=o=>S(k)?k.value=o:null),placeholder:"abc@example.com"},null,8,["modelValue"]),n(_,{label:"Add",variant:a(k)?"outline":"solid",color:a(k)?"primary":"gray",disabled:!a(k),onClick:Ae},null,8,["variant","color","disabled"])])]),default:i(()=>[n(b,{columns:[{key:"email",label:a(l)("common.email"),sortable:!0},{key:"action"}],rows:a(Ue)},{"email-data":i(({row:o})=>[n(_,{label:o.email,to:`mailto:${o.email}`,variant:"link",padded:!1},null,8,["label","to"])]),"action-data":i(({row:o})=>[p("div",At,[n(_,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>a(W).splice(o.index,1)},null,8,["onClick"])])]),_:1},8,["columns","rows"])]),_:1}),n(c,{ui:{body:{padding:""}}},{header:i(()=>e[9]||(e[9]=[p("h3",{class:"font-bold font-mono"}," Sales Channel Summary / 銷售渠道摘要 ",-1)])),default:i(()=>[n(b,{columns:[{key:"id",label:a(l)("table.channel_id"),sortable:!0},{key:"count",label:a(l)("table.count"),sortable:!0},{key:"totalUSD",label:a(l)("table.total_usd"),sortable:!0}],rows:a(Re)},{"id-data":i(({row:o})=>[o.id!=="empty"?(g(),U("span",Bt,f(o.idLabel),1)):(g(),N(d,{key:1,label:o.idLabel,ui:{rounded:"rounded-full"},color:"gray"},null,8,["label"]))]),_:1},8,["columns","rows"])]),_:1}),n(c,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"12px"}}},{default:i(()=>[p("div",Vt,[p("h3",Ft,f(a(l)("nft_book_form.advanced_settings")),1),n(_,{color:"gray",variant:"ghost",icon:a(z)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",onClick:e[5]||(e[5]=()=>{z.value=!a(z)})},null,8,["icon"])]),a(z)?(g(),U("div",Ot,[n(qe,{"is-show-physical-goods-checkbox":!1,"is-loading":a(G),"shipping-info":a(u).shippingRates,onUpdateShippingRates:Fe},null,8,["is-loading","shipping-info"]),n(c,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"",base:"space-y-8"}}},{header:i(()=>[p("h4",jt,f(a(l)("form.share_sales_data"))+" / 分享銷售數據給特定地址 ",1),p("div",zt,[n(x,{modelValue:a(v),"onUpdate:modelValue":e[6]||(e[6]=o=>S(v)?v.value=o:null),class:"font-mono",placeholder:"0x..."},null,8,["modelValue"]),n(_,{label:a(l)("common.add"),variant:a(v)?"outline":"solid",color:a(v)?"primary":"gray",disabled:!a(v),onClick:Pe},null,8,["label","variant","color","disabled"])])]),default:i(()=>[n(b,{columns:a(Te),rows:a(Ne)},{"wallet-data":i(({row:o})=>[n(re,{text:o.wallet},{default:i(()=>[n(_,{class:"font-mono",label:o.shortenWallet,to:o.walletLink,variant:"link",padded:!1,size:"xs"},null,8,["label","to"])]),_:2},1032,["text"])]),"remove-data":i(({row:o})=>[p("div",qt,[n(_,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>a(T).splice(o.index,1)},null,8,["onClick"])])]),_:1},8,["columns","rows"])]),_:1}),n(c,{ui:{body:{base:"space-y-4"}}},{header:i(()=>[p("h3",Mt,f(a(l)("form.copy_purchase_link")),1)]),default:i(()=>[p("div",null,[n(Me,{modelValue:a(P),"onUpdate:modelValue":e[7]||(e[7]=o=>S(P)?P.value=o:null)},null,8,["modelValue"]),ee(" Use "+f(a(P)?"Liker Land":"Stripe")+" Purchase Link ",1)]),n(ce,{label:a(l)("form.sales_channel_for_links"),hint:a(l)("common.optional")},{default:i(()=>[n(x,{modelValue:a(L),"onUpdate:modelValue":e[8]||(e[8]=o=>S(L)?L.value=o:null),placeholder:"Channel ID"},null,8,["modelValue"])]),_:1},8,["label","hint"]),n(_,{class:"font-mono break-all",label:`${a(M)}`,to:a(M),variant:"outline",color:"gray",target:"_blank"},null,8,["label","to"]),e[10]||(e[10]=p("br",null,null,-1)),n(_,{label:a(l)("form.copy_purchase_link"),variant:"outline",color:"primary",onClick:Oe},null,8,["label"]),n(He,{data:a(M),"file-name":`collection-${a(ne)}-channel_${a(L)||""}`,width:500,height:500},{header:i(()=>[p("h3",Ht,f(a(l)("collection.purchase_link_qr")),1)]),_:1},8,["data","file-name"])]),_:1,__:[10]})])):A("",!0)]),_:1}),n(_,{label:a(l)("common.save"),loading:a(C),size:"lg",disabled:a(C),onClick:Ve},null,8,["label","loading","disabled"])],64)):A("",!0),n(Qe,{transition:!1})]),_:1})}}});export{ca as default};
