import{a_ as Qe,a$ as eo,b6 as oo,bl as to,bk as ao,bn as Q,b9 as h,b8 as r,bJ as lo,ba as G,bb as no,b1 as so,aS as P,aT as f,b3 as A,br as S,aW as s,b4 as e,bs as io,bi as de,aU as u,aX as i,bf as D,aV as g,bt as ro,bL as ce,bj as uo,bE as co,aY as me,bA as mo,bg as _o,bU as fo,bK as po,bh as vo,aQ as bo}from"./BUXJByGc.js";import{_ as ho}from"./D0Cb1eU_.js";import{_ as go}from"./BiRWpGNK.js";import{a as yo,_ as ko}from"./z0cwiz0P.js";import{p as wo,c as xo,_ as Eo,E as Co,a as Uo,v as So}from"./DOi2Ob9-.js";import{_ as Vo}from"./by5kpKfq.js";import{_ as Mo}from"./aRuE-VtY.js";import{_ as Io}from"./DDgAA1aB.js";import{f as Po,D as _e,M as j,U as Ao,c as Do}from"./BXN3p7MA.js";import{u as To}from"./CyXn6u7w.js";import{u as No}from"./DbwAroBc.js";import{g as $o}from"./xruF5QiM.js";import{u as Lo}from"./BoqsnqYo.js";(function(){try{var p=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},z=new p.Error().stack;z&&(p._sentryDebugIds=p._sentryDebugIds||{},p._sentryDebugIds[z]="fd0eae30-a778-4757-b486-4123a772c78d",p._sentryDebugIdIdentifier="sentry-dbid-fd0eae30-a778-4757-b486-4123a772c78d")}catch{}})();function X(p=""){return p.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function Bo(p){return wo.sanitize(p)}const jo={class:"pb-[40px]"},zo={class:"font-bold font-mono"},Wo={class:"font-bold font-mono"},Fo={class:"block text-[14px] text-[#374151] mt-[8px]"},Ro={class:"flex flex-col gap-2"},Oo={class:"space-y-2"},Zo={key:0,class:"pl-8 space-y-2"},qo={class:"space-y-2"},Ko={key:0,class:"pl-8 space-y-2"},Go={class:"text-gray-500 text-[12px]"},Xo={class:"flex justify-center items-center"},Ho={class:"flex justify-center items-center"},Yo={class:"flex justify-between items-center w-full"},Jo={class:"font-bold font-mono"},Qo={key:0,class:"mt-[24px] flex flex-col gap-[12px]"},et={class:"text-sm font-bold font-mono"},ot={class:"flex gap-2"},tt={class:"flex justify-end items-center"},at={class:"text-sm font-bold font-mono"},lt={class:"flex gap-2"},nt={class:"flex justify-end items-center"},st={class:"w-full flex justify-center"},it={class:"space-y-3"},rt={class:"flex justify-between items-center"},ut={class:"text-xs text-gray-500"},dt=1*1024*1024,ct=Qe({__name:"NewNFTBook",props:{isNewClassPage:{type:Boolean,default:!1},classId:{type:String,default:""},editionIndex:{type:[String,Number],default:void 0},isEditMode:{type:Boolean,default:!1}},emits:["submit"],setup(p,{emit:z}){const{t:l}=eo(),{LIKE_CO_API:ee}=oo().public,fe=to(),W=ao(),oe=To(),{wallet:E}=Q(fe),{newBookListing:pe,updateEditionPrice:ve,uploadSignImages:be}=W,{fetchStripeConnectStatusByWallet:he}=oe,{getStripeConnectStatusByWallet:ge}=Q(oe),{token:ye}=Q(W),ke=No(),{getBalanceOf:we}=Lo(),xe=z,V=h(()=>B.editionIndex),{lazyFetchClassMetadataById:te}=ke,y=r(""),m=r(!1),Ee=r({en:"e.g.: This edition includes EPUB and PDF ebook files.",zh:"例：此版本包含 EPUB 及 PDF 電子書檔"}),v=h(()=>B.classId),T=r(1),N=r(!1),M=r(!0),_=r([{price:-1,deliveryMethod:"auto",autoMemo:"Thank you for your support. It means a lot to me.",stock:Po,name:l("prices.standard_edition"),nameEn:"Standard Edition",nameZh:"標準版",descriptionEn:"",descriptionZh:"",isAllowCustomPrice:M.value,isUnlisted:!1}]),F=h(()=>_.value.length>1),R=r(["like1rclg677y2jqt8x4ylj0kjlqjjmnn6w63uflpgr"]),O=r([]),k=r(""),w=r(""),$=r(!1),L=r(""),H=r(!1),Y=r(!0),Ce=r(null),Z=r(null),Ue=r(Number(Do)),Se=h(()=>Math.max(le.value-ae.value,0)),Ve=r(0),ae=r(0),le=r(0),Me=r(["bold","italic","strikeThrough","title","-","unorderedList","orderedList","-","code","link","=","preview"]),C=h(()=>B.isEditMode),Ie=h(()=>C.value?l("nft_book_form.edit_title"):l("nft_book_form.page_title")),Pe=h(()=>C.value?l("common.save"):l("common.submit")),q=r(!1),Ae=h(()=>[{key:"wallet",label:l("common.wallet"),sortable:!0},{key:"remove",label:"",sortable:!1}]),De=h(()=>R.value.map((a,o)=>({index:o,wallet:a,walletLink:lo(a)}))),Te=h(()=>O.value.map((a,o)=>({index:o,email:a}))),ne=h(()=>{var a,o;return(o=(a=Ce.value)==null?void 0:a.contentMetadata)==null?void 0:o.inLanguage});G(m,a=>{a&&(y.value="")},{immediate:!0}),xo({markdownItConfig(a){a.options.html=!1}});const B=p;no({title:()=>l("seo_titles.new_book_listing"),ogTitle:()=>l("seo_titles.new_book_listing")}),so(async()=>{try{m.value=!0;const a=E.value?await we(v.value,E.value):0;if(le.value=Number(a)||0,C.value||V.value!==void 0){if(E.value)try{await he(E.value),ge.value(E.value).isReady&&($.value=!0,L.value=E.value)}catch(t){console.error(t)}const o=await $fetch(`${ee}/likernft/book/store/${v.value}`,{headers:{authorization:`Bearer ${ye.value}`}});if(o){if((o==null?void 0:o.ownerWallet)!==E.value)throw new Error("NOT_OWNER_OF_NFT_CLASS");if(V.value!==void 0)if(o.prices.length){const t=o.prices.find(d=>d.index.toString()===V.value);if(!t)throw new Error("Edition not found");_.value=[{price:t.price,deliveryMethod:t.isAutoDeliver?"auto":"manual",autoMemo:t.autoMemo,stock:t.stock,name:o.inLanguage==="en"?t.name.en:t.name.zh,nameEn:t.name.en,nameZh:t.name.zh,descriptionEn:t.description.en,descriptionZh:t.description.zh,isAllowCustomPrice:t.isAllowCustomPrice,isUnlisted:t.isUnlisted,oldIsAutoDeliver:t.isAutoDeliver,oldStock:t.stock}],M.value=t.isAllowCustomPrice}else throw new Error("No prices found");else _.value[0].price=_e;Ve.value=o.prices.reduce((t,d)=>d.index.toString()!==V.value?t+d.stock:t,0),ae.value=o.prices.reduce((t,d)=>d.index.toString()!==V.value&&!d.isAutoDeliver?t+d.stock:t,0)}else throw new Error(l("errors.nft_class_not_found"))}}catch(a){console.error(a)}finally{m.value=!1}}),G(M,a=>{_.value.forEach(o=>{o.isAllowCustomPrice=a})}),G(m,a=>{a&&(y.value="")}),G(v,async a=>{if(a){const o=await te(a),t=o==null?void 0:o.contentFingerprints;t&&Ne(t)&&(N.value=!0)}},{immediate:!0});function Ne(a){const t=$o().API_GET_ARWEAVE_V2_LINK;return a.some(d=>!!d.startsWith(t)||d.includes("?key="))}function $e(a,o="signatureImage"){if(!(a!=null&&a.length))return;const t=a[0];if(t.type!=="image/png"){y.value=l("errors.png_only");return}if(t.size>dt){y.value=l("errors.file_size_limit");return}o==="signatureImage"?Z.value=t:console.warn(`Unknown upload key: ${o}`)}function Le(a){a.stock=Math.min(Se.value,a.stock)}function Be(){T.value+=1,_.value.push({index:So(),price:_e,deliveryMethod:"auto",autoMemo:"",stock:1,name:ne.value==="en"?`Tier ${T.value}`:`級別 ${T.value}`,nameEn:`Tier ${T.value}`,nameZh:`級別 ${T.value}`,descriptionEn:"",descriptionZh:"",isAllowCustomPrice:!0,isUnlisted:!1})}function je(a){_.value.splice(a,1)}function ze(){k.value&&(R.value.push(k.value),k.value="")}function We(){w.value&&(O.value.push(w.value),w.value="")}function Fe(a){L.value=a,H.value=!0}function K(a){const o=ne.value==="en";return a.map(t=>({name:o?{en:t.name,zh:t.nameZh}:{en:t.nameEn,zh:t.name},description:o?{en:X(t.description),zh:X(t.descriptionZh)}:{en:X(t.descriptionEn),zh:X(t.description)},priceInDecimal:Math.round(Number(t.price)*100),price:Number(t.price),stock:Number(t.stock),isAutoDeliver:t.deliveryMethod==="auto",isAllowCustomPrice:t.isAllowCustomPrice,isUnlisted:t.isUnlisted??!1,autoMemo:t.deliveryMethod==="auto"&&t.autoMemo||""}))}function Re(a){const o=[];return a.forEach(t=>{t.price!==0&&t.price<j&&o.push({path:"price",message:l("errors.price_validation",{minPrice:j})}),(!t.name.en||!t.name.zh)&&o.push({path:"name",message:l("errors.product_name_required")})}),o.length>0?(y.value=o.map(t=>t.message).join(`
`),!1):!0}async function Oe(){try{const a=K(_.value);if(!Re(a))return;if(C.value?await Ze():B.isNewClassPage?await se():(await fetch(`${ee}/likernft/book/store/${v.value}`)).ok?await qe():await se(),Z.value){const o=new FormData;Z.value&&o.append("signImage",Z.value),await be(o,v.value)}xe("submit")}catch{}}async function se(){try{if(!v.value)throw new Error(l("errors.nft_class_id_required"));if(k.value)throw new Error(l("errors.add_moderator_wallet"));if(w.value)throw new Error(l("errors.add_notification_email"));m.value=!0;const a=await te(v.value),o=(a==null?void 0:a.nft_meta_collection_id)||"";if(!o.includes("nft_book")&&!o.includes("book_nft"))throw new Error(l("errors.not_nft_book_collection"));const t=K(_.value);if(t.find(U=>U.price!==0&&U.price<j))throw new Error(l("errors.price_validation",{minPrice:j}));const d=$.value&&L.value?{[L.value]:100}:null,b=_.value.some(U=>U.deliveryMethod==="manual");await pe(v.value,{defaultPaymentCurrency:"USD",connectedWallets:d,moderatorWallets:R.value,notificationEmails:O.value,prices:t,mustClaimToView:!0,enableCustomMessagePage:b,hideDownload:N.value})}catch(a){const o=a.data||a;console.error(o),y.value=o}finally{H.value=!1,m.value=!1}}async function Ze(){try{if(!C.value)throw new Error(l("errors.missing_edition_data"));const o=K(_.value)[0];m.value=!0,await ve(v.value,V.value,{price:o})}catch(a){const o=a.data||a;console.error(o),y.value=o}finally{m.value=!1}}async function qe(){try{m.value=!0;const o=K(_.value)[0];await W.addEditionPrice(v.value.toString(),(V.value||0).toString(),{price:o})}catch(a){console.error(a)}finally{m.value=!1}}return(a,o)=>{const t=io,d=ho,b=go,U=yo,ie=Eo,I=ro,Ke=Vo,Ge=mo,re=Mo,x=_o,ue=ko,Xe=Io,He=fo,Ye=po,Je=vo;return f(),P("div",jo,[e(y)?(f(),A(t,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${e(y)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:o[0]||(o[0]=n=>y.value="")},null,8,["title"])):S("",!0),e(W).isAuthenticated?(f(),P(de,{key:1},[s(I,{ui:{body:{base:"space-y-4"}}},{header:i(()=>[u("h2",zo,g(e(Ie)),1)]),default:i(()=>[s(b,{label:e(l)("nft_book_form.nft_class_id")},{default:i(()=>[s(d,{"model-value":e(v),disabled:"",class:"font-mono"},null,8,["model-value"])]),_:1},8,["label"]),s(b,{class:"flex items-center"},{default:i(()=>[s(ie,{"tool-tip-text":e(l)("nft_book_form.drm_tooltip")},{default:i(()=>[s(U,{modelValue:e(N),"onUpdate:modelValue":o[1]||(o[1]=n=>D(N)?N.value=n:null),name:"hideDownload",disabled:!0,label:e(l)("nft_book_form.drm_label")},null,8,["modelValue","label"])]),_:1},8,["tool-tip-text"])]),_:1}),s(b,null,{default:i(()=>[s(U,{modelValue:e(M),"onUpdate:modelValue":o[2]||(o[2]=n=>D(M)?M.value=n:null),name:"isAllowCustomPrice",label:e(l)("nft_book_form.accept_tipping")},null,8,["modelValue","label"])]),_:1})]),_:1}),(f(),A(ce(e(F)?"ul":"div"),{class:"flex flex-col gap-[12px]"},{default:i(()=>[s(I,{ui:{body:{base:"space-y-5 relative"},base:"overflow-visible border-none !border-transparent"}},{default:i(()=>[(f(!0),P(de,null,uo(e(_),(n,J)=>(f(),A(ce(e(F)?"li":"div"),{key:n.index},{default:i(()=>[s(I,{ui:{body:{base:"flex flex-col gap-[20px]"},base:"overflow-visible border-[4px]"}},co({default:i(()=>[s(b,{label:e(l)("nft_book_form.unit_price_label",{minPrice:e(j)})},{default:i(()=>[s(Ke,{modelValue:n.price,"onUpdate:modelValue":c=>n.price=c,options:e(Ao),"value-attribute":"value"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:2},1032,["label"]),s(b,{label:e(l)("nft_book_form.copies_label")},{default:i(()=>[s(d,{modelValue:n.stock,"onUpdate:modelValue":c=>n.stock=c,type:"number",step:"1",min:0,max:e(Ue)},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1032,["label"]),s(b,{label:e(l)("new_nft_book.product_name"),ui:{container:"space-y-2"}},{label:i(()=>[me(g(e(l)("nft_book_form.product_name"))+" ",1),s(ie,{"image-style":{width:"250px"}},{image:i(()=>o[9]||(o[9]=[u("img",{src:Uo,class:"object-cover",alt:""},null,-1)])),default:i(()=>[s(Ge,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:i(()=>[s(d,{modelValue:n.name,"onUpdate:modelValue":c=>n.name=c,placeholder:e(l)("nft_book_form.product_name_placeholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),u("span",Fo,g(e(l)("nft_book_form.description_optional")),1),s(e(Co),{modelValue:n.descriptionEn,"onUpdate:modelValue":c=>n.descriptionEn=c,language:"en-US","editor-id":`en-${J}`,placeholder:e(Ee).en,toolbars:e(Me),sanitize:e(Bo),style:{height:"200px",width:"100%",marginTop:"0px"}},null,8,["modelValue","onUpdate:modelValue","editor-id","placeholder","toolbars","sanitize"])]),_:2},1032,["label"]),u("div",Ro,[u("div",Oo,[s(re,{modelValue:n.deliveryMethod,"onUpdate:modelValue":c=>n.deliveryMethod=c,value:"auto",disabled:e(C)&&n.oldIsAutoDeliver,name:"deliveryMethod",label:e(l)("nft_book_form.auto_delivery")},null,8,["modelValue","onUpdate:modelValue","disabled","label"]),n.deliveryMethod==="auto"?(f(),P("div",Zo,[s(b,{label:e(l)("nft_book_form.delivery_memo")},{default:i(()=>[s(d,{modelValue:n.autoMemo,"onUpdate:modelValue":c=>n.autoMemo=c,placeholder:e(l)("nft_book_form.memo_placeholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"])])):S("",!0)]),u("div",qo,[s(re,{modelValue:n.deliveryMethod,"onUpdate:modelValue":c=>n.deliveryMethod=c,value:"manual",disabled:e(C)&&n.oldIsAutoDeliver,name:"deliveryMethod",label:e(l)("nft_book_form.manual_delivery"),onClick:c=>Le(n)},null,8,["modelValue","onUpdate:modelValue","disabled","label","onClick"]),n.deliveryMethod==="manual"?(f(),P("div",Ko,[s(b,null,{label:i(()=>[u("p",null,g(e(l)("nft_book_form.autograph_image")),1),u("span",Go,g(e(l)("nft_book_form.image_requirements")),1)]),default:i(()=>[s(d,{type:"file",accept:"image/png",onChange:o[3]||(o[3]=c=>$e(c,"signatureImage"))})]),_:1})])):S("",!0)])]),s(b,null,{default:i(()=>[s(U,{modelValue:n.isUnlisted,"onUpdate:modelValue":c=>n.isUnlisted=c,name:"isUnlisted",label:e(l)("nft_book_form.pause_selling")},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024)]),_:2},[e(F)?{name:"header",fn:i(()=>[u("h3",Wo,g(e(l)("nft_book_form.edition_number",{number:J+1})),1)]),key:"0"}:void 0]),1024),u("div",Xo,[e(F)?(f(),A(x,{key:0,label:e(l)("common.delete"),color:"red",onClick:c=>je(J)},null,8,["label","onClick"])):S("",!0)])]),_:2},1024))),128))]),_:1})]),_:1})),u("div",Ho,[B.isNewClassPage?(f(),A(x,{key:0,ui:{rounded:"rounded-full"},color:"gray",icon:"i-heroicons-plus-solid",label:e(l)("nft_book_form.add_edition"),onClick:Be},null,8,["label"])):S("",!0)]),s(I,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"12px"}}},{default:i(()=>[u("div",Yo,[u("h3",Jo,g(e(l)("nft_book_form.advanced_settings")),1),s(x,{color:"gray",variant:"ghost",icon:e(q)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",onClick:o[4]||(o[4]=()=>{q.value=!e(q)})},null,8,["icon"])]),e(q)?(f(),P("div",Qo,[s(I,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""}}},{header:i(()=>[u("h4",et,g(e(l)("nft_book_form.notification_email_header")),1),u("div",ot,[s(d,{modelValue:e(w),"onUpdate:modelValue":o[5]||(o[5]=n=>D(w)?w.value=n:null),placeholder:"abc@example.com"},null,8,["modelValue"]),s(x,{label:e(l)("common.add"),variant:e(w)?"outline":"solid",color:e(w)?"primary":"gray",disabled:!e(w),onClick:We},null,8,["label","variant","color","disabled"])])]),default:i(()=>[s(ue,{columns:[{key:"email",label:e(l)("common.email"),sortable:!0},{key:"action"}],rows:e(Te)},{"email-data":i(({row:n})=>[s(x,{label:n.email,to:`mailto:${n.email}`,variant:"link",padded:!1},null,8,["label","to"])]),"action-data":i(({row:n})=>[u("div",tt,[s(x,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>e(O).splice(n.index,1)},null,8,["onClick"])])]),_:1},8,["columns","rows"])]),_:1}),e(C)?(f(),A(Xe,{key:0,"is-stripe-connect-checked":e($),"onUpdate:isStripeConnectChecked":o[6]||(o[6]=n=>D($)?$.value=n:null),"is-using-default-account":e(Y),"onUpdate:isUsingDefaultAccount":o[7]||(o[7]=n=>D(Y)?Y.value=n:null),"stripe-connect-wallet":e(L),"should-disable-setting":e(H),"login-address":e(E),onSave:Fe},null,8,["is-stripe-connect-checked","is-using-default-account","stripe-connect-wallet","should-disable-setting","login-address"])):S("",!0),s(I,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"",base:"space-y-8"}}},{header:i(()=>[u("h4",at,g(e(l)("nft_book_form.share_sales_data")),1),u("div",lt,[s(d,{modelValue:e(k),"onUpdate:modelValue":o[8]||(o[8]=n=>D(k)?k.value=n:null),class:"font-mono",placeholder:"0x..."},null,8,["modelValue"]),s(x,{label:e(l)("common.add"),variant:e(k)?"outline":"solid",color:e(k)?"primary":"gray",disabled:!e(k),onClick:ze},null,8,["label","variant","color","disabled"])])]),default:i(()=>[s(ue,{columns:e(Ae),rows:e(De)},{"wallet-data":i(({row:n})=>[s(x,{class:"font-mono",label:n.wallet,to:n.walletLink,variant:"link",padded:!1},null,8,["label","to"])]),"remove-data":i(({row:n})=>[u("div",nt,[s(x,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>e(R).splice(n.index,1)},null,8,["onClick"])])]),_:1},8,["columns","rows"])]),_:1})])):S("",!0)]),_:1}),u("div",st,[s(x,{label:e(Pe),loading:e(m),size:"lg",disabled:e(m),onClick:Oe},null,8,["label","loading","disabled"])])],64)):S("",!0),s(Je,{"model-value":!!e(m),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:i(()=>[u("div",it,[u("div",rt,[s(He,{variant:"soft"},{default:i(()=>[me(g(e(l)("common.loading")),1)]),_:1}),u("p",ut,g(e(l)("nft_book_form.loading_progress_text")),1)]),s(Ye,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),Ct=bo(ct,[["__scopeId","data-v-bfdd99a5"]]);export{Ct as _};
