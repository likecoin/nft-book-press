import{a_ as Q,b6 as ae,b7 as Z,b8 as se,b9 as i,ba as V,bb as G,b1 as oe,bc as _e,aS as B,aT as b,aW as g,b4 as r,bd as me,aX as Y,aU as v,be as fe,aY as be,aV as H,bf as ve,bg as ge,aQ as we,a$ as ne,bh as ie,b3 as J,bi as X,bj as ye,bk as he,b0 as Ie,bl as Se,b2 as j,bm as Ne,bn as ee,bo as Fe,bp as Te,bq as ke,br as xe,bs as Ce}from"./97_6hNTm.js";import{u as Re,v as De,a as te,_ as Me,f as Ue,b as Be}from"./BfS7sGeI.js";import{L as Ee,u as $e}from"./BU2c8jh1.js";import{u as Le,a as le,b as Ae,_ as Ve}from"./C9fmvtmv.js";import{D as Oe}from"./DcbAekho.js";import{_ as Pe}from"./wnLN627m.js";import{_ as Ke}from"./CJFsAI_w.js";import"./Bp5jfyOs.js";import"./DI0YXo6Z.js";import"./DL5wMAUg.js";import"./DWbU-yTm.js";import"./Bv_MnmwN.js";import"./Co-fYNuA.js";import"./_9UqywLG.js";import"./D3xXy05Y.js";import"./Ab1WHR6d.js";import"./CbEwXf7N.js";import"./DfQfhsVP.js";import"./bAIbzOLT.js";(function(){try{var w=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},l=new w.Error().stack;l&&(w._sentryDebugIds=w._sentryDebugIds||{},w._sentryDebugIds[l]="5b7679a9-5b24-47e9-ade6-ef30eceef445",w._sentryDebugIdIdentifier="sentry-dbid-5b7679a9-5b24-47e9-ade6-ef30eceef445")}catch{}})();const qe={class:"space-y-3"},ze={class:"flex justify-between items-center"},We={class:"text-xs text-gray-500"},je=Q({__name:"RegisterISCN",emits:["handleSubmit","submit","formValidChange"],setup(w,{expose:l,emit:x}){const C=ae(),{getFileType:E}=te(),{LIKE_EVM_NFT_TARGET_ADDRESS:$}=Z().public,{wallet:m,signer:f}=se(C),{validateWalletConsistency:F}=C,{assertPositiveWalletBalance:o,waitForTransactionReceipt:T}=Le(),{stripHtmlTags:R,formatLanguage:D}=te(),{showErrorToast:M}=le(),{LIKE_NFT_CONTRACT_ADDRESS:L}=Z().public,c=i({type:"Book",title:"",description:"",isbn:"",publisher:"",publicationDate:"",author:{name:"",description:""},license:"All Rights Reserved",customLicense:"",contentFingerprints:[{url:""}],downloadableUrls:[{url:"",type:"",fileName:""}],language:"",bookInfoUrl:"",tags:[],coverUrl:""}),u=i(""),A=i(""),U=x,{payload:n,computeISCNSalt:d}=Re({iscnFormData:c}),{writeContractAsync:k}=Ae(),y=V(()=>De(c.value)),O=V(()=>{var e;return!((e=y.value)!=null&&e.length)});G(O,e=>{U("formValidChange",e)},{immediate:!0}),oe(()=>{const e=q();e&&(c.value=e)});const q=()=>{var h,I,p,S,t,s;const e=_e();if(!e)return null;const _={type:"Book",title:((h=e.epubMetadata)==null?void 0:h.title)||"",description:R(((I=e.epubMetadata)==null?void 0:I.description)||""),isbn:"",publisher:"",publicationDate:new Date().toISOString().split("T")[0],author:{name:((p=e.epubMetadata)==null?void 0:p.author)||"",description:""},license:"All Rights Reserved",contentFingerprints:[],downloadableUrls:[],coverUrl:(S=e.epubMetadata)!=null&&S.thumbnailArweaveId?`ar://${e.epubMetadata.thumbnailArweaveId}`:"",language:D(((t=e.epubMetadata)==null?void 0:t.language)||"zh"),tags:((s=e.epubMetadata)==null?void 0:s.tags)||[]};return _.downloadableUrls=e.fileRecords.filter(a=>a.fileType==="application/pdf"||a.fileType==="application/epub+zip").map(a=>({url:a.arweaveKey?a.arweaveLink:`ar://${a.arweaveId}`,type:E(a.fileType),fileName:a.fileName})),_.contentFingerprints=[...new Set(e.fileRecords.map(a=>{const W=a.arweaveKey?a.arweaveLink:`ar://${a.arweaveId}`;return a.fileType==="application/epub+zip"||a.fileType==="application/pdf"?W:`ar://${a.arweaveId}`}).filter(Boolean))].map(a=>({url:a})),_},P=async()=>{if(u.value="checking",!O.value){M(y.value.join(", "));return}c.value.contentFingerprints.length&&await z()},z=async()=>{if(u.value="loading",await F(),!m.value||!f.value){A.value="MISSING_SIGNER",u.value="";return}try{u.value="signing";const e=Ue(n.value),_={name:e.name,description:e.description,...e,symbol:"BOOK",image:(e==null?void 0:e.thumbnailUrl)||"",external_link:(e==null?void 0:e.url)||"",nft_meta_collection_id:"nft_book",nft_meta_collection_name:"NFT Book",nft_meta_collection_description:"NFT Book by Liker Land",recordTimestamp:new Date().toISOString()};await o({wallet:m.value});const h=d(m.value),I=await k({address:L,abi:Ee,functionName:"newBookNFT",args:[h,{creator:m.value,updaters:[m.value,$],minters:[m.value,$],config:{name:_.name,symbol:"BOOK",metadata:JSON.stringify(_),max_supply:Oe}},500]}),p=await T({hash:I});if(console.log(p),!p||p.status!=="success")throw new Error("INVALID_RECEIPT");if(!p.logs[0].address)throw new Error("INVALID_CLASS_ID");const S=p.logs[0].address;u.value="success",U("submit",{iscnId:S,txHash:I})}catch(e){console.error(e),M(`'SIGNING_ERROR':${e}`),u.value=""}finally{u.value=""}};return l({onSubmit:P}),(e,_)=>{const h=Me,I=fe,p=ve,S=ge;return b(),B("div",null,[g(h,{modelValue:r(c),"onUpdate:modelValue":_[0]||(_[0]=t=>me(c)?c.value=t:null)},null,8,["modelValue"]),g(S,{"model-value":!!r(u),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:Y(()=>[v("div",qe,[v("div",ze,[g(I,{variant:"soft"},{default:Y(()=>[be(H(r(u)),1)]),_:1}),v("p",We,H(e.$t("notifications.iscn_registration_complete")),1)]),g(p,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),Ge=we(je,[["__scopeId","data-v-cb01cd69"]]),Ye={class:"flex flex-col items-stretch grow space-y-4"},He=Q({__name:"MintNFT",props:{iscnId:{type:String,default:""}},emits:["submit","loadingChange"],setup(w,{expose:l,emit:x}){const{getClassOwner:C,getClassMetadata:E,checkNFTClassIsBookNFT:$}=$e(),m=i(1),f=i(""),F=i(!1),o=i(""),T=i(null),R=i(""),D=i(null),M=x;G(F,n=>{M("loadingChange",n),n&&(f.value="")},{immediate:!0});const{t:L}=ne();ie({title:()=>L("seo.mint_nft_book_title"),ogTitle:()=>L("seo.mint_nft_book_title")});const c=w;G(()=>c.iscnId,async n=>{n&&await u(c.iscnId)},{immediate:!0});async function u(n){if(n)try{if(F.value=!0,!await $(n))throw new Error("Invalid NFT Class ID");const[k,y]=await Promise.all([E(n),C(n)]);if(!k)throw new Error("Invalid NFT Class ID");T.value={contentMetadata:k,owner:y,"@id":n},o.value=y,R.value=n,m.value=3}catch(d){console.error(d),f.value=d.toString()}finally{F.value=!1}}function A(){var n;(n=D.value)==null||n.startNFTMintFlow()}function U({classId:n,nftMintCount:d}={}){R.value=n||"",M("submit",{classId:n||"",nftMintCount:d})}return l({startNFTMintFlow:A}),(n,d)=>{const k=ye,y=Ve;return b(),B("div",Ye,[r(f)?(b(),J(k,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${r(f)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:d[0]||(d[0]=O=>f.value="")},null,8,["title"])):X("",!0),g(y,{ref_key:"liteMintNFTRef",ref:D,"iscn-data":r(T),"should-show-submit":!1,onSubmit:U},null,8,["iscn-data"])])}}}),Je={class:"w-full"},Xe={class:"justify-evenly items-center flex space-x-4 relative"},Qe={class:"text-sm font-semibold"},Ze={class:"mt-6 p-4 border rounded-lg bg-gray-100 text-center flex flex-col gap-[24px]"},et={key:0},tt={key:1},at={key:2},st={key:3},ot={class:"flex gap-2 justify-center mt-4"},Nt=Q({__name:"new-book",setup(w){var p,S;const{t:l}=ne(),x=ae(),{wallet:C,signer:E}=se(x),{validateWalletConsistency:$}=x,m=he(),f=Ie(),{showErrorToast:F}=le(),o=i(0),T=i(),R=i(),D=i(),M=i(""),L=i(""),c=i(((p=m.query.iscn_id)==null?void 0:p.toString())||""),u=i(((S=m.query.class_id)==null?void 0:S.toString())||""),A=i([]),U=i(""),n=i(!1),d=i(!1);ie({title:()=>l("seo_titles.publish_nft_book"),ogTitle:()=>l("seo_titles.publish_nft_book")});const k=V(()=>{switch(o.value){case 0:return l("publish_button.upload_files");case 1:return l("publish_button.metadata");case 2:return l("publish_button.mint_nft");default:return l("publish_button.publish_now")}}),y=V(()=>{var t;return((t=A.value)==null?void 0:t.length)>0}),O=V(()=>o.value===0?y.value:o.value<3),q=V(()=>o.value===0?U.value!=="":o.value===2?d.value:!1),P=[{title:l("publish_steps.upload_files"),description:"Upload your book file"},{title:l("publish_steps.register_iscn"),description:"Register ISCN"},{title:l("publish_steps.mint_nft"),description:"Mint NFT"},{title:l("publish_steps.new_book_publish"),description:"Publish new book"}];oe(()=>{var s;let t=null;try{const a=sessionStorage.getItem(Se);a&&(t=JSON.parse(a))}catch(a){console.error(a)}c.value?(M.value=c.value,_({iscnId:c.value})):u.value?h({classId:u.value}):t!=null&&t.epubMetadata&&(t!=null&&t.fileRecords)&&(L.value=(s=t==null?void 0:t.epubMetadata)==null?void 0:s.title)});const z=async()=>{if((!C.value||!E.value)&&await $(),!C.value||!E.value){F(l("auth.login_required"));return}try{if(o.value===0&&T.value){await T.value.onSubmit();return}if(o.value===1){if(!n.value){F("Please fill in all required fields");return}await R.value.onSubmit();return}if(o.value===2){await D.value.startNFTMintFlow();return}o.value<P.length-1&&o.value++}catch(t){console.error("Error during form submission:",t)}},e=t=>{Ce(t),o.value=1},_=async t=>{const{iscnId:s}=t;s&&await j(f({query:{iscn_id:s}}),{replace:!0}),Ne(),o.value=2,await ee(),c.value=s},h=async t=>{const{classId:s,nftMintCount:a}=t;s&&(u.value=s,await j(f({query:{class_id:s,count:a}}),{replace:!0}),o.value=3,await ee())},I=async()=>{await j(f({name:"my-books"}))};return(t,s)=>{const a=ke,W=Be,re=Ge,ce=He,ue=Pe,de=xe,pe=Ke;return b(),J(pe,{class:"flex flex-col items-stretch grow space-y-4"},{default:Y(()=>[v("div",Je,[v("div",Xe,[s[4]||(s[4]=v("div",{class:"absolute w-full h-[1px] bg-gray-300 top-[50%] left-0 z-[-1]"},null,-1)),(b(),B(Fe,null,Te(P,(N,K)=>v("div",{key:K,class:"flex items-center space-x-2 bg-white p-2 rounded-lg"},[g(a,{size:K===r(o)?"lg":"md",text:(K+1).toString(),ui:{background:K===r(o)?"bg-primary-100":"bg-gray-200"}},null,8,["size","text","ui"]),v("p",Qe,H(N.title),1)])),64))]),v("div",Ze,[r(o)===0?(b(),B("div",et,[g(W,{ref_key:"uploadFormRef",ref:T,onFileUploadStatus:s[0]||(s[0]=N=>U.value=N),onFileReady:s[1]||(s[1]=N=>A.value=N),onSubmit:e},null,512)])):r(o)===1?(b(),B("div",tt,[g(re,{ref_key:"registerISCN",ref:R,onFormValidChange:s[2]||(s[2]=N=>n.value=N),onSubmit:_},null,512)])):r(o)===2?(b(),B("div",at,[g(ce,{ref_key:"mintNFT",ref:D,"iscn-id":r(c),onLoadingChange:s[3]||(s[3]=N=>d.value=N),onSubmit:h},null,8,["iscn-id"])])):r(o)===3?(b(),B("div",st,[g(ue,{ref:"newNFTBook",class:"p-0 flex flex-col text-left gap-[24px]","is-new-class-page":!0,"class-id":r(u),onSubmit:I},null,8,["class-id"])])):X("",!0),v("div",ot,[r(O)?(b(),J(de,{key:0,disabled:r(q),label:r(k),onClick:z},null,8,["disabled","label"])):X("",!0)])])])]),_:1})}}});export{Nt as default};
