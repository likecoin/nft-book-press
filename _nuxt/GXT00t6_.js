import{_ as ke}from"./D5QEOJkE.js";import{a_ as we,a$ as Ue,bk as Ve,bt as Se,b7 as $e,b9 as u,bb as te,ba as S,bh as Ne,b1 as Me,b3 as R,aX as s,b4 as n,bC as Re,aT as v,aW as t,bD as Oe,bd as b,br as Be,aU as d,b_ as Pe,aS as W,bi as O,aV as ne,bx as Le,bo as le,bv as Te,bw as je,bg as Ae,bp as De}from"./CFpP0Qfr.js";import{_ as Ee}from"./CxljOOW8.js";import{_ as ze}from"./DdpYE5kc.js";import{_ as Fe}from"./oAF15bOe.js";import{_ as qe}from"./Du-Ev3ZH.js";import{_ as Je}from"./ClVZgrpj.js";import{_ as Qe}from"./ChNgszvx.js";import{_ as We}from"./Dba_QIEU.js";import{a as Ge}from"./l4Q9i8j1.js";import"./BPfddmP2.js";import"./C3jLROnn.js";import"./CKvoyTkq.js";import"./D6TRAm2U.js";import"./Dgbln9FO.js";import"./CrJ7IZ_X.js";import"./CsGK_NXO.js";(function(){try{var h=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},r=new h.Error().stack;r&&(h._sentryDebugIds=h._sentryDebugIds||{},h._sentryDebugIds[r]="e8cdf908-0fc6-490c-b80c-dbb867972b85",h._sentryDebugIdIdentifier="sentry-dbid-e8cdf908-0fc6-490c-b80c-dbb867972b85")}catch{}})();const He={class:"flex items-center gap-2"},Ke=["textContent"],Xe={class:"flex items-start gap-4"},Ye=["src"],Ze={class:"flex flex-col justify-start"},eo=["textContent"],oo={class:"text-center"},to={class:"flex items-center gap-2 px-4 sm:px-6"},no={class:"flex items-center gap-2"},lo={class:"flex justify-center items-center gap-4"},ao={class:"flex items-center gap-2"},so={class:"flex justify-center gap-4"},wo=we({__name:"index",setup(h){const{t:r}=Ue(),G=Ve(),E=Se(),{BOOK3_URL:ae}=$e().public,B=Ge(),{lazyFetchClassMetadataById:H,lazyFetchClassListingInfoById:K}=B,m=u([{id:0,value:""}]),X=u(1),g=u(!1),I=u(""),y=u(""),C=u([]),f=u(""),p=u([]),x=u(!1),$=u(!1),k=u(!1);te(x,o=>{o||(m.value=[{id:0,value:""}],X.value=1)});const se=S(()=>{const o=[{key:"name",label:r("common.name"),class:""}];return k.value&&o.push({key:"delete-action",label:"",class:"w-12"}),o}),ie=S(()=>{const o=[];return z.value.length&&o.push([{label:k.value?"Exit Edit Items":"Edit Items",icon:k.value?"i-heroicons-pencil-solid":"i-heroicons-pencil",click:_e}]),o.push([{label:"New Coupon",icon:"i-heroicons-tag",click:()=>{g.value=!g.value}},{class:"text-red-500",label:"Clear All Coupons",icon:"i-heroicons-trash",iconClass:"text-red-500",disabled:!C.value.length,click:ve}]),o}),z=S(()=>{var o;return(o=p.value)==null?void 0:o.map((e,i)=>{var a,L,N,T,j,A;return{classId:e.classId,name:(a=B.getClassMetadataById(e.classId))==null?void 0:a.name,prices:(N=(L=B.getClassListingInfoById(e.classId))==null?void 0:L.prices)==null?void 0:N.map(V=>({...V})),image:Re((A=(j=(T=B.getClassMetadataById(e.classId))==null?void 0:T.data)==null?void 0:j.metadata)==null?void 0:A.image),index:i}})}),w=u([]),P=S(()=>w.value.map(e=>p.value[e.index]).sort((e,i)=>(e==null?void 0:e.priceIndex)!==void 0&&!(i!=null&&i.priceIndex)?-1:!(e!=null&&e.priceIndex)&&(i==null?void 0:i.priceIndex)!==void 0?1:0));te(z,o=>{o.length||(k.value=!1)});const U=S(()=>{const o=new URLSearchParams({utm_source:"direct-checkout",utm_medium:"pos"}),e=P.value.map(({classId:i,priceIndex:a})=>`${i}${a?`:${a}`:""}`).join(",");return o.append("products",e),f.value&&o.append("coupon",f.value),`${ae}/checkout?${o.toString()}`}),F=S(()=>"3ook Point Of Sale");Ne({title:()=>F.value,ogTitle:()=>F.value}),Me(()=>{try{const o=window.localStorage.getItem("nft_book_store_pos_items");if(o){const i=JSON.parse(o);p.value=i.map(a=>({classId:a.classId,priceIndex:a.priceIndex}))}const e=window.localStorage.getItem("nft_book_store_pos_coupons");if(e){const i=JSON.parse(e);C.value=i.map(a=>({name:a.name,code:a.code}))}}catch(o){console.error(o)}p.value.forEach(o=>{o.classId&&(H(o.classId),K(o.classId))})});function de(){m.value.length&&m.value.push({id:X.value++,value:""})}function re(o){m.value.splice(o,1)}function ue(o,e){m.value[o].error=void 0,m.value[o].value=e}function ce(){m.value.forEach(o=>{o.error=void 0;let e=o.value.trim();e.startsWith("http")&&(e=new URL(e).pathname.split("/").pop()||""),e.startsWith("0x")?(p.value.push({classId:e,priceIndex:0}),H(e),K(e)):o.error=new Error("Invalid product ID")}),m.value.every(o=>!o.error)&&(x.value=!1,q())}function me(o,{index:e}){p.value[e].priceIndex=Number(o),q()}function pe({index:o}){p.value.splice(o,1),w.value=w.value.filter(e=>e.index!==o),q()}function Y(){x.value=!x.value}function _e(){k.value=!k.value}function fe(){C.value.push({name:I.value,code:y.value}),I.value="",y.value="",Z(),E.add({title:"Added coupon",timeout:2e3,color:"green"}),g.value=!1}function ve(){window.confirm("Are you sure you want to clear all coupons?")&&(C.value=[],f.value="",Z(),E.add({title:"Cleared all coupons",timeout:2e3,color:"red"}))}function q(){window.localStorage.setItem("nft_book_store_pos_items",JSON.stringify(p.value))}function Z(){window.localStorage.setItem("nft_book_store_pos_coupons",JSON.stringify(C.value))}function be(){E.add({title:"Copied URL to clipboard",timeout:2e3}),navigator.clipboard.writeText(U.value)}function ge(){window.open(U.value)}function xe(){$.value=!0}return(o,e)=>{const i=ke,a=Be,L=Ee,N=ze,T=Pe,j=Fe,A=Le,V=je,D=Te,he=qe,J=Ae,Ie=Je,Q=Oe,ye=Qe,Ce=We;return v(),R(Ce,{key:n(G).path},{default:s(()=>[t(i,{title:n(F)},null,8,["title"]),t(ye,{ui:{base:"flex flex-col items-stretch grow space-y-4",padding:"max-md:!px-0 max-md:py-0"}},{default:s(()=>[t(Q,{ui:{base:"flex flex-col grow",rounded:"max-md:rounded-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"grow",padding:""},footer:{base:"sticky bottom-0 bg-white dark:bg-gray-900 rounded-b-[inherit]",padding:"px-0 sm:px-0 space-y-4"}}},{header:s(()=>[d("div",He,[d("h2",{class:"text-xl font-bold",textContent:ne(n(r)("sales_pos.sales_items")+(n(P).length>0?n(r)("sales_pos.selected_count",{count:n(P).length}):""))},null,8,Ke),t(a,{icon:"i-heroicons-plus-circle",variant:"soft",onClick:Y})]),t(L,{items:n(ie),popper:{placement:"bottom-end"}},{default:s(()=>[t(a,{color:"white",icon:"i-heroicons-ellipsis-horizontal-circle"})]),_:1},8,["items"])]),footer:s(()=>[d("div",to,[t(N,{modelValue:n(f),"onUpdate:modelValue":e[1]||(e[1]=l=>b(f)?f.value=l:null),class:"grow",options:n(C).map(l=>({label:l.name,value:l.code})),placeholder:n(r)("sales_pos.select_coupon")},null,8,["modelValue","options","placeholder"]),n(f)?(v(),R(a,{key:0,icon:"i-heroicons-x-mark-16-solid",size:"sm",color:"gray",variant:"outline",onClick:e[2]||(e[2]=()=>{f.value=""})})):O("",!0)]),t(A),t(Ie,{class:"w-full",items:[{key:"direct",label:n(r)("sales_pos.direct_checkout")}],ui:{wrapper:"px-4 sm:px-6",base:"flex flex-col space-y-4"}},{item:s(({item:l})=>[l.key==="direct"?(v(),W(le,{key:0},[t(D,{label:n(r)("sales_pos.checkout_url")},{default:s(()=>[d("div",no,[t(V,{modelValue:n(U),"onUpdate:modelValue":e[3]||(e[3]=c=>b(U)?U.value=c:null),class:"grow font-mono",readonly:""},null,8,["modelValue"]),t(a,{icon:"i-heroicons-clipboard-document",variant:"soft",color:"gray",onClick:be})])]),_:1},8,["label"]),d("div",lo,[t(a,{label:n(r)("sales_pos.view_cart"),size:"lg",onClick:ge},null,8,["label"]),t(a,{label:n(r)("sales_pos.generate_qr_code"),disabled:!n(P).length,size:"lg",onClick:xe},null,8,["label","disabled"]),t(J,{modelValue:n($),"onUpdate:modelValue":e[5]||(e[5]=c=>b($)?$.value=c:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:s(()=>[t(he,{data:n(U),mode:"readonly","file-name":"likerland_checkout",width:280,height:280},{header:s(()=>[e[11]||(e[11]=d("h3",{class:"font-bold font-mono",textContent:"Scan to buy"},null,-1)),t(a,{icon:"i-heroicons-x-mark",color:"gray",variant:"ghost",onClick:e[4]||(e[4]=c=>$.value=!1)})]),_:1},8,["data"])]),_:1},8,["modelValue"])])],64)):O("",!0)]),_:1},8,["items"])]),default:s(()=>[t(j,{modelValue:n(w),"onUpdate:modelValue":e[0]||(e[0]=l=>b(w)?w.value=l:null),columns:n(se),rows:n(z),ui:{wrapper:"static h-full",thead:"sticky top-0"}},{"name-data":s(({row:l})=>{var c,M;return[d("div",Xe,[l.image?(v(),W("img",{key:0,class:"w-[64px] object-contain rounded-sm",src:l.image,alt:"Item image"},null,8,Ye)):O("",!0),d("div",Ze,[d("div",{class:"whitespace-break-spaces",textContent:ne(l.name)},null,8,eo),l.classId&&((c=l.prices)==null?void 0:c.length)>1?(v(),R(N,{key:0,class:"mt-2","model-value":n(p)[l.index].priceIndex||0,options:(M=l.prices)==null?void 0:M.map(_=>{var ee,oe;return{label:((ee=_.name)==null?void 0:ee.zh)||((oe=_.name)==null?void 0:oe.en)||_.name,value:_.index}}),"onUpdate:modelValue":_=>me(_,l)},null,8,["model-value","options","onUpdate:modelValue"])):O("",!0)])])]}),"delete-action-header":s(()=>[d("div",oo,[t(T,{name:"i-heroicons-trash-solid"})])]),"delete-action-data":s(({row:l})=>[t(a,{icon:"i-heroicons-x-mark",color:"red",variant:"link",onClick:c=>pe(l)},null,8,["onClick"])]),_:1},8,["modelValue","columns","rows"])]),_:1}),t(J,{modelValue:n(x),"onUpdate:modelValue":e[6]||(e[6]=l=>b(x)?x.value=l:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:s(()=>[t(Q,{ui:{rounded:"max-sm:rounded-b-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"space-y-4"},footer:{base:"flex justify-center items-center"}}},{header:s(()=>[e[12]||(e[12]=d("h3",{class:"font-bold font-mono",textContent:"Add Item(s)"},null,-1)),t(a,{icon:"i-heroicons-x-mark",color:"gray",variant:"link",onClick:Y})]),footer:s(()=>[t(a,{label:"Confirm",onClick:ce})]),default:s(()=>[(v(!0),W(le,null,De(n(m),(l,c)=>{var M;return v(),R(D,{key:`input-${l.id}`,label:n(r)("sales_pos.enter_product_id_urls"),required:!0,error:(M=l.error)==null?void 0:M.message},{default:s(()=>[d("div",ao,[t(V,{class:"grow font-mono","model-value":l.value,placeholder:"https://3ook.com/store/0x....","onUpdate:modelValue":_=>ue(c,_)},null,8,["model-value","onUpdate:modelValue"]),n(m).length>1?(v(),R(a,{key:0,icon:"i-heroicons-x-circle",variant:"link",onClick:_=>re(c)},null,8,["onClick"])):O("",!0)])]),_:2},1032,["label","error"])}),128)),d("div",so,[t(a,{icon:"i-heroicons-plus-circle",label:n(r)("sales_pos.add"),variant:"outline",onClick:de},null,8,["label"])])]),_:1})]),_:1},8,["modelValue"]),t(J,{modelValue:n(g),"onUpdate:modelValue":e[10]||(e[10]=l=>b(g)?g.value=l:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:s(()=>[t(Q,{ui:{rounded:"max-sm:rounded-b-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"space-y-4"},footer:{base:"flex justify-end items-center gap-4"}}},{header:s(()=>[e[13]||(e[13]=d("h3",{class:"font-bold",textContent:"Add Coupon"},null,-1)),t(a,{icon:"i-heroicons-x-mark-16-solid",color:"gray",size:"xl",padded:!1,variant:"link",onClick:e[7]||(e[7]=l=>g.value=!1)})]),footer:s(()=>[t(a,{icon:"i-heroicons-plus-circle",label:"Add Coupon",disabled:!n(I)||!n(y),onClick:fe},null,8,["disabled"])]),default:s(()=>[t(D,{label:"Coupon Name",help:"For POS Display Only",required:!0},{default:s(()=>[t(V,{modelValue:n(I),"onUpdate:modelValue":e[8]||(e[8]=l=>b(I)?I.value=l:null),placeholder:"Fall Promotion"},null,8,["modelValue"])]),_:1}),t(D,{label:"Coupon Code",required:!0},{default:s(()=>[t(V,{modelValue:n(y),"onUpdate:modelValue":e[9]||(e[9]=l=>b(y)?y.value=l:null),class:"font-mono",placeholder:"FALLPROMO"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}});export{wo as default};
