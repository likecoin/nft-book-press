import{_ as re}from"./DgLfHven.js";import{a_ as ie,a$ as ce,b7 as ue,by as _e,bz as me,b6 as de,b0 as be,bk as fe,b8 as S,ba as l,b9 as c,bh as pe,b1 as ke,bb as ye,b3 as b,aX as n,bA as ve,bB as ge,bC as he,aT as u,aW as _,bi as D,b4 as o,bj as we,bD as xe,aY as C,aV as v,bd as P,aU as E,bw as Se,br as Ce,aS as Ie,bE as I,b2 as Ue,bF as $e,bn as Be}from"./BVgQfaNN.js";import{_ as Re}from"./CKjq_wLR.js";import{_ as Le}from"./DkEM-FlO.js";import{_ as Te}from"./D2YwAVrx.js";import{_ as Ve}from"./B7Q4iAhT.js";import{u as Ne}from"./C9kugC67.js";import"./B235-UCu.js";import"./BCqzyNmh.js";import"./Ob-Xc3PG.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new i.Error().stack;t&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[t]="84f13faa-c026-44b9-a614-deec6f04266b",i._sentryDebugIdIdentifier="sentry-dbid-84f13faa-c026-44b9-a614-deec6f04266b")}catch{}})();const Ae={class:"flex px-3 py-3.5 border-b border-gray-200"},De=["src","alt"],Pe=["textContent"],Xe=ie({__name:"latest-books",setup(i){const{t}=ce(),{BOOK3_URL:g,LIKE_CO_API:j}=ue().public,q=_e(),K=Ne(),M=me(),O=de(),W=be(),z=fe(),{wallet:U}=S(O),{userLikerInfo:$}=S(q),{isAuthenticated:h}=S(M),B=l(()=>[{label:t("latest_books.latest_releases"),key:"latest"},{label:t("latest_books.best_sellers"),key:"bestselling"}]),m=c(""),f=c(!1),R=c([]),L=c([]),p=c(0),d=c(z.query.q||""),w=l(()=>$.value?.user?ve($.value?.user):""),x=l(()=>f.value&&w.value),F=l(()=>[{key:"image",label:t("table.cover"),sortable:!1},{key:"className",label:t("latest_books.book_name"),sortable:!0},{key:"author",label:t("common.author"),sortable:!0},{key:"priceInUSD",label:t("common.price"),sortable:!0},{key:"url",label:x.value?t("latest_books.affiliation_link"):t("common.link"),sortable:!1}]),T=l(()=>B.value[p.value].key),H=l(()=>T.value==="latest"?R.value:L.value),V=l(()=>H.value.map(e=>{const a=e.name||e.title,r=e.thumbnailUrl||e.imageUrl,k=e.author?.name||e.author;return{className:a,image:r?ge(he(r)):void 0,author:k,priceInUSD:`US$${e.minPrice||e.prices?.[0]?.price||0}`,url:`${g}/store/${e.classId}?from=${w.value}&utm_source=bookpress&utm_medium=list_${T.value}`}})),X=l(()=>{if(!d.value)return V.value;const e=d.value.toLowerCase();return V.value.filter(a=>[a.className,a.author].some(r=>r&&r.toLowerCase().includes(e)))});pe({title:()=>t("seo.latest_books_title"),ogTitle:()=>t("seo.latest_books_title")}),ke(async()=>{if(await Promise.all([Y().catch(e=>{m.value=e}),G().catch(e=>{m.value=e})]),h.value)try{await N()}catch(e){console.error(e)}});async function Y(){const e=await $fetch(`${j}/likernft/book/store/list?chain=base&limit=100`);R.value=e?.list||[]}async function G(){const e=await $fetch(`${g}/api/store/products?tag=bestselling`);L.value=e?.records||[]}async function N(){if(!U.value){f.value=!1;return}try{const e=await K.fetchStripeConnectStatusByWallet(U.value);f.value=e?.isReady}catch(e){console.error(e),f.value=!1}}function J(){I("latest_books_click_affiliation_setup"),Ue(W({name:"settings"}))}function Q(e){I("latest_books_click_table_row"),window.open(e.url,"_blank")}function Z(e,a){e.stopPropagation(),I("latest_books_click_copy_button"),$e(a)}return ye(h,()=>{h.value&&Be(()=>{N()})}),(e,a)=>{const r=re,k=we,ee=Re,A=xe,te=Se,oe=Ce,ae=Le,se=Te,le=Ve;return u(),b(le,null,{default:n(()=>[_(r,{title:o(t)("latest_books.title")},null,8,["title"]),o(m)?(u(),b(k,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${o(m)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:a[0]||(a[0]=y=>m.value="")},null,8,["title"])):D("",!0),o(x)?(u(),b(A,{key:2},{default:n(()=>[C(v(o(t)("latest_books_extended.append_text")),1),_(ee,{class:"font-mono"},{default:n(()=>[C(" ?from="+v(o(w)),1)]),_:1}),C(v(o(t)("latest_books_extended.append_suffix")),1)]),_:1})):(u(),b(k,{key:1,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"soft",title:o(t)("latest_books.join_affiliation"),description:o(t)("latest_books.affiliation_description"),actions:[{label:o(t)("common.setup"),color:"orange",variant:"outline",click:J}]},null,8,["title","description","actions"])),_(se,{modelValue:o(p),"onUpdate:modelValue":a[2]||(a[2]=y=>P(p)?p.value=y:null),class:"w-full",items:o(B)},{item:n(({item:y})=>[(u(),b(A,{key:y.key,ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{default:n(()=>[E("div",Ae,[_(te,{modelValue:o(d),"onUpdate:modelValue":a[1]||(a[1]=s=>P(d)?d.value=s:null),placeholder:o(t)("latest_books.filter_placeholder")},null,8,["modelValue","placeholder"])]),_(ae,{columns:o(F),rows:o(X),onSelect:Q},{"image-data":n(({row:s})=>[s.image?(u(),Ie("img",{key:0,src:s.image,alt:s.className,class:"w-12 h-12 object-cover rounded-lg"},null,8,De)):D("",!0)]),"className-data":n(({row:s})=>[E("div",{class:"max-w-[20vw] whitespace-normal",textContent:v(s.className)},null,8,Pe)]),"url-data":n(({row:s})=>[_(oe,{label:o(t)("common.copy"),disabled:!o(x),onClick:ne=>Z(ne,s.url)},null,8,["label","disabled","onClick"])]),_:1},8,["columns","rows"])]),_:1}))]),_:1},8,["modelValue","items"])]),_:1})}}});export{Xe as default};
