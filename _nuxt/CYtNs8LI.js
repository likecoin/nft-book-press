import{a_ as Xe,b6 as Ye,bl as Ge,bk as Je,bx as Ke,bn as ue,bm as Ze,by as et,b7 as tt,b8 as c,b9 as b,ba as at,b1 as ot,b3 as E,aX as s,bD as lt,dj as de,bO as ce,dk as nt,cs as st,aT as h,aU as p,br as W,aS as T,aW as l,aV as $,b4 as o,bs as it,bP as rt,aY as K,bi as Z,bt as ut,cM as dt,bg as ct,bJ as pt,cP as mt,bf as S,bj as ft,bM as bt}from"./C1Iws6nc.js";import{_ as yt}from"./MtMEjHTa.js";import{_ as ht}from"./UdKhLVak.js";import{_ as gt}from"./Da-bcJIo.js";import{_ as vt}from"./BAWiKx-w.js";import{_ as kt}from"./r6m6QBwU.js";import{_ as _t}from"./CB-BER-0.js";import{_ as Ct}from"./DLL8wjC8.js";import{_ as St}from"./CckUxYIo.js";import{u as wt}from"./Cw4LaRUG.js";import{u as xt}from"./D_bIx0Dn.js";import"./DXAePL8a.js";import"./CDuNXhdq.js";import"./Chb40_89.js";import"./BsUu7wpa.js";import"./Cxa2cc_s.js";(function(){try{var w=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},B=new w.Error().stack;B&&(w._sentryDebugIds=w._sentryDebugIds||{},w._sentryDebugIds[B]="e8c8554d-45e5-4fbf-b11e-f1b7a52b0545",w._sentryDebugIdIdentifier="sentry-dbid-e8c8554d-45e5-4fbf-b11e-f1b7a52b0545")}catch{}})();const Dt={class:"text-lg font-bold font-mono"},Et={class:"flex flex-col gap-[8px] items-start"},Tt={class:"text-center"},$t={class:"flex gap-2"},Ut={class:"flex justify-end items-center"},Nt={key:0,class:"font-bold font-mono"},Lt={class:"flex justify-between items-center w-full"},Pt={key:0,class:"mt-[24px] flex flex-col gap-[12px]"},Rt={class:"flex gap-2"},At={class:"flex justify-end items-center"},Kt=Xe({__name:"[collectionId]",setup(w){const{CHAIN_EXPLORER_URL:B,LIKE_CO_API:I}=Ye().public,pe=Ge(),ee=Je(),me=wt(),V=Ke(),fe=xt(),{token:H}=ue(ee),{wallet:x}=ue(pe),{updateNFTBookCollectionById:Q,reduceListingPendingNFTCountById:be}=V,{getClassMetadataById:ye,lazyFetchClassMetadataById:he}=me,{fetchStripeConnectStatusByWallet:te}=fe,ge=Ze(),ve=et(),ae=tt(),k=c(""),_=c(!1),y=c(ge.params.collectionId),U=c(void 0),u=c({}),N=c({}),X=c(!1),L=c(""),D=c([]),P=c([]),g=c(""),v=c(""),R=c(!1),F=c(""),O=c({}),A=c(!0),j=c(!1),Y=c(!1),z=c(!0),oe=b(()=>{var t;return(t=V.getCollectionById(y.value))==null?void 0:t.name}),le=b(()=>{var t;return(t=u==null?void 0:u.value)==null?void 0:t.ownerWallet}),ne=b(()=>q.value.find(t=>!!t.shippingStatus)),G=b(()=>x.value&&le.value===x.value),ke=b(()=>G.value),M=b(()=>lt({collectionId:y.value,channel:U.value,isUseLikerLandLink:A.value})),_e=b(()=>q.value.length?q.value.reduce((e,n)=>{const i=n.from||"empty";return e[i]||(e[i]={count:0,totalUSD:0}),e[i].count+=1,e[i].totalUSD+=n.price,e},{}):{}),q=b(()=>{var t;return(t=N.value)!=null&&t.orders?N.value.orders.map(e=>{const n=e.timestamp,i=new Date(n),d=`${i.getDate()}/${i.getMonth()+1}/${i.getFullYear()}`;return{...e,formattedDate:d}}).sort((e,n)=>n.timestamp-e.timestamp):[]}),Ce=b(()=>{const t=[{key:"actions",label:"Actions",sortable:!1},{key:"orderDate",label:"Order Date",sortable:!0},{key:"status",label:"Status",sortable:!0}];return ne.value&&t.push({key:"shippingStatus",label:"Shipping Status",sortable:!0}),t.push({key:"from",label:"Sales Channel",sortable:!0},{key:"price",label:"Price",sortable:!0},{key:"quantity",label:"Quantity",sortable:!0},{key:"coupon",label:"Coupon Applied",sortable:!1},{key:"buyerEmail",label:"Buyer Email",sortable:!0},{key:"readerEmail",label:"Reader Email",sortable:!0},{key:"wallet",label:"Reader Wallet",sortable:!0},{key:"message",label:"Reader Message",sortable:!1}),ne.value&&(t.push({key:"buyerPhone",label:"Buyer Phone",sortable:!0}),t.push({key:"shippingName",label:"Shipping Name",sortable:!0}),t.push({key:"shippingAddress",label:"Shipping Address",sortable:!0}),t.push({key:"shippingCountry",label:"Shipping Country",sortable:!0})),t});function Se(t){const e=[];return t.status==="completed"&&t.txHash?e.push([{label:"View Transaction",icon:"i-heroicons-magnifying-glass",to:`${B}/${t.txHash}`,target:"_blank"}]):t.status==="pendingNFT"&&ke.value&&e.push([{label:"Send NFT",icon:"i-heroicons-paper-airplane",to:{name:"nft-book-store-collection-send-collectionId",params:{collectionId:t.collectionId},query:{owner_wallet:le.value,payment_id:t.id}}}]),t.status==="paid"&&e.push([{label:"Send Reminder Email",icon:"i-heroicons-envelope",click:()=>{Pe(t)}}]),["pendingNFT","paid"].includes(t.status)&&e.push([{label:"Mark Complete",icon:"i-heroicons-check-circle",click:()=>{Re(t)}}]),e}function we(t){switch(t.status){case"paid":return"Paid";case"pendingNFT":return"Pending NFT";case"completed":return t.shippingStatus==="pending"?"Pending Shipping":"Completed";default:return t.status}}function xe(t){switch(t.status){case"paid":return"blue";case"pendingNFT":return"amber";case"completed":return t.shippingStatus==="pending"?"amber":"green";default:return"gray"}}const De=b(()=>{var t;return(t=q.value)==null?void 0:t.map((e,n)=>{var i,d,m,r;return{index:n,buyerEmail:e.email,buyerPhone:e.phone||"",readerEmail:((i=e.giftInfo)==null?void 0:i.toEmail)||e.email,status:e.status,statusLabel:we(e),statusLabelColor:xe(e),orderDate:e.formattedDate,shippingStatus:e.shippingStatus,shippingCountry:((m=(d=e.shippingDetails)==null?void 0:d.address)==null?void 0:m.country)||"",shippingAddress:nt(e.shippingDetails)||"",shippingName:((r=e.shippingDetails)==null?void 0:r.name)||"",wallet:e.wallet||"",walletLink:ce(e.wallet),shortenWallet:de(e.wallet),priceName:e.priceName,price:e.price||0,quantity:e.quantity||1,coupon:e.coupon||"",message:e.message||"",from:e.from||"",actions:Se(e)}}).filter(e=>{var i,d,m,r,C;if(!L.value)return!0;const n=L.value.toLowerCase();return e.buyerEmail.toLowerCase().includes(n)||e.buyerPhone.toLowerCase().includes(n)||e.readerEmail.toLowerCase().includes(n)||((i=e.wallet)==null?void 0:i.toLowerCase().includes(n))||((d=e.priceName)==null?void 0:d.toLowerCase().includes(n))||((m=e.statusLabel)==null?void 0:m.toLowerCase().includes(n))||((r=e.orderDate)==null?void 0:r.toLowerCase().includes(n))||((C=e.from)==null?void 0:C.toLowerCase().includes(n))})}),Ee=b(()=>{const t=[{key:"wallet",label:"Wallet",sortable:!0}];return G.value&&t.push({key:"remove",label:"",sortable:!1}),t}),Te=b(()=>D.value?D.value.map((t,e)=>({index:e,wallet:t,shortenWallet:de(t),walletLink:ce(t)})):[]),$e=b(()=>{var t;return(t=P.value)==null?void 0:t.map((e,n)=>({index:n,email:e}))}),Ue=b(()=>{var e,n,i;const t=(e=u.value)==null?void 0:e.classIds;return t!=null&&t.length?[{index:1,books:(n=u.value)==null?void 0:n.classIds,price:((i=u.value)==null?void 0:i.priceInDecimal)/100,action:y.value}]:[]});function Ne(t){switch(t){case"empty":return"Not set";default:return t}}const Le=b(()=>{var t;return(t=Object.entries(_e.value))==null?void 0:t.map(([e,n])=>({id:e,idLabel:Ne(e),count:n.count||0,totalUSD:n.totalUSD||0}))});at(_,t=>{t&&(k.value="")}),ot(async()=>{_.value=!0;try{u.value=await V.fetchCollectionById(y.value);const t=u.value.typePayload;t&&(u.value={...u.value,...t});const{moderatorWallets:e,notificationEmails:n,connectedWallets:i}=u.value;D.value=e,P.value=n,R.value=!!(i&&Object.keys(i).length),O.value=i;const d=i&&Object.keys(i)[0];if(d&&(F.value=d,d!==x.value)){z.value=!1;try{await te(d)}catch(r){console.error(r)}}const m=await $fetch(`${I}/likernft/book/collection/purchase/${y.value}/orders`,{headers:{authorization:`Bearer ${H.value}`}});if(N.value=m,x.value)try{await te(x.value)}catch(r){console.error(r)}u.value.classIds.forEach(r=>he(r))}catch(t){console.error(t),k.value=t.toString()}finally{_.value=!1}});async function Pe(t){var n,i;if(!((i=(n=N.value)==null?void 0:n.orders)==null?void 0:i.find(d=>d.id===t.id)))throw new Error("ORDER_NOT_FOUND");await $fetch(`${I}/likernft/book/collection/purchase/${y.value}/status/${t.id}/remind`,{method:"POST",headers:{authorization:`Bearer ${H.value}`}}),ae.add({icon:"i-heroicons-check-circle",title:"Reminder email sent",timeout:2e3,color:"green"})}async function Re(t){var d,m;if(!confirm("Do you want to skip the 'Send NFT' action and override this payment status to 'completed'?"))return;const n=(m=(d=N.value)==null?void 0:d.orders)==null?void 0:m.find(r=>r.id===t.id);if(!n)throw new Error("ORDER_NOT_FOUND");const i=n.status;n.status="completed";try{await $fetch(`${I}/likernft/book/collection/purchase/${y.value}/sent/${t.id}`,{method:"POST",body:{txHash:null,quantity:t.quantity||1},headers:{authorization:`Bearer ${H.value}`}})}catch(r){throw n.status=i,r}i==="pendingNFT"&&(u.value.pendingNFTCount-=11,be(y.value,1))}function Ae(){g.value&&(D.value.push(g.value),g.value="")}function We(){v.value&&(P.value.push(v.value),v.value="")}async function Be(t){O.value={[t]:100},F.value=t;try{await Q(y.value,{connectedWallets:O.value})}catch(e){const n=e.data||e;k.value=n}finally{Y.value=!0}}async function Ie(){try{if(g.value)throw new Error('Please press "Add" button to add moderator wallet');if(v.value)throw new Error('Please press "Add" button to add notification email');_.value=!0;const t=R.value&&F.value?O.value:null;await Q(y.value,{moderatorWallets:D,notificationEmails:P,connectedWallets:t}),ve.push({name:"nft-book-store-collection"})}catch(t){const e=t.data||t;console.error(e),k.value=e}finally{_.value=!1,Y.value=!1}}async function Ve(t){X.value=!0;try{await Q(y.value,{shippingRates:t}),u.value=await V.fetchCollectionById(y.value);const e=u.value.typePayload;e&&(u.value={...u.value,...e})}catch(e){const n=e.data||e;k.value=n}finally{X.value=!1}}async function Fe(){await navigator.clipboard.writeText(M.value),ae.add({icon:"i-heroicons-check-circle",title:"Copied purchase link to clipboard",timeout:2e3,color:"green"})}return(t,e)=>{const n=it,i=rt,d=dt,m=yt,r=ut,C=ht,f=ct,se=mt,Oe=gt,ie=vt,je=kt,ze=_t,Me=Ct,qe=st("QRCode"),He=bt,Qe=St;return h(),E(Qe,{class:"space-y-10 pb-10"},{default:s(()=>[p("h1",Dt,' NFT Book Collection Status "'+$(o(oe))+'" ',1),o(k)?(h(),E(n,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${o(k)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:e[0]||(e[0]=a=>k.value="")},null,8,["title"])):W("",!0),o(_)?(h(),E(i,{key:1,animation:"carousel"},{indicator:s(()=>e[9]||(e[9]=[K(" Loading... ")])),_:1})):W("",!0),o(ee).isAuthenticated?(h(),T(Z,{key:2},[l(r,{ui:{body:{padding:""}}},{header:s(()=>e[10]||(e[10]=[p("h3",{class:"font-bold font-mono"}," Status ",-1)])),default:s(()=>[l(m,{columns:[{key:"pendingAction",label:"Pending Action"},{key:"sold",label:"Sold"},{key:"stock",label:"Stock"}],rows:[{pendingAction:o(u).pendingNFTCount||0,sold:o(u).sold||0,stock:o(u).stock||0}]},{"pendingAction-data":s(({row:a})=>[a.pendingAction?(h(),E(d,{key:0,label:`${a.pendingAction}`,color:"red",ui:{rounded:"rounded-full"}},null,8,["label"])):(h(),T(Z,{key:1},[K($(a.pendingAction),1)],64))]),_:1},8,["rows"])]),_:1}),l(r,{ui:{header:{base:"flex justify-between items-center gap-4"},body:{padding:""}}},{header:s(()=>[e[11]||(e[11]=p("h3",{class:"font-bold font-mono"}," Orders ",-1)),l(C,{modelValue:o(L),"onUpdate:modelValue":e[1]||(e[1]=a=>S(L)?L.value=a:null),icon:"i-heroicons-magnifying-glass-20-solid",placeholder:"Search..."},null,8,["modelValue"])]),default:s(()=>[l(m,{columns:o(Ce),rows:o(De)},{"buyerEmail-data":s(({row:a})=>[l(f,{label:a.buyerEmail,to:`mailto:${a.buyerEmail}`,variant:"link",padded:!1},null,8,["label","to"])]),"readerEmail-data":s(({row:a})=>[l(f,{label:a.readerEmail,to:`mailto:${a.readerEmail}`,variant:"link",padded:!1},null,8,["label","to"])]),"wallet-data":s(({row:a})=>[l(se,{text:a.wallet},{default:s(()=>[l(f,{class:"font-mono",label:a.shortenWallet,to:a.walletLink,variant:"link",padded:!1,size:"xs",target:"_blank"},null,8,["label","to"])]),_:2},1032,["text"])]),"status-data":s(({row:a})=>[l(d,{color:a.statusLabelColor,label:a.statusLabel,variant:"outline",ui:{rounded:"rounded-full"}},null,8,["color","label"])]),"actions-data":s(({row:a})=>[l(Oe,{items:a.actions},{default:s(()=>[l(f,{class:pt({hidden:!a.actions.length}),icon:"i-heroicons-ellipsis-horizontal-20-solid",color:"gray",variant:"ghost"},null,8,["class"])]),_:2},1032,["items"])]),_:1},8,["columns","rows"])]),_:1}),l(r,{ui:{body:{padding:""}}},{header:s(()=>e[12]||(e[12]=[p("h3",{class:"font-bold font-mono"}," Books in Collection ",-1)])),default:s(()=>[l(ie,null,{default:s(()=>[l(m,{columns:[{key:"index",label:""},{key:"books",label:"Books"},{key:"price",label:"Price (USD)"},{key:"action",label:"Edit"}],rows:o(Ue)},{"books-data":s(({row:a})=>[p("div",Et,[(h(!0),T(Z,null,ft(a==null?void 0:a.books,J=>{var re;return h(),T("span",{key:J,class:"text-left whitespace-pre-line"},$(`${(re=o(ye)(J))==null?void 0:re.name}
 class id: ${J} 
`),1)}),128))])]),"price-data":s(({row:a})=>[p("span",Tt,$(a.price),1)]),"action-data":s(({row:a})=>[l(f,{icon:"i-heroicons-document-magnifying-glass",to:{name:"nft-book-store-collection-status-collectionId-edit",params:{collectionId:a.collectionId}},variant:"soft",color:"gray"},null,8,["to"])]),_:1},8,["rows"])]),_:1})]),_:1}),o(G)?(h(),E(je,{key:0,"is-stripe-connect-checked":o(R),"onUpdate:isStripeConnectChecked":e[2]||(e[2]=a=>S(R)?R.value=a:null),"is-using-default-account":o(z),"onUpdate:isUsingDefaultAccount":e[3]||(e[3]=a=>S(z)?z.value=a:null),"stripe-connect-wallet":o(F),"should-disable-setting":o(Y),"login-address":o(x),onSave:Be},null,8,["is-stripe-connect-checked","is-using-default-account","stripe-connect-wallet","should-disable-setting","login-address"])):W("",!0),l(r,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""}}},{header:s(()=>[e[13]||(e[13]=p("h4",{class:"text-sm font-bold font-mono"}," Email to receive sales notifications / 欲收到銷售通知的電郵 ",-1)),p("div",$t,[l(C,{modelValue:o(v),"onUpdate:modelValue":e[4]||(e[4]=a=>S(v)?v.value=a:null),placeholder:"abc@example.com"},null,8,["modelValue"]),l(f,{label:"Add",variant:o(v)?"outline":"solid",color:o(v)?"primary":"gray",disabled:!o(v),onClick:We},null,8,["variant","color","disabled"])])]),default:s(()=>[l(m,{columns:[{key:"email",label:"Email",sortable:!0},{key:"action"}],rows:o($e)},{"email-data":s(({row:a})=>[l(f,{label:a.email,to:`mailto:${a.email}`,variant:"link",padded:!1},null,8,["label","to"])]),"action-data":s(({row:a})=>[p("div",Ut,[l(f,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>o(P).splice(a.index,1)},null,8,["onClick"])])]),_:1},8,["rows"])]),_:1}),l(r,{ui:{body:{padding:""}}},{header:s(()=>e[14]||(e[14]=[p("h3",{class:"font-bold font-mono"}," Sales Channel Summary / 銷售渠道摘要 ",-1)])),default:s(()=>[l(m,{columns:[{key:"id",label:"Channel ID",sortable:!0},{key:"count",label:"Count",sortable:!0},{key:"totalUSD",label:"Total USD",sortable:!0}],rows:o(Le)},{"id-data":s(({row:a})=>[a.id!=="empty"?(h(),T("span",Nt,$(a.idLabel),1)):(h(),E(d,{key:1,label:a.idLabel,ui:{rounded:"rounded-full"},color:"gray"},null,8,["label"]))]),_:1},8,["rows"])]),_:1}),l(r,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"12px"}}},{default:s(()=>[p("div",Lt,[e[15]||(e[15]=p("h3",{class:"font-bold font-mono"}," Advanced Settings ",-1)),l(f,{color:"gray",variant:"ghost",icon:o(j)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",onClick:e[5]||(e[5]=()=>{j.value=!o(j)})},null,8,["icon"])]),o(j)?(h(),T("div",Pt,[l(ze,{"is-show-physical-goods-checkbox":!1,"is-loading":o(X),"shipping-info":o(u).shippingRates,onUpdateShippingRates:Ve},null,8,["is-loading","shipping-info"]),l(r,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"",base:"space-y-8"}}},{header:s(()=>[e[16]||(e[16]=p("h4",{class:"text-sm font-bold font-mono"}," Share sales data to wallets / 分享銷售數據給特定地址 ",-1)),p("div",Rt,[l(C,{modelValue:o(g),"onUpdate:modelValue":e[6]||(e[6]=a=>S(g)?g.value=a:null),class:"font-mono",placeholder:"like1..."},null,8,["modelValue"]),l(f,{label:"Add",variant:o(g)?"outline":"solid",color:o(g)?"primary":"gray",disabled:!o(g),onClick:Ae},null,8,["variant","color","disabled"])])]),default:s(()=>[l(m,{columns:o(Ee),rows:o(Te)},{"wallet-data":s(({row:a})=>[l(se,{text:a.wallet},{default:s(()=>[l(f,{class:"font-mono",label:a.shortenWallet,to:a.walletLink,variant:"link",padded:!1,size:"xs"},null,8,["label","to"])]),_:2},1032,["text"])]),"remove-data":s(({row:a})=>[p("div",At,[l(f,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>o(D).splice(a.index,1)},null,8,["onClick"])])]),_:1},8,["columns","rows"])]),_:1}),l(r,{ui:{body:{base:"space-y-4"}}},{header:s(()=>e[17]||(e[17]=[p("h3",{class:"font-bold font-mono"}," Copy Purchase Link / 複製購買連結 ",-1)])),default:s(()=>[p("div",null,[l(Me,{modelValue:o(A),"onUpdate:modelValue":e[7]||(e[7]=a=>S(A)?A.value=a:null)},null,8,["modelValue"]),K(" Use "+$(o(A)?"Liker Land":"Stripe")+" Purchase Link ",1)]),l(ie,{label:"Sales channel for this link",hint:"Optional"},{default:s(()=>[l(C,{modelValue:o(U),"onUpdate:modelValue":e[8]||(e[8]=a=>S(U)?U.value=a:null),placeholder:"Channel ID"},null,8,["modelValue"])]),_:1}),l(f,{class:"font-mono break-all",label:`${o(M)}`,to:o(M),variant:"outline",color:"gray",target:"_blank"},null,8,["label","to"]),e[19]||(e[19]=p("br",null,null,-1)),l(f,{label:"Copy Purchase Link",variant:"outline",color:"primary",onClick:Fe}),l(qe,{data:o(M),"file-name":`collection-${o(oe)}-channel_${o(U)||""}`,width:500,height:500},{header:s(()=>e[18]||(e[18]=[p("h3",{class:"font-bold font-mono"}," Purchase Link QR Code ",-1)])),_:1},8,["data","file-name"])]),_:1,__:[19]})])):W("",!0)]),_:1}),l(f,{label:"Save Changes",loading:o(_),size:"lg",disabled:o(_),onClick:Ie},null,8,["loading","disabled"])],64)):W("",!0),l(He,{transition:!1})]),_:1})}}});export{Kt as default};
