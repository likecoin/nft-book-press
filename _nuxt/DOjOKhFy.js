import{_ as ee}from"./DUA0qLL8.js";import{_ as te}from"./CeuJHouT.js";import{a_ as ae,b6 as oe,b7 as le,bk as ne,bn as se,bm as re,b0 as ue,b8 as n,b9 as k,ba as D,b1 as ie,b3 as C,aX as l,aT as I,aU as L,aW as a,br as O,aV as q,b4 as o,bf as w,bK as de,aY as V,bt as ce,bg as fe,bU as me,bZ as pe,b_ as _e,b2 as be}from"./Dc3DrglY.js";import{_ as ve}from"./C2l-TPl0.js";import{_ as ge}from"./DVr_2zQn.js";import{_ as ye}from"./BnJ54_cs.js";import{_ as ke}from"./BTrlxp03.js";import{p as $e}from"./CUxdmJDi.js";import{u as he}from"./BT9eh9F6.js";import"./BjejjuGA.js";import"./BcAx5RlV.js";(function(){try{var d=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},p=new d.Error().stack;p&&(d._sentryDebugIds=d._sentryDebugIds||{},d._sentryDebugIds[p]="eb4f500e-5d4c-4e1a-9082-d8a9ffe03dde",d._sentryDebugIdIdentifier="sentry-dbid-eb4f500e-5d4c-4e1a-9082-d8a9ffe03dde")}catch{}})();const we={class:"text-lg font-bold font-mono"},Ae=ae({__name:"[classId]",setup(d){const{LIKE_CO_API:p}=oe().public,U=le(),N=ne(),{token:T}=se(N),B=he(),{lazyFetchClassMetadataById:z}=B,G=re(),M=ue(),_=n(""),c=n(!1),f=n(G.params.classId),x=n({}),S=n([]),m=n(0),E=k(()=>{var e;return(e=x.value.prices)==null?void 0:e.map((t,r)=>({label:`${t.name.en||t.name} - $${t.price}`,value:r,disabled:r===m.value}))}),b=n(""),v=n(""),g=n(""),R=k(()=>!!b.value&&!!v.value&&!!g.value&&!!y.value.length),y=n([]),F=k(()=>{var e;return((e=y.value)==null?void 0:e.length)||0}),P=k(()=>{var e;return(e=B.getClassMetadataById(f.value))==null?void 0:e.name});D(c,e=>{e&&(_.value="")});const K=["wallet","email","toName","message"],W=k(()=>[{label:"Email (required)",key:"email"},{label:"Wallet (optional)",key:"wallet"},{label:"Recipient name (optional)",key:"toName"},{label:"Message (optional)",key:"message"}]);ie(async()=>{c.value=!0;try{const e=await $fetch(`${p}/likernft/book/store/${f.value}`,{headers:{authorization:`Bearer ${T.value}`}});x.value=e,S.value=x.value.prices,z(f.value)}catch(e){console.error(e),_.value=e.toString()}finally{c.value=!1}}),D(_,e=>{e&&U.add({icon:"i-heroicons-exclamation-circle",title:e,timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}})});function H(){pe(_e([K.reduce((e,t)=>(e[t]="",e),{})],{header:!0}),"gift_list.csv","text/csv;charset=utf-8;")}function X(e){if(!e)return;const[t]=e,r=new FileReader;r.onload=u=>{var $;try{const s=($=u.target)==null?void 0:$.result;if(typeof s!="string")return;const h=$e(s,{columns:!0});y.value=h}catch(s){console.error(s),_.value=s.toString()}},r.readAsText(t)}async function Y(){if(R.value)try{if(c.value=!0,S.value[m.value].stock<=F.value)throw new Error("NOT_ENOUGH_STOCK");await $fetch(`${p}/likernft/book/store/class/${f.value}/price/${m.value}/gift`,{method:"POST",body:{receivers:y.value,giftInfo:{toName:b.value,fromName:v.value,message:g.value}},headers:{authorization:`Bearer ${T.value}`}}),await be(M({name:"nft-book-store-status-classId",params:{classId:f.value}}))}catch(e){console.error(e),_.value=e.toString()}finally{c.value=!1}}return(e,t)=>{const r=ee,u=te,$=de,s=ve,h=fe,Z=ge,j=me,J=ye,A=ce,Q=ke;return I(),C(Q,null,{default:l(()=>[L("h1",we,' Gift NFT Book "'+q(o(P)||o(f))+'" ',1),a(u,{label:"Gift edition",required:!0},{default:l(()=>[a(r,{modelValue:o(m),"onUpdate:modelValue":t[0]||(t[0]=i=>w(m)?m.value=i:null),options:o(E)},null,8,["modelValue","options"])]),_:1}),o(c)?(I(),C($,{key:0,animation:"carousel"},{indicator:l(()=>t[4]||(t[4]=[V(" Loading... ")])),_:1})):O("",!0),o(N).isAuthenticated?(I(),C(A,{key:1,ui:{body:{base:"space-y-4"},footer:{base:"flex justify-center gap-2"}}},{footer:l(()=>[a(h,{label:"Confirm",disabled:!o(R),size:"xl",onClick:Y},null,8,["disabled"])]),default:l(()=>[a(u,{label:e.$t("gift.default_recipient_name"),required:!0},{default:l(()=>[a(s,{modelValue:o(b),"onUpdate:modelValue":t[1]||(t[1]=i=>w(b)?b.value=i:null),placeholder:e.$t("gift.fellow_reader")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(u,{label:e.$t("gift.default_gift_message"),required:!0},{default:l(()=>[a(s,{modelValue:o(g),"onUpdate:modelValue":t[2]||(t[2]=i=>w(g)?g.value=i:null),placeholder:e.$t("gift.thank_you_support")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(u,{label:e.$t("gift.gift_giver_name"),required:!0},{default:l(()=>[a(s,{modelValue:o(v),"onUpdate:modelValue":t[3]||(t[3]=i=>w(v)?v.value=i:null),placeholder:e.$t("gift.your_name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(u,null,{label:l(()=>[V(q(e.$t("gift.upload_recipient_list"))+" (",1),a(h,{label:e.$t("gift.download_csv_template"),variant:"link",padded:!1,size:"xs",onClick:H},null,8,["label"]),t[5]||(t[5]=V(") "))]),default:l(()=>[a(Z,{class:"mt-1",type:"file",accept:".csv",onChange:X})]),_:1}),a(A,{ui:{header:{base:"flex gap-4 items-center"},body:{padding:""}}},{header:l(()=>[t[6]||(t[6]=L("h2",{class:"text-lg font-bold font-mono"}," Recipients ",-1)),a(j,{label:`${o(F)}`,ui:{rounded:"rounded-full"}},null,8,["label"])]),default:l(()=>[a(J,{columns:o(W),rows:o(y)},null,8,["columns","rows"])]),_:1})]),_:1})):O("",!0)]),_:1})}}});export{Ae as default};
