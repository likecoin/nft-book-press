import{_ as M}from"./CqvhB5OJ.js";import{_ as Q}from"./wxULK9li.js";import{_ as G}from"./Cs0rOM-S.js";import{_ as X}from"./-gN7atBo.js";import{a_ as Y,b7 as J,bm as Z,b0 as ee,b8 as f,b9 as L,bb as te,b1 as oe,b3 as g,aX as r,aT as S,aW as t,br as R,aU as V,bf as v,b4 as l,bt as ne,be as ae,bg as re,aY as B,aV as I,bK as le,bL as se,b2 as ie}from"./CfseOdbi.js";import{_ as ue}from"./MYa5ghU3.js";import{_ as de}from"./Vz5hS-_V.js";import{_ as ce}from"./YhmgSYdO.js";import{_ as me}from"./D9-Opd7q.js";import{p as _e}from"./CUxdmJDi.js";import"./Jm4E6K-K.js";import"./W06PnaAv.js";(function(){try{var m=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new m.Error().stack;i&&(m._sentryDebugIds=m._sentryDebugIds||{},m._sentryDebugIds[i]="f3e53857-9fd0-4954-a7ad-9b4608e35909",m._sentryDebugIdIdentifier="sentry-dbid-f3e53857-9fd0-4954-a7ad-9b4608e35909")}catch{}})();const pe={class:"flex justify-center"},fe={class:"flex items-center gap-2"},w="key,url",Le=Y({__name:"batch-short-links",setup(m){const i=J(),x=Z(),T=ee(),D=[{label:"Bitly",value:"bitly"},{label:"Short.io",value:"shortio"}],_=f(x.query.provider||"bitly"),U=L(()=>_.value==="shortio"),b=f(""),h=f(x.query.title_prefix||"NFT Book Press"),u=f(""),P=`${w}
example01,https://example01.com,
example02,https://example02.com,`,p=f(""),A=L(()=>{switch(_.value){case"bitly":return"Bitly Access Token";case"shortio":return"Short.io API Key";default:return""}}),y=f([]);te({title:"Batch Create Book Short Links",ogTitle:"Batch Create Book Short Links"}),oe(()=>{try{const n=sessionStorage.getItem("nft_book_press_batch_shorten_url");n&&(u.value=n,sessionStorage.removeItem("nft_book_press_batch_shorten_url"))}catch(n){console.error(n)}});async function N({url:n,key:e}){try{const o=await $fetch("https://api-ssl.bitly.com/v4/bitlinks",{method:"POST",headers:{Authorization:`Bearer ${p.value}`},body:{long_url:n,domain:"bit.ly",title:[h.value,e].join(" - "),tags:["nft-book-press"]}});if(!o)throw new Error("No data returned from Bitly");return o.link}catch(o){return console.error(o),i.add({icon:"i-heroicons-exclamation-circle",title:o.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}}),"error"}}async function $({url:n,key:e}){try{const o=await $fetch("https://api.short.io/links/public",{method:"POST",headers:{Authorization:p.value},body:{allowDuplicates:!0,domain:b.value,originalURL:n,title:[h.value,e].join(" - "),tags:["nft-book-press"]}});if(!o)throw new Error("No data returned from Short.io");return o.shortURL}catch(o){return console.error(o),i.add({icon:"i-heroicons-exclamation-circle",title:o.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}}),"error"}}async function q(){let n=[];try{let e=u.value;e.includes(w)||(e=`${w}
${e}`),n=_e(e,{columns:!0,skip_empty_lines:!0})}catch(e){console.error(e),i.add({icon:"i-heroicons-exclamation-circle",title:e.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}});return}try{for(const{key:e,url:o}of n){let d="";switch(_.value){case"bitly":d=await N({url:o,key:e});break;case"shortio":d=await $({url:o,key:e});break;default:break}y.value.push({key:e,url:d,destination:o})}}catch(e){console.error(e),i.add({icon:"i-heroicons-exclamation-circle",title:e.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}})}}function O(){le({data:y.value,fileName:"shortened_links.csv",fileType:"csv"})}function j(){sessionStorage.setItem("nft_book_press_batch_qrcode",se(y.value)),ie(T({name:"batch-qrcode"}))}function E(n){if(!n)return;const[e]=n,o=new FileReader;o.onload=d=>{var c;const s=(c=d.target)==null?void 0:c.result;typeof s=="string"&&(u.value=s)},o.readAsText(e)}return(n,e)=>{const o=M,d=Q,s=G,c=X,F=ae,K=ue,C=ne,k=re,z=de,W=ce,H=me;return S(),g(H,null,{default:r(()=>[t(o,{title:"Batch Create Book Short Links"}),t(W,null,{default:r(()=>[t(s,{label:"Short Link Provider",required:!0},{default:r(()=>[t(d,{modelValue:l(_),"onUpdate:modelValue":e[0]||(e[0]=a=>v(_)?_.value=a:null),options:D},null,8,["modelValue"])]),_:1}),t(s,{label:l(A),required:!0},{default:r(()=>[t(c,{modelValue:l(p),"onUpdate:modelValue":e[1]||(e[1]=a=>v(p)?p.value=a:null),class:"font-mono",autocomplete:!1},null,8,["modelValue"])]),_:1},8,["label"]),l(U)?(S(),g(s,{key:0,label:"Short.io Domain",required:!0},{default:r(()=>[t(c,{modelValue:l(b),"onUpdate:modelValue":e[2]||(e[2]=a=>v(b)?b.value=a:null),class:"font-mono",placeholder:"link.liker.land",autocomplete:!1},null,8,["modelValue"])]),_:1})):R("",!0),t(s,{label:"Title Prefix"},{default:r(()=>[t(c,{modelValue:l(h),"onUpdate:modelValue":e[3]||(e[3]=a=>v(h)?h.value=a:null),hint:"Optional"},null,8,["modelValue"])]),_:1}),t(C,{ui:{body:{base:"space-y-2"}}},{default:r(()=>[t(s,{label:"Upload CSV file"},{default:r(()=>[t(c,{type:"file",accept:"csv",onChange:E})]),_:1}),t(F,{class:"print:hidden",label:"OR"}),t(s,{label:"Input CSV content"},{default:r(()=>[t(K,{modelValue:l(u),"onUpdate:modelValue":e[4]||(e[4]=a=>v(u)?u.value=a:null),class:"font-mono",placeholder:P,resize:!0},null,8,["modelValue"])]),_:1})]),_:1}),V("div",pe,[t(k,{label:"Start",size:"lg",disabled:!l(u)||!l(p)||l(U)&&!l(b),onClick:q},null,8,["disabled"])]),l(y).length?(S(),g(C,{key:1,ui:{header:{base:"flex justify-between items-center gap-2"},body:{padding:""}}},{header:r(()=>[e[5]||(e[5]=V("h3",{class:"font-bold font-mono"}," Results ",-1)),V("div",fe,[t(k,{label:"Download CSV",variant:"outline",onClick:O}),t(k,{label:"Convert to QR Codes",variant:"outline",onClick:j})])]),default:r(()=>[t(z,{columns:[{key:"key",label:"Key"},{key:"url",label:"URL"},{key:"destination",label:"Destination"}],rows:l(y)},{"url-data":r(({row:a})=>[t(k,{class:"font-mono",to:a.url,target:"_blank",rel:"noopener",variant:"link",padded:!1},{default:r(()=>[B(I(a.url),1)]),_:2},1032,["to"])]),"destination-data":r(({row:a})=>[t(k,{class:"font-mono",to:a.destination,target:"_blank",rel:"noopener",variant:"link",padded:!1},{default:r(()=>[B(I(a.destination),1)]),_:2},1032,["to"])]),_:1},8,["rows"])]),_:1})):R("",!0)]),_:1})]),_:1})}}});export{Le as default};
