import{a_ as te,bj as le,b3 as ae,bl as ie,b5 as s,b6 as L,b7 as Z,b0 as re,du as ge,aS as k,aT as v,aW as i,bd as n,bc as ne,aX as S,aU as m,cJ as ye,aY as G,aV as ee,bM as we,bf as Ie,cO as Ne,aQ as Se,b1 as J,br as Fe,cq as xe,be as ue,bp as q,b8 as Ce,bq as Te,bk as he,a$ as ke,dv as Me,dw as Ue,b9 as oe,bg as De,bh as Re,ct as Ee,dx as Be}from"./3oYfw71m.js";import{u as ce,b as $e,v as Ve,c as se,d as Le,f as Ae,a as Oe,_ as Pe,e as qe}from"./BiI5FW4T.js";import{a as Ke,u as ze}from"./whXo9D3j.js";import{a as je,u as Ge}from"./g4OYHvTq.js";import{_ as We}from"./Crmrqqp1.js";import{_ as de}from"./BmaU4iZi.js";import{_ as Je}from"./CeG8QK9k.js";import{_ as Ye}from"./C-KO8Qm_.js";import"./qUHHi-yh.js";import"./C01ROuPZ.js";import"./BlLV1cZV.js";import"./DGSwXr-s.js";import"./DLkSWbr3.js";import"./CDTwr7E8.js";import"./a_jSdbFl.js";import"./CT8_8sF1.js";import"./BRt3F7YL.js";import"./JX11BDCH.js";import"./DryZx6Qm.js";import"./D-2Y3n-Y.js";import"./DHI_H3F_.js";import"./r2e_CVFx.js";(function(){try{var C=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},F=new C.Error().stack;F&&(C._sentryDebugIds=C._sentryDebugIds||{},C._sentryDebugIds[F]="0685369f-937b-41ae-859d-07be2a4bc8c0",C._sentryDebugIdIdentifier="sentry-dbid-0685369f-937b-41ae-859d-07be2a4bc8c0")}catch{}})();const He={class:"space-y-3"},Xe={class:"flex justify-between items-center"},Qe=te({__name:"RegisterISCN",emits:["handleSubmit","submit","formValidChange"],setup(C,{expose:F,emit:f}){const w=le(),{getFileType:D}=se(),{LIKE_EVM_NFT_TARGET_ADDRESS:x}=ae().public,{wallet:b,signer:y}=ie(w),{initIfNecessary:a}=w,{assertPositiveWalletBalance:g,waitForTransactionReceipt:M}=je(),{stripHtmlTags:R,formatLanguage:E}=se(),{showErrorToast:I}=ce(),{LIKE_NFT_CONTRACT_ADDRESS:T}=ae().public,p=s({type:"Book",title:"",description:"",isbn:"",publisher:"",publicationDate:"",author:{name:"",description:""},license:"All Rights Reserved",customLicense:"",contentFingerprints:[{url:""}],downloadableUrls:[{url:"",type:"",fileName:""}],language:"",bookInfoUrl:"",tags:[],coverUrl:""}),d=s(""),A=s(""),O=f,{payload:K}=$e({iscnFormData:p}),{writeContractAsync:z}=Ge(),o=L(()=>Ve(p.value)),c=L(()=>{var t;return!((t=o.value)!=null&&t.length)});Z(c,t=>{O("formValidChange",t)},{immediate:!0}),re(()=>{const t=B();t&&(p.value=t)});const B=()=>{var U,N,h,P,j,Y;const t=ge();if(!t)return null;const r={type:"Book",title:((U=t.epubMetadata)==null?void 0:U.title)||"",description:R(((N=t.epubMetadata)==null?void 0:N.description)||""),isbn:"",publisher:"",publicationDate:new Date().toISOString().split("T")[0],author:{name:((h=t.epubMetadata)==null?void 0:h.author)||"",description:""},license:"All Rights Reserved",contentFingerprints:[],downloadableUrls:[],coverUrl:(P=t.epubMetadata)!=null&&P.thumbnailArweaveId?`ar://${t.epubMetadata.thumbnailArweaveId}`:"",language:E(((j=t.epubMetadata)==null?void 0:j.language)||"zh"),tags:((Y=t.epubMetadata)==null?void 0:Y.tags)||[]};return r.downloadableUrls=t.fileRecords.filter(u=>u.fileType==="application/pdf"||u.fileType==="application/epub+zip").map(u=>({url:u.arweaveKey?u.arweaveLink:`ar://${u.arweaveId}`,type:D(u.fileType),fileName:u.fileName})),r.contentFingerprints=[...new Set(t.fileRecords.map(u=>{const H=u.arweaveKey?u.arweaveLink:`ar://${u.arweaveId}`;return u.fileType==="application/epub+zip"||u.fileType==="application/pdf"?H:`ar://${u.arweaveId}`}).filter(Boolean))].map(u=>({url:u})),r},$=async()=>{if(d.value="checking",!c.value){I(o.value.join(", "));return}p.value.contentFingerprints.length&&await W()},W=async()=>{if(d.value="loading",await a(),!b.value||!y.value){A.value="MISSING_SIGNER",d.value="";return}try{d.value="signing";const t=Ae(K.value),r={name:t.name,description:t.description,...t,symbol:"BOOK",image:(t==null?void 0:t.thumbnailUrl)||"",external_link:(t==null?void 0:t.url)||"",nft_meta_collection_id:"nft_book",nft_meta_collection_name:"NFT Book",nft_meta_collection_description:"NFT Book by Liker Land",recordTimestamp:new Date().toISOString()};await g({wallet:b.value});const U=await z({address:T,abi:Ke,functionName:"newBookNFTWithRoyalty",args:[{creator:b.value,updaters:[b.value,x],minters:[b.value,x],config:{name:r.name,symbol:"BOOK",metadata:JSON.stringify(r),max_supply:Ne}},500]}),N=await M({hash:U});if(console.log(N),!N||N.status!=="success")throw new Error("INVALID_RECEIPT");if(!N.logs[0].address)throw new Error("INVALID_CLASS_ID");const h=N.logs[0].address;d.value="success",O("submit",{iscnId:h,txHash:U})}catch(t){console.error(t),I(`'SIGNING_ERROR':${t}`),d.value=""}finally{d.value=""}};return F({onSubmit:$}),(t,r)=>{const U=Le,N=ye,h=we,P=Ie;return v(),k("div",null,[i(U,{modelValue:n(p),"onUpdate:modelValue":r[0]||(r[0]=j=>ne(p)?p.value=j:null)},null,8,["modelValue"]),i(P,{"model-value":!!n(d),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:S(()=>[m("div",He,[m("div",Xe,[i(N,{variant:"soft"},{default:S(()=>[G(ee(n(d)),1)]),_:1}),r[1]||(r[1]=m("p",{class:"text-xs text-gray-500"}," 請勿關閉此視窗，直到 ISCN 註冊完成。 ",-1))]),i(h,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),Ze=Se(Qe,[["__scopeId","data-v-f0d388f9"]]),et=te({__name:"ISCNInfoCard",props:{iscnId:{},iscnOwner:{},iscnData:{},showEditButton:{type:Boolean}},emits:["edit"],setup(C){const{OPENSEA_URL:F}=ae().public;return(f,w)=>{const D=ue,x=We,b=de,y=Fe;return v(),J(y,{ui:{body:{base:"space-y-4"}}},{header:S(()=>w[1]||(w[1]=[m("h2",{class:"font-bold font-mono"}," ISCN Information ",-1)])),default:S(()=>[i(x,{label:"Owner",class:"text-left"},{default:S(()=>[i(D,{label:f.iscnOwner,to:`${n(F)}/${encodeURIComponent(f.iscnOwner)}`,target:"_blank",variant:"link",padded:!1},null,8,["label","to"])]),_:1}),i(x,{label:"Title"},{default:S(()=>{var a,g;return[i(b,{value:(g=(a=f.iscnData)==null?void 0:a.contentMetadata)==null?void 0:g.name,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1}),i(x,{label:"Description"},{default:S(()=>{var a,g;return[i(b,{value:(g=(a=f.iscnData)==null?void 0:a.contentMetadata)==null?void 0:g.description,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1}),xe(f.$slots,"actions",{},()=>[f.showEditButton?(v(),J(D,{key:0,label:"Edit ISCN Metadata",onClick:w[0]||(w[0]=a=>f.$emit("edit"))})):q("",!0)])]),_:3})}}}),tt={class:"flex flex-col items-stretch grow space-y-4"},at=te({__name:"MintNFT",props:{iscnId:{type:String,default:""}},emits:["submit","formValidChange","loadingChange"],setup(C,{expose:F,emit:f}){const{getClassOwner:w,getClassMetadata:D,checkNFTClassIsBookNFT:x}=ze(),b=s(1),y=s(""),a=s(!1),g=s(""),M=s(null),R=s(""),E=s(null),I=L(()=>{var o;return(o=M.value)==null?void 0:o["@id"]}),T=s(!1),p=s(!1),d=f;Z(a,o=>{d("loadingChange",o),o&&(y.value="")},{immediate:!0}),Z(p,o=>{d("formValidChange",o)},{immediate:!0}),Ce({title:"Mint Liker Land NFT Book",ogTitle:"Mint Liker Land NFT Book"});const A=C;Z(()=>A.iscnId,async o=>{o&&await O(A.iscnId)},{immediate:!0});async function O(o){if(o)try{if(a.value=!0,!await x(o))throw new Error("Invalid NFT Class ID");const[B,$]=await Promise.all([D(o),w(o)]);if(!B)throw new Error("Invalid NFT Class ID");M.value={contentMetadata:B,owner:$,"@id":o},g.value=$,R.value=o,b.value=3}catch(c){console.error(c),y.value=c.toString()}finally{a.value=!1}}function K(){var o;(o=E.value)==null||o.startNFTMintFlow()}function z({classId:o,nftMintCount:c}={}){R.value=o||"",d("submit",{classId:o||"",nftMintCount:c})}return F({startNFTMintFlow:K}),(o,c)=>{const B=Te,$=et,W=Oe,t=Pe;return v(),k("div",tt,[n(y)?(v(),J(B,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${n(y)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:c[0]||(c[0]=r=>y.value="")},null,8,["title"])):q("",!0),i($,{"iscn-id":n(I),"iscn-owner":n(g),"iscn-data":n(M),"show-edit-button":!0,onEdit:c[1]||(c[1]=r=>T.value=!0)},null,8,["iscn-id","iscn-owner","iscn-data"]),i(W,{ref_key:"liteMintNFTRef",ref:E,"iscn-data":n(M),"should-show-submit":!1,onFormValidChange:c[2]||(c[2]=r=>p.value=r),onSubmit:z},null,8,["iscn-data"]),i(t,{modelValue:n(T),"onUpdate:modelValue":c[3]||(c[3]=r=>ne(T)?T.value=r:null),"class-id":n(R)},null,8,["modelValue","class-id"])])}}}),nt={class:"w-full"},ot={class:"justify-evenly items-center flex space-x-4 relative"},st={class:"text-sm font-semibold"},lt={class:"mt-6 p-4 border rounded-lg bg-gray-100 text-center flex flex-col gap-[24px]"},it={key:0},rt={key:1},ut={key:2},ct={key:3},dt={class:"flex gap-2 justify-center mt-4"},pt={key:0,class:"flex flex-col justify-center px-[12px] mt-[16px]"},mt={class:"flex flex-col items-center gap-4 py-4"},ft={class:"flex flex-col items-center"},_t={key:0},vt={class:"flex items-center"},bt={key:0,class:"flex flex-col items-center gap-2 w-full max-w-md"},Ot=te({__name:"index",setup(C){var u,H;const F=le(),{wallet:f,signer:w}=ie(F),{initIfNecessary:D}=F,x=he(),b=ke(),{showErrorToast:y}=ce(),a=s(0),g=s(),M=s(),R=s(),E=s(!1),I=s(""),T=s(""),p=s(((u=x.query.iscn_id)==null?void 0:u.toString())||""),d=s(((H=x.query.class_id)==null?void 0:H.toString())||""),A=s([]),O=s(""),K=s(!1),z=s(!1),o=s(!1),c=L(()=>!!T.value),B=L(()=>{switch(a.value){case 0:return"Start Upload";case 1:return"Register ISCN";case 2:return"Mint NFT";default:return"Next"}}),$=L(()=>{var l;return((l=A.value)==null?void 0:l.length)>0}),W=L(()=>a.value===0?$.value:a.value<3),t=L(()=>a.value===0?O.value!=="":a.value===2?o.value:!1),r=[{title:"上傳檔案",description:"Upload your book file"},{title:"註冊 ISCN",description:"Register ISCN"},{title:"鑄造區塊鏈書",description:"Mint NFT"},{title:"新書發佈",description:"Publish new book"}];re(()=>{var e;let l=null;try{const V=sessionStorage.getItem(Me);V&&(l=JSON.parse(V))}catch(V){console.error(V)}p.value?(I.value=p.value,h({iscnId:p.value})):d.value?P({classId:d.value}):l!=null&&l.epubMetadata&&(l!=null&&l.fileRecords)&&(T.value=(e=l==null?void 0:l.epubMetadata)==null?void 0:e.title)});const U=async()=>{if((!f.value||!w.value)&&await D(),!f.value||!w.value){y("Please login first");return}try{if(a.value===0&&g.value){await g.value.onSubmit();return}if(a.value===1){if(!K.value){y("Please fill in all required fields");return}await M.value.onSubmit();return}if(a.value===2){if(!z.value){y("Please fill in all required fields");return}await R.value.startNFTMintFlow();return}a.value<r.length-1&&a.value++}catch(l){console.error("Error during form submission:",l)}},N=l=>{Be(l),a.value=1},h=async l=>{const{iscnId:e}=l;e&&b.replace({query:{iscn_id:e}}),Ue(),a.value=2,await oe(),p.value=e},P=async l=>{const{classId:e,nftMintCount:V}=l;e&&(d.value=e,b.replace({query:{class_id:e,count:V}}),a.value=3,await oe())},j=()=>{b.push({name:"nft-book-store"})},Y=async()=>{I.value&&await h({iscnId:I.value})};return(l,e)=>{const V=Ee,pe=qe,me=Ze,fe=at,_e=Je,X=ue,ve=de,be=Ye;return v(),J(be,{class:"flex flex-col items-stretch grow space-y-4"},{default:S(()=>[m("div",nt,[m("div",ot,[e[8]||(e[8]=m("div",{class:"absolute w-full h-[1px] bg-gray-300 top-[50%] left-0 z-[-1]"},null,-1)),(v(),k(De,null,Re(r,(_,Q)=>m("div",{key:Q,class:"flex items-center space-x-2 bg-white p-2 rounded-lg"},[i(V,{size:Q===n(a)?"lg":"md",text:(Q+1).toString(),ui:{background:Q===n(a)?"bg-primary-100":"bg-gray-200"}},null,8,["size","text","ui"]),m("p",st,ee(_.title),1)])),64))]),m("div",lt,[n(a)===0?(v(),k("div",it,[i(pe,{ref_key:"uploadFormRef",ref:g,onFileUploadStatus:e[0]||(e[0]=_=>O.value=_),onFileReady:e[1]||(e[1]=_=>A.value=_),onSubmit:N},null,512)])):n(a)===1?(v(),k("div",rt,[i(me,{ref_key:"registerISCN",ref:M,onFormValidChange:e[2]||(e[2]=_=>K.value=_),onSubmit:h},null,512)])):n(a)===2?(v(),k("div",ut,[i(fe,{ref_key:"mintNFT",ref:R,"iscn-id":n(p),onLoadingChange:e[3]||(e[3]=_=>o.value=_),onFormValidChange:e[4]||(e[4]=_=>z.value=_),onSubmit:P},null,8,["iscn-id"])])):n(a)===3?(v(),k("div",ct,[i(_e,{ref:"newNFTBook",class:"p-0 flex flex-col text-left gap-[24px]","is-new-class-page":!0,"class-id":n(d),onSubmit:j},null,8,["class-id"])])):q("",!0),m("div",dt,[n(W)?(v(),J(X,{key:0,disabled:n(t),onClick:U},{default:S(()=>[G(ee(n(B)),1)]),_:1},8,["disabled"])):q("",!0)])]),n(a)===0?(v(),k("div",pt,[e[13]||(e[13]=m("div",{class:"w-full bg-gray-300 h-[1px]"},null,-1)),m("div",mt,[m("div",ft,[n(c)?(v(),k("div",_t,[e[9]||(e[9]=G(" 繼續上次的註冊: ")),i(X,{variant:"ghost",class:"text-primary-500 font-semibold",onClick:e[5]||(e[5]=_=>a.value=1)},{default:S(()=>[G(ee(n(T)),1)]),_:1})])):q("",!0),m("div",vt,[e[11]||(e[11]=m("span",null,"已經有 ISCN ID 了？ 按",-1)),i(X,{variant:"ghost",onClick:e[6]||(e[6]=_=>E.value=!n(E))},{default:S(()=>e[10]||(e[10]=[G(" 這裡 ")])),_:1,__:[10]})])]),n(E)?(v(),k("div",bt,[i(ve,{modelValue:n(I),"onUpdate:modelValue":e[7]||(e[7]=_=>ne(I)?I.value=_:null),placeholder:"輸入 ISCN ID"},null,8,["modelValue"]),i(X,{disabled:!n(I),onClick:Y},{default:S(()=>e[12]||(e[12]=[G(" 確認 ")])),_:1,__:[12]},8,["disabled"])])):q("",!0)])])):q("",!0)])]),_:1})}}});export{Ot as default};
