import{_ as ke}from"./Dv1ldGFY.js";import{a_ as we,a$ as Ue,bm as Ve,b7 as Se,b6 as Ne,b8 as r,ba as te,b9 as S,bb as $e,b1 as Re,b3 as M,aX as s,b4 as l,bq as Me,aT as v,aW as t,bt as Oe,bf as g,bg as Pe,aU as d,bA as Ae,aS as G,br as O,aV as ne,be as Be,bi as le,bh as Le,bj as je}from"./txgQZPFG.js";import{_ as Ee}from"./BPMj3vNd.js";import{_ as Te}from"./D18XSE06.js";import{_ as De}from"./BKEwjpUf.js";import{_ as ze}from"./BR5D-kfy.js";import{_ as Fe}from"./DHygA2y8.js";import{_ as qe}from"./DPYursPc.js";import{_ as Je}from"./CzKgS6CM.js";import{_ as Qe}from"./CinJpKqV.js";import{_ as Ge}from"./DEQL_L_k.js";import{u as We}from"./DTq-QGyr.js";import"./Dy8zRKt0.js";import"./BfIo4g5b.js";import"./BRPZAmvh.js";import"./CLRraj03.js";import"./RvvsvhHK.js";(function(){try{var h=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},f=new h.Error().stack;f&&(h._sentryDebugIds=h._sentryDebugIds||{},h._sentryDebugIds[f]="7c71f48a-30d9-442f-a768-33d235694f40",h._sentryDebugIdIdentifier="sentry-dbid-7c71f48a-30d9-442f-a768-33d235694f40")}catch{}})();const He={class:"flex items-center gap-2"},Ke=["textContent"],Xe={class:"flex items-start gap-4"},Ye=["src"],Ze={class:"flex flex-col justify-start"},eo=["textContent"],oo={class:"text-center"},to={class:"flex items-center gap-2 px-4 sm:px-6"},no={class:"flex items-center gap-2"},lo={class:"flex justify-center items-center gap-4"},ao={class:"flex items-center gap-2"},so={class:"flex justify-center gap-4"},wo=we({__name:"index",setup(h){const{t:f}=Ue(),W=Ve(),D=Se(),{BOOK3_URL:ae}=Ne().public,P=We(),{lazyFetchClassMetadataById:H,lazyFetchClassListingInfoById:K}=P,c=r([{id:0,value:""}]),X=r(1),b=r(!1),I=r(""),C=r(""),y=r([]),_=r(""),m=r([]),x=r(!1),N=r(!1),k=r(!1);te(x,o=>{o||(c.value=[{id:0,value:""}],X.value=1)});const se=S(()=>{const o=[{key:"name",label:f("common.name"),class:""}];return k.value&&o.push({key:"delete-action",label:"",class:"w-12"}),o}),ie=S(()=>{const o=[];return z.value.length&&o.push([{label:k.value?"Exit Edit Items":"Edit Items",icon:k.value?"i-heroicons-pencil-solid":"i-heroicons-pencil",click:fe}]),o.push([{label:"New Coupon",icon:"i-heroicons-tag",click:()=>{b.value=!b.value}},{class:"text-red-500",label:"Clear All Coupons",icon:"i-heroicons-trash",iconClass:"text-red-500",disabled:!y.value.length,click:ve}]),o}),z=S(()=>{var o;return(o=m.value)==null?void 0:o.map((e,i)=>{var a,B,$,L,j,E;return{classId:e.classId,name:(a=P.getClassMetadataById(e.classId))==null?void 0:a.name,prices:($=(B=P.getClassListingInfoById(e.classId))==null?void 0:B.prices)==null?void 0:$.map(V=>({...V})),image:Me((E=(j=(L=P.getClassMetadataById(e.classId))==null?void 0:L.data)==null?void 0:j.metadata)==null?void 0:E.image),index:i}})}),w=r([]),A=S(()=>w.value.map(e=>m.value[e.index]).sort((e,i)=>(e==null?void 0:e.priceIndex)!==void 0&&!(i!=null&&i.priceIndex)?-1:!(e!=null&&e.priceIndex)&&(i==null?void 0:i.priceIndex)!==void 0?1:0));te(z,o=>{o.length||(k.value=!1)});const U=S(()=>{const o=new URLSearchParams({utm_source:"direct-checkout",utm_medium:"pos"}),e=A.value.map(({classId:i,priceIndex:a})=>`${i}${a?`:${a}`:""}`).join(",");return o.append("products",e),_.value&&o.append("coupon",_.value),`${ae}/checkout?${o.toString()}`}),F=S(()=>"3ook Point Of Sale");$e({title:()=>F.value,ogTitle:()=>F.value}),Re(()=>{try{const o=window.localStorage.getItem("nft_book_store_pos_items");if(o){const i=JSON.parse(o);m.value=i.map(a=>({classId:a.classId,priceIndex:a.priceIndex}))}const e=window.localStorage.getItem("nft_book_store_pos_coupons");if(e){const i=JSON.parse(e);y.value=i.map(a=>({name:a.name,code:a.code}))}}catch(o){console.error(o)}m.value.forEach(o=>{o.classId&&(H(o.classId),K(o.classId))})});function de(){c.value.length&&c.value.push({id:X.value++,value:""})}function re(o){c.value.splice(o,1)}function ue(o,e){c.value[o].error=void 0,c.value[o].value=e}function ce(){c.value.forEach(o=>{o.error=void 0;let e=o.value.trim();e.startsWith("http")&&(e=new URL(e).pathname.split("/").pop()||""),e.startsWith("0x")?(m.value.push({classId:e,priceIndex:0}),H(e),K(e)):o.error=new Error("Invalid product ID")}),c.value.every(o=>!o.error)&&(x.value=!1,q())}function me(o,{index:e}){m.value[e].priceIndex=Number(o),q()}function pe({index:o}){m.value.splice(o,1),w.value=w.value.filter(e=>e.index!==o),q()}function Y(){x.value=!x.value}function fe(){k.value=!k.value}function _e(){y.value.push({name:I.value,code:C.value}),I.value="",C.value="",Z(),D.add({title:"Added coupon",timeout:2e3,color:"green"}),b.value=!1}function ve(){window.confirm("Are you sure you want to clear all coupons?")&&(y.value=[],_.value="",Z(),D.add({title:"Cleared all coupons",timeout:2e3,color:"red"}))}function q(){window.localStorage.setItem("nft_book_store_pos_items",JSON.stringify(m.value))}function Z(){window.localStorage.setItem("nft_book_store_pos_coupons",JSON.stringify(y.value))}function ge(){D.add({title:"Copied URL to clipboard",timeout:2e3}),navigator.clipboard.writeText(U.value)}function be(){window.open(U.value)}function xe(){N.value=!0}return(o,e)=>{const i=ke,a=Pe,B=Ee,$=Te,L=Ae,j=De,E=Be,V=ze,T=Fe,he=qe,J=Le,Ie=Je,Q=Oe,Ce=Qe,ye=Ge;return v(),M(ye,{key:l(W).path},{default:s(()=>[t(i,{title:l(F)},null,8,["title"]),t(Ce,{ui:{base:"flex flex-col items-stretch grow space-y-4",padding:"max-md:!px-0 max-md:py-0"}},{default:s(()=>[t(Q,{ui:{base:"flex flex-col grow",rounded:"max-md:rounded-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"grow",padding:""},footer:{base:"sticky bottom-0 bg-white dark:bg-gray-900 rounded-b-[inherit]",padding:"px-0 sm:px-0 space-y-4"}}},{header:s(()=>[d("div",He,[d("h2",{class:"text-xl font-bold",textContent:ne(l(f)("sales_pos.sales_items")+(l(A).length>0?l(f)("sales_pos.selected_count",{count:l(A).length}):""))},null,8,Ke),t(a,{icon:"i-heroicons-plus-circle",variant:"soft",onClick:Y})]),t(B,{items:l(ie),popper:{placement:"bottom-end"}},{default:s(()=>[t(a,{color:"white",icon:"i-heroicons-ellipsis-horizontal-circle"})]),_:1},8,["items"])]),footer:s(()=>[d("div",to,[t($,{modelValue:l(_),"onUpdate:modelValue":e[1]||(e[1]=n=>g(_)?_.value=n:null),class:"grow",options:l(y).map(n=>({label:n.name,value:n.code})),placeholder:"Select Coupon"},null,8,["modelValue","options"]),l(_)?(v(),M(a,{key:0,icon:"i-heroicons-x-mark-16-solid",size:"sm",color:"gray",variant:"outline",onClick:e[2]||(e[2]=()=>{_.value=""})})):O("",!0)]),t(E),t(Ie,{class:"w-full",items:[{key:"direct",label:l(f)("sales_pos.direct_checkout")}],ui:{wrapper:"px-4 sm:px-6",base:"flex flex-col space-y-4"}},{item:s(({item:n})=>[n.key==="direct"?(v(),G(le,{key:0},[t(T,{label:l(f)("sales_pos.checkout_url")},{default:s(()=>[d("div",no,[t(V,{modelValue:l(U),"onUpdate:modelValue":e[3]||(e[3]=u=>g(U)?U.value=u:null),class:"grow font-mono",readonly:""},null,8,["modelValue"]),t(a,{icon:"i-heroicons-clipboard-document",variant:"soft",color:"gray",onClick:ge})])]),_:1},8,["label"]),d("div",lo,[t(a,{label:"View Cart",size:"lg",onClick:be}),t(a,{label:"Generate QR Code",disabled:!l(A).length,size:"lg",onClick:xe},null,8,["disabled"]),t(J,{modelValue:l(N),"onUpdate:modelValue":e[5]||(e[5]=u=>g(N)?N.value=u:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:s(()=>[t(he,{data:l(U),mode:"readonly","file-name":"likerland_checkout",width:280,height:280},{header:s(()=>[e[11]||(e[11]=d("h3",{class:"font-bold font-mono",textContent:"Scan to buy"},null,-1)),t(a,{icon:"i-heroicons-x-mark",color:"gray",variant:"ghost",onClick:e[4]||(e[4]=u=>N.value=!1)})]),_:1},8,["data"])]),_:1},8,["modelValue"])])],64)):O("",!0)]),_:1},8,["items"])]),default:s(()=>[t(j,{modelValue:l(w),"onUpdate:modelValue":e[0]||(e[0]=n=>g(w)?w.value=n:null),columns:l(se),rows:l(z),ui:{wrapper:"static h-full",thead:"sticky top-0"}},{"name-data":s(({row:n})=>{var u,R;return[d("div",Xe,[n.image?(v(),G("img",{key:0,class:"w-[64px] object-contain rounded-sm",src:n.image},null,8,Ye)):O("",!0),d("div",Ze,[d("div",{class:"whitespace-break-spaces",textContent:ne(n.name)},null,8,eo),n.classId&&((u=n.prices)==null?void 0:u.length)>1?(v(),M($,{key:0,class:"mt-2","model-value":l(m)[n.index].priceIndex||0,options:(R=n.prices)==null?void 0:R.map(p=>{var ee,oe;return{label:((ee=p.name)==null?void 0:ee.zh)||((oe=p.name)==null?void 0:oe.en)||p.name,value:p.index}}),"onUpdate:modelValue":p=>me(p,n)},null,8,["model-value","options","onUpdate:modelValue"])):O("",!0)])])]}),"delete-action-header":s(()=>[d("div",oo,[t(L,{name:"i-heroicons-trash-solid"})])]),"delete-action-data":s(({row:n})=>[t(a,{icon:"i-heroicons-x-mark",color:"red",variant:"link",onClick:u=>pe(n)},null,8,["onClick"])]),_:1},8,["modelValue","columns","rows"])]),_:1}),t(J,{modelValue:l(x),"onUpdate:modelValue":e[6]||(e[6]=n=>g(x)?x.value=n:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:s(()=>[t(Q,{ui:{rounded:"max-sm:rounded-b-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"space-y-4"},footer:{base:"flex justify-center items-center"}}},{header:s(()=>[e[12]||(e[12]=d("h3",{class:"font-bold font-mono",textContent:"Add Item(s)"},null,-1)),t(a,{icon:"i-heroicons-x-mark",color:"gray",variant:"link",onClick:Y})]),footer:s(()=>[t(a,{label:"Confirm",onClick:ce})]),default:s(()=>[(v(!0),G(le,null,je(l(c),(n,u)=>{var R;return v(),M(T,{key:`input-${n.id}`,label:"Enter Product ID/URL(s)",required:!0,error:(R=n.error)==null?void 0:R.message},{default:s(()=>[d("div",ao,[t(V,{class:"grow font-mono","model-value":n.value,placeholder:"https://3ook.com/store/0x....","onUpdate:modelValue":p=>ue(u,p)},null,8,["model-value","onUpdate:modelValue"]),l(c).length>1?(v(),M(a,{key:0,icon:"i-heroicons-x-circle",variant:"link",onClick:p=>re(u)},null,8,["onClick"])):O("",!0)])]),_:2},1032,["error"])}),128)),d("div",so,[t(a,{icon:"i-heroicons-plus-circle",label:"Add",variant:"outline",onClick:de})])]),_:1})]),_:1},8,["modelValue"]),t(J,{modelValue:l(b),"onUpdate:modelValue":e[10]||(e[10]=n=>g(b)?b.value=n:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:s(()=>[t(Q,{ui:{rounded:"max-sm:rounded-b-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"space-y-4"},footer:{base:"flex justify-end items-center gap-4"}}},{header:s(()=>[e[13]||(e[13]=d("h3",{class:"font-bold",textContent:"Add Coupon"},null,-1)),t(a,{icon:"i-heroicons-x-mark-16-solid",color:"gray",size:"xl",padded:!1,variant:"link",onClick:e[7]||(e[7]=n=>b.value=!1)})]),footer:s(()=>[t(a,{icon:"i-heroicons-plus-circle",label:"Add Coupon",disabled:!l(I)||!l(C),onClick:_e},null,8,["disabled"])]),default:s(()=>[t(T,{label:"Coupon Name",help:"For POS Display Only",required:!0},{default:s(()=>[t(V,{modelValue:l(I),"onUpdate:modelValue":e[8]||(e[8]=n=>g(I)?I.value=n:null),placeholder:"Fall Promotion"},null,8,["modelValue"])]),_:1}),t(T,{label:"Coupon Code",required:!0},{default:s(()=>[t(V,{modelValue:l(C),"onUpdate:modelValue":e[9]||(e[9]=n=>g(C)?C.value=n:null),class:"font-mono",placeholder:"FALLPROMO"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}});export{wo as default};
