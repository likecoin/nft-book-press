import{a_ as X,bj as oe,b3 as se,bl as le,b5 as s,b6 as B,b7 as Y,b0 as ie,dv as ge,aS as U,aT as v,aW as i,bd as a,bc as Z,aX as S,aU as p,cJ as ye,aY as j,aV as H,bM as we,bf as Ie,cO as Ne,cT as Se,aQ as xe,b1 as G,br as Fe,cq as Ce,be as re,bp as O,b8 as Te,bq as he,bk as ke,a$ as Me,dw as Ue,dx as De,b9 as ne,bg as Re,bh as Ee,ct as $e,dy as Be}from"./BTgmShB0.js";import{u as ue,b as Ve,v as Le,c as ae,d as Ae,f as Oe,a as Pe,_ as qe,e as Ke}from"./CIEXGwNU.js";import{a as ze,b as je,u as Ge}from"./DF5aNtBQ.js";import{u as We,a as Je}from"./noA2pr89.js";import{_ as Ye}from"./D3pMUPT6.js";import{_ as ce}from"./Kaa100Vk.js";import{_ as He}from"./28u6TEgZ.js";import{_ as Xe}from"./CZsiBBgC.js";import"./DJYuJFUJ.js";import"./C6_JTRsm.js";import"./D-tw_PJZ.js";import"./DJaA4HDy.js";import"./DZymGoW7.js";import"./DmI-ENb3.js";import"./DAV3lIDy.js";import"./DG0Pnc7H.js";import"./BXc_itC8.js";import"./DKNe7kQL.js";import"./CkSFfhiz.js";import"./FMVVb-Pr.js";import"./UnKWNVua.js";import"./pRjQd_uE.js";import"./B-u73Uu-.js";(function(){try{var h=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},x=new h.Error().stack;x&&(h._sentryDebugIds=h._sentryDebugIds||{},h._sentryDebugIds[x]="db220180-ee4d-4214-aef7-40af3e5970e2",h._sentryDebugIdIdentifier="sentry-dbid-db220180-ee4d-4214-aef7-40af3e5970e2")}catch{}})();const Qe={class:"space-y-3"},Ze={class:"flex justify-between items-center"},et=X({__name:"RegisterISCN",emits:["handleSubmit","submit","formValidChange"],setup(h,{expose:x,emit:m}){const N=oe(),{getFileType:E}=ae(),{LIKE_EVM_NFT_TARGET_ADDRESS:F}=se().public,{wallet:w,signer:I}=le(N),{initIfNecessary:n}=N,{stripHtmlTags:b,formatLanguage:D}=ae(),{showErrorToast:R}=ue(),g=s({type:"Book",title:"",description:"",isbn:"",publisher:"",publicationDate:"",author:{name:"",description:""},license:"All Rights Reserved",customLicense:"",contentFingerprints:[{url:""}],downloadableUrls:[{url:"",type:"",fileName:""}],language:"",bookInfoUrl:"",tags:[],coverUrl:""}),u=s(""),k=s(""),C=m,{payload:M}=Ve({iscnFormData:g}),{writeContractAsync:V}=We(),L=B(()=>Le(g.value)),A=B(()=>{var e;return!((e=L.value)!=null&&e.length)});Y(A,e=>{C("formValidChange",e)},{immediate:!0}),ie(()=>{const e=P();e&&(g.value=e)});const P=()=>{var T,y,f,q,K,z;const e=ge();if(!e)return null;const d={type:"Book",title:((T=e.epubMetadata)==null?void 0:T.title)||"",description:b(((y=e.epubMetadata)==null?void 0:y.description)||""),isbn:"",publisher:"",publicationDate:new Date().toISOString().split("T")[0],author:{name:((f=e.epubMetadata)==null?void 0:f.author)||"",description:""},license:"All Rights Reserved",contentFingerprints:[],downloadableUrls:[],coverUrl:(q=e.epubMetadata)!=null&&q.thumbnailArweaveId?`ar://${e.epubMetadata.thumbnailArweaveId}`:"",language:D(((K=e.epubMetadata)==null?void 0:K.language)||"zh"),tags:((z=e.epubMetadata)==null?void 0:z.tags)||[]};return d.downloadableUrls=e.fileRecords.filter(r=>r.fileType==="application/pdf"||r.fileType==="application/epub+zip").map(r=>({url:r.arweaveKey?r.arweaveLink:`ar://${r.arweaveId}`,type:E(r.fileType),fileName:r.fileName})),d.contentFingerprints=[...new Set(e.fileRecords.map(r=>{const Q=r.arweaveKey?r.arweaveLink:`ar://${r.arweaveId}`;return r.fileType==="application/epub+zip"||r.fileType==="application/pdf"?Q:`ar://${r.arweaveId}`}).filter(Boolean))].map(r=>({url:r})),d},o=async()=>{if(u.value="checking",!A.value){R(L.value.join(", "));return}g.value.contentFingerprints.length&&await c()},c=async()=>{if(u.value="loading",await n(),!w.value||!I.value){k.value="MISSING_SIGNER",u.value="";return}try{u.value="signing";const e=Oe(M.value),d={name:e.name,description:e.description,...e,symbol:"BOOK",image:(e==null?void 0:e.thumbnailUrl)||"",external_link:(e==null?void 0:e.url)||"",nft_meta_collection_id:"nft_book",nft_meta_collection_name:"NFT Book",nft_meta_collection_description:"NFT Book by Liker Land",recordTimestamp:new Date().toISOString()},T=await V({address:je,abi:ze,functionName:"newBookNFTWithRoyalty",args:[{creator:w.value,updaters:[w.value,F],minters:[w.value,F],config:{name:d.name,symbol:"BOOK",metadata:JSON.stringify(d),max_supply:Ne}},500]}),y=await Je(Se,{hash:T});if(console.log(y),!y||y.status!=="success")throw new Error("INVALID_RECEIPT");if(!y.logs[0].address)throw new Error("INVALID_CLASS_ID");const f=y.logs[0].address;u.value="success",C("submit",{iscnId:f,txHash:T})}catch(e){console.error(e),R(`'SIGNING_ERROR':${e}`),u.value=""}finally{u.value=""}};return x({onSubmit:o}),(e,d)=>{const T=Ae,y=ye,f=we,q=Ie;return v(),U("div",null,[i(T,{modelValue:a(g),"onUpdate:modelValue":d[0]||(d[0]=K=>Z(g)?g.value=K:null)},null,8,["modelValue"]),i(q,{"model-value":!!a(u),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:S(()=>[p("div",Qe,[p("div",Ze,[i(y,{variant:"soft"},{default:S(()=>[j(H(a(u)),1)]),_:1}),d[1]||(d[1]=p("p",{class:"text-xs text-gray-500"}," 請勿關閉此視窗，直到 ISCN 註冊完成。 ",-1))]),i(f,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),tt=xe(et,[["__scopeId","data-v-e5210b79"]]),nt=X({__name:"ISCNInfoCard",props:{iscnId:{},iscnOwner:{},iscnData:{},showEditButton:{type:Boolean}},emits:["edit"],setup(h){const{OPENSEA_URL:x}=se().public;return(m,N)=>{const E=re,F=Ye,w=ce,I=Fe;return v(),G(I,{ui:{body:{base:"space-y-4"}}},{header:S(()=>N[1]||(N[1]=[p("h2",{class:"font-bold font-mono"}," ISCN Information ",-1)])),default:S(()=>[i(F,{label:"Owner",class:"text-left"},{default:S(()=>[i(E,{label:m.iscnOwner,to:`${a(x)}/${encodeURIComponent(m.iscnOwner)}`,target:"_blank",variant:"link",padded:!1},null,8,["label","to"])]),_:1}),i(F,{label:"Title"},{default:S(()=>{var n,b;return[i(w,{value:(b=(n=m.iscnData)==null?void 0:n.contentMetadata)==null?void 0:b.name,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1}),i(F,{label:"Description"},{default:S(()=>{var n,b;return[i(w,{value:(b=(n=m.iscnData)==null?void 0:n.contentMetadata)==null?void 0:b.description,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1}),Ce(m.$slots,"actions",{},()=>[m.showEditButton?(v(),G(E,{key:0,label:"Edit ISCN Metadata",onClick:N[0]||(N[0]=n=>m.$emit("edit"))})):O("",!0)])]),_:3})}}}),at={class:"flex flex-col items-stretch grow space-y-4"},ot=X({__name:"MintNFT",props:{iscnId:{type:String,default:""}},emits:["submit","formValidChange","loadingChange"],setup(h,{expose:x,emit:m}){const{getClassOwner:N,getClassMetadata:E,checkNFTClassIsBookNFT:F}=Ge(),w=s(1),I=s(""),n=s(!1),b=s(""),D=s(null),R=s(""),g=s(null),u=B(()=>{var o;return(o=D.value)==null?void 0:o["@id"]}),k=s(!1),C=s(!1),M=m;Y(n,o=>{M("loadingChange",o),o&&(I.value="")},{immediate:!0}),Y(C,o=>{M("formValidChange",o)},{immediate:!0}),Te({title:"Mint Liker Land NFT Book",ogTitle:"Mint Liker Land NFT Book"});const V=h;Y(()=>V.iscnId,async o=>{o&&await L(V.iscnId)},{immediate:!0});async function L(o){if(o)try{if(n.value=!0,!await F(o))throw new Error("Invalid NFT Class ID");const[e,d]=await Promise.all([E(o),N(o)]);if(!e)throw new Error("Invalid NFT Class ID");D.value={contentMetadata:e,owner:d,"@id":o},b.value=d,R.value=o,w.value=3}catch(c){console.error(c),I.value=c.toString()}finally{n.value=!1}}function A(){var o;(o=g.value)==null||o.startNFTMintFlow()}function P({classId:o,nftMintCount:c}={}){R.value=o||"",M("submit",{classId:o||"",nftMintCount:c})}return x({startNFTMintFlow:A}),(o,c)=>{const e=he,d=nt,T=Pe,y=qe;return v(),U("div",at,[a(I)?(v(),G(e,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${a(I)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:c[0]||(c[0]=f=>I.value="")},null,8,["title"])):O("",!0),i(d,{"iscn-id":a(u),"iscn-owner":a(b),"iscn-data":a(D),"show-edit-button":!0,onEdit:c[1]||(c[1]=f=>k.value=!0)},null,8,["iscn-id","iscn-owner","iscn-data"]),i(T,{ref_key:"liteMintNFTRef",ref:g,"iscn-data":a(D),"should-show-submit":!1,onFormValidChange:c[2]||(c[2]=f=>C.value=f),onSubmit:P},null,8,["iscn-data"]),i(y,{modelValue:a(k),"onUpdate:modelValue":c[3]||(c[3]=f=>Z(k)?k.value=f:null),"class-id":a(R)},null,8,["modelValue","class-id"])])}}}),st={class:"w-full"},lt={class:"justify-evenly items-center flex space-x-4 relative"},it={class:"text-sm font-semibold"},rt={class:"mt-6 p-4 border rounded-lg bg-gray-100 text-center flex flex-col gap-[24px]"},ut={key:0},ct={key:1},dt={key:2},pt={key:3},mt={class:"flex gap-2 justify-center mt-4"},ft={key:0,class:"flex flex-col justify-center px-[12px] mt-[16px]"},_t={class:"flex flex-col items-center gap-4 py-4"},vt={class:"flex flex-col items-center"},bt={key:0},gt={class:"flex items-center"},yt={key:0,class:"flex flex-col items-center gap-2 w-full max-w-md"},Kt=X({__name:"index",setup(h){var ee,te;const x=oe(),{wallet:m,signer:N}=le(x),{initIfNecessary:E}=x,F=ke(),w=Me(),{showErrorToast:I}=ue(),n=s(0),b=s(),D=s(),R=s(),g=s(!1),u=s(""),k=s(""),C=s(((ee=F.query.iscn_id)==null?void 0:ee.toString())||""),M=s(((te=F.query.class_id)==null?void 0:te.toString())||""),V=s([]),L=s(""),A=s(!1),P=s(!1),o=s(!1),c=B(()=>!!k.value),e=B(()=>{switch(n.value){case 0:return"Start Upload";case 1:return"Register ISCN";case 2:return"Mint NFT";default:return"Next"}}),d=B(()=>{var l;return((l=V.value)==null?void 0:l.length)>0}),T=B(()=>n.value===0?d.value:n.value<3),y=B(()=>n.value===0?L.value!=="":n.value===2?o.value:!1),f=[{title:"上傳檔案",description:"Upload your book file"},{title:"註冊 ISCN",description:"Register ISCN"},{title:"鑄造區塊鏈書",description:"Mint NFT"},{title:"新書發佈",description:"Publish new book"}];ie(()=>{var t;let l=null;try{const $=sessionStorage.getItem(Ue);$&&(l=JSON.parse($))}catch($){console.error($)}C.value?(u.value=C.value,z({iscnId:C.value})):M.value?r({classId:M.value}):l!=null&&l.epubMetadata&&(l!=null&&l.fileRecords)&&(k.value=(t=l==null?void 0:l.epubMetadata)==null?void 0:t.title)});const q=async()=>{if((!m.value||!N.value)&&await E(),!m.value||!N.value){I("Please login first");return}try{if(n.value===0&&b.value){await b.value.onSubmit();return}if(n.value===1){if(!A.value){I("Please fill in all required fields");return}await D.value.onSubmit();return}if(n.value===2){if(!P.value){I("Please fill in all required fields");return}await R.value.startNFTMintFlow();return}n.value<f.length-1&&n.value++}catch(l){console.error("Error during form submission:",l)}},K=l=>{Be(l),n.value=1},z=async l=>{const{iscnId:t}=l;t&&w.replace({query:{iscn_id:t}}),De(),n.value=2,await ne(),C.value=t},r=async l=>{const{classId:t,nftMintCount:$}=l;t&&(M.value=t,w.replace({query:{class_id:t,count:$}}),n.value=3,await ne())},Q=()=>{w.push({name:"nft-book-store"})},de=async()=>{u.value&&await z({iscnId:u.value})};return(l,t)=>{const $=$e,pe=Ke,me=tt,fe=ot,_e=He,W=re,ve=ce,be=Xe;return v(),G(be,{class:"flex flex-col items-stretch grow space-y-4"},{default:S(()=>[p("div",st,[p("div",lt,[t[8]||(t[8]=p("div",{class:"absolute w-full h-[1px] bg-gray-300 top-[50%] left-0 z-[-1]"},null,-1)),(v(),U(Re,null,Ee(f,(_,J)=>p("div",{key:J,class:"flex items-center space-x-2 bg-white p-2 rounded-lg"},[i($,{size:J===a(n)?"lg":"md",text:(J+1).toString(),ui:{background:J===a(n)?"bg-primary-100":"bg-gray-200"}},null,8,["size","text","ui"]),p("p",it,H(_.title),1)])),64))]),p("div",rt,[a(n)===0?(v(),U("div",ut,[i(pe,{ref_key:"uploadFormRef",ref:b,onFileUploadStatus:t[0]||(t[0]=_=>L.value=_),onFileReady:t[1]||(t[1]=_=>V.value=_),onSubmit:K},null,512)])):a(n)===1?(v(),U("div",ct,[i(me,{ref_key:"registerISCN",ref:D,onFormValidChange:t[2]||(t[2]=_=>A.value=_),onSubmit:z},null,512)])):a(n)===2?(v(),U("div",dt,[i(fe,{ref_key:"mintNFT",ref:R,"iscn-id":a(C),onLoadingChange:t[3]||(t[3]=_=>o.value=_),onFormValidChange:t[4]||(t[4]=_=>P.value=_),onSubmit:r},null,8,["iscn-id"])])):a(n)===3?(v(),U("div",pt,[i(_e,{ref:"newNFTBook",class:"p-0 flex flex-col text-left gap-[24px]","is-new-class-page":!0,"class-id":a(M),onSubmit:Q},null,8,["class-id"])])):O("",!0),p("div",mt,[a(T)?(v(),G(W,{key:0,disabled:a(y),onClick:q},{default:S(()=>[j(H(a(e)),1)]),_:1},8,["disabled"])):O("",!0)])]),a(n)===0?(v(),U("div",ft,[t[13]||(t[13]=p("div",{class:"w-full bg-gray-300 h-[1px]"},null,-1)),p("div",_t,[p("div",vt,[a(c)?(v(),U("div",bt,[t[9]||(t[9]=j(" 繼續上次的註冊: ")),i(W,{variant:"ghost",class:"text-primary-500 font-semibold",onClick:t[5]||(t[5]=_=>n.value=1)},{default:S(()=>[j(H(a(k)),1)]),_:1})])):O("",!0),p("div",gt,[t[11]||(t[11]=p("span",null,"已經有 ISCN ID 了？ 按",-1)),i(W,{variant:"ghost",onClick:t[6]||(t[6]=_=>g.value=!a(g))},{default:S(()=>t[10]||(t[10]=[j(" 這裡 ")])),_:1,__:[10]})])]),a(g)?(v(),U("div",yt,[i(ve,{modelValue:a(u),"onUpdate:modelValue":t[7]||(t[7]=_=>Z(u)?u.value=_:null),placeholder:"輸入 ISCN ID"},null,8,["modelValue"]),i(W,{disabled:!a(u),onClick:de},{default:S(()=>t[12]||(t[12]=[j(" 確認 ")])),_:1,__:[12]},8,["disabled"])])):O("",!0)])])):O("",!0)])]),_:1})}}});export{Kt as default};
