import{a_ as be,b6 as ye,a$ as ke,bk as he,bn as ne,b7 as ge,b0 as ve,b8 as I,b9 as $,ba as se,b1 as xe,b3 as r,aX as a,bo as Se,co as we,cp as j,aT as l,br as B,aS as F,b4 as e,bs as Ie,bi as ie,aW as s,bt as Ee,bE as L,aY as D,aV as R,bu as Ce,aU as y,cq as Te,bg as Ue,bQ as $e,bf as Be}from"./txgQZPFG.js";import{_ as Le}from"./BR5D-kfy.js";import{_ as Re}from"./DHygA2y8.js";import{_ as Ne}from"./BKEwjpUf.js";import{_ as ze}from"./BoaMLt1B.js";import{_ as De}from"./CinJpKqV.js";import{u as Pe}from"./C9xiYAgT.js";import{u as Ve}from"./DTq-QGyr.js";import"./BRPZAmvh.js";import"./CLRraj03.js";(function(){try{var h=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},_=new h.Error().stack;_&&(h._sentryDebugIds=h._sentryDebugIds||{},h._sentryDebugIds[_]="7d0775ef-6a1f-4deb-8a58-dd94af678ee0",h._sentryDebugIdIdentifier="sentry-dbid-7d0775ef-6a1f-4deb-8a58-dd94af678ee0")}catch{}})();const Ae={class:"text-center font-bold font-mono"},Oe={key:1},He={class:"text-center font-bold font-mono"},je={class:"flex items-center gap-2"},Fe=["href"],et=be({__name:"index",setup(h){const{LIKE_CO_API:_,BOOK3_URL:N}=ye().public,{t:n}=ke(),G=Ve(),K=he(),z=Pe(),{token:g,wallet:le}=ne(K),{bookUser:f,isUpdatingBookUserProfile:re,userLikerInfo:E,isFetchingUserLikerInfo:ce}=ne(z),M=ge(),ue=ve(),m=I(""),c=I(!1),v=I({}),P=I([]),W=I([]),x=I(!0),Y=$(()=>{var t,o;return(t=E.value)!=null&&t.user?Se((o=E.value)==null?void 0:o.user):""});se(f,t=>{x.value=(t==null?void 0:t.isEnableNotificationEmails)||!1}),se(c,t=>{t&&(m.value="")});const V=$(()=>{var t,o;return!!((t=f.value)!=null&&t.notificationEmail&&((o=f.value)!=null&&o.isEmailVerified))});xe(async()=>{await Promise.all([q(),X(),J(),z.lazyFetchBookUserProfile()]),k.value&&await Q()});const k=$(()=>{var t;return(t=v.value)==null?void 0:t.isReady}),de=$(()=>P.value.map(t=>{let o=t.type;switch(o){case"connectedWallet":o="royalties";break;case"channelCommission":o="channel";break}return{...t,type:o,amount:j(t.amount,t.currency),amountTotal:j(t.amountTotal,t.currency),currency:we(t.currency),timestamp:new Date(t.timestamp).toLocaleString()}})),fe=$(()=>W.value.map(t=>{const{id:o,amount:d,currency:u,status:S,arrivalTs:C,createdTs:A}=t;return{id:o,amount:j(d,u),status:S,createdTs:new Date(A*1e3).toLocaleString(),arrivalTs:C?new Date(C*1e3).toLocaleString():""}}));async function q(){try{c.value=!0;const t=await $fetch(`${_}/likernft/book/user/commissions/list`,{headers:{authorization:`Bearer ${g.value}`}});P.value=(t==null?void 0:t.commissions)||[],new Set(P.value.filter(d=>d.classId).map(d=>d.classId)).forEach(d=>G.lazyFetchClassMetadataById(d))}catch(t){console.error(t),m.value=t.toString()}finally{c.value=!1}}async function Q(){try{c.value=!0;const t=await $fetch(`${_}/likernft/book/user/payouts/list`,{headers:{authorization:`Bearer ${g.value}`}});W.value=(t==null?void 0:t.payouts)||[]}catch(t){console.error(t),m.value=t.toString()}finally{c.value=!1}}async function X(){try{await z.fetchUserLikerInfo({nocache:!0})}catch(t){console.error(t),m.value=t.toString()}}async function J(){var t;try{await Z(),(t=v.value)!=null&&t.hasAccount&&!k.value&&(await $fetch(`${_}/likernft/book/user/connect/refresh`,{method:"POST",headers:{authorization:`Bearer ${g.value}`}})).isReady&&(v.value.isReady=!0,await Z())}catch(o){console.error(o),m.value=o.toString()}finally{c.value=!1}}async function Z(){try{c.value=!0;const t=await $fetch(`${_}/likernft/book/user/connect/status?wallet=${le.value}`,{headers:{authorization:`Bearer ${g.value}`}});v.value=t||{}}catch(t){console.error(t),m.value=t.toString()}finally{c.value=!1}}async function ee(){try{c.value=!0;const o=(await $fetch(`${_}/likernft/book/user/connect/login`,{method:"POST",headers:{authorization:`Bearer ${g.value}`}})).url;if(o)window.open(o);else throw new Error("CANNOT_GET_STRIPE_CONNECT_RUL")}catch(t){console.error(t),m.value=t.toString()}finally{c.value=!1}}async function me(){try{c.value=!0;const o=(await $fetch(`${_}/likernft/book/user/connect/new`,{method:"POST",headers:{authorization:`Bearer ${g.value}`}})).url;if(o)window.open(o);else throw new Error("CANNOT_GET_STRIPE_CONNECT_RUL")}catch(t){console.error(t),m.value=t.toString()}finally{c.value=!1}}async function pe(){if(V.value)try{await z.updateBookUserProfile({isEnableNotificationEmails:x.value}),M.add({icon:"i-heroicons-check-circle",title:"User profile updated"})}catch(t){console.error(t),M.add({icon:"i-heroicons-exclamation-circle",title:"Unable to update user profile",description:t.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}})}}return(t,o)=>{const d=Ie,u=Ue,S=Te,C=Le,A=Ce,O=Re,T=Ee,w=$e,H=Ne,te=ze,_e=De;return l(),r(_e,null,{default:a(()=>{var oe;return[e(m)?(l(),r(d,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${e(m)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:o[0]||(o[0]=i=>m.value="")},null,8,["title"])):B("",!0),e(k)?B("",!0):(l(),r(d,{key:1,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"soft",title:e(n)("user_settings.stripe_express_notice"),description:e(n)("user_settings.stripe_express_description")},null,8,["title","description"])),e(K).isAuthenticated?(l(),F(ie,{key:2},[s(T,{ui:{header:{base:"flex justify-between items-center"},footer:{base:"text-center"}}},L({header:a(()=>[y("h1",Ae,R(e(n)("user_settings.affiliation_program")),1),s(S,{text:e(n)("user_settings.refresh_liker_id"),popper:{placement:"left"}},{default:a(()=>[s(u,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:e(ce),onClick:X},null,8,["disabled"])]),_:1},8,["text"])]),default:a(()=>{var i;return[(i=e(E))!=null&&i.user?(l(),r(O,{key:0,label:e(n)("user_settings.affiliation_channel_id"),size:"xl"},L({default:a(()=>[s(C,{placeholder:e(n)("user.affiliation_id_placeholder"),"model-value":e(Y),disabled:""},null,8,["placeholder","model-value"])]),_:2},[e(k)?{name:"help",fn:a(()=>[o[2]||(o[2]=D(" Append ")),s(A,{class:"font-mono"},{default:a(()=>[D(" ?from="+R(e(Y)),1)]),_:1}),o[3]||(o[3]=D(" in any bookstore page to earn commission from book sales. "))]),key:"1"}:{name:"help",fn:a(()=>[D(R(e(n)("user_settings.setup_stripe_notice")),1)]),key:"0"}]),1032,["label"])):(l(),F("p",Oe," You have not setup your channel ID yet. "))]}),_:2},[(oe=e(E))!=null&&oe.user?void 0:{name:"footer",fn:a(()=>[s(u,{label:"Setup your ID",size:"lg",rel:"noopener",target:"_blank",to:`${e(N)}/account`},null,8,["to"])]),key:"0"}]),1024),s(T,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{header:a(()=>[y("h1",He,R(e(n)("user_settings.stripe_payout_status")),1),s(S,{text:"Refresh Status",popper:{placement:"left"}},{default:a(()=>[s(u,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:e(c),onClick:J},null,8,["disabled"])]),_:1})]),footer:a(()=>{var i;return[e(c)?(l(),r(u,{key:0,label:"Loading",size:"lg",loading:!0,onClick:ee})):e(k)?(l(),r(u,{key:1,label:"Login to Stripe account",size:"lg",onClick:ee})):(i=e(E))!=null&&i.user?(l(),r(u,{key:3,label:"Setup Stripe Payment Recipient Account",size:"lg",onClick:me})):(l(),r(u,{key:2,label:"Setup your ID",size:"lg",rel:"noopener",target:"_blank",to:`${e(N)}/account`},null,8,["to"]))]}),default:a(()=>{var i;return[s(H,{columns:[{key:"initiated",label:e(n)("user_settings.setup_initiated")},{key:"completed",label:e(n)("user_settings.setup_completed")}],rows:[{initiated:((i=e(v))==null?void 0:i.hasAccount)||!1,completed:e(k)||!1}],ui:{th:{base:"text-center"},td:{base:"text-center"}}},{"initiated-data":a(({row:b})=>[b.initiated?(l(),r(w,{key:0,label:e(n)("user.yes"),color:"green",variant:"outline"},null,8,["label"])):(l(),r(w,{key:1,label:e(n)("user.no"),color:"red",variant:"outline"},null,8,["label"]))]),"completed-data":a(({row:b})=>{var p;return[b.completed?(l(),r(w,{key:0,label:((p=e(v))==null?void 0:p.notificationEmail)||e(n)("user.yes"),color:"green",variant:"outline"},null,8,["label"])):(l(),r(w,{key:1,label:e(n)("user.no"),color:"red",variant:"outline"},null,8,["label"]))]}),_:1},8,["columns","rows"])]}),_:1}),e(k)?(l(),F(ie,{key:0},[s(T,{ui:{header:{base:"flex justify-between items-center"},body:{base:"flex flex-col gap-6"},footer:{base:"text-center"}}},L({header:a(()=>[o[4]||(o[4]=y("h1",{class:"text-center font-bold font-mono"}," User Setting ",-1))]),default:a(()=>{var i,b;return[s(O,{label:"Liker ID Email"},{default:a(()=>{var p,U;return[s(C,{"model-value":(p=e(f))==null?void 0:p.notificationEmail,label:"Liker ID Email",disabled:"",ui:{base:"font-mono"}},L({_:2},[(U=e(f))!=null&&U.notificationEmail?{name:"trailing",fn:a(()=>{var ae;return[(ae=e(f))!=null&&ae.isEmailVerified?(l(),r(w,{key:0,label:"Verified",color:"green",size:"xs",ui:{rounded:"rounded-full"}})):(l(),r(w,{key:1,label:"Unverified",color:"amber",variant:"outline",size:"xs",ui:{rounded:"rounded-full"}}))]}),key:"0"}:void 0]),1032,["model-value"])]}),_:1}),s(O,{label:"Email Notification Settings"},L({default:a(()=>[y("div",je,[e(V)?(l(),r(te,{key:0,modelValue:e(x),"onUpdate:modelValue":o[1]||(o[1]=p=>Be(x)?x.value=p:null)},null,8,["modelValue"])):(l(),r(te,{key:1,"model-value":!1,disabled:!0})),o[5]||(o[5]=y("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-200"}," Receive email notifications about commissions ",-1))])]),_:2},[!((i=e(f))!=null&&i.notificationEmail)||!((b=e(f))!=null&&b.isEmailVerified)?{name:"help",fn:a(()=>{var p,U;return[(p=e(f))!=null&&p.notificationEmail?(U=e(f))!=null&&U.isEmailVerified?B("",!0):(l(),r(d,{key:1,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"subtle",title:"Email is not verified.",description:"To enable email notifications, please verify your Liker ID email."})):(l(),r(d,{key:0,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"subtle",title:"Email is not setup yet.",description:"To enable email notifications, please setup your Liker ID email."}))]}),key:"0"}:void 0]),1024)]}),_:2},[e(V)?{name:"footer",fn:a(()=>{var i;return[s(u,{label:"Update",disabled:((i=e(f))==null?void 0:i.isEnableNotificationEmails)===e(x),loading:e(re),onClick:pe},null,8,["disabled","loading"])]}),key:"0"}:void 0]),1024),s(T,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{header:a(()=>[o[6]||(o[6]=y("h1",{class:"text-center font-bold font-mono"}," Book Sales Commission History ",-1)),s(S,{text:"Refresh Status",popper:{placement:"left"}},{default:a(()=>[s(u,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:e(c),onClick:q},null,8,["disabled"])]),_:1})]),default:a(()=>[s(H,{columns:[{key:"timestamp",label:e(n)("user_settings.timestamp")},{key:"type",label:e(n)("user_settings.commission_type")},{key:"amount",label:e(n)("user_settings.commission")},{key:"classId",label:e(n)("user_settings.book_id")},{key:"currency",label:e(n)("user_settings.currency")},{key:"amountTotal",label:e(n)("user_settings.sale_amount")}],rows:e(de),ui:{th:{base:"text-center"},td:{base:"text-center"}}},{"classId-data":a(({row:i})=>{var b;return[y("a",{href:`${e(N)}/store/${i.classId}`,target:"_blank"},R(((b=e(G).getClassMetadataById(i.classId))==null?void 0:b.name)||i.classId),9,Fe)]}),_:1},8,["columns","rows"])]),_:1}),s(T,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{header:a(()=>[o[7]||(o[7]=y("h1",{class:"text-center font-bold font-mono"}," Commission Payout History ",-1)),s(S,{text:"Refresh Status",popper:{placement:"left"}},{default:a(()=>[s(u,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:e(c),onClick:Q},null,8,["disabled"])]),_:1})]),default:a(()=>[s(H,{columns:[{key:"createdTs",label:e(n)("user_settings.created")},{key:"amount",label:e(n)("user_settings.payout_amount")},{key:"status",label:e(n)("user_settings.status")},{key:"arrivalTs",label:e(n)("user_settings.arrived")},{key:"details",label:e(n)("user_settings.details")}],rows:e(fe),ui:{th:{base:"text-center"},td:{base:"text-center"}}},{"details-data":a(({row:i})=>[s(u,{label:"Details",size:"sm",color:"gray",to:e(ue)({name:"my-books-user-payouts-payoutId",params:{payoutId:i.id}})},null,8,["to"])]),_:1},8,["columns","rows"])]),_:1})],64)):B("",!0)],64)):B("",!0)]}),_:1})}}});export{et as default};
