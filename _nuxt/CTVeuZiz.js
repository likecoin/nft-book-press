import{a_ as ee,bl as re,b6 as ae,bn as ue,b8 as o,b9 as O,ba as Z,b1 as ce,dw as we,aS as k,aT as b,aW as i,b4 as t,bf as ne,aX as S,aU as f,cM as Ie,aY as W,aV as A,bP as he,bh as Ne,cR as Se,aQ as Fe,b3 as J,bt as xe,ct as Te,bg as de,br as K,bb as Ce,bs as ke,a$ as Re,bm as Me,by as Ue,b0 as De,dx as Ee,dy as $e,bc as le,bi as Be,bj as Ve,cw as Le,dz as Ae,b2 as Oe}from"./C1Iws6nc.js";import{u as pe,b as Pe,v as ze,c as ie,d as Ke,f as je,a as qe,_ as Ge,e as We}from"./B36vIIUC.js";import{a as Ye,u as He}from"./Cxa2cc_s.js";import{a as Je,u as Xe}from"./BmObtvYH.js";import{_ as Qe}from"./BAWiKx-w.js";import{_ as me}from"./UdKhLVak.js";import{_ as Ze}from"./DaelsYhV.js";import{_ as et}from"./CckUxYIo.js";import"./tH9phZsQ.js";import"./DXAePL8a.js";import"./C8rFwdj2.js";import"./MtMEjHTa.js";import"./Dzq_D4j4.js";import"./Cw4LaRUG.js";import"./Bwj6d1Q6.js";import"./Chb40_89.js";import"./CB-BER-0.js";import"./r6m6QBwU.js";import"./DLL8wjC8.js";import"./BsUu7wpa.js";import"./D_bIx0Dn.js";import"./DsFenduE.js";(function(){try{var F=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},d=new F.Error().stack;d&&(F._sentryDebugIds=F._sentryDebugIds||{},F._sentryDebugIds[d]="1538dfc2-6bed-415d-9622-27461fa0eefd",F._sentryDebugIdIdentifier="sentry-dbid-1538dfc2-6bed-415d-9622-27461fa0eefd")}catch{}})();const tt={class:"space-y-3"},at={class:"flex justify-between items-center"},nt=ee({__name:"RegisterISCN",emits:["handleSubmit","submit","formValidChange"],setup(F,{expose:d,emit:_}){const h=re(),{getFileType:R}=ie(),{LIKE_EVM_NFT_TARGET_ADDRESS:x}=ae().public,{wallet:w,signer:N}=ue(h),{initIfNecessary:g}=h,{assertPositiveWalletBalance:y,waitForTransactionReceipt:s}=Je(),{stripHtmlTags:M,formatLanguage:P}=ie(),{showErrorToast:z}=pe(),{LIKE_NFT_CONTRACT_ADDRESS:T}=ae().public,p=o({type:"Book",title:"",description:"",isbn:"",publisher:"",publicationDate:"",author:{name:"",description:""},license:"All Rights Reserved",customLicense:"",contentFingerprints:[{url:""}],downloadableUrls:[{url:"",type:"",fileName:""}],language:"",bookInfoUrl:"",tags:[],coverUrl:""}),m=o(""),C=o(""),U=_,{payload:j}=Pe({iscnFormData:p}),{writeContractAsync:q}=Xe(),n=O(()=>ze(p.value)),r=O(()=>{var e;return!((e=n.value)!=null&&e.length)});Z(r,e=>{U("formValidChange",e)},{immediate:!0}),ce(()=>{const e=D();e&&(p.value=e)});const D=()=>{var E,I,B,G,V,H;const e=we();if(!e)return null;const u={type:"Book",title:((E=e.epubMetadata)==null?void 0:E.title)||"",description:M(((I=e.epubMetadata)==null?void 0:I.description)||""),isbn:"",publisher:"",publicationDate:new Date().toISOString().split("T")[0],author:{name:((B=e.epubMetadata)==null?void 0:B.author)||"",description:""},license:"All Rights Reserved",contentFingerprints:[],downloadableUrls:[],coverUrl:(G=e.epubMetadata)!=null&&G.thumbnailArweaveId?`ar://${e.epubMetadata.thumbnailArweaveId}`:"",language:P(((V=e.epubMetadata)==null?void 0:V.language)||"zh"),tags:((H=e.epubMetadata)==null?void 0:H.tags)||[]};return u.downloadableUrls=e.fileRecords.filter(c=>c.fileType==="application/pdf"||c.fileType==="application/epub+zip").map(c=>({url:c.arweaveKey?c.arweaveLink:`ar://${c.arweaveId}`,type:R(c.fileType),fileName:c.fileName})),u.contentFingerprints=[...new Set(e.fileRecords.map(c=>{const te=c.arweaveKey?c.arweaveLink:`ar://${c.arweaveId}`;return c.fileType==="application/epub+zip"||c.fileType==="application/pdf"?te:`ar://${c.arweaveId}`}).filter(Boolean))].map(c=>({url:c})),u},$=async()=>{if(m.value="checking",!r.value){z(n.value.join(", "));return}p.value.contentFingerprints.length&&await Y()},Y=async()=>{if(m.value="loading",await g(),!w.value||!N.value){C.value="MISSING_SIGNER",m.value="";return}try{m.value="signing";const e=je(j.value),u={name:e.name,description:e.description,...e,symbol:"BOOK",image:(e==null?void 0:e.thumbnailUrl)||"",external_link:(e==null?void 0:e.url)||"",nft_meta_collection_id:"nft_book",nft_meta_collection_name:"NFT Book",nft_meta_collection_description:"NFT Book by Liker Land",recordTimestamp:new Date().toISOString()};await y({wallet:w.value});const E=await q({address:T,abi:Ye,functionName:"newBookNFTWithRoyalty",args:[{creator:w.value,updaters:[w.value,x],minters:[w.value,x],config:{name:u.name,symbol:"BOOK",metadata:JSON.stringify(u),max_supply:Se}},500]}),I=await s({hash:E});if(console.log(I),!I||I.status!=="success")throw new Error("INVALID_RECEIPT");if(!I.logs[0].address)throw new Error("INVALID_CLASS_ID");const B=I.logs[0].address;m.value="success",U("submit",{iscnId:B,txHash:E})}catch(e){console.error(e),z(`'SIGNING_ERROR':${e}`),m.value=""}finally{m.value=""}};return d({onSubmit:$}),(e,u)=>{const E=Ke,I=Ie,B=he,G=Ne;return b(),k("div",null,[i(E,{modelValue:t(p),"onUpdate:modelValue":u[0]||(u[0]=V=>ne(p)?p.value=V:null)},null,8,["modelValue"]),i(G,{"model-value":!!t(m),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:S(()=>[f("div",tt,[f("div",at,[i(I,{variant:"soft"},{default:S(()=>[W(A(t(m)),1)]),_:1}),u[1]||(u[1]=f("p",{class:"text-xs text-gray-500"}," 請勿關閉此視窗，直到 ISCN 註冊完成。 ",-1))]),i(B,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),st=Fe(nt,[["__scopeId","data-v-f0d388f9"]]),ot=ee({__name:"ISCNInfoCard",props:{iscnId:{},iscnOwner:{},iscnData:{},showEditButton:{type:Boolean}},emits:["edit"],setup(F){const{OPENSEA_URL:d}=ae().public;return(_,h)=>{const R=de,x=Qe,w=me,N=xe;return b(),J(N,{ui:{body:{base:"space-y-4"}}},{header:S(()=>h[1]||(h[1]=[f("h2",{class:"font-bold font-mono"}," ISCN Information ",-1)])),default:S(()=>[i(x,{label:"Owner",class:"text-left"},{default:S(()=>[i(R,{label:_.iscnOwner,to:`${t(d)}/${encodeURIComponent(_.iscnOwner)}`,target:"_blank",variant:"link",padded:!1},null,8,["label","to"])]),_:1}),i(x,{label:"Title"},{default:S(()=>{var g,y;return[i(w,{value:(y=(g=_.iscnData)==null?void 0:g.contentMetadata)==null?void 0:y.name,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1}),i(x,{label:"Description"},{default:S(()=>{var g,y;return[i(w,{value:(y=(g=_.iscnData)==null?void 0:g.contentMetadata)==null?void 0:y.description,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1}),Te(_.$slots,"actions",{},()=>[_.showEditButton?(b(),J(R,{key:0,label:"Edit ISCN Metadata",onClick:h[0]||(h[0]=g=>_.$emit("edit"))})):K("",!0)])]),_:3})}}}),lt={class:"flex flex-col items-stretch grow space-y-4"},it=ee({__name:"MintNFT",props:{iscnId:{type:String,default:""}},emits:["submit","formValidChange","loadingChange"],setup(F,{expose:d,emit:_}){const{getClassOwner:h,getClassMetadata:R,checkNFTClassIsBookNFT:x}=He(),w=o(1),N=o(""),g=o(!1),y=o(""),s=o(null),M=o(""),P=o(null),z=O(()=>{var n;return(n=s.value)==null?void 0:n["@id"]}),T=o(!1),p=o(!1),m=_;Z(g,n=>{m("loadingChange",n),n&&(N.value="")},{immediate:!0}),Z(p,n=>{m("formValidChange",n)},{immediate:!0}),Ce({title:"Mint Liker Land NFT Book",ogTitle:"Mint Liker Land NFT Book"});const C=F;Z(()=>C.iscnId,async n=>{n&&await U(C.iscnId)},{immediate:!0});async function U(n){if(n)try{if(g.value=!0,!await x(n))throw new Error("Invalid NFT Class ID");const[D,$]=await Promise.all([R(n),h(n)]);if(!D)throw new Error("Invalid NFT Class ID");s.value={contentMetadata:D,owner:$,"@id":n},y.value=$,M.value=n,w.value=3}catch(r){console.error(r),N.value=r.toString()}finally{g.value=!1}}function j(){var n;(n=P.value)==null||n.startNFTMintFlow()}function q({classId:n,nftMintCount:r}={}){M.value=n||"",m("submit",{classId:n||"",nftMintCount:r})}return d({startNFTMintFlow:j}),(n,r)=>{const D=ke,$=ot,Y=qe,e=Ge;return b(),k("div",lt,[t(N)?(b(),J(D,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${t(N)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:r[0]||(r[0]=u=>N.value="")},null,8,["title"])):K("",!0),i($,{"iscn-id":t(z),"iscn-owner":t(y),"iscn-data":t(s),"show-edit-button":!0,onEdit:r[1]||(r[1]=u=>T.value=!0)},null,8,["iscn-id","iscn-owner","iscn-data"]),i(Y,{ref_key:"liteMintNFTRef",ref:P,"iscn-data":t(s),"should-show-submit":!1,onFormValidChange:r[2]||(r[2]=u=>p.value=u),onSubmit:q},null,8,["iscn-data"]),i(e,{modelValue:t(T),"onUpdate:modelValue":r[3]||(r[3]=u=>ne(T)?T.value=u:null),"class-id":t(M)},null,8,["modelValue","class-id"])])}}}),rt={class:"w-full"},ut={class:"justify-evenly items-center flex space-x-4 relative"},ct={class:"text-sm font-semibold"},dt={class:"mt-6 p-4 border rounded-lg bg-gray-100 text-center flex flex-col gap-[24px]"},pt={key:0},mt={key:1},ft={key:2},_t={key:3},vt={class:"flex gap-2 justify-center mt-4"},bt={key:0,class:"flex flex-col justify-center px-[12px] mt-[16px]"},gt={class:"flex flex-col items-center gap-4 py-4"},yt={class:"flex flex-col items-center"},wt={key:0},It={class:"flex items-center"},ht={key:0,class:"flex flex-col items-center gap-2 w-full max-w-md"},qt=ee({__name:"index",setup(F){var se,oe;const{t:d}=Re(),_=re(),{wallet:h,signer:R}=ue(_),{initIfNecessary:x}=_,w=Me(),N=Ue(),g=De(),{showErrorToast:y}=pe(),s=o(0),M=o(),P=o(),z=o(),T=o(!1),p=o(""),m=o(""),C=o(((se=w.query.iscn_id)==null?void 0:se.toString())||""),U=o(((oe=w.query.class_id)==null?void 0:oe.toString())||""),j=o([]),q=o(""),n=o(!1),r=o(!1),D=o(!1),$=O(()=>!!m.value),Y=O(()=>{switch(s.value){case 0:return"Start Upload";case 1:return"Register ISCN";case 2:return"Mint NFT";default:return"Next"}}),e=O(()=>{var l;return((l=j.value)==null?void 0:l.length)>0}),u=O(()=>s.value===0?e.value:s.value<3),E=O(()=>s.value===0?q.value!=="":s.value===2?D.value:!1),I=[{title:d("publish_steps.upload_files"),description:"Upload your book file"},{title:d("publish_steps.register_iscn"),description:"Register ISCN"},{title:d("publish_steps.mint_nft"),description:"Mint NFT"},{title:d("publish_steps.new_book_publish"),description:"Publish new book"}];ce(()=>{var a;let l=null;try{const L=sessionStorage.getItem(Ee);L&&(l=JSON.parse(L))}catch(L){console.error(L)}C.value?(p.value=C.value,V({iscnId:C.value})):U.value?H({classId:U.value}):l!=null&&l.epubMetadata&&(l!=null&&l.fileRecords)&&(m.value=(a=l==null?void 0:l.epubMetadata)==null?void 0:a.title)});const B=async()=>{if((!h.value||!R.value)&&await x(),!h.value||!R.value){y("Please login first");return}try{if(s.value===0&&M.value){await M.value.onSubmit();return}if(s.value===1){if(!n.value){y("Please fill in all required fields");return}await P.value.onSubmit();return}if(s.value===2){if(!r.value){y("Please fill in all required fields");return}await z.value.startNFTMintFlow();return}s.value<I.length-1&&s.value++}catch(l){console.error("Error during form submission:",l)}},G=l=>{Ae(l),s.value=1},V=async l=>{const{iscnId:a}=l;a&&N.replace({query:{iscn_id:a}}),$e(),s.value=2,await le(),C.value=a},H=async l=>{const{classId:a,nftMintCount:L}=l;a&&(U.value=a,N.replace({query:{class_id:a,count:L}}),s.value=3,await le())},c=()=>{Oe(g({name:"nft-book-store"}))},te=async()=>{p.value&&await V({iscnId:p.value})};return(l,a)=>{const L=Le,fe=We,_e=st,ve=it,be=Ze,X=de,ge=me,ye=et;return b(),J(ye,{class:"flex flex-col items-stretch grow space-y-4"},{default:S(()=>[f("div",rt,[f("div",ut,[a[8]||(a[8]=f("div",{class:"absolute w-full h-[1px] bg-gray-300 top-[50%] left-0 z-[-1]"},null,-1)),(b(),k(Be,null,Ve(I,(v,Q)=>f("div",{key:Q,class:"flex items-center space-x-2 bg-white p-2 rounded-lg"},[i(L,{size:Q===t(s)?"lg":"md",text:(Q+1).toString(),ui:{background:Q===t(s)?"bg-primary-100":"bg-gray-200"}},null,8,["size","text","ui"]),f("p",ct,A(v.title),1)])),64))]),f("div",dt,[t(s)===0?(b(),k("div",pt,[i(fe,{ref_key:"uploadFormRef",ref:M,onFileUploadStatus:a[0]||(a[0]=v=>q.value=v),onFileReady:a[1]||(a[1]=v=>j.value=v),onSubmit:G},null,512)])):t(s)===1?(b(),k("div",mt,[i(_e,{ref_key:"registerISCN",ref:P,onFormValidChange:a[2]||(a[2]=v=>n.value=v),onSubmit:V},null,512)])):t(s)===2?(b(),k("div",ft,[i(ve,{ref_key:"mintNFT",ref:z,"iscn-id":t(C),onLoadingChange:a[3]||(a[3]=v=>D.value=v),onFormValidChange:a[4]||(a[4]=v=>r.value=v),onSubmit:H},null,8,["iscn-id"])])):t(s)===3?(b(),k("div",_t,[i(be,{ref:"newNFTBook",class:"p-0 flex flex-col text-left gap-[24px]","is-new-class-page":!0,"class-id":t(U),onSubmit:c},null,8,["class-id"])])):K("",!0),f("div",vt,[t(u)?(b(),J(X,{key:0,disabled:t(E),onClick:B},{default:S(()=>[W(A(t(Y)),1)]),_:1},8,["disabled"])):K("",!0)])]),t(s)===0?(b(),k("div",bt,[a[9]||(a[9]=f("div",{class:"w-full bg-gray-300 h-[1px]"},null,-1)),f("div",gt,[f("div",yt,[t($)?(b(),k("div",wt,[W(A(t(d)("publish_steps.continue_last_register"))+" ",1),i(X,{variant:"ghost",class:"text-primary-500 font-semibold",onClick:a[5]||(a[5]=v=>s.value=1)},{default:S(()=>[W(A(t(m)),1)]),_:1})])):K("",!0),f("div",It,[f("span",null,A(t(d)("publish_steps.already_have_iscn")),1),i(X,{variant:"ghost",onClick:a[6]||(a[6]=v=>T.value=!t(T))},{default:S(()=>[W(A(t(d)("publish_steps.here")),1)]),_:1})])]),t(T)?(b(),k("div",ht,[i(ge,{modelValue:t(p),"onUpdate:modelValue":a[7]||(a[7]=v=>ne(p)?p.value=v:null),placeholder:t(d)("publish_steps.enter_iscn_id")},null,8,["modelValue","placeholder"]),i(X,{disabled:!t(p),onClick:te},{default:S(()=>[W(A(t(d)("common.confirm")),1)]),_:1},8,["disabled"])])):K("",!0)])])):K("",!0)])]),_:1})}}});export{qt as default};
