import{_ as Ve}from"./DvNGBpwF.js";import{a_ as Se,a$ as Ne,bm as Re,b7 as Le,b6 as $e,b8 as u,ba as ae,b9 as y,bb as Ee,b1 as Me,b3 as P,aX as s,b4 as l,bq as Pe,aT as v,aW as t,bt as Ae,bf as g,bg as Te,aU as d,bA as je,aS as z,br as A,aV as se,be as Be,bi as H,bh as De,bj as Oe}from"./E33ysz1m.js";import{_ as ze}from"./NBdgEczf.js";import{_ as Fe}from"./ChZefAIF.js";import{_ as Ge}from"./B-LzDAq6.js";import{_ as qe}from"./DWdWc6G1.js";import{_ as Je}from"./-Bzcrlxe.js";import{_ as Qe}from"./BSo1iZqr.js";import{_ as We}from"./yvPh375K.js";import{_ as He}from"./DksFI6pR.js";import{_ as Ke}from"./DdCk2kKI.js";import{u as Xe}from"./4FWyaWIx.js";import"./CM09gukG.js";import"./DEn5Cskz.js";import"./BNLP0phw.js";import"./Cxrvdmvx.js";import"./CQnmrbGh.js";import"./bz-3DZyA.js";(function(){try{var C=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},c=new C.Error().stack;c&&(C._sentryDebugIds=C._sentryDebugIds||{},C._sentryDebugIds[c]="213a8a61-cdf6-43f1-9ab0-2843d0ed1663",C._sentryDebugIdIdentifier="sentry-dbid-213a8a61-cdf6-43f1-9ab0-2843d0ed1663")}catch{}})();const Ye={class:"flex items-center gap-2"},Ze=["textContent"],eo={class:"flex items-start gap-4"},oo=["src"],to={class:"flex flex-col justify-start"},no=["textContent"],lo={class:"text-center"},ao={class:"flex items-center gap-2 px-4 sm:px-6"},so={class:"flex items-center gap-2"},io={class:"flex justify-center items-center gap-4"},ro={class:"flex justify-center items-center gap-4"},uo={class:"flex items-center gap-2"},co={class:"flex justify-center gap-4"},Ro=Se({__name:"index",setup(C){const{t:c}=Ne(),K=Re(),F=Le(),{LIKER_LAND_URL:X}=$e().public,T=Xe(),{lazyFetchClassMetadataById:Y,lazyFetchClassListingInfoById:Z}=T,m=u([{id:0,value:""}]),ee=u(1),b=u(!1),I=u(""),k=u(""),w=u([]),p=u(""),U=u(""),f=u([]),x=u(!1),L=u(!1),V=u(!1);ae(x,o=>{o||(m.value=[{id:0,value:""}],ee.value=1)});const ie=y(()=>{const o=[{key:"name",label:c("common.name"),class:""}];return V.value&&o.push({key:"delete-action",label:"",class:"w-12"}),o}),de=y(()=>{const o=[];return G.value.length&&o.push([{label:V.value?"Exit Edit Items":"Edit Items",icon:V.value?"i-heroicons-pencil-solid":"i-heroicons-pencil",click:ve}]),o.push([{label:"New Coupon",icon:"i-heroicons-tag",click:()=>{b.value=!b.value}},{class:"text-red-500",label:"Clear All Coupons",icon:"i-heroicons-trash",iconClass:"text-red-500",disabled:!w.value.length,click:be}]),o}),G=y(()=>{var o;return(o=f.value)==null?void 0:o.map((e,i)=>{var a,j,$,B,D,O;return{classId:e.classId,name:(a=T.getClassMetadataById(e.classId))==null?void 0:a.name,prices:($=(j=T.getClassListingInfoById(e.classId))==null?void 0:j.prices)==null?void 0:$.map(h=>({...h})),image:Pe((O=(D=(B=T.getClassMetadataById(e.classId))==null?void 0:B.data)==null?void 0:D.metadata)==null?void 0:O.image),index:i}})}),S=u([]),N=y(()=>S.value.map(e=>f.value[e.index]).sort((e,i)=>(e==null?void 0:e.priceIndex)!==void 0&&!(i!=null&&i.priceIndex)?-1:!(e!=null&&e.priceIndex)&&(i==null?void 0:i.priceIndex)!==void 0?1:0));ae(G,o=>{o.length||(V.value=!1)});const R=y(()=>{const o=new URLSearchParams({utm_source:"direct-checkout",utm_medium:"pos"});return N.value.forEach(({classId:e,priceIndex:i,collectionId:a})=>{e&&o.append("class_id",e),i&&o.append("price_index",i.toString()),a&&o.append("collection_id",a)}),p.value&&o.append("coupon",p.value),`${X}/shopping-cart/book?${o.toString()}`}),re=y(()=>{const o=new URLSearchParams({gift_to_email:U.value,checkout:"1",utm_source:"direct-sales",utm_medium:"pos"});return N.value.forEach(({classId:e,priceIndex:i,collectionId:a})=>{e&&o.append("class_id",e),i&&o.append("price_index",i.toString()),a&&o.append("collection_id",a)}),p.value&&o.append("coupon",p.value),`${X}/shopping-cart/book?${o.toString()}`}),q=y(()=>"Liker Land Point Of Sale");Ee({title:()=>q.value,ogTitle:()=>q.value}),Me(()=>{try{const o=window.localStorage.getItem("nft_book_store_pos_items");if(o){const i=JSON.parse(o);f.value=i.map(a=>({classId:a.classId,priceIndex:a.priceIndex}))}const e=window.localStorage.getItem("nft_book_store_pos_coupons");if(e){const i=JSON.parse(e);w.value=i.map(a=>({name:a.name,code:a.code}))}}catch(o){console.error(o)}f.value.forEach(o=>{o.classId&&(Y(o.classId),Z(o.classId))})});function ue(){m.value.length&&m.value.push({id:ee.value++,value:""})}function ce(o){m.value.splice(o,1)}function me(o,e){m.value[o].error=void 0,m.value[o].value=e}function pe(){m.value.forEach(o=>{o.error=void 0;let e=o.value.trim();e.startsWith("http")&&(e=new URL(e).pathname.split("/").pop()||""),e.startsWith("0x")?(f.value.push({classId:e,priceIndex:0}),Y(e),Z(e)):o.error=new Error("Invalid product ID")}),m.value.every(o=>!o.error)&&(x.value=!1,J())}function fe(o,{index:e}){f.value[e].priceIndex=Number(o),J()}function _e({index:o}){f.value.splice(o,1),S.value=S.value.filter(e=>e.index!==o),J()}function oe(){x.value=!x.value}function ve(){V.value=!V.value}function ge(){w.value.push({name:I.value,code:k.value}),I.value="",k.value="",te(),F.add({title:"Added coupon",timeout:2e3,color:"green"}),b.value=!1}function be(){window.confirm("Are you sure you want to clear all coupons?")&&(w.value=[],p.value="",te(),F.add({title:"Cleared all coupons",timeout:2e3,color:"red"}))}function J(){window.localStorage.setItem("nft_book_store_pos_items",JSON.stringify(f.value))}function te(){window.localStorage.setItem("nft_book_store_pos_coupons",JSON.stringify(w.value))}function xe(){F.add({title:"Copied URL to clipboard",timeout:2e3}),navigator.clipboard.writeText(R.value)}function he(){window.open(R.value)}function ye(){L.value=!0}function Ce(){if(!U.value){alert("Please enter email");return}window.open(re.value)}return(o,e)=>{const i=Ve,a=Te,j=ze,$=Fe,B=je,D=Ge,O=Be,h=qe,E=Je,Ie=Qe,Q=De,ke=We,W=Ae,we=He,Ue=Ke;return v(),P(Ue,{key:l(K).path},{default:s(()=>[t(i,{title:l(q)},null,8,["title"]),t(we,{ui:{base:"flex flex-col items-stretch grow space-y-4",padding:"max-md:!px-0 max-md:py-0"}},{default:s(()=>[t(W,{ui:{base:"flex flex-col grow",rounded:"max-md:rounded-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"grow",padding:""},footer:{base:"sticky bottom-0 bg-white dark:bg-gray-900 rounded-b-[inherit]",padding:"px-0 sm:px-0 space-y-4"}}},{header:s(()=>[d("div",Ye,[d("h2",{class:"text-xl font-bold",textContent:se(l(c)("sales_pos.sales_items")+(l(N).length>0?l(c)("sales_pos.selected_count",{count:l(N).length}):""))},null,8,Ze),t(a,{icon:"i-heroicons-plus-circle",variant:"soft",onClick:oe})]),t(j,{items:l(de),popper:{placement:"bottom-end"}},{default:s(()=>[t(a,{color:"white",icon:"i-heroicons-ellipsis-horizontal-circle"})]),_:1},8,["items"])]),footer:s(()=>[d("div",ao,[t($,{modelValue:l(p),"onUpdate:modelValue":e[1]||(e[1]=n=>g(p)?p.value=n:null),class:"grow",options:l(w).map(n=>({label:n.name,value:n.code})),placeholder:"Select Coupon"},null,8,["modelValue","options"]),l(p)?(v(),P(a,{key:0,icon:"i-heroicons-x-mark-16-solid",size:"sm",color:"gray",variant:"outline",onClick:e[2]||(e[2]=()=>{p.value=""})})):A("",!0)]),t(O),t(ke,{class:"w-full",items:[{key:"direct",label:l(c)("sales_pos.direct_checkout")},{key:"gift",label:l(c)("sales_pos.gift_checkout")}],ui:{wrapper:"px-4 sm:px-6",base:"flex flex-col space-y-4"}},{item:s(({item:n})=>[n.key==="direct"?(v(),z(H,{key:0},[t(E,{label:l(c)("sales_pos.checkout_url")},{default:s(()=>[d("div",so,[t(h,{modelValue:l(R),"onUpdate:modelValue":e[3]||(e[3]=r=>g(R)?R.value=r:null),class:"grow font-mono",readonly:""},null,8,["modelValue"]),t(a,{icon:"i-heroicons-clipboard-document",variant:"soft",color:"gray",onClick:xe})])]),_:1},8,["label"]),d("div",io,[t(a,{label:"View Cart",size:"lg",onClick:he}),t(a,{label:"Generate QR Code",disabled:!l(N).length,size:"lg",onClick:ye},null,8,["disabled"]),t(Q,{modelValue:l(L),"onUpdate:modelValue":e[5]||(e[5]=r=>g(L)?L.value=r:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:s(()=>[t(Ie,{data:l(R),mode:"readonly","file-name":"likerland_checkout",width:280,height:280},{header:s(()=>[e[12]||(e[12]=d("h3",{class:"font-bold font-mono",textContent:"Scan to buy"},null,-1)),t(a,{icon:"i-heroicons-x-mark",color:"gray",variant:"ghost",onClick:e[4]||(e[4]=r=>L.value=!1)})]),_:1},8,["data"])]),_:1},8,["modelValue"])])],64)):n.key==="gift"?(v(),z(H,{key:1},[t(E,{label:l(c)("sales_pos.receiver_email")},{default:s(()=>[t(h,{modelValue:l(U),"onUpdate:modelValue":e[6]||(e[6]=r=>g(U)?U.value=r:null),type:"email",placeholder:"example@liker.land"},null,8,["modelValue"])]),_:1},8,["label"]),d("div",ro,[t(a,{label:"Send Gift",disabled:!l(N).length||!l(U),size:"lg",onClick:Ce},null,8,["disabled"])])],64)):A("",!0)]),_:1},8,["items"])]),default:s(()=>[t(D,{modelValue:l(S),"onUpdate:modelValue":e[0]||(e[0]=n=>g(S)?S.value=n:null),columns:l(ie),rows:l(G),ui:{wrapper:"static h-full",thead:"sticky top-0"}},{"name-data":s(({row:n})=>{var r,M;return[d("div",eo,[n.image?(v(),z("img",{key:0,class:"w-[64px] object-contain rounded-sm",src:n.image},null,8,oo)):A("",!0),d("div",to,[d("div",{class:"whitespace-break-spaces",textContent:se(n.name)},null,8,no),n.classId&&((r=n.prices)==null?void 0:r.length)>1?(v(),P($,{key:0,class:"mt-2","model-value":l(f)[n.index].priceIndex||0,options:(M=n.prices)==null?void 0:M.map(_=>{var ne,le;return{label:((ne=_.name)==null?void 0:ne.zh)||((le=_.name)==null?void 0:le.en)||_.name,value:_.index}}),"onUpdate:modelValue":_=>fe(_,n)},null,8,["model-value","options","onUpdate:modelValue"])):A("",!0)])])]}),"delete-action-header":s(()=>[d("div",lo,[t(B,{name:"i-heroicons-trash-solid"})])]),"delete-action-data":s(({row:n})=>[t(a,{icon:"i-heroicons-x-mark",color:"red",variant:"link",onClick:r=>_e(n)},null,8,["onClick"])]),_:1},8,["modelValue","columns","rows"])]),_:1}),t(Q,{modelValue:l(x),"onUpdate:modelValue":e[7]||(e[7]=n=>g(x)?x.value=n:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:s(()=>[t(W,{ui:{rounded:"max-sm:rounded-b-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"space-y-4"},footer:{base:"flex justify-center items-center"}}},{header:s(()=>[e[13]||(e[13]=d("h3",{class:"font-bold font-mono",textContent:"Add Item(s)"},null,-1)),t(a,{icon:"i-heroicons-x-mark",color:"gray",variant:"link",onClick:oe})]),footer:s(()=>[t(a,{label:"Confirm",onClick:pe})]),default:s(()=>[(v(!0),z(H,null,Oe(l(m),(n,r)=>{var M;return v(),P(E,{key:`input-${n.id}`,label:"Enter Product ID/URL(s)",required:!0,error:(M=n.error)==null?void 0:M.message},{default:s(()=>[d("div",uo,[t(h,{class:"grow font-mono","model-value":n.value,placeholder:"https://3ook.com/store/0x....","onUpdate:modelValue":_=>me(r,_)},null,8,["model-value","onUpdate:modelValue"]),l(m).length>1?(v(),P(a,{key:0,icon:"i-heroicons-x-circle",variant:"link",onClick:_=>ce(r)},null,8,["onClick"])):A("",!0)])]),_:2},1032,["error"])}),128)),d("div",co,[t(a,{icon:"i-heroicons-plus-circle",label:"Add",variant:"outline",onClick:ue})])]),_:1})]),_:1},8,["modelValue"]),t(Q,{modelValue:l(b),"onUpdate:modelValue":e[11]||(e[11]=n=>g(b)?b.value=n:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:s(()=>[t(W,{ui:{rounded:"max-sm:rounded-b-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"space-y-4"},footer:{base:"flex justify-end items-center gap-4"}}},{header:s(()=>[e[14]||(e[14]=d("h3",{class:"font-bold",textContent:"Add Coupon"},null,-1)),t(a,{icon:"i-heroicons-x-mark-16-solid",color:"gray",size:"xl",padded:!1,variant:"link",onClick:e[8]||(e[8]=n=>b.value=!1)})]),footer:s(()=>[t(a,{icon:"i-heroicons-plus-circle",label:"Add Coupon",disabled:!l(I)||!l(k),onClick:ge},null,8,["disabled"])]),default:s(()=>[t(E,{label:"Coupon Name",help:"For POS Display Only",required:!0},{default:s(()=>[t(h,{modelValue:l(I),"onUpdate:modelValue":e[9]||(e[9]=n=>g(I)?I.value=n:null),placeholder:"Fall Promotion"},null,8,["modelValue"])]),_:1}),t(E,{label:"Coupon Code",required:!0},{default:s(()=>[t(h,{modelValue:l(k),"onUpdate:modelValue":e[10]||(e[10]=n=>g(k)?k.value=n:null),class:"font-mono",placeholder:"FALLPROMO"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}});export{Ro as default};
