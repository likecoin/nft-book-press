import{_ as Re}from"./CFvwAYK7.js";import{a_ as Le,a$ as $e,bm as Ee,b7 as Me,b6 as Pe,bx as Be,b8 as c,ba as de,b9 as y,bb as Ae,b1 as De,b3 as P,aX as s,b4 as n,bq as re,aT as v,aW as t,bt as Te,bf as g,bg as je,aU as d,bD as Oe,aS as z,br as B,aV as ce,be as ze,bi as X,bh as Fe,bj as Ge}from"./DaZIWAWk.js";import{_ as qe}from"./DZrYRecG.js";import{_ as Je}from"./COx0FKOC.js";import{_ as Qe}from"./C1l9EIN-.js";import{_ as We}from"./zqqbkB1s.js";import{_ as He}from"./BwUoDNsX.js";import{_ as Ke}from"./C_XfnTsA.js";import{_ as Xe}from"./BYtaqiGm.js";import{_ as Ye}from"./DC-3WgAj.js";import{_ as Ze}from"./znR61J54.js";import{u as eo}from"./CNaYdJ-r.js";import"./C3qha4Uc.js";import"./DJyDHAFY.js";import"./DAaaT-58.js";import"./dCkR1Ibu.js";import"./Bd6R6kf0.js";import"./Bo9ayLW9.js";(function(){try{var C=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},u=new C.Error().stack;u&&(C._sentryDebugIds=C._sentryDebugIds||{},C._sentryDebugIds[u]="c4506a48-5d84-4d41-b83d-b8bfc04bef78",C._sentryDebugIdIdentifier="sentry-dbid-c4506a48-5d84-4d41-b83d-b8bfc04bef78")}catch{}})();const oo={class:"flex items-center gap-2"},to=["textContent"],lo={class:"flex items-start gap-4"},no=["src"],ao={class:"flex flex-col justify-start"},so=["textContent"],io={class:"text-center"},ro={class:"flex items-center gap-2 px-4 sm:px-6"},co={class:"flex items-center gap-2"},uo={class:"flex justify-center items-center gap-4"},mo={class:"flex justify-center items-center gap-4"},po={class:"flex items-center gap-2"},fo={class:"flex justify-center gap-4"},Eo=Le({__name:"index",setup(C){const{t:u}=$e(),Y=Ee(),F=Me(),{LIKER_LAND_URL:Z}=Pe().public,A=eo(),G=Be(),{lazyFetchClassMetadataById:ee,lazyFetchClassListingInfoById:oe}=A,{lazyFetchCollectionById:te}=G,m=c([{id:0,value:""}]),le=c(1),h=c(!1),k=c(""),w=c(""),U=c([]),p=c(""),V=c(""),f=c([]),I=c(!1),$=c(!1),S=c(!1);de(I,o=>{o||(m.value=[{id:0,value:""}],le.value=1)});const ue=y(()=>{const o=[{key:"name",label:u("common.name"),class:""}];return S.value&&o.push({key:"delete-action",label:"",class:"w-12"}),o}),me=y(()=>{const o=[];return q.value.length&&o.push([{label:S.value?"Exit Edit Items":"Edit Items",icon:S.value?"i-heroicons-pencil-solid":"i-heroicons-pencil",click:he}]),o.push([{label:"New Coupon",icon:"i-heroicons-tag",click:()=>{h.value=!h.value}},{class:"text-red-500",label:"Clear All Coupons",icon:"i-heroicons-trash",iconClass:"text-red-500",disabled:!U.value.length,click:ye}]),o}),q=y(()=>{var o;return(o=f.value)==null?void 0:o.map((e,i)=>{var a,D,E,T,j,O,b,x;return e.collectionId?{collectionId:e.collectionId,name:(a=G.getCollectionById(e.collectionId))==null?void 0:a.name,image:re((D=G.getCollectionById(e.collectionId))==null?void 0:D.image),index:i}:{classId:e.classId,name:(E=A.getClassMetadataById(e.classId))==null?void 0:E.name,prices:(j=(T=A.getClassListingInfoById(e.classId))==null?void 0:T.prices)==null?void 0:j.map(W=>({...W})),image:re((x=(b=(O=A.getClassMetadataById(e.classId))==null?void 0:O.data)==null?void 0:b.metadata)==null?void 0:x.image),index:i}})}),N=c([]),R=y(()=>N.value.map(e=>f.value[e.index]).sort((e,i)=>(e==null?void 0:e.priceIndex)!==void 0&&!(i!=null&&i.priceIndex)?-1:!(e!=null&&e.priceIndex)&&(i==null?void 0:i.priceIndex)!==void 0?1:0));de(q,o=>{o.length||(S.value=!1)});const L=y(()=>{const o=new URLSearchParams({utm_source:"direct-checkout",utm_medium:"pos"});return R.value.forEach(({classId:e,priceIndex:i,collectionId:a})=>{e&&o.append("class_id",e),i&&o.append("price_index",i.toString()),a&&o.append("collection_id",a)}),p.value&&o.append("coupon",p.value),`${Z}/shopping-cart/book?${o.toString()}`}),pe=y(()=>{const o=new URLSearchParams({gift_to_email:V.value,checkout:"1",utm_source:"direct-sales",utm_medium:"pos"});return R.value.forEach(({classId:e,priceIndex:i,collectionId:a})=>{e&&o.append("class_id",e),i&&o.append("price_index",i.toString()),a&&o.append("collection_id",a)}),p.value&&o.append("coupon",p.value),`${Z}/shopping-cart/book?${o.toString()}`}),J=y(()=>"Liker Land Point Of Sale");Ae({title:()=>J.value,ogTitle:()=>J.value}),De(()=>{try{const o=window.localStorage.getItem("nft_book_store_pos_items");if(o){const i=JSON.parse(o);f.value=i.map(a=>({collectionId:a.collectionId,classId:a.classId,priceIndex:a.priceIndex}))}const e=window.localStorage.getItem("nft_book_store_pos_coupons");if(e){const i=JSON.parse(e);U.value=i.map(a=>({name:a.name,code:a.code}))}}catch(o){console.error(o)}f.value.forEach(o=>{o.classId&&(ee(o.classId),oe(o.classId)),o.collectionId&&te(o.collectionId)})});function fe(){m.value.length&&m.value.push({id:le.value++,value:""})}function _e(o){m.value.splice(o,1)}function ve(o,e){m.value[o].error=void 0,m.value[o].value=e}function ge(){m.value.forEach(o=>{o.error=void 0;let e=o.value.trim();e.startsWith("http")&&(e=new URL(e).pathname.split("/").pop()||""),e.startsWith("0x")?(f.value.push({classId:e,priceIndex:0}),ee(e),oe(e)):e.startsWith("col_book_")?(f.value.push({collectionId:e}),te(e)):o.error=new Error("Invalid product ID")}),m.value.every(o=>!o.error)&&(I.value=!1,Q())}function be(o,{index:e}){f.value[e].priceIndex=Number(o),Q()}function xe({index:o}){f.value.splice(o,1),N.value=N.value.filter(e=>e.index!==o),Q()}function ne(){I.value=!I.value}function he(){S.value=!S.value}function Ie(){U.value.push({name:k.value,code:w.value}),k.value="",w.value="",ae(),F.add({title:"Added coupon",timeout:2e3,color:"green"}),h.value=!1}function ye(){window.confirm("Are you sure you want to clear all coupons?")&&(U.value=[],p.value="",ae(),F.add({title:"Cleared all coupons",timeout:2e3,color:"red"}))}function Q(){window.localStorage.setItem("nft_book_store_pos_items",JSON.stringify(f.value))}function ae(){window.localStorage.setItem("nft_book_store_pos_coupons",JSON.stringify(U.value))}function Ce(){F.add({title:"Copied URL to clipboard",timeout:2e3}),navigator.clipboard.writeText(L.value)}function ke(){window.open(L.value)}function we(){$.value=!0}function Ue(){if(!V.value){alert("Please enter email");return}window.open(pe.value)}return(o,e)=>{const i=Re,a=je,D=qe,E=Je,T=Oe,j=Qe,O=ze,b=We,x=He,W=Ke,H=Fe,Ve=Xe,K=Te,Se=Ye,Ne=Ze;return v(),P(Ne,{key:n(Y).path},{default:s(()=>[t(i,{title:n(J)},null,8,["title"]),t(Se,{ui:{base:"flex flex-col items-stretch grow space-y-4",padding:"max-md:!px-0 max-md:py-0"}},{default:s(()=>[t(K,{ui:{base:"flex flex-col grow",rounded:"max-md:rounded-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"grow",padding:""},footer:{base:"sticky bottom-0 bg-white dark:bg-gray-900 rounded-b-[inherit]",padding:"px-0 sm:px-0 space-y-4"}}},{header:s(()=>[d("div",oo,[d("h2",{class:"text-xl font-bold",textContent:ce(n(u)("sales_pos.sales_items")+(n(R).length>0?n(u)("sales_pos.selected_count",{count:n(R).length}):""))},null,8,to),t(a,{icon:"i-heroicons-plus-circle",variant:"soft",onClick:ne})]),t(D,{items:n(me),popper:{placement:"bottom-end"}},{default:s(()=>[t(a,{color:"white",icon:"i-heroicons-ellipsis-horizontal-circle"})]),_:1},8,["items"])]),footer:s(()=>[d("div",ro,[t(E,{modelValue:n(p),"onUpdate:modelValue":e[1]||(e[1]=l=>g(p)?p.value=l:null),class:"grow",options:n(U).map(l=>({label:l.name,value:l.code})),placeholder:"Select Coupon"},null,8,["modelValue","options"]),n(p)?(v(),P(a,{key:0,icon:"i-heroicons-x-mark-16-solid",size:"sm",color:"gray",variant:"outline",onClick:e[2]||(e[2]=()=>{p.value=""})})):B("",!0)]),t(O),t(Ve,{class:"w-full",items:[{key:"direct",label:n(u)("sales_pos.direct_checkout")},{key:"gift",label:n(u)("sales_pos.gift_checkout")}],ui:{wrapper:"px-4 sm:px-6",base:"flex flex-col space-y-4"}},{item:s(({item:l})=>[l.key==="direct"?(v(),z(X,{key:0},[t(x,{label:n(u)("sales_pos.checkout_url")},{default:s(()=>[d("div",co,[t(b,{modelValue:n(L),"onUpdate:modelValue":e[3]||(e[3]=r=>g(L)?L.value=r:null),class:"grow font-mono",readonly:""},null,8,["modelValue"]),t(a,{icon:"i-heroicons-clipboard-document",variant:"soft",color:"gray",onClick:Ce})])]),_:1},8,["label"]),d("div",uo,[t(a,{label:"View Cart",size:"lg",onClick:ke}),t(a,{label:"Generate QR Code",disabled:!n(R).length,size:"lg",onClick:we},null,8,["disabled"]),t(H,{modelValue:n($),"onUpdate:modelValue":e[5]||(e[5]=r=>g($)?$.value=r:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:s(()=>[t(W,{data:n(L),mode:"readonly","file-name":"likerland_checkout",width:280,height:280},{header:s(()=>[e[12]||(e[12]=d("h3",{class:"font-bold font-mono",textContent:"Scan to buy"},null,-1)),t(a,{icon:"i-heroicons-x-mark",color:"gray",variant:"ghost",onClick:e[4]||(e[4]=r=>$.value=!1)})]),_:1},8,["data"])]),_:1},8,["modelValue"])])],64)):l.key==="gift"?(v(),z(X,{key:1},[t(x,{label:n(u)("sales_pos.receiver_email")},{default:s(()=>[t(b,{modelValue:n(V),"onUpdate:modelValue":e[6]||(e[6]=r=>g(V)?V.value=r:null),type:"email",placeholder:"example@liker.land"},null,8,["modelValue"])]),_:1},8,["label"]),d("div",mo,[t(a,{label:"Send Gift",disabled:!n(R).length||!n(V),size:"lg",onClick:Ue},null,8,["disabled"])])],64)):B("",!0)]),_:1},8,["items"])]),default:s(()=>[t(j,{modelValue:n(N),"onUpdate:modelValue":e[0]||(e[0]=l=>g(N)?N.value=l:null),columns:n(ue),rows:n(q),ui:{wrapper:"static h-full",thead:"sticky top-0"}},{"name-data":s(({row:l})=>{var r,M;return[d("div",lo,[l.image?(v(),z("img",{key:0,class:"w-[64px] object-contain rounded-sm",src:l.image},null,8,no)):B("",!0),d("div",ao,[d("div",{class:"whitespace-break-spaces",textContent:ce(l.name)},null,8,so),l.classId&&((r=l.prices)==null?void 0:r.length)>1?(v(),P(E,{key:0,class:"mt-2","model-value":n(f)[l.index].priceIndex||0,options:(M=l.prices)==null?void 0:M.map(_=>{var se,ie;return{label:((se=_.name)==null?void 0:se.zh)||((ie=_.name)==null?void 0:ie.en)||_.name,value:_.index}}),"onUpdate:modelValue":_=>be(_,l)},null,8,["model-value","options","onUpdate:modelValue"])):B("",!0)])])]}),"delete-action-header":s(()=>[d("div",io,[t(T,{name:"i-heroicons-trash-solid"})])]),"delete-action-data":s(({row:l})=>[t(a,{icon:"i-heroicons-x-mark",color:"red",variant:"link",onClick:r=>xe(l)},null,8,["onClick"])]),_:1},8,["modelValue","columns","rows"])]),_:1}),t(H,{modelValue:n(I),"onUpdate:modelValue":e[7]||(e[7]=l=>g(I)?I.value=l:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:s(()=>[t(K,{ui:{rounded:"max-sm:rounded-b-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"space-y-4"},footer:{base:"flex justify-center items-center"}}},{header:s(()=>[e[13]||(e[13]=d("h3",{class:"font-bold font-mono",textContent:"Add Item(s)"},null,-1)),t(a,{icon:"i-heroicons-x-mark",color:"gray",variant:"link",onClick:ne})]),footer:s(()=>[t(a,{label:"Confirm",onClick:ge})]),default:s(()=>[(v(!0),z(X,null,Ge(n(m),(l,r)=>{var M;return v(),P(x,{key:`input-${l.id}`,label:"Enter Product ID/URL(s)",required:!0,error:(M=l.error)==null?void 0:M.message},{default:s(()=>[d("div",po,[t(b,{class:"grow font-mono","model-value":l.value,placeholder:"https://3ook.com/store/0x....","onUpdate:modelValue":_=>ve(r,_)},null,8,["model-value","onUpdate:modelValue"]),n(m).length>1?(v(),P(a,{key:0,icon:"i-heroicons-x-circle",variant:"link",onClick:_=>_e(r)},null,8,["onClick"])):B("",!0)])]),_:2},1032,["error"])}),128)),d("div",fo,[t(a,{icon:"i-heroicons-plus-circle",label:"Add",variant:"outline",onClick:fe})])]),_:1})]),_:1},8,["modelValue"]),t(H,{modelValue:n(h),"onUpdate:modelValue":e[11]||(e[11]=l=>g(h)?h.value=l:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:s(()=>[t(K,{ui:{rounded:"max-sm:rounded-b-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"space-y-4"},footer:{base:"flex justify-end items-center gap-4"}}},{header:s(()=>[e[14]||(e[14]=d("h3",{class:"font-bold",textContent:"Add Coupon"},null,-1)),t(a,{icon:"i-heroicons-x-mark-16-solid",color:"gray",size:"xl",padded:!1,variant:"link",onClick:e[8]||(e[8]=l=>h.value=!1)})]),footer:s(()=>[t(a,{icon:"i-heroicons-plus-circle",label:"Add Coupon",disabled:!n(k)||!n(w),onClick:Ie},null,8,["disabled"])]),default:s(()=>[t(x,{label:"Coupon Name",help:"For POS Display Only",required:!0},{default:s(()=>[t(b,{modelValue:n(k),"onUpdate:modelValue":e[9]||(e[9]=l=>g(k)?k.value=l:null),placeholder:"Fall Promotion"},null,8,["modelValue"])]),_:1}),t(x,{label:"Coupon Code",required:!0},{default:s(()=>[t(b,{modelValue:n(w),"onUpdate:modelValue":e[10]||(e[10]=l=>g(w)?w.value=l:null),class:"font-mono",placeholder:"FALLPROMO"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}});export{Eo as default};
