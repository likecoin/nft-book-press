import{a as O,s as N,b as L,m as R,r as u,w as D,q as V,o as h,f as p,j as e,t as i,u as t,h as w,i as $,v as T,k as C}from"./entry.712e2c55.js";import{u as E}from"./fetch.50084ecf.js";import{g as H,f as M,h as P}from"./cosmos.6203a0f1.js";import{L as F}from"./index.4e4f5e4e.js";import{u as W}from"./book-store-api.a1910588.js";import{u as q}from"./wallet.47d7c9b9.js";const z={key:0,style:{color:"red"}},U={key:1,style:{color:"green"}},X=e("hr",null,null,-1),j={key:2},J=e("tr",null,[e("td",null,"email"),e("td",null,"status"),e("td",null,"wallet"),e("td",null,"buyer message"),e("td",null,"sales channel")],-1),K=e("hr",null,null,-1),Z=e("p",null,[e("label",null,"Enter Author's Message (optional)")],-1),G=e("p",null,[e("label",null,"Enter NFT ID (optional)")],-1),Q=["disabled"],se=O({__name:"[classId]",setup(Y){const S=q(),{wallet:c,signer:g}=N(S),{connect:B}=S,y=W(),{token:k}=N(y),b=L(),x=R(),d=u(""),v=u(!1),o=u(b.params.classId),I=u(b.query.payment_id),f=u(""),n=u(""),s=u({});D(v,a=>{a&&(d.value="")}),V(async()=>{const{data:a,error:l}=await E(`${F}/likernft/book/purchase/${o.value}/status/${I.value}`,{headers:{authorization:`Bearer ${k.value}`}},"$FPZ0aoE4bl");l.value&&(l.value.statusCode===403?d.value="NOT_OWNER_OF_NFT_CLASS":d.value=l.value.toString()),s.value=a.value});async function A(){try{if(v.value=!0,(!c.value||!g.value)&&await B(),!c.value||!g.value)return;let a="";if(n.value){const{owner:r}=await H(o.value,n.value);if(r!==c.value)throw new Error(`NFT classId: ${o} nftId:${n} is not owned by sender!`);a=n.value}else{const{nfts:r}=await M({classId:o.value,owner:c.value,needCount:1});if(!r.length)throw new Error(`Sender does not own any class id: ${o.value} `);a=r[0].id}const l=await P(g.value);if(!l.getSigningStargateClient())throw new Error("Signing client not exists");const _=await l.sendNFTs(c.value,s.value.wallet,o.value,[a],{memo:f.value});if(_.transactionHash&&_.code===0){const{error:r}=await E(`${F}/likernft/book/purchase/${o.value}/sent/${I.value}`,{method:"POST",body:{txHash:_.transactionHash},headers:{authorization:`Bearer ${k.value}`}},"$lJuXXCdpwa");if(r.value)throw r.value;x.push({name:"nft-book-store-status-classId",params:{classId:o.value}})}}catch(a){console.error(a),d.value=a.toString()}finally{v.value=!1}}return(a,l)=>(h(),p("div",null,[e("h1",null,"Deliver NFT Book "+i(t(o)),1),t(d)?(h(),p("div",z,i(t(d)),1)):w("",!0),t(v)?(h(),p("div",U," Loading... ")):w("",!0),X,t(y).isAuthenticated?(h(),p("section",j,[e("table",null,[J,e("tr",null,[e("td",null,i(t(s).email),1),e("td",null,i(t(s).status),1),e("td",null,i(t(s).wallet),1),e("td",null,i(t(s).message),1),e("td",null,i(t(s).from),1)])]),K,Z,$(e("input",{"onUpdate:modelValue":l[0]||(l[0]=m=>C(f)?f.value=m:null),placeholder:"default memo"},null,512),[[T,t(f)]]),G,$(e("input",{"onUpdate:modelValue":l[1]||(l[1]=m=>C(n)?n.value=m:null),placeholder:"default memo"},null,512),[[T,t(n)]]),e("button",{disabled:t(v),style:{"margin-top":"16px"},onClick:A}," Sign and Send ",8,Q)])):w("",!0)]))}});export{se as default};
