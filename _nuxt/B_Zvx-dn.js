import{_ as Ie}from"./DY4_1x7Q.js";import{a_ as ye,a$ as Ce,bk as ke,bt as we,b7 as Ue,b9 as c,bb as X,ba as U,bh as Ve,b1 as Se,b3 as S,aT as f,aX as a,b4 as n,aW as t,bA as Ne,bd as b,bq as $e,aU as r,bX as Me,aS as E,bi as N,aV as H,bx as Re,bw as Oe,bv as Be,be as Pe,bp as K,bo as Ae,bF as Le}from"./B9KV3Ijx.js";import{_ as Te}from"./DKF_sCqJ.js";import{_ as je}from"./DxTGh4Sf.js";import{_ as Ee}from"./BqPBRM10.js";import{_ as De}from"./C_Z1gxAZ.js";import{_ as Fe}from"./CW5xfJ3j.js";import{_ as ze}from"./BGd7RjVW.js";import{_ as qe}from"./BUbz0LnP.js";import{a as Je}from"./BSVciC6n.js";import"./QEg1gtkY.js";import"./4oxi0Lpu.js";import"./Dq01mTLe.js";import"./DPomPntw.js";import"./BEpUvBgA.js";import"./Bs0s6h6b.js";import"./CWEVCHYG.js";(function(){try{var x=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},u=new x.Error().stack;u&&(x._sentryDebugIds=x._sentryDebugIds||{},x._sentryDebugIds[u]="d0ab1e0b-906f-4ba4-af9c-b04cfb0537b0",x._sentryDebugIdIdentifier="sentry-dbid-d0ab1e0b-906f-4ba4-af9c-b04cfb0537b0")}catch{}})();const Qe={class:"flex items-center gap-2"},We=["textContent"],Ge={class:"flex items-start gap-4"},Xe=["src"],He={class:"flex flex-col justify-start"},Ke=["textContent"],Ye={class:"text-center"},Ze={class:"flex items-center gap-2 px-4 sm:px-6"},eo={class:"flex items-center gap-2"},oo={class:"flex justify-center items-center gap-4"},to={class:"flex items-center gap-2"},no={class:"flex justify-center gap-4"},yo=ye({__name:"index",setup(x){const{t:u}=Ce(),D=ke(),B=we(),{BOOK3_URL:Y}=Ue().public,$=Je(),{lazyFetchClassMetadataById:F,lazyFetchClassListingInfoById:z}=$,m=c([{id:0,value:""}]),q=c(1),v=c(!1),h=c(""),I=c(""),y=c([]),_=c(""),p=c([]),g=c(!1),V=c(!1),C=c(!1);X(g,o=>{o||(m.value=[{id:0,value:""}],q.value=1)});const Z=U(()=>{const o=[{key:"name",label:u("common.name"),class:""}];return C.value&&o.push({key:"delete-action",label:"",class:"w-12"}),o}),ee=U(()=>{const o=[];return P.value.length&&o.push([{label:C.value?"Exit Edit Items":"Edit Items",icon:C.value?"i-heroicons-pencil-solid":"i-heroicons-pencil",click:ie}]),o.push([{label:"New Coupon",icon:"i-heroicons-tag",click:()=>{v.value=!v.value}},{class:"text-red-500",label:"Clear All Coupons",icon:"i-heroicons-trash",iconClass:"text-red-500",disabled:!y.value.length,click:re}]),o}),P=U(()=>p.value?.map((o,e)=>({classId:o.classId,name:$.getClassMetadataById(o.classId)?.name,prices:$.getClassListingInfoById(o.classId)?.prices?.map(i=>({...i})),image:Le($.getClassMetadataById(o.classId)?.data?.metadata?.image),index:e}))),k=c([]),M=U(()=>k.value.map(e=>p.value[e.index]).sort((e,i)=>e?.priceIndex!==void 0&&!i?.priceIndex?-1:!e?.priceIndex&&i?.priceIndex!==void 0?1:0));X(P,o=>{o.length||(C.value=!1)});const w=U(()=>{const o=new URLSearchParams({utm_source:"direct-checkout",utm_medium:"pos"}),e=M.value.map(({classId:i,priceIndex:s})=>`${i}${s?`:${s}`:""}`).join(",");return o.append("products",e),_.value&&o.append("coupon",_.value),`${Y}/checkout?${o.toString()}`}),A=U(()=>"3ook Point Of Sale");Ve({title:()=>A.value,ogTitle:()=>A.value}),Se(()=>{try{const o=window.localStorage.getItem("nft_book_store_pos_items");if(o){const i=JSON.parse(o);p.value=i.map(s=>({classId:s.classId,priceIndex:s.priceIndex}))}const e=window.localStorage.getItem("nft_book_store_pos_coupons");if(e){const i=JSON.parse(e);y.value=i.map(s=>({name:s.name,code:s.code}))}}catch(o){console.error(o)}p.value.forEach(o=>{o.classId&&(F(o.classId),z(o.classId))})});function oe(){m.value.length&&m.value.push({id:q.value++,value:""})}function te(o){m.value.splice(o,1)}function ne(o,e){const i=m.value[o];i&&(i.error=void 0,i.value=e)}function le(){m.value.forEach(o=>{o.error=void 0;let e=o.value.trim();e.startsWith("http")&&(e=new URL(e).pathname.split("/").pop()||""),e.startsWith("0x")?(p.value.push({classId:e,priceIndex:0}),F(e),z(e)):o.error=new Error("Invalid product ID")}),m.value.every(o=>!o.error)&&(g.value=!1,L())}function ae(o,{index:e}){p.value[e].priceIndex=Number(o),L()}function se({index:o}){p.value.splice(o,1),k.value=k.value.filter(e=>e.index!==o),L()}function J(){g.value=!g.value}function ie(){C.value=!C.value}function de(){y.value.push({name:h.value,code:I.value}),h.value="",I.value="",Q(),B.add({title:"Added coupon",timeout:2e3,color:"green"}),v.value=!1}function re(){window.confirm("Are you sure you want to clear all coupons?")&&(y.value=[],_.value="",Q(),B.add({title:"Cleared all coupons",timeout:2e3,color:"red"}))}function L(){window.localStorage.setItem("nft_book_store_pos_items",JSON.stringify(p.value))}function Q(){window.localStorage.setItem("nft_book_store_pos_coupons",JSON.stringify(y.value))}function ue(){B.add({title:"Copied URL to clipboard",timeout:2e3}),navigator.clipboard.writeText(w.value)}function ce(){window.open(w.value)}function me(){V.value=!0}return(o,e)=>{const i=Ie,s=$e,pe=Te,W=je,_e=Me,fe=Ee,be=Re,R=Be,O=Oe,ve=De,T=Pe,ge=Fe,j=Ne,xe=ze,he=qe;return f(),S(he,{key:n(D).path},{default:a(()=>[t(i,{title:n(A)},null,8,["title"]),t(xe,{ui:{base:"flex flex-col items-stretch grow space-y-4",padding:"max-md:!px-0 max-md:py-0"}},{default:a(()=>[t(j,{ui:{base:"flex flex-col grow",rounded:"max-md:rounded-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"grow",padding:""},footer:{base:"sticky bottom-0 bg-white dark:bg-gray-900 rounded-b-[inherit]",padding:"px-0 sm:px-0 space-y-4"}}},{header:a(()=>[r("div",Qe,[r("h2",{class:"text-xl font-bold",textContent:H(n(u)("sales_pos.sales_items")+(n(M).length>0?n(u)("sales_pos.selected_count",{count:n(M).length}):""))},null,8,We),t(s,{icon:"i-heroicons-plus-circle",variant:"soft",onClick:J})]),t(pe,{items:n(ee),popper:{placement:"bottom-end"}},{default:a(()=>[t(s,{color:"white",icon:"i-heroicons-ellipsis-horizontal-circle"})]),_:1},8,["items"])]),footer:a(()=>[r("div",Ze,[t(W,{modelValue:n(_),"onUpdate:modelValue":e[1]||(e[1]=l=>b(_)?_.value=l:null),class:"grow",options:n(y).map(l=>({label:l.name,value:l.code})),placeholder:n(u)("sales_pos.select_coupon")},null,8,["modelValue","options","placeholder"]),n(_)?(f(),S(s,{key:0,icon:"i-heroicons-x-mark-16-solid",size:"sm",color:"gray",variant:"outline",onClick:e[2]||(e[2]=()=>{_.value=""})})):N("",!0)]),t(be),t(ge,{class:"w-full",items:[{key:"direct",label:n(u)("sales_pos.direct_checkout")}],ui:{wrapper:"px-4 sm:px-6",base:"flex flex-col space-y-4"}},{item:a(({item:l})=>[l.key==="direct"?(f(),E(K,{key:0},[t(O,{label:n(u)("sales_pos.checkout_url")},{default:a(()=>[r("div",eo,[t(R,{modelValue:n(w),"onUpdate:modelValue":e[3]||(e[3]=d=>b(w)?w.value=d:null),class:"grow font-mono",readonly:""},null,8,["modelValue"]),t(s,{icon:"i-heroicons-clipboard-document",variant:"soft",color:"gray",onClick:ue})])]),_:1},8,["label"]),r("div",oo,[t(s,{label:n(u)("sales_pos.view_cart"),size:"lg",onClick:ce},null,8,["label"]),t(s,{label:n(u)("sales_pos.generate_qr_code"),disabled:!n(M).length,size:"lg",onClick:me},null,8,["label","disabled"]),t(T,{modelValue:n(V),"onUpdate:modelValue":e[5]||(e[5]=d=>b(V)?V.value=d:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:a(()=>[t(ve,{data:n(w),mode:"readonly","file-name":"likerland_checkout",width:280,height:280},{header:a(()=>[e[11]||(e[11]=r("h3",{class:"font-bold font-mono",textContent:"Scan to buy"},null,-1)),t(s,{icon:"i-heroicons-x-mark",color:"gray",variant:"ghost",onClick:e[4]||(e[4]=d=>V.value=!1)})]),_:1},8,["data"])]),_:1},8,["modelValue"])])],64)):N("",!0)]),_:1},8,["items"])]),default:a(()=>[t(fe,{modelValue:n(k),"onUpdate:modelValue":e[0]||(e[0]=l=>b(k)?k.value=l:null),columns:n(Z),rows:n(P),ui:{wrapper:"static h-full",thead:"sticky top-0"}},{"name-data":a(({row:l})=>[r("div",Ge,[l.image?(f(),E("img",{key:0,class:"w-[64px] object-contain rounded-sm",src:l.image,alt:"Item image"},null,8,Xe)):N("",!0),r("div",He,[r("div",{class:"whitespace-break-spaces",textContent:H(l.name)},null,8,Ke),l.classId&&l.prices?.length>1?(f(),S(W,{key:0,class:"mt-2","model-value":n(p)[l.index].priceIndex||0,options:l.prices?.map(d=>({label:d.name?.zh||d.name?.en||d.name,value:d.index})),"onUpdate:modelValue":d=>ae(d,l)},null,8,["model-value","options","onUpdate:modelValue"])):N("",!0)])])]),"delete-action-header":a(()=>[r("div",Ye,[t(_e,{name:"i-heroicons-trash-solid"})])]),"delete-action-data":a(({row:l})=>[t(s,{icon:"i-heroicons-x-mark",color:"red",variant:"link",onClick:d=>se(l)},null,8,["onClick"])]),_:1},8,["modelValue","columns","rows"])]),_:1}),t(T,{modelValue:n(g),"onUpdate:modelValue":e[6]||(e[6]=l=>b(g)?g.value=l:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:a(()=>[t(j,{ui:{rounded:"max-sm:rounded-b-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"space-y-4"},footer:{base:"flex justify-center items-center"}}},{header:a(()=>[e[12]||(e[12]=r("h3",{class:"font-bold font-mono",textContent:"Add Item(s)"},null,-1)),t(s,{icon:"i-heroicons-x-mark",color:"gray",variant:"link",onClick:J})]),footer:a(()=>[t(s,{label:"Confirm",onClick:le})]),default:a(()=>[(f(!0),E(K,null,Ae(n(m),(l,d)=>(f(),S(O,{key:`input-${l.id}`,label:n(u)("sales_pos.enter_product_id_urls"),required:!0,error:l.error?.message},{default:a(()=>[r("div",to,[t(R,{class:"grow font-mono","model-value":l.value,placeholder:"https://3ook.com/store/0x....","onUpdate:modelValue":G=>ne(d,G)},null,8,["model-value","onUpdate:modelValue"]),n(m).length>1?(f(),S(s,{key:0,icon:"i-heroicons-x-circle",variant:"link",onClick:G=>te(d)},null,8,["onClick"])):N("",!0)])]),_:2},1032,["label","error"]))),128)),r("div",no,[t(s,{icon:"i-heroicons-plus-circle",label:n(u)("sales_pos.add"),variant:"outline",onClick:oe},null,8,["label"])])]),_:1})]),_:1},8,["modelValue"]),t(T,{modelValue:n(v),"onUpdate:modelValue":e[10]||(e[10]=l=>b(v)?v.value=l:null),ui:{padding:"p-0",rounded:"max-sm:rounded-b-none"}},{default:a(()=>[t(j,{ui:{rounded:"max-sm:rounded-b-none",header:{base:"flex justify-between items-center gap-4"},body:{base:"space-y-4"},footer:{base:"flex justify-end items-center gap-4"}}},{header:a(()=>[e[13]||(e[13]=r("h3",{class:"font-bold",textContent:"Add Coupon"},null,-1)),t(s,{icon:"i-heroicons-x-mark-16-solid",color:"gray",size:"xl",padded:!1,variant:"link",onClick:e[7]||(e[7]=l=>v.value=!1)})]),footer:a(()=>[t(s,{icon:"i-heroicons-plus-circle",label:"Add Coupon",disabled:!n(h)||!n(I),onClick:de},null,8,["disabled"])]),default:a(()=>[t(O,{label:"Coupon Name",help:"For POS Display Only",required:!0},{default:a(()=>[t(R,{modelValue:n(h),"onUpdate:modelValue":e[8]||(e[8]=l=>b(h)?h.value=l:null),placeholder:"Fall Promotion"},null,8,["modelValue"])]),_:1}),t(O,{label:"Coupon Code",required:!0},{default:a(()=>[t(R,{modelValue:n(I),"onUpdate:modelValue":e[9]||(e[9]=l=>b(I)?I.value=l:null),class:"font-mono",placeholder:"FALLPROMO"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})}}});export{yo as default};
