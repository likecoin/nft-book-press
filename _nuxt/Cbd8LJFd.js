import{_ as M}from"./Dv1ldGFY.js";import{_ as Q}from"./D18XSE06.js";import{_ as X}from"./DHygA2y8.js";import{_ as Y}from"./BR5D-kfy.js";import{a_ as J,a$ as Z,b7 as tt,bm as et,b0 as ot,b8 as h,b9 as R,bb as at,b1 as nt,b3 as g,aX as s,aT as w,aW as a,b4 as e,br as T,aU as S,bf as x,bt as lt,be as rt,bg as st,aY as B,aV as V,bG as it,bH as ct,b2 as ut}from"./txgQZPFG.js";import{_ as _t}from"./Sk9OM3Cd.js";import{_ as dt}from"./BKEwjpUf.js";import{_ as mt}from"./CinJpKqV.js";import{_ as bt}from"./DEQL_L_k.js";import{p as ht}from"./CUxdmJDi.js";import"./Dy8zRKt0.js";import"./BRPZAmvh.js";import"./CLRraj03.js";(function(){try{var d=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new d.Error().stack;o&&(d._sentryDebugIds=d._sentryDebugIds||{},d._sentryDebugIds[o]="6323a3ab-d16a-499a-929f-56ad13089b5c",d._sentryDebugIdIdentifier="sentry-dbid-6323a3ab-d16a-499a-929f-56ad13089b5c")}catch{}})();const pt={class:"flex justify-center"},ft={class:"font-bold font-mono"},kt={class:"flex items-center gap-2"},U="key,url",Bt=J({__name:"batch-short-links",setup(d){const{t:o}=Z(),p=tt(),I=et(),$=ot(),D=[{label:"Bitly",value:"bitly"},{label:"Short.io",value:"shortio"}],m=h(I.query.provider||"bitly"),L=R(()=>m.value==="shortio"),f=h(""),k=h(I.query.title_prefix||o("batch_short_links.default_title_prefix")),c=h(""),P=`${U}
example01,https://example01.com,
example02,https://example02.com,`,b=h(""),q=R(()=>{switch(m.value){case"bitly":return o("batch_short_links.bitly_token");case"shortio":return o("batch_short_links.shortio_api_key");default:return""}}),y=h([]);at({title:"Batch Create Book Short Links",ogTitle:"Batch Create Book Short Links"}),nt(()=>{try{const l=sessionStorage.getItem("nft_book_press_batch_shorten_url");l&&(c.value=l,sessionStorage.removeItem("nft_book_press_batch_shorten_url"))}catch(l){console.error(l)}});async function A({url:l,key:t}){try{const n=await $fetch("https://api-ssl.bitly.com/v4/bitlinks",{method:"POST",headers:{Authorization:`Bearer ${b.value}`},body:{long_url:l,domain:"bit.ly",title:[k.value,t].join(" - "),tags:["nft-book-press"]}});if(!n)throw new Error(o("batch_short_links.bitly_no_data"));return n.link}catch(n){return console.error(n),p.add({icon:"i-heroicons-exclamation-circle",title:n.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}}),"error"}}async function j({url:l,key:t}){try{const n=await $fetch("https://api.short.io/links/public",{method:"POST",headers:{Authorization:b.value},body:{allowDuplicates:!0,domain:f.value,originalURL:l,title:[k.value,t].join(" - "),tags:["nft-book-press"]}});if(!n)throw new Error(o("batch_short_links.shortio_no_data"));return n.shortURL}catch(n){return console.error(n),p.add({icon:"i-heroicons-exclamation-circle",title:n.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}}),"error"}}async function E(){let l=[];try{let t=c.value;t.includes(U)||(t=`${U}
${t}`),l=ht(t,{columns:!0,skip_empty_lines:!0})}catch(t){console.error(t),p.add({icon:"i-heroicons-exclamation-circle",title:t.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}});return}try{for(const{key:t,url:n}of l){let u="";switch(m.value){case"bitly":u=await A({url:n,key:t});break;case"shortio":u=await j({url:n,key:t});break;default:break}y.value.push({key:t,url:u,destination:n})}}catch(t){console.error(t),p.add({icon:"i-heroicons-exclamation-circle",title:t.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}})}}function N(){it({data:y.value,fileName:"shortened_links.csv",fileType:"csv"})}async function O(){sessionStorage.setItem("nft_book_press_batch_qrcode",ct(y.value)),await ut($({name:"batch-qrcode"}))}function z(l){if(!l)return;const[t]=l,n=new FileReader;n.onload=u=>{var _;const i=(_=u.target)==null?void 0:_.result;typeof i=="string"&&(c.value=i)},n.readAsText(t)}return(l,t)=>{const n=M,u=Q,i=X,_=Y,F=rt,H=_t,C=lt,v=st,W=dt,G=mt,K=bt;return w(),g(K,null,{default:s(()=>[a(n,{title:e(o)("batch_short_links.page_title")},null,8,["title"]),a(G,null,{default:s(()=>[a(i,{label:e(o)("batch_short_links.provider_label"),required:!0},{default:s(()=>[a(u,{modelValue:e(m),"onUpdate:modelValue":t[0]||(t[0]=r=>x(m)?m.value=r:null),options:D},null,8,["modelValue"])]),_:1},8,["label"]),a(i,{label:e(q),required:!0},{default:s(()=>[a(_,{modelValue:e(b),"onUpdate:modelValue":t[1]||(t[1]=r=>x(b)?b.value=r:null),class:"font-mono",autocomplete:!1},null,8,["modelValue"])]),_:1},8,["label"]),e(L)?(w(),g(i,{key:0,label:e(o)("batch_short_links.shortio_domain"),required:!0},{default:s(()=>[a(_,{modelValue:e(f),"onUpdate:modelValue":t[2]||(t[2]=r=>x(f)?f.value=r:null),class:"font-mono",placeholder:"link.liker.land",autocomplete:!1},null,8,["modelValue"])]),_:1},8,["label"])):T("",!0),a(i,{label:e(o)("batch_short_links.title_prefix")},{default:s(()=>[a(_,{modelValue:e(k),"onUpdate:modelValue":t[3]||(t[3]=r=>x(k)?k.value=r:null),hint:e(o)("batch_short_links.optional")},null,8,["modelValue","hint"])]),_:1},8,["label"]),a(C,{ui:{body:{base:"space-y-2"}}},{default:s(()=>[a(i,{label:e(o)("batch_short_links.upload_csv")},{default:s(()=>[a(_,{type:"file",accept:"csv",onChange:z})]),_:1},8,["label"]),a(F,{class:"print:hidden",label:e(o)("batch_short_links.or_divider")},null,8,["label"]),a(i,{label:e(o)("batch_short_links.input_csv")},{default:s(()=>[a(H,{modelValue:e(c),"onUpdate:modelValue":t[4]||(t[4]=r=>x(c)?c.value=r:null),class:"font-mono",placeholder:P,resize:!0},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),S("div",pt,[a(v,{label:e(o)("batch_short_links.start"),size:"lg",disabled:!e(c)||!e(b)||e(L)&&!e(f),onClick:E},null,8,["label","disabled"])]),e(y).length?(w(),g(C,{key:1,ui:{header:{base:"flex justify-between items-center gap-2"},body:{padding:""}}},{header:s(()=>[S("h3",ft,V(e(o)("batch_short_links.results")),1),S("div",kt,[a(v,{label:e(o)("batch_short_links.download_csv"),variant:"outline",onClick:N},null,8,["label"]),a(v,{label:e(o)("batch_short_links.convert_to_qr"),variant:"outline",onClick:O},null,8,["label"])])]),default:s(()=>[a(W,{columns:[{key:"key",label:e(o)("batch_short_links.key_column")},{key:"url",label:e(o)("batch_short_links.url_column")},{key:"destination",label:e(o)("batch_short_links.destination_column")}],rows:e(y)},{"url-data":s(({row:r})=>[a(v,{class:"font-mono",to:r.url,target:"_blank",rel:"noopener",variant:"link",padded:!1},{default:s(()=>[B(V(r.url),1)]),_:2},1032,["to"])]),"destination-data":s(({row:r})=>[a(v,{class:"font-mono",to:r.destination,target:"_blank",rel:"noopener",variant:"link",padded:!1},{default:s(()=>[B(V(r.destination),1)]),_:2},1032,["to"])]),_:1},8,["columns","rows"])]),_:1})):T("",!0)]),_:1})]),_:1})}}});export{Bt as default};
