import{_ as Z}from"./C-xXY3k_.js";import{_ as ee}from"./CROjSDN2.js";import{a_ as te,b6 as oe,b7 as ae,bk as le,bn as ne,bm as se,b0 as re,b8 as n,b9 as C,ba as G,b1 as ue,b3 as I,aX as a,aT as S,aU as L,aW as o,br as O,aV as ie,b4 as l,bf as w,bO as ce,aY as h,bt as de,bg as me,cL as fe,cS as pe,cT as _e,b2 as be}from"./C7XQIrPM.js";import{_ as ve}from"./DjLNcy8s.js";import{_ as ge}from"./DvV_81yL.js";import{_ as ye}from"./CZhspGV5.js";import{_ as xe}from"./DAsO9jpg.js";import{p as ke}from"./CUxdmJDi.js";import{u as Ce}from"./C6NCxhyU.js";import"./D_LCcsEc.js";import"./BRjOu1Ku.js";(function(){try{var c=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},p=new c.Error().stack;p&&(c._sentryDebugIds=c._sentryDebugIds||{},c._sentryDebugIds[p]="d1c26527-4410-4e70-a7c7-c468a97eeaf2",c._sentryDebugIdIdentifier="sentry-dbid-d1c26527-4410-4e70-a7c7-c468a97eeaf2")}catch{}})();const we={class:"text-lg font-bold font-mono"},Fe=te({__name:"[classId]",setup(c){const{LIKE_CO_API:p}=oe().public,N=ae(),T=le(),{token:U}=ne(T),$=Ce(),{lazyFetchClassMetadataById:A}=$,M=se(),q=re(),_=n(""),d=n(!1),m=n(M.params.classId),V=n({}),B=n([]),f=n(0),z=C(()=>{var e;return(e=V.value.prices)==null?void 0:e.map((t,r)=>({label:`${t.name.en||t.name} - $${t.price}`,value:r,disabled:r===f.value}))}),b=n(""),v=n(""),g=n(""),R=C(()=>!!b.value&&!!v.value&&!!g.value&&!!y.value.length),y=n([]),D=C(()=>{var e;return((e=y.value)==null?void 0:e.length)||0}),E=C(()=>{var e;return(e=$.getClassMetadataById(m.value))==null?void 0:e.name});G(d,e=>{e&&(_.value="")});const P=["wallet","email","toName","message"],K=[{label:"Email (required)",key:"email"},{label:"Wallet (optional)",key:"wallet"},{label:"Recipient name (optional)",key:"toName"},{label:"Message (optional)",key:"message"}];ue(async()=>{d.value=!0;try{const e=await $fetch(`${p}/likernft/book/store/${m.value}`,{headers:{authorization:`Bearer ${U.value}`}});V.value=e,B.value=V.value.prices,A(m.value)}catch(e){console.error(e),_.value=e.toString()}finally{d.value=!1}}),G(_,e=>{e&&N.add({icon:"i-heroicons-exclamation-circle",title:e,timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}})});function W(){pe(_e([P.reduce((e,t)=>(e[t]="",e),{})],{header:!0}),"gift_list.csv","text/csv;charset=utf-8;")}function Y(e){if(!e)return;const[t]=e,r=new FileReader;r.onload=u=>{var x;try{const s=(x=u.target)==null?void 0:x.result;if(typeof s!="string")return;const k=ke(s,{columns:!0});y.value=k}catch(s){console.error(s),_.value=s.toString()}},r.readAsText(t)}async function H(){if(R.value)try{if(d.value=!0,B.value[f.value].stock<=D.value)throw new Error("NOT_ENOUGH_STOCK");await $fetch(`${p}/likernft/book/store/class/${m.value}/price/${f.value}/gift`,{method:"POST",body:{receivers:y.value,giftInfo:{toName:b.value,fromName:v.value,message:g.value}},headers:{authorization:`Bearer ${U.value}`}}),await be(q({name:"nft-book-store-status-classId",params:{classId:m.value}}))}catch(e){console.error(e),_.value=e.toString()}finally{d.value=!1}}return(e,t)=>{const r=Z,u=ee,x=ce,s=ve,k=me,X=ge,j=fe,J=ye,F=de,Q=xe;return S(),I(Q,null,{default:a(()=>[L("h1",we,' Gift NFT Book "'+ie(l(E)||l(m))+'" ',1),o(u,{label:"Gift edition",required:!0},{default:a(()=>[o(r,{modelValue:l(f),"onUpdate:modelValue":t[0]||(t[0]=i=>w(f)?f.value=i:null),options:l(z)},null,8,["modelValue","options"])]),_:1}),l(d)?(S(),I(x,{key:0,animation:"carousel"},{indicator:a(()=>t[4]||(t[4]=[h(" Loading... ")])),_:1})):O("",!0),l(T).isAuthenticated?(S(),I(F,{key:1,ui:{body:{base:"space-y-4"},footer:{base:"flex justify-center gap-2"}}},{footer:a(()=>[o(k,{label:"Confirm",disabled:!l(R),size:"xl",onClick:H},null,8,["disabled"])]),default:a(()=>[o(u,{label:"Default Recipient Name",required:!0},{default:a(()=>[o(s,{modelValue:l(b),"onUpdate:modelValue":t[1]||(t[1]=i=>w(b)?b.value=i:null),placeholder:"Fellow Reader"},null,8,["modelValue"])]),_:1}),o(u,{label:"Default Gift Message",required:!0},{default:a(()=>[o(s,{modelValue:l(g),"onUpdate:modelValue":t[2]||(t[2]=i=>w(g)?g.value=i:null),placeholder:"Thank you for your support"},null,8,["modelValue"])]),_:1}),o(u,{label:"Gift Giverâ€™s Name",required:!0},{default:a(()=>[o(s,{modelValue:l(v),"onUpdate:modelValue":t[3]||(t[3]=i=>w(v)?v.value=i:null),placeholder:"Your name"},null,8,["modelValue"])]),_:1}),o(u,null,{label:a(()=>[t[5]||(t[5]=h(" Upload Recipient List CSV file (")),o(k,{label:"Download CSV Template",variant:"link",padded:!1,size:"xs",onClick:W}),t[6]||(t[6]=h(") "))]),default:a(()=>[o(X,{class:"mt-1",type:"file",accept:".csv",onChange:Y})]),_:1}),o(F,{ui:{header:{base:"flex gap-4 items-center"},body:{padding:""}}},{header:a(()=>[t[7]||(t[7]=L("h2",{class:"text-lg font-bold font-mono"}," Recipients ",-1)),o(j,{label:`${l(D)}`,ui:{rounded:"rounded-full"}},null,8,["label"])]),default:a(()=>[o(J,{columns:K,rows:l(y)},null,8,["rows"])]),_:1})]),_:1})):O("",!0)]),_:1})}}});export{Fe as default};
