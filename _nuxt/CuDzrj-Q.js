import{_ as re}from"./NkMbLJQ0.js";import{_ as ie}from"./B9CPVQH-.js";import{_ as ce}from"./C5ceEQzY.js";import{a_ as ue,a$ as _e,b7 as me,bv as de,bw as be,b6 as fe,b0 as pe,bj as ke,b8 as U,ba as l,b9 as c,bh as ye,b1 as ve,bb as ge,b3 as f,aX as n,bx as he,by as we,bz as xe,aT as u,aW as _,bi as q,b4 as o,bA as Ie,aY as $,aV as w,bd as j,aU as E,bq as Se,aS as Ce,bB as B,b2 as Ue,bC as $e,bm as Be}from"./Bpv-nJtS.js";import{_ as Re}from"./DFJA_mbi.js";import{_ as Le}from"./DxdXqKd0.js";import{_ as Te}from"./By-1cIYM.js";import{_ as Ve}from"./CiIWcoTJ.js";import{u as Ne}from"./BSVs2JFV.js";import"./daq8aZJ1.js";import"./G4kmRT7V.js";import"./CD7crfRe.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new i.Error().stack;t&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[t]="6c342114-a3d5-48dd-95c1-9dad299c5b50",i._sentryDebugIdIdentifier="sentry-dbid-6c342114-a3d5-48dd-95c1-9dad299c5b50")}catch{}})();const Ae={class:"flex px-3 py-3.5 border-b border-gray-200"},De=["src","alt"],Pe=["textContent"],Ge=ue({__name:"latest-books",setup(i){const{t}=_e(),{BOOK3_URL:x,LIKE_CO_API:K}=me().public,M=de(),O=Ne(),W=be(),z=fe(),F=pe(),H=ke(),{wallet:R}=U(z),{userLikerInfo:L}=U(M),{isAuthenticated:I}=U(W),T=l(()=>[{label:t("latest_books.latest_releases"),key:"latest"},{label:t("latest_books.best_sellers"),key:"bestselling"}]),m=c(""),p=c(!1),V=c([]),N=c([]),k=c(0),d=c(H.query.q||""),S=l(()=>{var e,a;return(e=L.value)!=null&&e.user?he((a=L.value)==null?void 0:a.user):""}),C=l(()=>p.value&&S.value),X=l(()=>[{key:"image",label:t("table.cover"),sortable:!1},{key:"className",label:t("latest_books.book_name"),sortable:!0},{key:"author",label:t("common.author"),sortable:!0},{key:"priceInUSD",label:t("common.price"),sortable:!0},{key:"url",label:C.value?t("latest_books.affiliation_link"):t("common.link"),sortable:!1}]),A=l(()=>T.value[k.value].key),Y=l(()=>A.value==="latest"?V.value:N.value),D=l(()=>Y.value.map(e=>{var v,b,g;const a=e.name||e.title,r=e.thumbnailUrl||e.imageUrl,y=((v=e.author)==null?void 0:v.name)||e.author;return{className:a,image:r?we(xe(r)):void 0,author:y,priceInUSD:`US$${e.minPrice||((g=(b=e.prices)==null?void 0:b[0])==null?void 0:g.price)||0}`,url:`${x}/store/${e.classId}?from=${S.value}&utm_source=bookpress&utm_medium=list_${A.value}`}})),G=l(()=>{if(!d.value)return D.value;const e=d.value.toLowerCase();return D.value.filter(a=>[a.className,a.author].some(r=>r&&r.toLowerCase().includes(e)))});ye({title:()=>t("seo.latest_books_title"),ogTitle:()=>t("seo.latest_books_title")}),ve(async()=>{if(await Promise.all([J().catch(e=>{m.value=e}),Q().catch(e=>{m.value=e})]),I.value)try{await P()}catch(e){console.error(e)}});async function J(){const e=await $fetch(`${K}/likernft/book/store/list?limit=100`);V.value=(e==null?void 0:e.list)||[]}async function Q(){const e=await $fetch(`${x}/api/store/products?tag=bestselling`);N.value=(e==null?void 0:e.records)||[]}async function P(){if(!R.value){p.value=!1;return}try{const e=await O.fetchStripeConnectStatusByWallet(R.value);p.value=e==null?void 0:e.isReady}catch(e){console.error(e),p.value=!1}}function Z(){B("latest_books_click_affiliation_setup"),Ue(F({name:"settings"}))}function ee(e){B("latest_books_click_table_row"),window.open(e.url,"_blank")}function te(e,a){e.stopPropagation(),B("latest_books_click_copy_button"),$e(a)}return ge(I,()=>{I.value&&Be(()=>{P()})}),(e,a)=>{const r=re,y=ie,v=ce,b=Ie,g=Re,oe=Se,ae=Le,se=Te,le=Ve;return u(),f(le,null,{default:n(()=>[_(r,{title:o(t)("latest_books.title")},null,8,["title"]),o(m)?(u(),f(y,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${o(m)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:a[0]||(a[0]=h=>m.value="")},null,8,["title"])):q("",!0),o(C)?(u(),f(b,{key:2},{default:n(()=>[$(w(o(t)("latest_books_extended.append_text")),1),_(v,{class:"font-mono"},{default:n(()=>[$(" ?from="+w(o(S)),1)]),_:1}),$(w(o(t)("latest_books_extended.append_suffix")),1)]),_:1})):(u(),f(y,{key:1,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"soft",title:o(t)("latest_books.join_affiliation"),description:o(t)("latest_books.affiliation_description"),actions:[{label:o(t)("common.setup"),color:"orange",variant:"outline",click:Z}]},null,8,["title","description","actions"])),_(se,{modelValue:o(k),"onUpdate:modelValue":a[2]||(a[2]=h=>j(k)?k.value=h:null),class:"w-full",items:o(T)},{item:n(({item:h})=>[(u(),f(b,{key:h.key,ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{default:n(()=>[E("div",Ae,[_(g,{modelValue:o(d),"onUpdate:modelValue":a[1]||(a[1]=s=>j(d)?d.value=s:null),placeholder:o(t)("latest_books.filter_placeholder")},null,8,["modelValue","placeholder"])]),_(ae,{columns:o(X),rows:o(G),onSelect:ee},{"image-data":n(({row:s})=>[s.image?(u(),Ce("img",{key:0,src:s.image,alt:s.className,class:"w-12 h-12 object-cover rounded-lg"},null,8,De)):q("",!0)]),"className-data":n(({row:s})=>[E("div",{class:"max-w-[20vw] whitespace-normal",textContent:w(s.className)},null,8,Pe)]),"url-data":n(({row:s})=>[_(oe,{label:o(t)("common.copy"),disabled:!o(C),onClick:ne=>te(ne,s.url)},null,8,["label","disabled","onClick"])]),_:1},8,["columns","rows"])]),_:2},1024))]),_:1},8,["modelValue","items"])]),_:1})}}});export{Ge as default};
