import{a_ as Ze,bl as qe,a$ as Oe,bk as Ge,bn as fe,b0 as Qe,bm as Ye,b8 as r,b9 as C,bb as He,b1 as Ke,ba as Je,b3 as h,aX as a,bQ as Xe,aT as m,br as V,aS as ee,b4 as e,bs as eo,bK as oo,aY as j,aV as c,bi as pe,aW as t,aU as u,bt as to,bf as w,bR as _e,bj as lo,bS as ao,bA as no,bg as so,b2 as be,aQ as io}from"./BYo2dXVR.js";import{_ as ro}from"./7JmTsn_8.js";import{_ as uo}from"./52qwCRfV.js";import{_ as co}from"./BctUs1c_.js";import{_ as mo}from"./OKnbDGbn.js";import{_ as fo}from"./CgOXZL-B.js";import{c as po,_ as _o,E as ve,a as bo,v as vo,p as ho}from"./DX7Xantt.js";import{_ as go}from"./CVozDPS3.js";import{_ as wo}from"./90fTm4zi.js";import{_ as yo}from"./CBUwJk6N.js";import{_ as ko}from"./_KtQ4m5e.js";import{b as he,M as B,U as xo}from"./CJ75jTLm.js";import{u as Co}from"./Dz-AFHmF.js";import{u as Uo}from"./Bh4K2e_-.js";import"./DBI9bRw3.js";import"./7kmIQJZ-.js";import"./C_a0Tzcc.js";import"./D8C1ekd1.js";import"./1ixNJkj9.js";(function(){try{var I=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},L=new I.Error().stack;L&&(I._sentryDebugIds=I._sentryDebugIds||{},I._sentryDebugIds[L]="887b4699-f850-4113-b6a2-709d577b1e01",I._sentryDebugIdIdentifier="sentry-dbid-887b4699-f850-4113-b6a2-709d577b1e01")}catch{}})();const Vo=""+new URL("memo.BfdW4YCm.png",import.meta.url).href,Io=""+new URL("tipping.CML6JQGS.png",import.meta.url).href,Po=""+new URL("editionInfo-zh.3QZ-B73C.png",import.meta.url).href,Eo={class:"font-bold font-mono"},So={class:"font-bold font-mono"},To={class:"font-bold font-mono"},Mo={class:"block text-[14px] text-[#374151] mt-[8px]"},Do={class:"block text-[14px] text-[#374151] mt-[8px]"},No={class:"flex justify-center items-center"},Ao={class:"flex justify-center items-center"},$o={class:"text-sm font-bold font-mono"},Ro={class:"flex gap-2"},jo={class:"flex justify-end items-center"},Bo={class:"flex justify-between items-center w-full"},Lo={class:"font-bold font-mono"},Wo={key:0,class:"mt-[24px] flex flex-col gap-[12px]"},zo={class:"text-sm font-bold font-mono"},Fo={class:"flex gap-2"},Zo={class:"flex justify-end items-center"},qo={class:"font-bold font-mono"},Oo={class:"grid md:grid-cols-2 gap-4"},Go=Ze({__name:"new",setup(I){const{getClassOwner:L,getClassMetadata:oe}=Uo(),ge=qe(),{t:n}=Oe(),te=Ge(),le=Co(),{wallet:P}=fe(ge),{newBookListing:we,updateEditionPrice:ye}=te,{fetchStripeConnectStatusByWallet:ke}=le,{getStripeConnectStatusByWallet:xe}=fe(le),ae=Qe(),E=Ye(),H=r(E.params.editingClassId||E.query.class_id||""),ne=r(E.params.editionIndex),S=r(""),f=r(!1),se=r({en:"e.g.: This edition includes EPUB and PDF ebook files.",zh:"例：此版本包含 EPUB 及 PDF 電子書檔"}),U=r(H||""),K=r(1),W=r(""),z=r(!0),D=r(!1),F=r(!1),g=r([{price:he,deliveryMethod:"auto",autoMemo:"Thank you for your support. It means a lot to me.",stock:Number(E.query.count||1),nameEn:"Standard Edition",nameZh:"標準版",descriptionEn:"",descriptionZh:"",isAllowCustomPrice:!1,isUnlisted:!1}]),N=C(()=>g.value.length>1),ie=C(()=>N.value?"edition":"book"),Z=r(["like1rclg677y2jqt8x4ylj0kjlqjjmnn6w63uflpgr"]),q=r([]),p=r(""),_=r(""),A=r(!1),$=r(""),J=r(!1),X=r(!0),re=r(["bold","italic","strikeThrough","title","-","unorderedList","orderedList","-","code","link","=","preview"]),T=C(()=>!!(E.params.editingClassId&&ne.value)),Ce=C(()=>T.value?n("pages.edit_current_edition"):n("pages.new_book_listing")),Ue=C(()=>T.value?n("common.save"):n("common.submit")),O=r(!1),Ve=C(()=>[{key:"wallet",label:n("table.wallet"),sortable:!0},{key:"remove",label:"",sortable:!1}]),Ie=C(()=>Z.value.map((s,o)=>({index:o,wallet:s,walletLink:Xe(s)}))),Pe=C(()=>q.value.map((s,o)=>({index:o,email:s})));po({markdownItConfig(s){s.options.html=!1}}),He({title:()=>n("seo_titles.new_book_listing"),ogTitle:()=>n("seo_titles.new_book_listing")}),Ke(async()=>{try{if(f.value=!0,P.value){try{await ke(P.value)}catch(s){console.error(s)}xe.value(P.value).isReady&&(A.value=!0,$.value=P.value)}}catch(s){console.error(s)}finally{f.value=!1}}),Je(f,s=>{s&&(S.value="")});function G(s,o,M){var y;g.value[M][o]=(y=s.target)==null?void 0:y.value}function Ee(s,o){g.value[o].price=s,Number(s)===0&&(g.value[o].isAllowCustomPrice=!0)}function Se(){K.value+=1,g.value.push({index:vo(),price:he,deliveryMethod:"auto",autoMemo:"",stock:1,nameEn:`Tier ${K.value}`,nameZh:`級別 ${K.value}`,descriptionEn:"",descriptionZh:"",isAllowCustomPrice:!0,isUnlisted:!1})}function Te(s){g.value.splice(s,1)}function Me(){p.value&&(Z.value.push(p.value),p.value="")}function De(){_.value&&(q.value.push(_.value),_.value="")}function Ne(s){$.value=s,J.value=!0}function ue(s=""){return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function de(s){return ho.sanitize(s)}function ce(s){return s.map(o=>({name:{en:o.nameEn,zh:o.nameZh},description:{en:ue(o.descriptionEn),zh:ue(o.descriptionZh)},priceInDecimal:Math.round(Number(o.price)*100),price:Number(o.price),stock:Number(o.stock),isAutoDeliver:o.deliveryMethod==="auto",isAllowCustomPrice:o.isAllowCustomPrice??!0,isUnlisted:o.isUnlisted??!1,autoMemo:o.deliveryMethod==="auto"&&o.autoMemo||""}))}async function Ae(){try{if(!U.value)throw new Error("Please input NFT class ID");if(p.value)throw new Error('Please press "Add" button to add moderator wallet');if(_.value)throw new Error('Please press "Add" button to add notification email');f.value=!0;const[s,o]=await Promise.all([oe(U.value),L(U.value)]);if(o!==P.value)throw new Error("You are not the owner of this NFT Class");if(!s)throw new Error("Invalid NFT Class ID");const M=s.nft_meta_collection_id||"";if(!M.includes("nft_book")&&!M.includes("book_nft"))throw new Error("NFT Class not in NFT BOOK meta collection");const y=ce(g.value);if(y.find(d=>d.price!==0&&d.price<B))throw new Error(`Price of each edition must be at least $${B} or $0 (free)`);const b=A.value&&$.value?{[$.value]:100}:null;if(y.some(d=>d.isAutoDeliver)&&!confirm(`NFT Book Press - Reminder
Once you choose automatic delivery, you can't switch it back to manual delivery.  Are you sure?`))return;await we(U.value,{tableOfContents:W.value,defaultPaymentCurrency:"USD",connectedWallets:b,moderatorWallets:Z.value,notificationEmails:q.value,prices:y,mustClaimToView:z.value,enableCustomMessagePage:D.value,hideDownload:F.value}),await be(ae({name:"nft-book-store"}))}catch(s){const o=s.data||s;console.error(o),S.value=o}finally{J.value=!1,f.value=!1}}async function $e(){try{if(!T.value)throw new Error("Unable to submit edit: Missing edition index or class ID");const o=ce(g.value)[0];if(!o||o.price===void 0)throw new Error("Please input price of edition");if(o.price!==0&&o.price<B)throw new Error(`Price of each edition must be at least $${B} or $0 (free)`);if(!o.stock&&o.stock!==0)throw new Error("Please input stock of edition");if(o.stock<0)throw new Error("Stock cannot be negative");if(!o.name.en||!o.name.zh)throw new Error("Please input product name");f.value=!0,await ye(H.value,ne.value,{price:o}),await be(ae({name:"nft-book-store"}))}catch(s){const o=s.data||s;console.error(o),S.value=o}finally{f.value=!1}}function Re(){return T.value?$e():Ae()}function je(s){s==="manual"&&(D.value=!0)}return(s,o)=>{const M=eo,y=oo,b=ro,d=uo,Be=co,k=to,Le=mo,We=fo,Q=no,Y=_o,R=go,v=so,ze=wo,me=yo,Fe=ko;return m(),h(Fe,{class:"pb-[40px]"},{default:a(()=>[e(S)?(m(),h(M,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${e(S)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:o[0]||(o[0]=l=>S.value="")},null,8,["title"])):V("",!0),e(f)?(m(),h(y,{key:1,animation:"carousel"},{indicator:a(()=>[j(c(e(n)("loading.progress")),1)]),_:1})):V("",!0),e(te).isAuthenticated?(m(),ee(pe,{key:2},[t(k,{ui:{body:{base:"space-y-4"}}},{header:a(()=>[u("h2",Eo,c(e(Ce)),1)]),default:a(()=>[t(d,{label:e(n)("form.nft_class_id")},{default:a(()=>[e(T)?(m(),h(b,{key:1,"model-value":e(H),readonly:!0},null,8,["model-value"])):(m(),h(b,{key:0,modelValue:e(U),"onUpdate:modelValue":o[1]||(o[1]=l=>w(U)?U.value=l:null),class:"font-mono",placeholder:"0x...."},null,8,["modelValue"]))]),_:1},8,["label"]),t(d,{label:e(n)("form.table_of_content")},{default:a(()=>[t(Be,{modelValue:e(W),"onUpdate:modelValue":o[2]||(o[2]=l=>w(W)?W.value=l:null)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),(m(),h(_e(e(N)?"ul":"div"),{class:"flex flex-col gap-[12px]"},{default:a(()=>[(m(!0),ee(pe,null,lo(e(g),(l,x)=>(m(),h(_e(e(N)?"li":"div"),{key:l.index},{default:a(()=>[t(k,{ui:{body:{base:"space-y-5 border-[4px] relative"},base:"overflow-visible border-[2px]"}},{default:a(()=>[t(k,{ui:{body:{base:"flex flex-col gap-[20px]"},base:"overflow-visible"}},{header:a(()=>[u("h3",So,c(e(n)("form.pricing_availability")),1)]),default:a(()=>[t(d,{label:e(n)("form.unit_price_label",{minPrice:e(B)})},{default:a(()=>[t(Le,{modelValue:l.price,"onUpdate:modelValue":[i=>l.price=i,i=>Ee(i,x)],options:e(xo),"value-attribute":"value"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:2},1032,["label"]),t(d,{label:e(n)("new_listing.total_nft_for_sale",{type:e(N)?"edition":"ebook"})},{default:a(()=>[t(b,{"model-value":l.stock,type:"number",step:"1",min:0,max:Number(e(E).query.count)||void 0,onInput:i=>G(i,"stock",x)},null,8,["model-value","max","onInput"])]),_:2},1032,["label"]),t(We,{modelValue:l.deliveryMethod,"onUpdate:modelValue":i=>l.deliveryMethod=i,legend:e(n)("form.delivery_method",{type:e(ie)}),options:e(ao),onChange:je},null,8,["modelValue","onUpdate:modelValue","legend","options"]),l.deliveryMethod==="auto"?(m(),h(d,{key:0},{label:a(()=>[j(c(e(n)("form.memo_delivery",{type:e(ie)}))+" ",1),t(Y,null,{image:a(()=>o[11]||(o[11]=[u("img",{src:Vo,class:"object-cover",alt:""},null,-1)])),default:a(()=>[t(Q,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:a(()=>[t(b,{"model-value":l.autoMemo,onInput:i=>G(i,"autoMemo",x)},null,8,["model-value","onInput"])]),_:2},1024)):V("",!0),t(d,null,{label:a(()=>[j(c(e(n)("form.allow_custom_price"))+" ",1),t(Y,{"image-style":{width:"300px"}},{image:a(()=>o[12]||(o[12]=[u("img",{src:Io,class:"object-cover",alt:""},null,-1)])),default:a(()=>[t(Q,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:a(()=>[t(R,{modelValue:l.isAllowCustomPrice,"onUpdate:modelValue":i=>l.isAllowCustomPrice=i,name:"isAllowCustomPrice",label:e(n)("form.allow_pay_more")},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),t(d,{label:e(n)("form.unlist_edition")},{default:a(()=>[t(R,{modelValue:l.isUnlisted,"onUpdate:modelValue":i=>l.isUnlisted=i,name:"isUnlisted",label:e(n)("form.pause_selling_edition")},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1032,["label"])]),_:2},1024),t(k,{ui:{body:{base:"flex flex-col gap-[20px]"},base:"overflow-visible"}},{header:a(()=>[u("h3",To,c(e(n)("form.product_information")),1)]),default:a(()=>[t(d,{label:e(n)("form.product_name"),ui:{container:"space-y-2"}},{label:a(()=>[j(c(e(n)("form.product_name_english"))+" ",1),t(Y,{"image-style":{width:"250px"}},{image:a(()=>o[13]||(o[13]=[u("img",{src:bo,class:"object-cover",alt:""},null,-1)])),default:a(()=>[t(Q,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:a(()=>[t(b,{placeholder:"Product Name","model-value":l.nameEn,onInput:i=>G(i,"nameEn",x)},null,8,["model-value","onInput"]),u("span",Mo,c(e(n)("form.description_optional")),1),t(e(ve),{modelValue:l.descriptionEn,"onUpdate:modelValue":i=>l.descriptionEn=i,language:"en-US","editor-id":`en-${x}`,placeholder:e(se).en,toolbars:e(re),sanitize:de,style:{height:"200px",width:"100%",marginTop:"0px"}},null,8,["modelValue","onUpdate:modelValue","editor-id","placeholder","toolbars"])]),_:2},1032,["label"]),t(d,{ui:{container:"space-y-2 my-[20px]"}},{label:a(()=>[j(c(e(n)("form.product_name_chinese"))+" ",1),t(Y,{"image-style":{width:"250px"}},{image:a(()=>o[14]||(o[14]=[u("img",{src:Po,class:"object-cover",alt:""},null,-1)])),default:a(()=>[t(Q,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:a(()=>[t(b,{placeholder:"產品名稱","model-value":l.nameZh,onInput:i=>G(i,"nameZh",x)},null,8,["model-value","onInput"]),u("span",Do,c(e(n)("form.description_optional")),1),t(e(ve),{modelValue:l.descriptionZh,"onUpdate:modelValue":i=>l.descriptionZh=i,language:"en-US","editor-id":`zh-${x}`,placeholder:e(se).zh,toolbars:e(re),sanitize:de,style:{height:"200px",width:"100%",marginTop:"0px"}},null,8,["modelValue","onUpdate:modelValue","editor-id","placeholder","toolbars"])]),_:2},1024)]),_:2},1024),u("div",No,[e(N)?(m(),h(v,{key:0,label:e(n)("common.delete"),color:"red",onClick:i=>Te(x)},null,8,["label","onClick"])):V("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:1})),u("div",Ao,[e(T)?V("",!0):(m(),h(v,{key:0,ui:{rounded:"rounded-full"},color:"gray",icon:"i-heroicons-plus-solid",label:e(n)("form.add_edition"),onClick:Se},null,8,["label"]))]),t(ze,{"is-stripe-connect-checked":e(A),"onUpdate:isStripeConnectChecked":o[3]||(o[3]=l=>w(A)?A.value=l:null),"is-using-default-account":e(X),"onUpdate:isUsingDefaultAccount":o[4]||(o[4]=l=>w(X)?X.value=l:null),"stripe-connect-wallet":e($),"should-disable-setting":e(J),"login-address":e(P),onSave:Ne},null,8,["is-stripe-connect-checked","is-using-default-account","stripe-connect-wallet","should-disable-setting","login-address"]),t(k,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""}}},{header:a(()=>[u("h4",$o,c(e(n)("form.email_notifications")),1),u("div",Ro,[t(b,{modelValue:e(_),"onUpdate:modelValue":o[5]||(o[5]=l=>w(_)?_.value=l:null),placeholder:"abc@example.com"},null,8,["modelValue"]),t(v,{label:e(n)("common.add"),variant:e(_)?"outline":"solid",color:e(_)?"primary":"gray",disabled:!e(_),onClick:De},null,8,["label","variant","color","disabled"])])]),default:a(()=>[t(me,{columns:[{key:"email",label:e(n)("table.email"),sortable:!0},{key:"action"}],rows:e(Pe)},{"email-data":a(({row:l})=>[t(v,{label:l.email,to:`mailto:${l.email}`,variant:"link",padded:!1},null,8,["label","to"])]),"action-data":a(({row:l})=>[u("div",jo,[t(v,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>e(q).splice(l.index,1)},null,8,["onClick"])])]),_:1},8,["columns","rows"])]),_:1}),t(k,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"12px"}}},{default:a(()=>[u("div",Bo,[u("h3",Lo,c(e(n)("nft_book_form.advanced_settings")),1),t(v,{color:"gray",variant:"ghost",icon:e(O)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",onClick:o[6]||(o[6]=()=>{O.value=!e(O)})},null,8,["icon"])]),e(O)?(m(),ee("div",Wo,[t(k,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"",base:"space-y-8"}}},{header:a(()=>[u("h4",zo,c(e(n)("form.share_sales_data")),1),u("div",Fo,[t(b,{modelValue:e(p),"onUpdate:modelValue":o[7]||(o[7]=l=>w(p)?p.value=l:null),class:"font-mono",placeholder:"0x..."},null,8,["modelValue"]),t(v,{label:e(n)("common.add"),variant:e(p)?"outline":"solid",color:e(p)?"primary":"gray",disabled:!e(p),onClick:Me},null,8,["label","variant","color","disabled"])])]),default:a(()=>[t(me,{columns:e(Ve),rows:e(Ie)},{"wallet-data":a(({row:l})=>[t(v,{class:"font-mono",label:l.wallet,to:l.walletLink,variant:"link",padded:!1},null,8,["label","to"])]),"remove-data":a(({row:l})=>[u("div",Zo,[t(v,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>e(Z).splice(l.index,1)},null,8,["onClick"])])]),_:1},8,["columns","rows"])]),_:1}),t(k,{ui:{body:{base:"space-y-8"}}},{header:a(()=>[u("h3",qo,c(e(n)("form.drm_options")),1)]),default:a(()=>[u("div",Oo,[t(d,{label:e(n)("form.force_nft_claim"),ui:{label:{base:"font-mono font-bold"}}},{default:a(()=>[t(R,{modelValue:e(z),"onUpdate:modelValue":o[8]||(o[8]=l=>w(z)?z.value=l:null),name:"mustClaimToView",label:e(n)("form.must_claim_to_view")},null,8,["modelValue","label"])]),_:1},8,["label"]),t(d,{label:e(n)("form.disable_file_download"),ui:{label:{base:"font-mono font-bold"}}},{default:a(()=>[t(R,{modelValue:e(F),"onUpdate:modelValue":o[9]||(o[9]=l=>w(F)?F.value=l:null),name:"hideDownload",label:e(n)("form.disable_download")},null,8,["modelValue","label"])]),_:1},8,["label"]),t(d,{label:e(n)("form.custom_message_page"),ui:{label:{base:"font-mono font-bold"}}},{default:a(()=>[t(R,{modelValue:e(D),"onUpdate:modelValue":o[10]||(o[10]=l=>w(D)?D.value=l:null),name:"enableCustomMessagePage",label:e(n)("form.enable_custom_message")},null,8,["modelValue","label"])]),_:1},8,["label"])])]),_:1})])):V("",!0)]),_:1}),t(v,{label:e(Ue),loading:e(f),size:"lg",disabled:e(f),onClick:Re},null,8,["label","loading","disabled"])],64)):V("",!0)]),_:1})}}}),ft=io(Go,[["__scopeId","data-v-3655ae92"]]);export{ft as default};
