import{a_ as Ge,bl as Qe,a$ as Ye,bk as He,bn as be,b0 as Je,bm as Ke,b8 as r,b9 as U,bb as Xe,b1 as eo,ba as oo,b3 as f,aX as a,bJ as lo,aT as c,br as $,aS as le,b4 as e,bs as to,bK as ao,aY as B,aV as m,bi as he,aW as l,aU as u,bt as no,bf as w,bL as ve,bj as io,bM as so,bA as ro,bg as uo,b2 as ge,aQ as co}from"./CfpLx2LB.js";import{_ as mo}from"./CKGVi-eE.js";import{_ as po}from"./Sm8FFGW_.js";import{_ as fo}from"./DG9umdHl.js";import{_ as _o}from"./CAIuxWe3.js";import{_ as bo}from"./BA839bSg.js";import{c as ho,_ as vo,E as ye,a as go,p as yo}from"./Bh2ToEIv.js";import{a as wo,_ as ko}from"./CptZa1T_.js";import{_ as xo,a as Co,v as Uo}from"./WWIZPLXd.js";import{_ as Vo}from"./BKxVq6zm.js";import{D as we,M as L,U as Po}from"./D6KCvO3T.js";import{u as Io}from"./CNiO1hQ7.js";import{u as So}from"./Cl1tprzA.js";import"./DnvCEll6.js";import"./BxRyaLmU.js";import"./MlDWAV-D.js";import"./B3Fd3VR-.js";import"./DGzvqedy.js";(function(){try{var P=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},z=new P.Error().stack;z&&(P._sentryDebugIds=P._sentryDebugIds||{},P._sentryDebugIds[z]="78fa5ac1-f366-4826-a768-526af8cb309b",P._sentryDebugIdIdentifier="sentry-dbid-78fa5ac1-f366-4826-a768-526af8cb309b")}catch{}})();const Eo=""+new URL("memo.BfdW4YCm.png",import.meta.url).href,Mo=""+new URL("tipping.CML6JQGS.png",import.meta.url).href,To=""+new URL("editionInfo-zh.3QZ-B73C.png",import.meta.url).href,Do={class:"font-bold font-mono"},$o={class:"font-bold font-mono"},Ro={class:"font-bold font-mono"},Ao={class:"block text-[14px] text-[#374151] mt-[8px]"},No={class:"block text-[14px] text-[#374151] mt-[8px]"},Oo={class:"flex justify-center items-center"},jo={class:"flex justify-center items-center"},Bo={class:"text-sm font-bold font-mono"},Lo={class:"flex gap-2"},zo={class:"flex justify-end items-center"},Wo={class:"flex justify-between items-center w-full"},Fo={class:"font-bold font-mono"},Zo={key:0,class:"mt-[24px] flex flex-col gap-[12px]"},qo={class:"text-sm font-bold font-mono"},Go={class:"flex gap-2"},Qo={class:"flex justify-end items-center"},Yo={class:"font-bold font-mono"},Ho={class:"grid md:grid-cols-2 gap-4"},Jo=Ge({__name:"new",setup(P){const{getClassOwner:z,getClassMetadata:te}=So(),ke=Qe(),{t:n}=Ye(),ae=He(),ne=Io(),{wallet:I}=be(ke),{newBookListing:xe,updateEditionPrice:Ce}=ae,{fetchStripeConnectStatusByWallet:Ue}=ne,{getStripeConnectStatusByWallet:Ve}=be(ne),ie=Je(),S=Ke(),K=r(S.params.editingClassId||S.query.class_id||""),se=r(S.params.editionIndex),E=r(""),_=r(!1),re=r({en:"e.g.: This edition includes EPUB and PDF ebook files.",zh:"例：此版本包含 EPUB 及 PDF 電子書檔"}),V=r(K||""),X=r(1),W=r(""),F=r(!0),R=r(!1),Z=r(!1),y=r([{price:we,deliveryMethod:"auto",autoMemo:"Thank you for your support. It means a lot to me.",stock:Number(S.query.count||1),nameEn:"Standard Edition",nameZh:"標準版",descriptionEn:"",descriptionZh:"",hasShipping:!1,isPhysicalOnly:!1,isAllowCustomPrice:!1,isUnlisted:!1}]),A=r([]),N=U(()=>y.value.length>1),ue=U(()=>N.value?"edition":"book"),q=r(["like1rclg677y2jqt8x4ylj0kjlqjjmnn6w63uflpgr"]),G=r([]),b=r(""),h=r(""),O=r(!1),j=r(""),ee=r(!1),oe=r(!0),de=r(["bold","italic","strikeThrough","title","-","unorderedList","orderedList","-","code","link","=","preview"]),M=U(()=>!!(S.params.editingClassId&&se.value)),Pe=U(()=>M.value?n("pages.edit_current_edition"):n("pages.new_book_listing")),Ie=U(()=>M.value?n("common.save"):n("common.submit")),Q=r(!1),Se=U(()=>[{key:"wallet",label:n("table.wallet"),sortable:!0},{key:"remove",label:"",sortable:!1}]),Ee=U(()=>q.value.map((i,o)=>({index:o,wallet:i,walletLink:lo(i)}))),Me=U(()=>G.value.map((i,o)=>({index:o,email:i})));ho({markdownItConfig(i){i.options.html=!1}}),Xe({title:()=>n("seo_titles.new_book_listing"),ogTitle:()=>n("seo_titles.new_book_listing")}),eo(async()=>{try{if(_.value=!0,I.value){try{await Ue(I.value)}catch(i){console.error(i)}Ve.value(I.value).isReady&&(O.value=!0,j.value=I.value)}}catch(i){console.error(i)}finally{_.value=!1}}),oo(_,i=>{i&&(E.value="")});function Y(i,o,T){var k;y.value[T][o]=(k=i.target)==null?void 0:k.value}function Te(i,o){y.value[o].price=i,Number(i)===0&&(y.value[o].isAllowCustomPrice=!0)}function De(){X.value+=1,y.value.push({index:Uo(),price:we,deliveryMethod:"auto",autoMemo:"",stock:1,nameEn:`Tier ${X.value}`,nameZh:`級別 ${X.value}`,descriptionEn:"",descriptionZh:"",hasShipping:!1,isPhysicalOnly:!1,isAllowCustomPrice:!0,isUnlisted:!1})}function $e(i){y.value.splice(i,1)}function Re(i){A.value=i}function Ae(){b.value&&(q.value.push(b.value),b.value="")}function Ne(){h.value&&(G.value.push(h.value),h.value="")}function Oe(i){j.value=i,ee.value=!0}function ce(i=""){return i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function me(i){return yo.sanitize(i)}function pe(i){return i.map(o=>({name:{en:o.nameEn,zh:o.nameZh},description:{en:ce(o.descriptionEn),zh:ce(o.descriptionZh)},priceInDecimal:Math.round(Number(o.price)*100),price:Number(o.price),stock:Number(o.stock),isAutoDeliver:!o.isPhysicalOnly&&o.deliveryMethod==="auto",isAllowCustomPrice:o.isAllowCustomPrice??!0,isUnlisted:o.isUnlisted??!1,autoMemo:o.deliveryMethod==="auto"&&o.autoMemo||"",hasShipping:o.hasShipping||!1,isPhysicalOnly:o.isPhysicalOnly||!1}))}async function je(){try{if(!V.value)throw new Error("Please input NFT class ID");if(b.value)throw new Error('Please press "Add" button to add moderator wallet');if(h.value)throw new Error('Please press "Add" button to add notification email');_.value=!0;const[i,o]=await Promise.all([te(V.value),z(V.value)]);if(o!==I.value)throw new Error("You are not the owner of this NFT Class");if(!i)throw new Error("Invalid NFT Class ID");const T=i.nft_meta_collection_id||"";if(!T.includes("nft_book")&&!T.includes("book_nft"))throw new Error("NFT Class not in NFT BOOK meta collection");const k=pe(y.value);if(k.find(p=>p.price!==0&&p.price<L))throw new Error(`Price of each edition must be at least $${L} or $0 (free)`);const v=O.value&&j.value?{[j.value]:100}:null,d=A.value.length?A.value.map(p=>({name:{en:p.name.en,zh:p.name.zh},priceInDecimal:p.priceInDecimal,price:p.priceInDecimal/100})):void 0;if(k.some(p=>p.isAutoDeliver)&&!confirm(`NFT Book Press - Reminder
Once you choose automatic delivery, you can't switch it back to manual delivery.  Are you sure?`))return;await xe(V.value,{tableOfContents:W.value,defaultPaymentCurrency:"USD",connectedWallets:v,moderatorWallets:q.value,notificationEmails:G.value,prices:k,shippingRates:d,mustClaimToView:F.value,enableCustomMessagePage:R.value,hideDownload:Z.value}),await ge(ie({name:"nft-book-store"}))}catch(i){const o=i.data||i;console.error(o),E.value=o}finally{ee.value=!1,_.value=!1}}async function Be(){try{if(!M.value)throw new Error("Unable to submit edit: Missing edition index or class ID");const o=pe(y.value)[0];if(!o||o.price===void 0)throw new Error("Please input price of edition");if(o.price!==0&&o.price<L)throw new Error(`Price of each edition must be at least $${L} or $0 (free)`);if(!o.stock&&o.stock!==0)throw new Error("Please input stock of edition");if(o.stock<0)throw new Error("Stock cannot be negative");if(!o.name.en||!o.name.zh)throw new Error("Please input product name");_.value=!0,await Ce(K.value,se.value,{price:o}),await ge(ie({name:"nft-book-store"}))}catch(i){const o=i.data||i;console.error(o),E.value=o}finally{_.value=!1}}function Le(){return M.value?Be():je()}function ze(i){i==="manual"&&(R.value=!0)}return(i,o)=>{const T=to,k=ao,v=mo,d=po,p=fo,x=no,We=_o,Fe=bo,H=ro,J=vo,D=wo,fe=xo,g=uo,Ze=Co,_e=ko,qe=Vo;return c(),f(qe,{class:"pb-[40px]"},{default:a(()=>[e(E)?(c(),f(T,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${e(E)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:o[0]||(o[0]=t=>E.value="")},null,8,["title"])):$("",!0),e(_)?(c(),f(k,{key:1,animation:"carousel"},{indicator:a(()=>[B(m(e(n)("loading.progress")),1)]),_:1})):$("",!0),e(ae).isAuthenticated?(c(),le(he,{key:2},[l(x,{ui:{body:{base:"space-y-4"}}},{header:a(()=>[u("h2",Do,m(e(Pe)),1)]),default:a(()=>[l(d,{label:e(n)("form.nft_class_id")},{default:a(()=>[e(M)?(c(),f(v,{key:1,"model-value":e(K),readonly:!0},null,8,["model-value"])):(c(),f(v,{key:0,modelValue:e(V),"onUpdate:modelValue":o[1]||(o[1]=t=>w(V)?V.value=t:null),class:"font-mono",placeholder:"0x...."},null,8,["modelValue"]))]),_:1},8,["label"]),l(d,{label:e(n)("form.table_of_content")},{default:a(()=>[l(p,{modelValue:e(W),"onUpdate:modelValue":o[2]||(o[2]=t=>w(W)?W.value=t:null)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),(c(),f(ve(e(N)?"ul":"div"),{class:"flex flex-col gap-[12px]"},{default:a(()=>[(c(!0),le(he,null,io(e(y),(t,C)=>(c(),f(ve(e(N)?"li":"div"),{key:t.index},{default:a(()=>[l(x,{ui:{body:{base:"space-y-5 border-[4px] relative"},base:"overflow-visible border-[2px]"}},{default:a(()=>[l(x,{ui:{body:{base:"flex flex-col gap-[20px]"},base:"overflow-visible"}},{header:a(()=>[u("h3",$o,m(e(n)("form.pricing_availability")),1)]),default:a(()=>[l(d,{label:e(n)("form.unit_price_label",{minPrice:e(L)})},{default:a(()=>[l(We,{modelValue:t.price,"onUpdate:modelValue":[s=>t.price=s,s=>Te(s,C)],options:e(Po),"value-attribute":"value"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:2},1032,["label"]),l(d,{label:e(n)("new_listing.total_nft_for_sale",{type:e(N)?"edition":"ebook"})},{default:a(()=>[l(v,{"model-value":t.stock,type:"number",step:"1",min:0,max:Number(e(S).query.count)||void 0,onInput:s=>Y(s,"stock",C)},null,8,["model-value","max","onInput"])]),_:2},1032,["label"]),l(Fe,{modelValue:t.deliveryMethod,"onUpdate:modelValue":s=>t.deliveryMethod=s,disabled:t.isPhysicalOnly,legend:e(n)("form.delivery_method",{type:e(ue)}),options:e(so),onChange:ze},null,8,["modelValue","onUpdate:modelValue","disabled","legend","options"]),t.deliveryMethod==="auto"?(c(),f(d,{key:0},{label:a(()=>[B(m(e(n)("form.memo_delivery",{type:e(ue)}))+" ",1),l(J,null,{image:a(()=>o[11]||(o[11]=[u("img",{src:Eo,class:"object-cover",alt:""},null,-1)])),default:a(()=>[l(H,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:a(()=>[l(v,{"model-value":t.autoMemo,onInput:s=>Y(s,"autoMemo",C)},null,8,["model-value","onInput"])]),_:2},1024)):(c(),f(d,{key:1,label:e(n)("form.is_physical_only")},{default:a(()=>[l(D,{modelValue:t.isPhysicalOnly,"onUpdate:modelValue":s=>t.isPhysicalOnly=s,name:"isPhysicalOnly",label:e(n)("form.no_digital_files")},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1032,["label"])),l(d,null,{label:a(()=>[B(m(e(n)("form.allow_custom_price"))+" ",1),l(J,{"image-style":{width:"300px"}},{image:a(()=>o[12]||(o[12]=[u("img",{src:Mo,class:"object-cover",alt:""},null,-1)])),default:a(()=>[l(H,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:a(()=>[l(D,{modelValue:t.isAllowCustomPrice,"onUpdate:modelValue":s=>t.isAllowCustomPrice=s,name:"isAllowCustomPrice",label:e(n)("form.allow_pay_more")},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),l(d,{label:e(n)("form.unlist_edition")},{default:a(()=>[l(D,{modelValue:t.isUnlisted,"onUpdate:modelValue":s=>t.isUnlisted=s,name:"isUnlisted",label:e(n)("form.pause_selling_edition")},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1032,["label"])]),_:2},1024),l(x,{ui:{body:{base:"flex flex-col gap-[20px]"},base:"overflow-visible"}},{header:a(()=>[u("h3",Ro,m(e(n)("form.product_information")),1)]),default:a(()=>[l(d,{label:e(n)("form.product_name"),ui:{container:"space-y-2"}},{label:a(()=>[B(m(e(n)("form.product_name_english"))+" ",1),l(J,{"image-style":{width:"250px"}},{image:a(()=>o[13]||(o[13]=[u("img",{src:go,class:"object-cover",alt:""},null,-1)])),default:a(()=>[l(H,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:a(()=>[l(v,{placeholder:"Product Name","model-value":t.nameEn,onInput:s=>Y(s,"nameEn",C)},null,8,["model-value","onInput"]),u("span",Ao,m(e(n)("form.description_optional")),1),l(e(ye),{modelValue:t.descriptionEn,"onUpdate:modelValue":s=>t.descriptionEn=s,language:"en-US","editor-id":`en-${C}`,placeholder:e(re).en,toolbars:e(de),sanitize:me,style:{height:"200px",width:"100%",marginTop:"0px"}},null,8,["modelValue","onUpdate:modelValue","editor-id","placeholder","toolbars"])]),_:2},1032,["label"]),l(d,{ui:{container:"space-y-2 my-[20px]"}},{label:a(()=>[B(m(e(n)("form.product_name_chinese"))+" ",1),l(J,{"image-style":{width:"250px"}},{image:a(()=>o[14]||(o[14]=[u("img",{src:To,class:"object-cover",alt:""},null,-1)])),default:a(()=>[l(H,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:a(()=>[l(v,{placeholder:"產品名稱","model-value":t.nameZh,onInput:s=>Y(s,"nameZh",C)},null,8,["model-value","onInput"]),u("span",No,m(e(n)("form.description_optional")),1),l(e(ye),{modelValue:t.descriptionZh,"onUpdate:modelValue":s=>t.descriptionZh=s,language:"en-US","editor-id":`zh-${C}`,placeholder:e(re).zh,toolbars:e(de),sanitize:me,style:{height:"200px",width:"100%",marginTop:"0px"}},null,8,["modelValue","onUpdate:modelValue","editor-id","placeholder","toolbars"])]),_:2},1024)]),_:2},1024),l(fe,{modelValue:t.hasShipping,"onUpdate:modelValue":s=>t.hasShipping=s,"is-show-physical-goods-checkbox":!0,"is-show-setting-modal-button":!0,"shipping-info":e(A)},null,8,["modelValue","onUpdate:modelValue","shipping-info"]),u("div",Oo,[e(N)?(c(),f(g,{key:0,label:e(n)("common.delete"),color:"red",onClick:s=>$e(C)},null,8,["label","onClick"])):$("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:1})),u("div",jo,[e(M)?$("",!0):(c(),f(g,{key:0,ui:{rounded:"rounded-full"},color:"gray",icon:"i-heroicons-plus-solid",label:e(n)("form.add_edition"),onClick:De},null,8,["label"]))]),l(Ze,{"is-stripe-connect-checked":e(O),"onUpdate:isStripeConnectChecked":o[3]||(o[3]=t=>w(O)?O.value=t:null),"is-using-default-account":e(oe),"onUpdate:isUsingDefaultAccount":o[4]||(o[4]=t=>w(oe)?oe.value=t:null),"stripe-connect-wallet":e(j),"should-disable-setting":e(ee),"login-address":e(I),onSave:Oe},null,8,["is-stripe-connect-checked","is-using-default-account","stripe-connect-wallet","should-disable-setting","login-address"]),l(x,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""}}},{header:a(()=>[u("h4",Bo,m(e(n)("form.email_notifications")),1),u("div",Lo,[l(v,{modelValue:e(h),"onUpdate:modelValue":o[5]||(o[5]=t=>w(h)?h.value=t:null),placeholder:"abc@example.com"},null,8,["modelValue"]),l(g,{label:e(n)("common.add"),variant:e(h)?"outline":"solid",color:e(h)?"primary":"gray",disabled:!e(h),onClick:Ne},null,8,["label","variant","color","disabled"])])]),default:a(()=>[l(_e,{columns:[{key:"email",label:e(n)("table.email"),sortable:!0},{key:"action"}],rows:e(Me)},{"email-data":a(({row:t})=>[l(g,{label:t.email,to:`mailto:${t.email}`,variant:"link",padded:!1},null,8,["label","to"])]),"action-data":a(({row:t})=>[u("div",zo,[l(g,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>e(G).splice(t.index,1)},null,8,["onClick"])])]),_:1},8,["columns","rows"])]),_:1}),l(x,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"12px"}}},{default:a(()=>[u("div",Wo,[u("h3",Fo,m(e(n)("nft_book_form.advanced_settings")),1),l(g,{color:"gray",variant:"ghost",icon:e(Q)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",onClick:o[6]||(o[6]=()=>{Q.value=!e(Q)})},null,8,["icon"])]),e(Q)?(c(),le("div",Zo,[l(fe,{"is-show-physical-goods-checkbox":!1,"is-show-setting-modal-button":!0,"shipping-info":e(A),onUpdateShippingRates:Re},null,8,["shipping-info"]),l(x,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"",base:"space-y-8"}}},{header:a(()=>[u("h4",qo,m(e(n)("form.share_sales_data")),1),u("div",Go,[l(v,{modelValue:e(b),"onUpdate:modelValue":o[7]||(o[7]=t=>w(b)?b.value=t:null),class:"font-mono",placeholder:"0x..."},null,8,["modelValue"]),l(g,{label:e(n)("common.add"),variant:e(b)?"outline":"solid",color:e(b)?"primary":"gray",disabled:!e(b),onClick:Ae},null,8,["label","variant","color","disabled"])])]),default:a(()=>[l(_e,{columns:e(Se),rows:e(Ee)},{"wallet-data":a(({row:t})=>[l(g,{class:"font-mono",label:t.wallet,to:t.walletLink,variant:"link",padded:!1},null,8,["label","to"])]),"remove-data":a(({row:t})=>[u("div",Qo,[l(g,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>e(q).splice(t.index,1)},null,8,["onClick"])])]),_:1},8,["columns","rows"])]),_:1}),l(x,{ui:{body:{base:"space-y-8"}}},{header:a(()=>[u("h3",Yo,m(e(n)("form.drm_options")),1)]),default:a(()=>[u("div",Ho,[l(d,{label:e(n)("form.force_nft_claim"),ui:{label:{base:"font-mono font-bold"}}},{default:a(()=>[l(D,{modelValue:e(F),"onUpdate:modelValue":o[8]||(o[8]=t=>w(F)?F.value=t:null),name:"mustClaimToView",label:e(n)("form.must_claim_to_view")},null,8,["modelValue","label"])]),_:1},8,["label"]),l(d,{label:e(n)("form.disable_file_download"),ui:{label:{base:"font-mono font-bold"}}},{default:a(()=>[l(D,{modelValue:e(Z),"onUpdate:modelValue":o[9]||(o[9]=t=>w(Z)?Z.value=t:null),name:"hideDownload",label:e(n)("form.disable_download")},null,8,["modelValue","label"])]),_:1},8,["label"]),l(d,{label:e(n)("form.custom_message_page"),ui:{label:{base:"font-mono font-bold"}}},{default:a(()=>[l(D,{modelValue:e(R),"onUpdate:modelValue":o[10]||(o[10]=t=>w(R)?R.value=t:null),name:"enableCustomMessagePage",label:e(n)("form.enable_custom_message")},null,8,["modelValue","label"])]),_:1},8,["label"])])]),_:1})])):$("",!0)]),_:1}),l(g,{label:e(Ie),loading:e(_),size:"lg",disabled:e(_),onClick:Le},null,8,["label","loading","disabled"])],64)):$("",!0)]),_:1})}}}),bl=co(Jo,[["__scopeId","data-v-bce48b55"]]);export{bl as default};
