import{a_ as to,a$ as ao,b6 as no,bl as lo,bk as io,bn as ee,b9 as g,b8 as r,bK as so,ba as X,bb as ro,b1 as uo,aS as T,aT as _,b3 as P,br as C,aW as i,b4 as e,bs as co,bi as ce,aU as u,aX as s,bf as N,aV as y,bt as mo,bM as me,bj as _o,bF as po,aY as _e,bB as fo,bg as vo,bV as bo,bL as ho,bh as go,aQ as yo}from"./C_4W5mDG.js";import{_ as ko}from"./DEJrXvk0.js";import{_ as wo}from"./CDaSbmg5.js";import{a as xo,_ as So}from"./B6wm2cil.js";import{p as Eo,c as Co,_ as Uo,E as Vo}from"./CtkK69K-.js";import{_ as Po}from"./KWYZieqz.js";import{_ as Io}from"./_meo1bKp.js";import{_ as Mo,v as Ao}from"./CCX8xg_h.js";import{_ as Do}from"./dGSnhl0K.js";import{_ as To}from"./Q12JaMuh.js";import{c as No,D as pe,M as oe,U as $o,b as Lo}from"./B3IOcFOC.js";import{u as zo}from"./R8S1OFIN.js";import{u as Bo}from"./BKpTc3Gx.js";import{g as jo}from"./Sc_PEgqN.js";import{u as Ro}from"./nfR5Ykvy.js";(function(){try{var f=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},R=new f.Error().stack;R&&(f._sentryDebugIds=f._sentryDebugIds||{},f._sentryDebugIds[R]="15854967-d6ba-4ab9-a45a-6c9d393fa5f6",f._sentryDebugIdIdentifier="sentry-dbid-15854967-d6ba-4ab9-a45a-6c9d393fa5f6")}catch{}})();function H(f=""){return f.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function Fo(f){return Eo.sanitize(f)}const Oo={class:"pb-[40px]"},Wo={class:"font-bold font-mono"},Zo={class:"font-bold font-mono"},qo={class:"block text-[14px] text-[#374151] mt-[8px]"},Ko={class:"flex flex-col gap-2"},Go={class:"space-y-2"},Xo={key:0,class:"pl-8 space-y-2"},Ho={class:"space-y-2"},Yo={key:0,class:"pl-8 space-y-2"},Qo={class:"text-gray-500 text-[12px]"},Jo={class:"flex flex-col gap-2"},et={class:"flex justify-center items-center"},ot={class:"flex justify-center items-center"},tt={class:"flex justify-between items-center w-full"},at={class:"font-bold font-mono"},nt={key:0,class:"mt-[24px] flex flex-col gap-[12px]"},lt={class:"text-sm font-bold font-mono"},it={class:"flex gap-2"},st={class:"flex justify-end items-center"},rt={class:"text-sm font-bold font-mono"},ut={class:"flex gap-2"},dt={class:"flex justify-end items-center"},ct={class:"w-full flex justify-center"},mt={class:"space-y-3"},_t={class:"flex justify-between items-center"},pt={class:"text-xs text-gray-500"},ft=1*1024*1024,vt=to({__name:"NewNFTBook",props:{isNewClassPage:{type:Boolean,default:!1},classId:{type:String,default:""},editionIndex:{type:[String,Number],default:void 0},isEditMode:{type:Boolean,default:!1}},emits:["submit"],setup(f,{emit:R}){const{t:n}=ao(),{LIKE_CO_API:te}=no().public,fe=lo(),F=io(),ae=zo(),{wallet:U}=ee(fe),{newBookListing:ve,updateEditionPrice:be,uploadSignImages:he}=F,{fetchStripeConnectStatusByWallet:ge}=ae,{getStripeConnectStatusByWallet:ye}=ee(ae),{token:ke}=ee(F),we=Bo(),{getBalanceOf:xe}=Ro(),Se=R,V=g(()=>j.editionIndex),{lazyFetchClassMetadataById:ne}=we,k=r(""),m=r(!1),Ee=r({en:"e.g.: This edition includes EPUB and PDF ebook files.",zh:"例：此版本包含 EPUB 及 PDF 電子書檔"}),v=g(()=>j.classId),$=r(1),L=r(!1),I=r(!0),b=r([{price:pe,deliveryMethod:"auto",autoMemo:"Thank you for your support. It means a lot to me.",stock:No,name:n("prices.standard_edition"),nameEn:"Standard Edition",nameZh:"標準版",descriptionEn:"",descriptionZh:"",hasShipping:!1,isPhysicalOnly:!1,isAllowCustomPrice:I.value,isUnlisted:!1}]),M=r([]),O=g(()=>b.value.length>1),W=r(["like1rclg677y2jqt8x4ylj0kjlqjjmnn6w63uflpgr"]),Z=r([]),w=r(""),x=r(""),z=r(!1),B=r(""),Y=r(!1),Q=r(!0),Ce=r(null),q=r(null),Ue=r(Number(Lo)),Ve=g(()=>Math.max(ie.value-le.value,0)),Pe=r(0),le=r(0),ie=r(0),Ie=r(["bold","italic","strikeThrough","title","-","unorderedList","orderedList","-","code","link","=","preview"]),E=g(()=>j.isEditMode),Me=g(()=>E.value?n("nft_book_form.edit_title"):n("nft_book_form.page_title")),Ae=g(()=>E.value?n("common.save"):n("common.submit")),K=r(!1),De=g(()=>[{key:"wallet",label:n("common.wallet"),sortable:!0},{key:"remove",label:"",sortable:!1}]),Te=g(()=>W.value.map((a,o)=>({index:o,wallet:a,walletLink:so(a)}))),Ne=g(()=>Z.value.map((a,o)=>({index:o,email:a}))),se=g(()=>{var a,o;return(o=(a=Ce.value)==null?void 0:a.contentMetadata)==null?void 0:o.inLanguage});X(m,a=>{a&&(k.value="")},{immediate:!0}),Co({markdownItConfig(a){a.options.html=!1}});const j=f;ro({title:()=>n("seo_titles.new_book_listing"),ogTitle:()=>n("seo_titles.new_book_listing")}),uo(async()=>{try{m.value=!0;const a=U.value?await xe(v.value,U.value):0;if(ie.value=Number(a)||0,E.value||V.value!==void 0){if(U.value)try{await ge(U.value),ye.value(U.value).isReady&&(z.value=!0,B.value=U.value)}catch(t){console.error(t)}const o=await $fetch(`${te}/likernft/book/store/${v.value}`,{headers:{authorization:`Bearer ${ke.value}`}});if(o){if(M.value=(o==null?void 0:o.shippingRates)||[],(o==null?void 0:o.ownerWallet)!==U.value)throw new Error("NOT_OWNER_OF_NFT_CLASS");if(V.value!==void 0)if(o.prices.length){const t=o.prices.find(d=>d.index.toString()===V.value);if(!t)throw new Error("Edition not found");b.value=[{price:t.price,deliveryMethod:t.isAutoDeliver?"auto":"manual",autoMemo:t.autoMemo,stock:t.stock,name:o.inLanguage==="en"?t.name.en:t.name.zh,nameEn:t.name.en,nameZh:t.name.zh,descriptionEn:t.description.en,descriptionZh:t.description.zh,hasShipping:t.hasShipping,isPhysicalOnly:t.isPhysicalOnly,isAllowCustomPrice:t.isAllowCustomPrice,isUnlisted:t.isUnlisted,oldIsAutoDeliver:t.isAutoDeliver,oldStock:t.stock}],I.value=t.isAllowCustomPrice}else throw new Error("No prices found");Pe.value=o.prices.reduce((t,d)=>d.index.toString()!==V.value?t+d.stock:t,0),le.value=o.prices.reduce((t,d)=>d.index.toString()!==V.value&&!d.isAutoDeliver?t+d.stock:t,0)}else throw new Error(n("errors.nft_class_not_found"))}}catch(a){console.error(a)}finally{m.value=!1}}),X(I,a=>{b.value.forEach(o=>{o.isAllowCustomPrice=a})}),X(m,a=>{a&&(k.value="")}),X(v,async a=>{if(a){const o=await ne(a),t=o==null?void 0:o.contentFingerprints;t&&$e(t)&&(L.value=!0)}},{immediate:!0});function $e(a){const t=jo().API_GET_ARWEAVE_V2_LINK;return a.some(d=>!!d.startsWith(t)||d.includes("?key="))}function Le(a,o="signatureImage"){if(!(a!=null&&a.length))return;const t=a[0];if(t.type!=="image/png"){k.value=n("errors.png_only");return}if(t.size>ft){k.value=n("errors.file_size_limit");return}o==="signatureImage"?q.value=t:console.warn(`Unknown upload key: ${o}`)}function ze(a){a.stock=Math.min(Ve.value,a.stock)}function Be(){$.value+=1,b.value.push({index:Ao(),price:pe,deliveryMethod:"auto",autoMemo:"",stock:1,name:se.value==="en"?`Tier ${$.value}`:`級別 ${$.value}`,nameEn:`Tier ${$.value}`,nameZh:`級別 ${$.value}`,descriptionEn:"",descriptionZh:"",hasShipping:!1,isPhysicalOnly:!1,isAllowCustomPrice:!0,isUnlisted:!1})}function je(a){b.value.splice(a,1)}function Re(a){M.value=a}function Fe(){w.value&&(W.value.push(w.value),w.value="")}function Oe(){x.value&&(Z.value.push(x.value),x.value="")}function We(a){B.value=a,Y.value=!0}function G(a){const o=se.value==="en";return a.map(t=>({name:o?{en:t.name,zh:t.nameZh}:{en:t.nameEn,zh:t.name},description:o?{en:H(t.description),zh:H(t.descriptionZh)}:{en:H(t.descriptionEn),zh:H(t.description)},priceInDecimal:Math.round(Number(t.price)*100),price:Number(t.price),stock:Number(t.stock),isAutoDeliver:!t.isPhysicalOnly&&t.deliveryMethod==="auto",isAllowCustomPrice:t.isAllowCustomPrice,isUnlisted:t.isUnlisted??!1,autoMemo:t.deliveryMethod==="auto"&&t.autoMemo||"",hasShipping:t.hasShipping||!1,isPhysicalOnly:t.isPhysicalOnly||!1}))}function Ze(a){const o=[];return a.forEach(t=>{(!t.name.en||!t.name.zh)&&o.push({path:"name",message:n("errors.product_name_required")}),t.hasShipping&&!M.value.length&&o.push({path:"shipping",message:n("errors.shipping_rates_required")})}),o.length>0?(k.value=o.map(t=>t.message).join(`
`),!1):!0}async function qe(){try{const a=G(b.value);if(!Ze(a))return;if(E.value?await Ke():j.isNewClassPage?await re():(await fetch(`${te}/likernft/book/store/${v.value}`)).ok?await Ge():await re(),q.value){const o=new FormData;q.value&&o.append("signImage",q.value),await he(o,v.value)}Se("submit")}catch{}}async function re(){try{if(!v.value)throw new Error(n("errors.nft_class_id_required"));if(w.value)throw new Error(n("errors.add_moderator_wallet"));if(x.value)throw new Error(n("errors.add_notification_email"));m.value=!0;const a=await ne(v.value),o=(a==null?void 0:a.nft_meta_collection_id)||"";if(!o.includes("nft_book")&&!o.includes("book_nft"))throw new Error(n("errors.not_nft_book_collection"));const t=G(b.value);if(t.find(p=>p.price!==0&&p.price<oe))throw new Error(n("errors.price_validation",{minPrice:oe}));const d=z.value&&B.value?{[B.value]:100}:null,h=M.value.length?M.value.map(p=>({name:{en:p.name.en,zh:p.name.zh},priceInDecimal:p.priceInDecimal,price:p.priceInDecimal/100})):void 0,A=b.value.some(p=>p.deliveryMethod==="manual");await ve(v.value,{defaultPaymentCurrency:"USD",connectedWallets:d,moderatorWallets:W.value,notificationEmails:Z.value,prices:t,shippingRates:h,mustClaimToView:!0,enableCustomMessagePage:A,hideDownload:L.value})}catch(a){const o=a.data||a;console.error(o),k.value=o}finally{Y.value=!1,m.value=!1}}async function Ke(){try{if(!E.value)throw new Error(n("errors.missing_edition_data"));const o=G(b.value)[0];m.value=!0,await be(v.value,V.value,{price:o})}catch(a){const o=a.data||a;console.error(o),k.value=o}finally{m.value=!1}}async function Ge(){try{m.value=!0;const o=G(b.value)[0];await F.addEditionPrice(v.value.toString(),(V.value||0).toString(),{price:o})}catch(a){console.error(a)}finally{m.value=!1}}return(a,o)=>{const t=co,d=ko,h=wo,A=xo,p=Uo,D=mo,Xe=Po,He=fo,ue=Io,Ye=Mo,S=vo,de=So,Qe=Do,Je=bo,eo=ho,oo=go;return _(),T("div",Oo,[e(k)?(_(),P(t,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${e(k)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:o[0]||(o[0]=l=>k.value="")},null,8,["title"])):C("",!0),e(F).isAuthenticated?(_(),T(ce,{key:1},[i(D,{ui:{body:{base:"space-y-4"}}},{header:s(()=>[u("h2",Wo,y(e(Me)),1)]),default:s(()=>[i(h,{label:e(n)("nft_book_form.nft_class_id")},{default:s(()=>[i(d,{"model-value":e(v),disabled:"",class:"font-mono"},null,8,["model-value"])]),_:1},8,["label"]),i(h,{class:"flex items-center"},{default:s(()=>[i(p,{"tool-tip-text":e(n)("nft_book_form.drm_tooltip")},{default:s(()=>[i(A,{modelValue:e(L),"onUpdate:modelValue":o[1]||(o[1]=l=>N(L)?L.value=l:null),name:"hideDownload",disabled:!0,label:e(n)("nft_book_form.drm_label")},null,8,["modelValue","label"])]),_:1},8,["tool-tip-text"])]),_:1}),i(h,null,{default:s(()=>[i(A,{modelValue:e(I),"onUpdate:modelValue":o[2]||(o[2]=l=>N(I)?I.value=l:null),name:"isAllowCustomPrice",label:e(n)("nft_book_form.accept_tipping")},null,8,["modelValue","label"])]),_:1})]),_:1}),(_(),P(me(e(O)?"ul":"div"),{class:"flex flex-col gap-[12px]"},{default:s(()=>[i(D,{ui:{body:{base:"space-y-5 relative"},base:"overflow-visible border-none !border-transparent"}},{default:s(()=>[(_(!0),T(ce,null,_o(e(b),(l,J)=>(_(),P(me(e(O)?"li":"div"),{key:l.index},{default:s(()=>[i(D,{ui:{body:{base:"flex flex-col gap-[20px]"},base:"overflow-visible border-[4px]"}},po({default:s(()=>[i(h,{label:e(n)("nft_book_form.unit_price_label",{minPrice:e(oe)})},{default:s(()=>[i(Xe,{modelValue:l.price,"onUpdate:modelValue":c=>l.price=c,options:e($o),"value-attribute":"value"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:2},1032,["label"]),i(h,{label:e(n)("nft_book_form.copies_label")},{default:s(()=>[i(d,{modelValue:l.stock,"onUpdate:modelValue":c=>l.stock=c,type:"number",step:"1",min:0,max:e(Ue)},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1032,["label"]),i(h,{label:e(n)("new_nft_book.product_name"),ui:{container:"space-y-2"}},{label:s(()=>[_e(y(e(n)("nft_book_form.product_name"))+" ",1),i(p,{"image-style":{width:"250px"}},{image:s(()=>o[9]||(o[9]=[u("img",{src:To,class:"object-cover",alt:""},null,-1)])),default:s(()=>[i(He,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:s(()=>[i(d,{modelValue:l.name,"onUpdate:modelValue":c=>l.name=c,placeholder:e(n)("nft_book_form.product_name_placeholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),u("span",qo,y(e(n)("nft_book_form.description_optional")),1),i(e(Vo),{modelValue:l.descriptionEn,"onUpdate:modelValue":c=>l.descriptionEn=c,language:"en-US","editor-id":`en-${J}`,placeholder:e(Ee).en,toolbars:e(Ie),sanitize:e(Fo),style:{height:"200px",width:"100%",marginTop:"0px"}},null,8,["modelValue","onUpdate:modelValue","editor-id","placeholder","toolbars","sanitize"])]),_:2},1032,["label"]),u("div",Ko,[u("div",Go,[i(ue,{modelValue:l.deliveryMethod,"onUpdate:modelValue":c=>l.deliveryMethod=c,value:"auto",disabled:e(E)&&l.oldIsAutoDeliver,name:"deliveryMethod",label:e(n)("nft_book_form.auto_delivery")},null,8,["modelValue","onUpdate:modelValue","disabled","label"]),l.deliveryMethod==="auto"?(_(),T("div",Xo,[i(h,{label:e(n)("nft_book_form.delivery_memo")},{default:s(()=>[i(d,{modelValue:l.autoMemo,"onUpdate:modelValue":c=>l.autoMemo=c,placeholder:e(n)("nft_book_form.memo_placeholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"])])):C("",!0)]),u("div",Ho,[i(ue,{modelValue:l.deliveryMethod,"onUpdate:modelValue":c=>l.deliveryMethod=c,value:"manual",disabled:e(E)&&l.oldIsAutoDeliver,name:"deliveryMethod",label:e(n)("nft_book_form.manual_delivery"),onClick:c=>ze(l)},null,8,["modelValue","onUpdate:modelValue","disabled","label","onClick"]),l.deliveryMethod==="manual"?(_(),T("div",Yo,[i(h,null,{label:s(()=>[u("p",null,y(e(n)("nft_book_form.autograph_image")),1),u("span",Qo,y(e(n)("nft_book_form.image_requirements")),1)]),default:s(()=>[i(d,{type:"file",accept:"image/png",onChange:o[3]||(o[3]=c=>Le(c,"signatureImage"))})]),_:1})])):C("",!0)])]),i(h,null,{default:s(()=>[i(A,{modelValue:l.isUnlisted,"onUpdate:modelValue":c=>l.isUnlisted=c,name:"isUnlisted",label:e(n)("nft_book_form.pause_selling")},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),u("div",Jo,[i(A,{modelValue:l.hasShipping,"onUpdate:modelValue":c=>l.hasShipping=c,name:"hasShipping",disabled:e(E)&&!l.hasShipping,label:e(n)("nft_book_form.includes_shipping")},null,8,["modelValue","onUpdate:modelValue","disabled","label"]),l.hasShipping?(_(),P(Ye,{key:0,"is-show-physical-goods-checkbox":!1,"is-show-setting-modal-button":!0,"shipping-info":e(M),onUpdateShippingRates:Re},null,8,["shipping-info"])):C("",!0)])]),_:2},[e(O)?{name:"header",fn:s(()=>[u("h3",Zo,y(e(n)("nft_book_form.edition_number",{number:J+1})),1)]),key:"0"}:void 0]),1024),u("div",et,[e(O)?(_(),P(S,{key:0,label:e(n)("common.delete"),color:"red",onClick:c=>je(J)},null,8,["label","onClick"])):C("",!0)])]),_:2},1024))),128))]),_:1})]),_:1})),u("div",ot,[j.isNewClassPage?(_(),P(S,{key:0,ui:{rounded:"rounded-full"},color:"gray",icon:"i-heroicons-plus-solid",label:e(n)("nft_book_form.add_edition"),onClick:Be},null,8,["label"])):C("",!0)]),i(D,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"12px"}}},{default:s(()=>[u("div",tt,[u("h3",at,y(e(n)("nft_book_form.advanced_settings")),1),i(S,{color:"gray",variant:"ghost",icon:e(K)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",onClick:o[4]||(o[4]=()=>{K.value=!e(K)})},null,8,["icon"])]),e(K)?(_(),T("div",nt,[i(D,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""}}},{header:s(()=>[u("h4",lt,y(e(n)("nft_book_form.notification_email_header")),1),u("div",it,[i(d,{modelValue:e(x),"onUpdate:modelValue":o[5]||(o[5]=l=>N(x)?x.value=l:null),placeholder:"abc@example.com"},null,8,["modelValue"]),i(S,{label:e(n)("common.add"),variant:e(x)?"outline":"solid",color:e(x)?"primary":"gray",disabled:!e(x),onClick:Oe},null,8,["label","variant","color","disabled"])])]),default:s(()=>[i(de,{columns:[{key:"email",label:e(n)("common.email"),sortable:!0},{key:"action"}],rows:e(Ne)},{"email-data":s(({row:l})=>[i(S,{label:l.email,to:`mailto:${l.email}`,variant:"link",padded:!1},null,8,["label","to"])]),"action-data":s(({row:l})=>[u("div",st,[i(S,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>e(Z).splice(l.index,1)},null,8,["onClick"])])]),_:1},8,["columns","rows"])]),_:1}),e(E)?(_(),P(Qe,{key:0,"is-stripe-connect-checked":e(z),"onUpdate:isStripeConnectChecked":o[6]||(o[6]=l=>N(z)?z.value=l:null),"is-using-default-account":e(Q),"onUpdate:isUsingDefaultAccount":o[7]||(o[7]=l=>N(Q)?Q.value=l:null),"stripe-connect-wallet":e(B),"should-disable-setting":e(Y),"login-address":e(U),onSave:We},null,8,["is-stripe-connect-checked","is-using-default-account","stripe-connect-wallet","should-disable-setting","login-address"])):C("",!0),i(D,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"",base:"space-y-8"}}},{header:s(()=>[u("h4",rt,y(e(n)("nft_book_form.share_sales_data")),1),u("div",ut,[i(d,{modelValue:e(w),"onUpdate:modelValue":o[8]||(o[8]=l=>N(w)?w.value=l:null),class:"font-mono",placeholder:"0x..."},null,8,["modelValue"]),i(S,{label:e(n)("common.add"),variant:e(w)?"outline":"solid",color:e(w)?"primary":"gray",disabled:!e(w),onClick:Fe},null,8,["label","variant","color","disabled"])])]),default:s(()=>[i(de,{columns:e(De),rows:e(Te)},{"wallet-data":s(({row:l})=>[i(S,{class:"font-mono",label:l.wallet,to:l.walletLink,variant:"link",padded:!1},null,8,["label","to"])]),"remove-data":s(({row:l})=>[u("div",dt,[i(S,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>e(W).splice(l.index,1)},null,8,["onClick"])])]),_:1},8,["columns","rows"])]),_:1})])):C("",!0)]),_:1}),u("div",ct,[i(S,{label:e(Ae),loading:e(m),size:"lg",disabled:e(m),onClick:qe},null,8,["label","loading","disabled"])])],64)):C("",!0),i(oo,{"model-value":!!e(m),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:s(()=>[u("div",mt,[u("div",_t,[i(Je,{variant:"soft"},{default:s(()=>[_e(y(e(n)("common.loading")),1)]),_:1}),u("p",pt,y(e(n)("nft_book_form.loading_progress_text")),1)]),i(eo,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),At=yo(vt,[["__scopeId","data-v-51dad291"]]);export{At as _};
