import{_ as H}from"./Bg7kHGKw.js";import{_ as Q}from"./FQt5NWBD.js";import{_ as W}from"./xH6-99D4.js";import{_ as J}from"./Hi3TXNqg.js";import{n as X,q as Y,u as Z,I as ee,r as p,s as L,v as te,x as oe,o as g,A as S,w as a,b as t,B as l,C as v,J as B,a as w,d as I,t as R,K as ne,L as re,E as ae,M as le,G as se}from"./D8Yytc38.js";import{_ as ie}from"./C-U_FDcx.js";import{_ as ue}from"./C5mHbq49.js";import{_ as de}from"./CElRPX-B.js";import{_ as ce}from"./BWy1NmwK.js";import{p as me}from"./Cp2hUfLz.js";import"./B3OpYCa8.js";import"./C4lamx6Q.js";(function(){try{var f=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new Error().stack;i&&(f._sentryDebugIds=f._sentryDebugIds||{},f._sentryDebugIds[i]="939835a5-cffc-4219-a7c2-33d338b10090",f._sentryDebugIdIdentifier="sentry-dbid-939835a5-cffc-4219-a7c2-33d338b10090")}catch{}})();const _e={class:"flex justify-center"},pe={class:"flex items-center gap-2"},V="key,url",Ue=X({__name:"batch-short-links",setup(f){const i=Y(),x=Z(),T=ee(),D=[{label:"Bitly",value:"bitly"},{label:"Short.io",value:"shortio"}],m=p(x.query.provider||"bitly"),C=L(()=>m.value==="shortio"),h=p(""),b=p(x.query.title_prefix||"NFT Book Press"),u=p(""),P=`${V}
example01,https://example01.com,
example02,https://example02.com,`,_=p(""),A=L(()=>{switch(m.value){case"bitly":return"Bitly Access Token";case"shortio":return"Short.io API Key";default:return""}}),y=p([]);te({title:"Batch Create Book Short Links",ogTitle:"Batch Create Book Short Links"}),oe(()=>{try{const n=sessionStorage.getItem("nft_book_press_batch_shorten_url");n&&(u.value=n,sessionStorage.removeItem("nft_book_press_batch_shorten_url"))}catch(n){console.error(n)}});async function $({url:n,key:e}){try{const o=await $fetch("https://api-ssl.bitly.com/v4/bitlinks",{method:"POST",headers:{Authorization:`Bearer ${_.value}`},body:{long_url:n,domain:"bit.ly",title:[b.value,e].join(" - "),tags:["nft-book-press"]}});if(!o)throw new Error("No data returned from Bitly");return o.link}catch(o){return console.error(o),i.add({icon:"i-heroicons-exclamation-circle",title:o.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}}),"error"}}async function q({url:n,key:e}){try{const o=await $fetch("https://api.short.io/links/public",{method:"POST",headers:{Authorization:_.value},body:{allowDuplicates:!0,domain:h.value,originalURL:n,title:[b.value,e].join(" - "),tags:["nft-book-press"]}});if(!o)throw new Error("No data returned from Short.io");return o.shortURL}catch(o){return console.error(o),i.add({icon:"i-heroicons-exclamation-circle",title:o.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}}),"error"}}async function N(){let n=[];try{let e=u.value;e.includes(V)||(e=`${V}
${e}`),n=me(e,{columns:!0,skip_empty_lines:!0})}catch(e){console.error(e),i.add({icon:"i-heroicons-exclamation-circle",title:e.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}});return}try{for(const{key:e,url:o}of n){let d="";switch(m.value){case"bitly":d=await $({url:o,key:e});break;case"shortio":d=await q({url:o,key:e});break;default:break}y.value.push({key:e,url:d,destination:o})}}catch(e){console.error(e),i.add({icon:"i-heroicons-exclamation-circle",title:e.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}})}}function O(){ne({data:y.value,fileName:"shortened_links.csv",fileType:"csv"})}function E(){sessionStorage.setItem("nft_book_press_batch_qrcode",re(y.value)),T.push({name:"batch-qrcode"})}function j(n){if(!n)return;const[e]=n,o=new FileReader;o.onload=d=>{var c;const s=(c=d.target)==null?void 0:c.result;typeof s=="string"&&(u.value=s)},o.readAsText(e)}return(n,e)=>{const o=H,d=Q,s=W,c=J,F=ae,K=ie,U=le,k=se,z=ue,M=de,G=ce;return g(),S(G,null,{default:a(()=>[t(o,{title:"Batch Create Book Short Links"}),t(M,null,{default:a(()=>[t(s,{label:"Short Link Provider",required:!0},{default:a(()=>[t(d,{modelValue:l(m),"onUpdate:modelValue":e[0]||(e[0]=r=>v(m)?m.value=r:null),options:D},null,8,["modelValue"])]),_:1}),t(s,{label:l(A),required:!0},{default:a(()=>[t(c,{modelValue:l(_),"onUpdate:modelValue":e[1]||(e[1]=r=>v(_)?_.value=r:null),class:"font-mono",autocomplete:!1},null,8,["modelValue"])]),_:1},8,["label"]),l(C)?(g(),S(s,{key:0,label:"Short.io Domain",required:!0},{default:a(()=>[t(c,{modelValue:l(h),"onUpdate:modelValue":e[2]||(e[2]=r=>v(h)?h.value=r:null),class:"font-mono",placeholder:"link.liker.land",autocomplete:!1},null,8,["modelValue"])]),_:1})):B("",!0),t(s,{label:"Title Prefix"},{default:a(()=>[t(c,{modelValue:l(b),"onUpdate:modelValue":e[3]||(e[3]=r=>v(b)?b.value=r:null),hint:"Optional"},null,8,["modelValue"])]),_:1}),t(U,{ui:{body:{base:"space-y-2"}}},{default:a(()=>[t(s,{label:"Upload CSV file"},{default:a(()=>[t(c,{type:"file",accept:"csv",onChange:j})]),_:1}),t(F,{class:"print:hidden",label:"OR"}),t(s,{label:"Input CSV content"},{default:a(()=>[t(K,{modelValue:l(u),"onUpdate:modelValue":e[4]||(e[4]=r=>v(u)?u.value=r:null),class:"font-mono",placeholder:P,resize:!0},null,8,["modelValue"])]),_:1})]),_:1}),w("div",_e,[t(k,{label:"Start",size:"lg",disabled:!l(u)||!l(_)||l(C)&&!l(h),onClick:N},null,8,["disabled"])]),l(y).length?(g(),S(U,{key:1,ui:{header:{base:"flex justify-between items-center gap-2"},body:{padding:""}}},{header:a(()=>[e[5]||(e[5]=w("h3",{class:"font-bold font-mono"}," Results ",-1)),w("div",pe,[t(k,{label:"Download CSV",variant:"outline",onClick:O}),t(k,{label:"Convert to QR Codes",variant:"outline",onClick:E})])]),default:a(()=>[t(z,{columns:[{key:"key",label:"Key"},{key:"url",label:"URL"},{key:"destination",label:"Destination"}],rows:l(y)},{"url-data":a(({row:r})=>[t(k,{class:"font-mono",to:r.url,target:"_blank",rel:"noopener",variant:"link",padded:!1},{default:a(()=>[I(R(r.url),1)]),_:2},1032,["to"])]),"destination-data":a(({row:r})=>[t(k,{class:"font-mono",to:r.destination,target:"_blank",rel:"noopener",variant:"link",padded:!1},{default:a(()=>[I(R(r.destination),1)]),_:2},1032,["to"])]),_:1},8,["rows"])]),_:1})):B("",!0)]),_:1})]),_:1})}}});export{Ue as default};
//# sourceMappingURL=BHGEV2dZ.js.map
