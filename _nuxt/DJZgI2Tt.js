import{_ as le}from"./BobYGP9G.js";import{a_ as re,b3 as ie,bi as ce,bj as ue,a$ as me,bk as de,bl as x,b5 as i,b6 as l,b8 as _e,b0 as fe,b7 as pe,b1 as p,aX as s,bm as be,bn as ke,bo as ye,aT as c,aW as u,bp as P,bd as a,bq as ve,br as ge,aY as C,bs as he,aV as q,bc as E,aU as K,be as Se,aS as we,bt as I,bu as Le,b9 as xe}from"./Dtf-ga44.js";import{_ as Ce}from"./DsCSTb_O.js";import{_ as Ie}from"./DoQBQjeU.js";import{_ as Be}from"./B87bfBat.js";import{_ as Ue}from"./BNebj5Ib.js";import{u as Re}from"./djTNId_E.js";import{u as $e}from"./cjfvGueO.js";import"./BZuHt2f4.js";import"./CvG8K_Ye.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},m=new r.Error().stack;m&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[m]="e79809b4-18f1-4b56-919d-a40a9ca4afc7",r._sentryDebugIdIdentifier="sentry-dbid-e79809b4-18f1-4b56-919d-a40a9ca4afc7")}catch{}})();const Te={class:"flex px-3 py-3.5 border-b border-gray-200"},Ae=["src","alt"],Ne=["textContent"],Fe=re({__name:"latest-books",setup(r){const{BOOK3_URL:m,LIKE_CO_API:B}=ie().public,O=Re(),j=$e(),M=ce(),W=ue(),F=me(),z=de(),{wallet:U}=x(W),{userLikerInfo:R}=x(O),{isAuthenticated:S}=x(M),$=[{label:"Latest Releases",key:"latest"},{label:"Best Sellers",key:"bestselling"}],d=i(""),b=i(!1),T=i([]),A=i([]),k=i(0),_=i(z.query.q||""),w=l(()=>{var e,t;return(e=R.value)!=null&&e.user?be((t=R.value)==null?void 0:t.user):""}),L=l(()=>b.value&&w.value),H=l(()=>[{key:"image",label:"Cover",sortable:!1},{key:"className",label:"Book Name",sortable:!0},{key:"author",label:"Author",sortable:!0},{key:"priceInUSD",label:"Price",sortable:!0},{key:"url",label:L.value?"Affiliation Link":"Link",sortable:!1}]),N=l(()=>$[k.value].key),J=l(()=>N.value==="latest"?T.value:A.value),V=l(()=>J.value.map(e=>{var v,f,g;const t=e.name||e.title,n=e.thumbnailUrl||e.imageUrl,y=((v=e.author)==null?void 0:v.name)||e.author;return{className:t,image:n?ke(ye(n)):void 0,author:y,priceInUSD:`US$${e.minPrice||((g=(f=e.prices)==null?void 0:f[0])==null?void 0:g.price)||0}`,url:`${m}/store/${e.classId}?from=${w.value}&utm_source=bookpress&utm_medium=list_${N.value}`}})),X=l(()=>{if(!_.value)return V.value;const e=_.value.toLowerCase();return V.value.filter(t=>[t.className,t.author].some(n=>n&&n.toLowerCase().includes(e)))});_e({title:"Latest Books",ogTitle:"Latest Books"}),fe(async()=>{if(await Promise.all([Y().catch(e=>{d.value=e}),G().catch(e=>{d.value=e})]),S.value)try{await D()}catch(e){console.error(e)}});async function Y(){const e=await $fetch(`${B}/likernft/book/store/list?limit=100`);T.value=(e==null?void 0:e.list)||[]}async function G(){const e=await $fetch(`${m}/api/store/products?tag=bestselling`);A.value=(e==null?void 0:e.records)||[]}async function D(){if(!U.value){b.value=!1;return}try{const e=await j.fetchStripeConnectStatusByWallet(U.value);b.value=e==null?void 0:e.isReady}catch(e){console.error(e),b.value=!1}}function Q(){I("latest_books_click_affiliation_setup"),F.push({name:"nft-book-store-user"})}function Z(e){I("latest_books_click_table_row"),window.open(e.url,"_blank")}function ee(e,t){e.stopPropagation(),I("latest_books_click_copy_button"),Le(t)}return pe(S,()=>{S.value&&xe(()=>{D()})}),(e,t)=>{const n=le,y=ve,v=he,f=ge,g=Ce,te=Se,oe=Ie,ae=Be,se=Ue;return c(),p(se,null,{default:s(()=>[u(n,{title:"Latest Books on Liker Land Bookstore"}),a(d)?(c(),p(y,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${a(d)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:t[0]||(t[0]=h=>d.value="")},null,8,["title"])):P("",!0),a(L)?(c(),p(f,{key:2},{default:s(()=>[t[3]||(t[3]=C(" Append ")),u(v,{class:"font-mono"},{default:s(()=>[C(" ?from="+q(a(w)),1)]),_:1}),t[4]||(t[4]=C(" in any bookstore page to earn commission from book sales. "))]),_:1,__:[3,4]})):(c(),p(y,{key:1,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"soft",title:"Join Our Affiliation Program!",description:"Setup your Liker ID and Stripe Connect Account to participate in sales affiliation program on Liker Land Bookstore.",actions:[{label:"Setup",color:"orange",variant:"outline",click:Q}]},null,8,["actions"])),u(ae,{modelValue:a(k),"onUpdate:modelValue":t[2]||(t[2]=h=>E(k)?k.value=h:null),class:"w-full",items:$},{item:s(({item:h})=>[(c(),p(f,{key:h.key,ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{default:s(()=>[K("div",Te,[u(g,{modelValue:a(_),"onUpdate:modelValue":t[1]||(t[1]=o=>E(_)?_.value=o:null),placeholder:"Filter books by name or author"},null,8,["modelValue"])]),u(oe,{columns:a(H),rows:a(X),onSelect:Z},{"image-data":s(({row:o})=>[o.image?(c(),we("img",{key:0,src:o.image,alt:o.className,class:"w-12 h-12 object-cover rounded-lg"},null,8,Ae)):P("",!0)]),"className-data":s(({row:o})=>[K("div",{class:"max-w-[20vw] whitespace-normal",textContent:q(o.className)},null,8,Ne)]),"url-data":s(({row:o})=>[u(te,{label:"Copy",disabled:!a(L),onClick:ne=>ee(ne,o.url)},null,8,["disabled","onClick"])]),_:1},8,["columns","rows"])]),_:2},1024))]),_:1},8,["modelValue"])]),_:1})}}});export{Fe as default};
