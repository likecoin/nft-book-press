import{n as ge,O as he,Q as we,R as ee,P as xe,a0 as be,u as Ie,I as Ce,r,s as O,h as te,x as Ne,a8 as Se,o as v,A as U,w as y,a9 as ae,U as ke,a,t as c,B as t,J as B,d as oe,b as d,C as Fe,c as R,D as Te,F as ne,y as $e,aa as Be,ab as Ee,ac as De,X as Ue,a1 as Re,M as Ae,G as Pe,E as Ve}from"./DBE1DAG7.js";import{_ as qe}from"./C1ufFlX3.js";import{_ as Le}from"./BARo-uas.js";import{_ as Me}from"./DFyQwwX-.js";import{u as Oe,_ as ze}from"./CK5FiWBs.js";import{_ as He}from"./RnWDTU7B.js";import{u as We}from"./CaIMtus0.js";import"./8mvRbGEp.js";(function(){try{var C=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},N=new Error().stack;N&&(C._sentryDebugIds=C._sentryDebugIds||{},C._sentryDebugIds[N]="9e6e0138-8b71-40a1-a2b9-e810795c4d4a",C._sentryDebugIdIdentifier="sentry-dbid-9e6e0138-8b71-40a1-a2b9-e810795c4d4a")}catch{}})();const je={class:"text-lg font-bold font-mono"},Ge={class:"divide-y w-full"},Qe={class:"px-4 py-3"},Je={class:"px-4 py-3"},Ke={class:"px-4 py-3"},Xe={class:"px-4 py-3"},Ye={class:"px-4 py-3"},Ze={class:"text-left px-4 py-3"},et={class:"px-4 py-3"},tt={class:"px-4 py-3"},at={class:"flex flex-wrap items-center justify-center gap-2"},ot=["src"],ft=ge({__name:"[collectionId]",setup(C){const{LIKE_CO_API:N,LCD_URL:z}=he().public,H=we(),{wallet:S,signer:k}=ee(H),{initIfNecessary:W}=H,j=xe(),{token:G}=ee(j),Q=We(),A=be(),{lazyFetchClassMetadataById:le}=Q,{lazyFetchCollectionById:se}=A,P=Ie(),re=Ce(),g=r(""),h=r(!1),w=r(P.params.collectionId),J=r(P.query.payment_id),E=r(P.query.owner_wallet||S.value),F=r(""),{messageCharCount:ie,isLimitReached:K}=Oe(F,ae),f=r([]),V=r([]),b=r(!1),I=r(!1),T=r(""),p=r(!1),X=r(void 0),l=r({}),$=r([]),Y=O(()=>p.value||h.value||b.value||I.value||!!T.value||K.value),ue=O(()=>{var o;return(o=A.getCollectionById(w.value))==null?void 0:o.name}),x=O(()=>{var o;return(o=A.getCollectionById(w.value))==null?void 0:o.classIds});te(h,o=>{o&&(g.value="")}),te(p,o=>{o||f.value.forEach(async(e,n)=>{e?$.value[n]=await Z(x.value[n],e):$.value[n]=""})}),Ne(async()=>{const o=await $fetch(`${N}/likernft/book/collection/purchase/${w.value}/status/${J.value}`,{headers:{authorization:`Bearer ${G.value}`}});l.value=o,await se(w.value),await Promise.all(x.value.map(e=>le(e))),q(l.value.quantity||1)});function ce(o){var e;return(e=Q.getClassMetadataById(o))==null?void 0:e.name}function de(){p.value=!p.value,T.value="",$e(()=>{var o,e,n;p.value&&((n=(e=(o=X.value)==null?void 0:o.$refs)==null?void 0:e.input)==null||n.focus())})}async function Z(o,e){var n,u,i;try{b.value=!0;const s=await $fetch(`${z}/cosmos/nft/v1beta1/nfts/${o}/${e}`),_=((i=(u=(n=s==null?void 0:s.nft)==null?void 0:n.data)==null?void 0:u.metadata)==null?void 0:i.image)||"";return ke(_)}catch(s){return g.value=s.toString(),""}finally{b.value=!1}}async function q(o=1){try{if(T.value="",I.value=!0,(!S.value||!k.value)&&await W(),!E.value)return;await Promise.all(x.value.map(async(e,n)=>{if(!V.value[n]){const{nfts:u}=await Se({classId:e,owner:E.value,needCount:o});if(u.length)V.value[n]=u.map(i=>i.id),f.value[n]=u[0].id,$.value[n]=await Z(e,f.value[n]);else throw new Error(`${E.value} does not hold any NFT of class ${e}`)}}))}catch(e){g.value=e.toString()}finally{I.value=!1}}function fe(){q(l.value.quantity||1)}async function pe(){if(!Y.value)try{if(h.value=!0,(!S.value||!k.value)&&await W(),!S.value||!k.value)return;if(await q(l.value.quantity),await Promise.all(x.value.map(async(s,_)=>{if(f.value[_]){const{owner:L}=await Be(s,f.value[_]);if(L!==E.value)throw new Error(`NFT classId: ${s} nftId:${f.value[_]} is not owned by sender!`)}})),x.value.find(s=>!s))throw new Error("Please specify NFT class ID");if(f.value.find(s=>!s))throw new Error("Please specify NFT ID");if(!(await Ee(k.value)).getSigningStargateClient())throw new Error("Signing client not exists");const n=x.value.map(s=>new Array(l.value.quantity).fill(s)).flat(),u=V.value.flat(),i=await De(l.value.wallet,n,u,k.value,S.value,F.value);i.transactionHash&&i.code===0&&(await $fetch(`${N}/likernft/book/collection/purchase/${w.value}/sent/${J.value}`,{method:"POST",body:{txHash:i.transactionHash,quantity:l.value.quantity||1},headers:{authorization:`Bearer ${G.value}`}}),re.push({name:"nft-book-store-collection-status-collectionId",params:{collectionId:w.value}}))}catch(o){console.error(o),g.value=o.toString()}finally{h.value=!1}}return(o,e)=>{const n=Ue,u=Re,i=Ae,s=qe,_=Le,L=Me,M=Pe,me=Ve,ye=ze,_e=He;return v(),U(_e,null,{default:y(()=>[a("h1",je,' Deliver NFT Book Collection "'+c(t(ue)||t(w))+'" ',1),t(g)?(v(),U(n,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${t(g)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:e[0]||(e[0]=m=>g.value="")},null,8,["title"])):B("",!0),t(h)?(v(),U(u,{key:1,animation:"carousel"},{indicator:y(()=>e[2]||(e[2]=[oe(" Loading... ")])),_:1})):B("",!0),t(j).isAuthenticated?(v(),U(i,{key:2,ui:{body:{base:"space-y-4"},footer:{base:"flex justify-center gap-2"}}},{footer:y(()=>[d(M,{label:"Sign and Send",disabled:t(Y),size:"xl",onClick:pe},null,8,["disabled"])]),default:y(()=>[d(i,{ui:{body:{padding:""}}},{default:y(()=>{var m;return[a("table",Ge,[a("tbody",null,[a("tr",null,[e[3]||(e[3]=a("th",{class:"text-left px-4 py-3"}," Buyer Email ",-1)),a("td",Qe,c(t(l).email),1)]),a("tr",null,[e[4]||(e[4]=a("th",{class:"text-left px-4 py-3"}," Reader Email ",-1)),a("td",Je,c(((m=t(l).giftInfo)==null?void 0:m.toEmail)||t(l).email),1)]),a("tr",null,[e[5]||(e[5]=a("th",{class:"text-left px-4 py-3"}," Status ",-1)),a("td",Ke,c(t(l).status),1)]),a("tr",null,[e[6]||(e[6]=a("th",{class:"text-left px-4 py-3"}," Buyer Wallet ",-1)),a("td",Xe,c(t(l).wallet),1)]),a("tr",null,[e[7]||(e[7]=a("th",{class:"text-left px-4 py-3"}," Price ",-1)),a("td",Ye,c(t(l).price),1)]),a("tr",null,[e[8]||(e[8]=a("th",{class:"text-left px-4 py-3"}," Quantity ",-1)),a("td",Ze,c(t(l).quantity),1)]),a("tr",null,[e[9]||(e[9]=a("th",{class:"text-left px-4 py-3"}," Buyer message ",-1)),a("td",et,c(t(l).message),1)]),a("tr",null,[e[10]||(e[10]=a("th",{class:"text-left px-4 py-3"}," Sales channel ",-1)),a("td",tt,c(t(l).from),1)])])])]}),_:1}),d(_,{label:"Enter Author's Message",error:t(K),hint:`${t(ie)} / ${t(ae)}`},{default:y(()=>[d(s,{modelValue:t(F),"onUpdate:modelValue":e[1]||(e[1]=m=>Fe(F)?F.value=m:null),placeholder:"default memo"},null,8,["modelValue"])]),_:1},8,["error","hint"]),d(_,{label:"Specify NFT ID",error:t(T)},{default:y(()=>[(v(!0),R(ne,null,Te(t(x),(m,D)=>(v(),R("div",{key:m},[a("label",null,c(ce(m)+": "+m),1),a("div",at,[t(l).quantity===1?(v(),R(ne,{key:0},[d(L,{ref_for:!0,ref_key:"nftIdInputRef",ref:X,modelValue:t(f)[D],"onUpdate:modelValue":ve=>t(f)[D]=ve,class:"font-mono flex-grow",readonly:!t(p),disabled:!t(p),placeholder:"Leave empty to auto-fetch NFT ID","trailing-icon":t(T)?"i-heroicons-exclamation-triangle-20-solid":void 0},null,8,["modelValue","onUpdate:modelValue","readonly","disabled","trailing-icon"]),d(M,{label:t(p)||t(b)&&!t(I)?"Confirm":"Edit",disabled:t(h)||t(b),variant:"outline",loading:t(b)&&!t(I),color:"gray",onClick:de},null,8,["label","disabled","loading"]),d(me,{class:"text-sm text-gray-600 sm:w-min"},{default:y(()=>e[11]||(e[11]=[oe(" OR ")])),_:1})],64)):B("",!0),d(M,{label:`Auto-fetch NFT ID for ${t(l).quantity} orders`,disabled:t(h)||t(p),loading:t(I),variant:"outline",onClick:fe},null,8,["label","disabled","loading"])]),d(ye,{class:"h-[300px]"},{default:y(()=>[t($)[D]?(v(),R("img",{key:0,class:"max-w-[180px] w-full h-full object-contain",src:t($)[D]},null,8,ot)):B("",!0)]),_:2},1024)]))),128))]),_:1},8,["error"])]),_:1})):B("",!0)]),_:1})}}});export{ft as default};
//# sourceMappingURL=BkqdmUZC.js.map
