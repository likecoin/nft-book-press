import{n as _e,a2 as he,q as xe,s as we,M as ke,u as Ve,x as Ie,r as s,C as oe,z as Ue,o as D,c as te,b as l,w as t,a4 as Pe,L as Ce,a as m,F as o,B as H,d as E,N as ae,a6 as z,G as d,a7 as Ne,W as Te,a9 as Se,K as De,a3 as Ee,Q as Ae,a8 as Re}from"./DR6WU_yq.js";import{_ as Be}from"./B8B-7YQb.js";import{_ as Me}from"./CNIlkbbq.js";import{_ as ze,a as Fe}from"./6Edx6PQd.js";import{_ as Le}from"./BIcD57rw.js";import{j as $e,u as ne,p as je,_ as Oe}from"./DiU9vwOe.js";import{_ as qe}from"./Cielvbn_.js";import{_ as Ge,a as He,b as We}from"./C6pswnDP.js";import{_ as Ze}from"./B-S8jxLs.js";import{u as Ke}from"./DZwj6PIs.js";import"./BqgLnsO0.js";import"./CiJ55Vv0.js";import"./C2QABZ7n.js";(function(){try{var x=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},p=new Error().stack;p&&(x._sentryDebugIds=x._sentryDebugIds||{},x._sentryDebugIds[p]="bfe6a648-3460-484e-a9e1-a61abff43ace",x._sentryDebugIdIdentifier="sentry-dbid-bfe6a648-3460-484e-a9e1-a61abff43ace")}catch{}})();const Qe=["src"],dl=_e({__name:"edit",setup(x){const p=he(),W=Ke(),Z=xe(),{initIfNecessary:se}=Z,{wallet:F,signer:L}=we(Z),K=ke(),ie=Ve(),$=Ie(),f=s(ie.params.collectionId),v=s(!1),i=s({}),A=s([]),b=s(Pe),w=s(1),k=s("auto"),V=s("Thanks for purchasing this NFT ebook."),I=s("Standard Edition"),U=s("標準版"),P=s(""),C=s(""),g=s(""),N=s(!1),h=s(!0),T=s(!1),y=s(!1),j=s([]),O=s(!1),q=s(0),R=s(!1),Q=s(["bold","italic","strikeThrough","title","-","unorderedList","orderedList","-","code","link","=","preview"]),J=s({en:"Product description in English...",zh:"產品中文描述..."}),X=oe(()=>k.value==="auto"),ue=oe(()=>R.value?q.value:0),{getClassMetadataById:re}=W;$e({markdownItConfig(a){a.options.html=!1}});function de(a){const e=a.target.value,u=b.value;Number(u)!==0&&Number(e)===0&&(h.value=!0)}Ue(async()=>{var a,e,u,_;try{v.value=!0,i.value=await p.fetchCollectionById(f.value);const r=i.value.typePayload;r&&(i.value={...i.value,...r}),A.value=i.value.classIds||[],b.value=i.value.priceInDecimal/100||0,w.value=i.value.stock||0,I.value=((a=i.value.name)==null?void 0:a.en)||"",U.value=((e=i.value.name)==null?void 0:e.zh)||"",g.value=i.value.image||"",P.value=((u=i.value.description)==null?void 0:u.en)||" ",C.value=((_=i.value.description)==null?void 0:_.zh)||" ",N.value=i.value.hasShipping||!1,j.value=i.value.shippingRates||[],y.value=i.value.isPhysicalOnly||!1,h.value=i.value.isAllowCustomPrice||!1,T.value=i.value.isUnlisted||!1,k.value=i.value.isAutoDeliver?"auto":"manual",V.value=i.value.autoMemo||"",q.value=i.value.stock,R.value=i.value.isAutoDeliver}catch(r){console.error(r),$.add({icon:"i-heroicons-exclamation-circle",title:r.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}})}finally{v.value=!1}});function Y(a=""){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function ee(a){return je.sanitize(a)}function ce(){K.push({name:"nft-book-store-collection-status-collectionId",params:{collectionId:f.value}})}async function me(a){var e;O.value=!0;try{await p.updateNFTBookCollectionById(f.value,{shippingRates:a});const u=await p.fetchCollectionById(f.value);j.value=(e=u==null?void 0:u.typePayload)==null?void 0:e.shippingRates}catch(u){const _=u.data||u;console.error(_),$.add({icon:"i-heroicons-exclamation-circle",title:_,timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}})}finally{O.value=!1}}async function pe(){try{const a={classIds:A.value,name:{en:I.value,zh:U.value},description:{en:Y(P.value),zh:Y(C.value)},image:g.value,priceInDecimal:Math.round(Number(b.value)*100),price:Number(b.value),stock:Number(w.value),isAutoDeliver:!y.value&&X.value,autoMemo:V.value||"",hasShipping:N.value||!1,isPhysicalOnly:y.value||!1,isAllowCustomPrice:h.value??!0,isUnlisted:T.value??!1};if(!a||a.price===void 0)throw new Error("Please input price of edition");if(a.price!==0&&a.price<z)throw new Error(`Price of each edition must be at least $${z} or $0 (free)`);if(!a.stock&&a.stock!==0)throw new Error("Please input stock of edition");if(a.stock<0)throw new Error("Stock cannot be negative");if(!a.name.en||!a.name.zh)throw new Error("Please input product name");v.value=!0;let e=0;a.isAutoDeliver&&(e=R.value?a.stock-q.value:a.stock);let u;if(e>0){if((!F.value||!L.value)&&await se(),!F.value||!L.value)throw new Error("Unable to connect to wallet");u=await Se(A.value,[],e,L.value,F.value)}await p.updateNFTBookCollectionById(f.value,{autoDeliverNFTsTxHash:u,...a}),K.push({name:"nft-book-store-collection-status-collectionId",params:{collectionId:f.value}})}catch(a){const e=a.data||a;console.error(e),$.add({icon:"i-heroicons-exclamation-circle",title:e,timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}})}finally{v.value=!1}}return(a,e)=>{const u=De,_=Ee,r=Be,c=Me,fe=ze,S=Ae,ve=Le,B=Re,M=Oe,G=Fe,be=qe,ge=Ce;return D(),te("div",null,[l(ge,{"model-value":!0,ui:{width:"sm:max-w-7xl"}},{default:t(()=>[l(S,{ui:{header:{base:"flex justify-between items-center"},body:{base:"space-y-4"},footer:{base:"flex justify-end items-center"}}},{header:t(()=>[e[13]||(e[13]=m("h2",{class:"font-bold font-mono"}," Edit collection info ",-1)),l(u,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:ce})]),footer:t(()=>[l(u,{label:"Save Changes",loading:o(v),size:"lg",disabled:o(v),onClick:pe},null,8,["loading","disabled"])]),default:t(()=>[o(v)?(D(),H(_,{key:0,animation:"carousel"},{indicator:t(()=>e[14]||(e[14]=[E(" Loading... ")])),_:1})):ae("",!0),l(S,{ui:{body:{base:"space-y-4"}}},{header:t(()=>e[15]||(e[15]=[m("h2",{class:"font-bold font-mono"}," Class Info ",-1)])),default:t(()=>[l(c,{label:"NFT collection ID"},{default:t(()=>[l(r,{class:"font-mono",value:o(f),readonly:!0,disabled:!0},null,8,["value"])]),_:1}),l(c,{label:"Books in Collection"},{default:t(()=>[l(S,{ui:{body:{padding:""}}},{default:t(()=>[l(fe,{columns:[{key:"classId",label:"Class ID"},{key:"name",label:"Book Name"}],rows:o(A).map((n,ye)=>{var le;return{index:ye,classId:n,name:(le=o(re)(n))==null?void 0:le.name}})},null,8,["rows"])]),_:1})]),_:1})]),_:1}),l(S,{ui:{body:{base:"flex flex-col gap-[20px]"},base:"overflow-visible"}},{header:t(()=>e[16]||(e[16]=[m("h3",{class:"font-bold font-mono"}," Pricing and Availability ",-1)])),default:t(()=>[l(c,{label:`Price(USD) of this collection (Minimal ${o(z)} or $0 (free)) / 版本定價（美金）`},{default:t(()=>[l(r,{modelValue:o(b),"onUpdate:modelValue":e[0]||(e[0]=n=>d(b)?b.value=n:null),type:"number",step:"0.01",min:o(z),onInput:de},null,8,["modelValue","min"])]),_:1},8,["label"]),l(c,{label:"Total number of NFT for sale of this collection / 此定價上架的數量"},{default:t(()=>[l(r,{modelValue:o(w),"onUpdate:modelValue":e[1]||(e[1]=n=>d(w)?w.value=n:null),type:"number",step:"1",min:o(ue)},null,8,["modelValue","min"])]),_:1}),l(ve,{modelValue:o(k),"onUpdate:modelValue":e[2]||(e[2]=n=>d(k)?k.value=n:null),disabled:o(R)||o(y),legend:"Delivery method of this collection / 自動或手動發書",options:o(Ne)},null,8,["modelValue","disabled","options"]),o(X)?(D(),H(c,{key:0},{label:t(()=>[e[18]||(e[18]=E(" Memo of this collection / 自動發書留言 ")),l(M,null,{image:t(()=>e[17]||(e[17]=[m("img",{src:Ge,class:"object-cover",alt:""},null,-1)])),default:t(()=>[l(B,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:t(()=>[l(r,{modelValue:o(V),"onUpdate:modelValue":e[3]||(e[3]=n=>d(V)?V.value=n:null)},null,8,["modelValue"])]),_:1})):(D(),H(c,{key:1,label:"Is Physical only good / 只含實體書",ui:{label:{base:"font-mono font-bold"}}},{default:t(()=>[l(G,{modelValue:o(y),"onUpdate:modelValue":e[4]||(e[4]=n=>d(y)?y.value=n:null),name:"isPhysicalOnly",label:"This collection does not contain any digital file/NFT"},null,8,["modelValue"])]),_:1})),l(c,null,{label:t(()=>[e[20]||(e[20]=E(" Allow custom price / 開啟打賞功能 ")),l(M,{"image-style":{width:"300px"}},{image:t(()=>e[19]||(e[19]=[m("img",{src:He,class:"object-cover",alt:""},null,-1)])),default:t(()=>[l(B,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:t(()=>[l(G,{modelValue:o(h),"onUpdate:modelValue":e[5]||(e[5]=n=>d(h)?h.value=n:null),name:"isAllowCustomPrice",label:"Allow user to pay more than defined price"},null,8,["modelValue"])]),_:1}),l(c,{label:"Unlist Edition / 暫時下架"},{default:t(()=>[l(G,{modelValue:o(T),"onUpdate:modelValue":e[6]||(e[6]=n=>d(T)?T.value=n:null),name:"isUnlisted",label:"Pause selling of this Edition"},null,8,["modelValue"])]),_:1})]),_:1}),l(S,{ui:{body:{base:"flex flex-col gap-[20px]"},base:"overflow-visible"}},{header:t(()=>e[21]||(e[21]=[m("h3",{class:"font-bold font-mono"}," Product Information ",-1)])),default:t(()=>[l(c,{label:"Product Name",ui:{container:"space-y-2"}},{label:t(()=>[e[23]||(e[23]=E(" Product Name / 產品名稱（英文） ")),l(M,{"image-style":{width:"250px"}},{image:t(()=>e[22]||(e[22]=[m("img",{src:Ze,class:"object-cover",alt:""},null,-1)])),default:t(()=>[l(B,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:t(()=>[l(r,{modelValue:o(I),"onUpdate:modelValue":e[7]||(e[7]=n=>d(I)?I.value=n:null),placeholder:"Product name in English"},null,8,["modelValue"]),e[24]||(e[24]=m("span",{class:"block text-[14px] text-[#374151] mt-[8px]"},"Description (Optional) / 描述（選填）",-1)),l(o(ne),{modelValue:o(P),"onUpdate:modelValue":e[8]||(e[8]=n=>d(P)?P.value=n:null),language:"en-US","editor-id":"en",placeholder:o(J).en,toolbars:o(Q),sanitize:ee,style:{height:"200px",width:"100%",marginTop:"0px"}},null,8,["modelValue","placeholder","toolbars"])]),_:1}),l(c,{ui:{container:"space-y-2 my-[20px]"}},{label:t(()=>[e[26]||(e[26]=E(" 產品名稱（中文） ")),l(M,{"image-style":{width:"250px"}},{image:t(()=>e[25]||(e[25]=[m("img",{src:We,class:"object-cover",alt:""},null,-1)])),default:t(()=>[l(B,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:t(()=>[l(r,{modelValue:o(U),"onUpdate:modelValue":e[9]||(e[9]=n=>d(U)?U.value=n:null),placeholder:"產品中文名字"},null,8,["modelValue"]),e[27]||(e[27]=m("span",{class:"block text-[14px] text-[#374151] mt-[8px]"},"描述 (選填)",-1)),l(o(ne),{modelValue:o(C),"onUpdate:modelValue":e[10]||(e[10]=n=>d(C)?C.value=n:null),language:"en-US","editor-id":"zh",placeholder:o(J).zh,toolbars:o(Q),sanitize:ee,style:{height:"200px",width:"100%",marginTop:"0px"}},null,8,["modelValue","placeholder","toolbars"])]),_:1}),l(c,{label:"Image of this book collection",ui:{container:"space-y-2"}},{default:t(()=>[l(r,{modelValue:o(g),"onUpdate:modelValue":e[11]||(e[11]=n=>d(g)?g.value=n:null),class:"font-mono",placeholder:"https://, ar://, ipfs://...."},null,8,["modelValue"]),o(g)?(D(),te("img",{key:0,src:o(Te)(o(g)),class:"w-1/3"},null,8,Qe)):ae("",!0)]),_:1})]),_:1}),l(be,{modelValue:o(N),"onUpdate:modelValue":e[12]||(e[12]=n=>d(N)?N.value=n:null),"is-show-physical-goods-checkbox":!0,"shipping-info":o(j),"is-loading":o(O),onUpdateShippingRates:me},null,8,["modelValue","shipping-info","is-loading"])]),_:1})]),_:1})])}}});export{dl as default};
//# sourceMappingURL=Bz4E4Rlt.js.map
