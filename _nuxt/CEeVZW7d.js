import{a_ as E,b7 as M,a$ as O,bz as K,b8 as L,b0 as q,b9 as b,bb as F,b1 as X,ba as f,b3 as g,aT as x,aX as n,bi as U,aW as r,b4 as e,bj as G,aU as k,aV as v,bq as J,bA as Q,cv as Y,cw as C}from"./Bm-IVQXy.js";import{_ as Z}from"./QQqPabFv.js";import{_ as ee}from"./By4zMR4m.js";import{_ as te}from"./BuTWThA6.js";import{a as se}from"./BXXo0CL6.js";import{u as ae}from"./BhEP3np7.js";import"./eXK-QAli.js";import"./Aujz5yYv.js";import"./CHUa3QAq.js";(function(){try{var l=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},d=new l.Error().stack;d&&(l._sentryDebugIds=l._sentryDebugIds||{},l._sentryDebugIds[d]="aaa7b502-7fc0-41db-a366-3565c59b6e3f",l._sentryDebugIdIdentifier="sentry-dbid-aaa7b502-7fc0-41db-a366-3565c59b6e3f")}catch{}})();const oe=["textContent"],ne=["href"],re=["textContent"],be=E({__name:"index",setup(l){const{LIKE_CO_API:d,BOOK3_URL:I}=M().public,{t:s}=O(),S=se(),A=K(),{token:w,wallet:$}=L(A),H=q(),T=ae(),{getStripeConnectStatusByWallet:z}=L(T),c=b(""),i=b(!1),h=b([]),B=b([]);F(i,t=>{t&&(c.value="")}),X(async()=>{await Promise.all([R(),D(),T.refreshStripeConnectStatus($.value)])});const N=f(()=>z.value($.value)),P=f(()=>N.value?.isReady),V=f(()=>h.value.map(t=>{let a=t.type;switch(a){case"connectedWallet":a="royalties";break;case"channelCommission":a="channel";break}return{...t,type:a,amount:C(t.amount,t.currency),amountTotal:C(t.amountTotal,t.currency),currency:Y(t.currency),timestamp:new Date(t.timestamp).toLocaleString()}})),W=f(()=>B.value.map(t=>{const{id:a,amount:o,currency:m,status:p,arrivalTs:_,createdTs:y}=t;return{id:a,amount:C(o,m),status:p,createdTs:new Date(y*1e3).toLocaleString(),arrivalTs:_?new Date(_*1e3).toLocaleString():""}}));async function R(){try{i.value=!0;const t=await $fetch(`${d}/likernft/book/user/commissions/list`,{headers:{authorization:`Bearer ${w.value}`}});h.value=t?.commissions||[],new Set(h.value.filter(o=>o.classId).map(o=>o.classId)).forEach(o=>S.lazyFetchClassMetadataById(o))}catch(t){console.error(t),c.value=t.toString()}finally{i.value=!1}}async function D(){try{i.value=!0;const t=await $fetch(`${d}/likernft/book/user/payouts/list`,{headers:{authorization:`Bearer ${w.value}`}});B.value=t?.payouts||[]}catch(t){c.value=t.toString()}finally{i.value=!1}}return(t,a)=>{const o=G,m=J,p=Z,_=ee,y=Q,j=te;return x(),g(j,null,{default:n(()=>[e(c)?(x(),g(o,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${e(c)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:a[0]||(a[0]=u=>c.value="")},null,8,["title"])):U("",!0),e(P)?U("",!0):(x(),g(o,{key:1,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"soft",title:e(s)("user_settings.stripe_express_notice"),description:e(s)("user_settings.stripe_express_description")},null,8,["title","description"])),r(y,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{header:n(()=>[k("h1",{class:"text-center font-bold font-mono",textContent:v(e(s)("user_settings.commission_history"))},null,8,oe),r(p,{text:e(s)("user_settings.commission_history.tooltip"),popper:{placement:"left"}},{default:n(()=>[r(m,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:e(i),onClick:R},null,8,["disabled"])]),_:1},8,["text"])]),default:n(()=>[r(_,{columns:[{key:"timestamp",label:e(s)("user_settings.timestamp")},{key:"type",label:e(s)("user_settings.commission_type")},{key:"amount",label:e(s)("user_settings.commission")},{key:"classId",label:e(s)("user_settings.book_id")},{key:"currency",label:e(s)("user_settings.currency")},{key:"amountTotal",label:e(s)("user_settings.sale_amount")}],rows:e(V),ui:{th:{base:"text-center"},td:{base:"text-center"}}},{"classId-data":n(({row:u})=>[k("a",{href:`${e(I)}/store/${u.classId}`,target:"_blank"},v(e(S).getClassMetadataById(u.classId)?.name||u.classId),9,ne)]),_:1},8,["columns","rows"])]),_:1}),r(y,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{header:n(()=>[k("h1",{class:"text-center font-bold font-mono",textContent:v(e(s)("user_settings.payout_history"))},null,8,re),r(p,{text:"Refresh Status",popper:{placement:"left"}},{default:n(()=>[r(m,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:e(i),onClick:D},null,8,["disabled"])]),_:1})]),default:n(()=>[r(_,{columns:[{key:"createdTs",label:e(s)("user_settings.created")},{key:"amount",label:e(s)("user_settings.payout_amount")},{key:"status",label:e(s)("user_settings.status")},{key:"arrivalTs",label:e(s)("user_settings.arrived")},{key:"details",label:e(s)("user_settings.details")}],rows:e(W),ui:{th:{base:"text-center"},td:{base:"text-center"}}},{"details-data":n(({row:u})=>[r(m,{label:e(s)("user_settings.details"),size:"sm",color:"gray",to:e(H)({name:"sales-report-payouts-payoutId",params:{payoutId:u.id}})},null,8,["label","to"])]),_:1},8,["columns","rows"])]),_:1})]),_:1})}}});export{be as default};
