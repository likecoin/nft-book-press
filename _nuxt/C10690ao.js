import{a_ as te,bl as re,b6 as ne,bn as ue,b8 as o,b9 as O,ba as ee,b1 as ce,dv as ye,aS as C,aT as b,aW as i,b4 as t,bf as se,aX as N,aU as f,cL as he,aY as W,aV as $,bO as Ie,bh as Ne,cQ as Se,aQ as Fe,b3 as H,bt as xe,cs as Te,bg as de,br as j,bb as ke,bs as Ce,a$ as $e,bm as Re,b0 as Ue,dw as Me,b2 as ae,dx as De,bc as le,bi as Ee,bj as Be,cv as Ve,dy as Le}from"./BfW3r3Wd.js";import{u as pe,b as Ae,v as Oe,c as ie,d as Pe,f as Ke,a as ze,_ as je,e as qe}from"./JazDwP7d.js";import{a as Ge,u as We}from"./aSOrzHxo.js";import{a as Ye,u as He}from"./BwYtUaEQ.js";import{_ as Je}from"./yng8DgXc.js";import{_ as me}from"./B1TLLwzs.js";import{_ as Qe}from"./Nkzj0jKQ.js";import{_ as Xe}from"./C83KFBWS.js";import"./B7VSlOfD.js";import"./BnG6nrxJ.js";import"./j-cVX1YD.js";import"./tbJqhEUi.js";import"./DLeeLdeN.js";import"./Cmgm7ykt.js";import"./DbbEb5Tq.js";import"./WMl6APt8.js";import"./BemY0Evb.js";import"./zks30B68.js";import"./Cqqp3aC0.js";import"./eXDiBZKU.js";import"./C6P8gX7I.js";import"./CHAZJJ7x.js";(function(){try{var S=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},p=new S.Error().stack;p&&(S._sentryDebugIds=S._sentryDebugIds||{},S._sentryDebugIds[p]="7af87461-0b26-4036-9ee2-e213753079d7",S._sentryDebugIdIdentifier="sentry-dbid-7af87461-0b26-4036-9ee2-e213753079d7")}catch{}})();const Ze={class:"space-y-3"},et={class:"flex justify-between items-center"},tt={class:"text-xs text-gray-500"},at=te({__name:"RegisterISCN",emits:["handleSubmit","submit","formValidChange"],setup(S,{expose:p,emit:r}){const F=re(),{getFileType:R}=ie(),{LIKE_EVM_NFT_TARGET_ADDRESS:x}=ne().public,{wallet:y,signer:h}=ue(F),{initIfNecessary:_}=F,{assertPositiveWalletBalance:a,waitForTransactionReceipt:T}=Ye(),{stripHtmlTags:M,formatLanguage:P}=ie(),{showErrorToast:D}=pe(),{LIKE_NFT_CONTRACT_ADDRESS:g}=ne().public,w=o({type:"Book",title:"",description:"",isbn:"",publisher:"",publicationDate:"",author:{name:"",description:""},license:"All Rights Reserved",customLicense:"",contentFingerprints:[{url:""}],downloadableUrls:[{url:"",type:"",fileName:""}],language:"",bookInfoUrl:"",tags:[],coverUrl:""}),c=o(""),U=o(""),K=r,{payload:q}=Ae({iscnFormData:w}),{writeContractAsync:G}=He(),s=O(()=>Oe(w.value)),u=O(()=>{var e;return!((e=s.value)!=null&&e.length)});ee(u,e=>{K("formValidChange",e)},{immediate:!0}),ce(()=>{const e=E();e&&(w.value=e)});const E=()=>{var k,I,V,L,z,J;const e=ye();if(!e)return null;const m={type:"Book",title:((k=e.epubMetadata)==null?void 0:k.title)||"",description:M(((I=e.epubMetadata)==null?void 0:I.description)||""),isbn:"",publisher:"",publicationDate:new Date().toISOString().split("T")[0],author:{name:((V=e.epubMetadata)==null?void 0:V.author)||"",description:""},license:"All Rights Reserved",contentFingerprints:[],downloadableUrls:[],coverUrl:(L=e.epubMetadata)!=null&&L.thumbnailArweaveId?`ar://${e.epubMetadata.thumbnailArweaveId}`:"",language:P(((z=e.epubMetadata)==null?void 0:z.language)||"zh"),tags:((J=e.epubMetadata)==null?void 0:J.tags)||[]};return m.downloadableUrls=e.fileRecords.filter(d=>d.fileType==="application/pdf"||d.fileType==="application/epub+zip").map(d=>({url:d.arweaveKey?d.arweaveLink:`ar://${d.arweaveId}`,type:R(d.fileType),fileName:d.fileName})),m.contentFingerprints=[...new Set(e.fileRecords.map(d=>{const Q=d.arweaveKey?d.arweaveLink:`ar://${d.arweaveId}`;return d.fileType==="application/epub+zip"||d.fileType==="application/pdf"?Q:`ar://${d.arweaveId}`}).filter(Boolean))].map(d=>({url:d})),m},B=async()=>{if(c.value="checking",!u.value){D(s.value.join(", "));return}w.value.contentFingerprints.length&&await Y()},Y=async()=>{if(c.value="loading",await _(),!y.value||!h.value){U.value="MISSING_SIGNER",c.value="";return}try{c.value="signing";const e=Ke(q.value),m={name:e.name,description:e.description,...e,symbol:"BOOK",image:(e==null?void 0:e.thumbnailUrl)||"",external_link:(e==null?void 0:e.url)||"",nft_meta_collection_id:"nft_book",nft_meta_collection_name:"NFT Book",nft_meta_collection_description:"NFT Book by Liker Land",recordTimestamp:new Date().toISOString()};await a({wallet:y.value});const k=await G({address:g,abi:Ge,functionName:"newBookNFTWithRoyalty",args:[{creator:y.value,updaters:[y.value,x],minters:[y.value,x],config:{name:m.name,symbol:"BOOK",metadata:JSON.stringify(m),max_supply:Se}},500]}),I=await T({hash:k});if(console.log(I),!I||I.status!=="success")throw new Error("INVALID_RECEIPT");if(!I.logs[0].address)throw new Error("INVALID_CLASS_ID");const V=I.logs[0].address;c.value="success",K("submit",{iscnId:V,txHash:k})}catch(e){console.error(e),D(`'SIGNING_ERROR':${e}`),c.value=""}finally{c.value=""}};return p({onSubmit:B}),(e,m)=>{const k=Pe,I=he,V=Ie,L=Ne;return b(),C("div",null,[i(k,{modelValue:t(w),"onUpdate:modelValue":m[0]||(m[0]=z=>se(w)?w.value=z:null)},null,8,["modelValue"]),i(L,{"model-value":!!t(c),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:N(()=>[f("div",Ze,[f("div",et,[i(I,{variant:"soft"},{default:N(()=>[W($(t(c)),1)]),_:1}),f("p",tt,$(e.$t("notifications.iscn_registration_complete")),1)]),i(V,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),nt=Fe(at,[["__scopeId","data-v-1eece739"]]),st={class:"font-bold font-mono"},ot=te({__name:"ISCNInfoCard",props:{iscnId:{},iscnOwner:{},iscnData:{},showEditButton:{type:Boolean}},emits:["edit"],setup(S){const{OPENSEA_URL:p}=ne().public;return(r,F)=>{const R=de,x=Je,y=me,h=xe;return b(),H(h,{ui:{body:{base:"space-y-4"}}},{header:N(()=>[f("h2",st,$(r.$t("iscn.information")),1)]),default:N(()=>[i(x,{label:r.$t("iscn.owner"),class:"text-left"},{default:N(()=>[i(R,{label:r.iscnOwner,to:`${t(p)}/${encodeURIComponent(r.iscnOwner)}`,target:"_blank",variant:"link",padded:!1},null,8,["label","to"])]),_:1},8,["label"]),i(x,{label:r.$t("common.title")},{default:N(()=>{var _,a;return[i(y,{value:(a=(_=r.iscnData)==null?void 0:_.contentMetadata)==null?void 0:a.name,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1},8,["label"]),i(x,{label:r.$t("common.description")},{default:N(()=>{var _,a;return[i(y,{value:(a=(_=r.iscnData)==null?void 0:_.contentMetadata)==null?void 0:a.description,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1},8,["label"]),Te(r.$slots,"actions",{},()=>[r.showEditButton?(b(),H(R,{key:0,label:r.$t("iscn.edit_metadata"),onClick:F[0]||(F[0]=_=>r.$emit("edit"))},null,8,["label"])):j("",!0)])]),_:3})}}}),lt={class:"flex flex-col items-stretch grow space-y-4"},it=te({__name:"MintNFT",props:{iscnId:{type:String,default:""}},emits:["submit","formValidChange","loadingChange"],setup(S,{expose:p,emit:r}){const{getClassOwner:F,getClassMetadata:R,checkNFTClassIsBookNFT:x}=We(),y=o(1),h=o(""),_=o(!1),a=o(""),T=o(null),M=o(""),P=o(null),D=O(()=>{var s;return(s=T.value)==null?void 0:s["@id"]}),g=o(!1),w=o(!1),c=r;ee(_,s=>{c("loadingChange",s),s&&(h.value="")},{immediate:!0}),ee(w,s=>{c("formValidChange",s)},{immediate:!0}),ke({title:"Mint Liker Land NFT Book",ogTitle:"Mint Liker Land NFT Book"});const U=S;ee(()=>U.iscnId,async s=>{s&&await K(U.iscnId)},{immediate:!0});async function K(s){if(s)try{if(_.value=!0,!await x(s))throw new Error("Invalid NFT Class ID");const[E,B]=await Promise.all([R(s),F(s)]);if(!E)throw new Error("Invalid NFT Class ID");T.value={contentMetadata:E,owner:B,"@id":s},a.value=B,M.value=s,y.value=3}catch(u){console.error(u),h.value=u.toString()}finally{_.value=!1}}function q(){var s;(s=P.value)==null||s.startNFTMintFlow()}function G({classId:s,nftMintCount:u}={}){M.value=s||"",c("submit",{classId:s||"",nftMintCount:u})}return p({startNFTMintFlow:q}),(s,u)=>{const E=Ce,B=ot,Y=ze,e=je;return b(),C("div",lt,[t(h)?(b(),H(E,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${t(h)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:u[0]||(u[0]=m=>h.value="")},null,8,["title"])):j("",!0),i(B,{"iscn-id":t(D),"iscn-owner":t(a),"iscn-data":t(T),"show-edit-button":!0,onEdit:u[1]||(u[1]=m=>g.value=!0)},null,8,["iscn-id","iscn-owner","iscn-data"]),i(Y,{ref_key:"liteMintNFTRef",ref:P,"iscn-data":t(T),"should-show-submit":!1,onFormValidChange:u[2]||(u[2]=m=>w.value=m),onSubmit:G},null,8,["iscn-data"]),i(e,{modelValue:t(g),"onUpdate:modelValue":u[3]||(u[3]=m=>se(g)?g.value=m:null),"class-id":t(M)},null,8,["modelValue","class-id"])])}}}),rt={class:"w-full"},ut={class:"justify-evenly items-center flex space-x-4 relative"},ct={class:"text-sm font-semibold"},dt={class:"mt-6 p-4 border rounded-lg bg-gray-100 text-center flex flex-col gap-[24px]"},pt={key:0},mt={key:1},_t={key:2},ft={key:3},vt={class:"flex gap-2 justify-center mt-4"},bt={key:0,class:"flex flex-col justify-center px-[12px] mt-[16px]"},gt={class:"flex flex-col items-center gap-4 py-4"},wt={class:"flex flex-col items-center"},yt={key:0},ht={class:"flex items-center"},It={key:0,class:"flex flex-col items-center gap-2 w-full max-w-md"},qt=te({__name:"index",setup(S){var Q,oe;const{t:p}=$e(),r=re(),{wallet:F,signer:R}=ue(r),{initIfNecessary:x}=r,y=Re(),h=Ue(),{showErrorToast:_}=pe(),a=o(0),T=o(),M=o(),P=o(),D=o(!1),g=o(""),w=o(""),c=o(((Q=y.query.iscn_id)==null?void 0:Q.toString())||""),U=o(((oe=y.query.class_id)==null?void 0:oe.toString())||""),K=o([]),q=o(""),G=o(!1),s=o(!1),u=o(!1),E=O(()=>!!w.value),B=O(()=>{switch(a.value){case 0:return"Start Upload";case 1:return"Register ISCN";case 2:return"Mint NFT";default:return"Next"}}),Y=O(()=>{var l;return((l=K.value)==null?void 0:l.length)>0}),e=O(()=>a.value===0?Y.value:a.value<3),m=O(()=>a.value===0?q.value!=="":a.value===2?u.value:!1),k=[{title:p("publish_steps.upload_files"),description:"Upload your book file"},{title:p("publish_steps.register_iscn"),description:"Register ISCN"},{title:p("publish_steps.mint_nft"),description:"Mint NFT"},{title:p("publish_steps.new_book_publish"),description:"Publish new book"}];ce(()=>{var n;let l=null;try{const A=sessionStorage.getItem(Me);A&&(l=JSON.parse(A))}catch(A){console.error(A)}c.value?(g.value=c.value,L({iscnId:c.value})):U.value?z({classId:U.value}):l!=null&&l.epubMetadata&&(l!=null&&l.fileRecords)&&(w.value=(n=l==null?void 0:l.epubMetadata)==null?void 0:n.title)});const I=async()=>{if((!F.value||!R.value)&&await x(),!F.value||!R.value){_("Please login first");return}try{if(a.value===0&&T.value){await T.value.onSubmit();return}if(a.value===1){if(!G.value){_("Please fill in all required fields");return}await M.value.onSubmit();return}if(a.value===2){if(!s.value){_("Please fill in all required fields");return}await P.value.startNFTMintFlow();return}a.value<k.length-1&&a.value++}catch(l){console.error("Error during form submission:",l)}},V=l=>{Le(l),a.value=1},L=async l=>{const{iscnId:n}=l;n&&await ae(h({query:{iscn_id:n}}),{replace:!0}),De(),a.value=2,await le(),c.value=n},z=async l=>{const{classId:n,nftMintCount:A}=l;n&&(U.value=n,await ae(h({query:{class_id:n,count:A}}),{replace:!0}),a.value=3,await le())},J=async()=>{await ae(h({name:"nft-book-store"}))},d=async()=>{g.value&&await L({iscnId:g.value})};return(l,n)=>{const A=Ve,_e=qe,fe=nt,ve=it,be=Qe,X=de,ge=me,we=Xe;return b(),H(we,{class:"flex flex-col items-stretch grow space-y-4"},{default:N(()=>[f("div",rt,[f("div",ut,[n[8]||(n[8]=f("div",{class:"absolute w-full h-[1px] bg-gray-300 top-[50%] left-0 z-[-1]"},null,-1)),(b(),C(Ee,null,Be(k,(v,Z)=>f("div",{key:Z,class:"flex items-center space-x-2 bg-white p-2 rounded-lg"},[i(A,{size:Z===t(a)?"lg":"md",text:(Z+1).toString(),ui:{background:Z===t(a)?"bg-primary-100":"bg-gray-200"}},null,8,["size","text","ui"]),f("p",ct,$(v.title),1)])),64))]),f("div",dt,[t(a)===0?(b(),C("div",pt,[i(_e,{ref_key:"uploadFormRef",ref:T,onFileUploadStatus:n[0]||(n[0]=v=>q.value=v),onFileReady:n[1]||(n[1]=v=>K.value=v),onSubmit:V},null,512)])):t(a)===1?(b(),C("div",mt,[i(fe,{ref_key:"registerISCN",ref:M,onFormValidChange:n[2]||(n[2]=v=>G.value=v),onSubmit:L},null,512)])):t(a)===2?(b(),C("div",_t,[i(ve,{ref_key:"mintNFT",ref:P,"iscn-id":t(c),onLoadingChange:n[3]||(n[3]=v=>u.value=v),onFormValidChange:n[4]||(n[4]=v=>s.value=v),onSubmit:z},null,8,["iscn-id"])])):t(a)===3?(b(),C("div",ft,[i(be,{ref:"newNFTBook",class:"p-0 flex flex-col text-left gap-[24px]","is-new-class-page":!0,"class-id":t(U),onSubmit:J},null,8,["class-id"])])):j("",!0),f("div",vt,[t(e)?(b(),H(X,{key:0,disabled:t(m),onClick:I},{default:N(()=>[W($(t(B)),1)]),_:1},8,["disabled"])):j("",!0)])]),t(a)===0?(b(),C("div",bt,[n[9]||(n[9]=f("div",{class:"w-full bg-gray-300 h-[1px]"},null,-1)),f("div",gt,[f("div",wt,[t(E)?(b(),C("div",yt,[W($(t(p)("publish_steps.continue_last_register"))+" ",1),i(X,{variant:"ghost",class:"text-primary-500 font-semibold",onClick:n[5]||(n[5]=v=>a.value=1)},{default:N(()=>[W($(t(w)),1)]),_:1})])):j("",!0),f("div",ht,[f("span",null,$(t(p)("publish_steps.already_have_iscn")),1),i(X,{variant:"ghost",onClick:n[6]||(n[6]=v=>D.value=!t(D))},{default:N(()=>[W($(t(p)("publish_steps.here")),1)]),_:1})])]),t(D)?(b(),C("div",It,[i(ge,{modelValue:t(g),"onUpdate:modelValue":n[7]||(n[7]=v=>se(g)?g.value=v:null),placeholder:t(p)("publish_steps.enter_iscn_id")},null,8,["modelValue","placeholder"]),i(X,{disabled:!t(g),onClick:d},{default:N(()=>[W($(t(p)("common.confirm")),1)]),_:1},8,["disabled"])])):j("",!0)])])):j("",!0)])]),_:1})}}});export{qt as default};
