import{_ as G}from"./BPSdN1lB.js";import{_ as H}from"./w5LVNL1l.js";import{_ as W}from"./BjKcvyIE.js";import{_ as J}from"./CtNY1BU_.js";import{n as X,x as Y,u as Z,M as ee,r as p,C as B,y as te,z as oe,o as g,B as S,w as a,b as t,F as l,G as v,N as L,a as w,d as I,t as R,O as ne,P as re,J as ae,Q as le,K as se}from"./BzQORAGQ.js";import{_ as ie}from"./6U2XS0tJ.js";import{_ as ue}from"./BS0hUOUR.js";import{_ as de}from"./CvhVVHmx.js";import{_ as ce}from"./C_9j0UzK.js";import{p as me}from"./Cp2hUfLz.js";import"./t9_g7etR.js";import"./DZ0PThcp.js";(function(){try{var f=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new Error().stack;i&&(f._sentryDebugIds=f._sentryDebugIds||{},f._sentryDebugIds[i]="c8e3511b-15ea-43fc-8051-353afb0d95d0",f._sentryDebugIdIdentifier="sentry-dbid-c8e3511b-15ea-43fc-8051-353afb0d95d0")}catch{}})();const _e={class:"flex justify-center"},pe={class:"flex items-center gap-2"},V="key,url",Ue=X({__name:"batch-short-links",setup(f){const i=Y(),x=Z(),P=ee(),T=[{label:"Bitly",value:"bitly"},{label:"Short.io",value:"shortio"}],m=p(x.query.provider||"bitly"),C=B(()=>m.value==="shortio"),h=p(""),b=p(x.query.title_prefix||"NFT Book Press"),u=p(""),D=`${V}
example01,https://example01.com,
example02,https://example02.com,`,_=p(""),N=B(()=>{switch(m.value){case"bitly":return"Bitly Access Token";case"shortio":return"Short.io API Key";default:return""}}),y=p([]);te({title:"Batch Create Book Short Links",ogTitle:"Batch Create Book Short Links"}),oe(()=>{try{const n=sessionStorage.getItem("nft_book_press_batch_shorten_url");n&&(u.value=n,sessionStorage.removeItem("nft_book_press_batch_shorten_url"))}catch(n){console.error(n)}});async function $({url:n,key:e}){try{const o=await $fetch("https://api-ssl.bitly.com/v4/bitlinks",{method:"POST",headers:{Authorization:`Bearer ${_.value}`},body:{long_url:n,domain:"bit.ly",title:[b.value,e].join(" - "),tags:["nft-book-press"]}});if(!o)throw new Error("No data returned from Bitly");return o.link}catch(o){return console.error(o),i.add({icon:"i-heroicons-exclamation-circle",title:o.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}}),"error"}}async function A({url:n,key:e}){try{const o=await $fetch("https://api.short.io/links/public",{method:"POST",headers:{Authorization:_.value},body:{allowDuplicates:!0,domain:h.value,originalURL:n,title:[b.value,e].join(" - "),tags:["nft-book-press"]}});if(!o)throw new Error("No data returned from Short.io");return o.shortURL}catch(o){return console.error(o),i.add({icon:"i-heroicons-exclamation-circle",title:o.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}}),"error"}}async function O(){let n=[];try{let e=u.value;e.includes(V)||(e=`${V}
${e}`),n=me(e,{columns:!0,skip_empty_lines:!0})}catch(e){console.error(e),i.add({icon:"i-heroicons-exclamation-circle",title:e.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}});return}try{for(const{key:e,url:o}of n){let d="";switch(m.value){case"bitly":d=await $({url:o,key:e});break;case"shortio":d=await A({url:o,key:e});break;default:break}y.value.push({key:e,url:d,destination:o})}}catch(e){console.error(e),i.add({icon:"i-heroicons-exclamation-circle",title:e.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}})}}function q(){ne({data:y.value,fileName:"shortened_links.csv",fileType:"csv"})}function F(){sessionStorage.setItem("nft_book_press_batch_qrcode",re(y.value)),P.push({name:"batch-qrcode"})}function j(n){if(!n)return;const[e]=n,o=new FileReader;o.onload=d=>{var c;const s=(c=d.target)==null?void 0:c.result;typeof s=="string"&&(u.value=s)},o.readAsText(e)}return(n,e)=>{const o=G,d=H,s=W,c=J,z=ae,E=ie,U=le,k=se,K=ue,M=de,Q=ce;return g(),S(Q,null,{default:a(()=>[t(o,{title:"Batch Create Book Short Links"}),t(M,null,{default:a(()=>[t(s,{label:"Short Link Provider",required:!0},{default:a(()=>[t(d,{modelValue:l(m),"onUpdate:modelValue":e[0]||(e[0]=r=>v(m)?m.value=r:null),options:T},null,8,["modelValue"])]),_:1}),t(s,{label:l(N),required:!0},{default:a(()=>[t(c,{modelValue:l(_),"onUpdate:modelValue":e[1]||(e[1]=r=>v(_)?_.value=r:null),class:"font-mono",autocomplete:!1},null,8,["modelValue"])]),_:1},8,["label"]),l(C)?(g(),S(s,{key:0,label:"Short.io Domain",required:!0},{default:a(()=>[t(c,{modelValue:l(h),"onUpdate:modelValue":e[2]||(e[2]=r=>v(h)?h.value=r:null),class:"font-mono",placeholder:"link.liker.land",autocomplete:!1},null,8,["modelValue"])]),_:1})):L("",!0),t(s,{label:"Title Prefix"},{default:a(()=>[t(c,{modelValue:l(b),"onUpdate:modelValue":e[3]||(e[3]=r=>v(b)?b.value=r:null),hint:"Optional"},null,8,["modelValue"])]),_:1}),t(U,{ui:{body:{base:"space-y-2"}}},{default:a(()=>[t(s,{label:"Upload CSV file"},{default:a(()=>[t(c,{type:"file",accept:"csv",onChange:j})]),_:1}),t(z,{class:"print:hidden",label:"OR"}),t(s,{label:"Input CSV content"},{default:a(()=>[t(E,{modelValue:l(u),"onUpdate:modelValue":e[4]||(e[4]=r=>v(u)?u.value=r:null),class:"font-mono",placeholder:D,resize:!0},null,8,["modelValue"])]),_:1})]),_:1}),w("div",_e,[t(k,{label:"Start",size:"lg",disabled:!l(u)||!l(_)||l(C)&&!l(h),onClick:O},null,8,["disabled"])]),l(y).length?(g(),S(U,{key:1,ui:{header:{base:"flex justify-between items-center gap-2"},body:{padding:""}}},{header:a(()=>[e[5]||(e[5]=w("h3",{class:"font-bold font-mono"}," Results ",-1)),w("div",pe,[t(k,{label:"Download CSV",variant:"outline",onClick:q}),t(k,{label:"Convert to QR Codes",variant:"outline",onClick:F})])]),default:a(()=>[t(K,{columns:[{key:"key",label:"Key"},{key:"url",label:"URL"},{key:"destination",label:"Destination"}],rows:l(y)},{"url-data":a(({row:r})=>[t(k,{class:"font-mono",to:r.url,target:"_blank",rel:"noopener",variant:"link",padded:!1},{default:a(()=>[I(R(r.url),1)]),_:2},1032,["to"])]),"destination-data":a(({row:r})=>[t(k,{class:"font-mono",to:r.destination,target:"_blank",rel:"noopener",variant:"link",padded:!1},{default:a(()=>[I(R(r.destination),1)]),_:2},1032,["to"])]),_:1},8,["rows"])]),_:1})):L("",!0)]),_:1})]),_:1})}}});export{Ue as default};
//# sourceMappingURL=DD97oc4X.js.map
