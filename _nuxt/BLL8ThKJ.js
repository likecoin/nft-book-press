import{ee as E,ef as U,eg as X,eh as L,ei as Y,ej as J,ek as O,el as R,em as Q,en as tt,dU as et,eo as S,ep as $,eq as at,er as nt,es as rt,et as st,eu as q,ev as ot,ew as ct,ex as it,dX as F,ey as ut,ez as W,eA as lt,eB as Z,eC as dt,dW as ft,eD as bt,dZ as pt,d_ as mt,e0 as ht,cT as P}from"./Dm55n_q7.js";import{g as wt,r as yt,m as gt,d as kt,c as j,e as Tt,L as D}from"./FexUiCd7.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},n=new t.Error().stack;n&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[n]="b4cca431-cff3-4a47-be0f-a5e372755b17",t._sentryDebugIdIdentifier="sentry-dbid-b4cca431-cff3-4a47-be0f-a5e372755b17")}catch{}})();const Nt=new Map,Ct=new Map;function vt(t){const n=(i,a)=>({clear:()=>a.delete(i),get:()=>a.get(i),set:r=>a.set(i,r)}),e=n(t,Nt),o=n(t,Ct);return{clear:()=>{e.clear(),o.clear()},promise:e,response:o}}async function Bt(t,{cacheKey:n,cacheTime:e=Number.POSITIVE_INFINITY}){const o=vt(n),i=o.response.get();if(i&&e>0&&new Date().getTime()-i.created.getTime()<e)return i.data;let a=o.promise.get();a||(a=t(),o.promise.set(a));try{const r=await a;return o.response.set({created:new Date,data:r}),r}finally{o.promise.clear()}}const It=t=>`blockNumber.${t}`;async function Rt(t,{cacheTime:n=t.cacheTime}={}){const e=await Bt(()=>t.request({method:"eth_blockNumber"}),{cacheKey:It(t.uid),cacheTime:n});return BigInt(e)}async function K(t,{blockHash:n,blockNumber:e,blockTag:o,hash:i,index:a}){var d,u,s;const r=o||"latest",p=e!==void 0?E(e):void 0;let c=null;if(i?c=await t.request({method:"eth_getTransactionByHash",params:[i]},{dedupe:!0}):n?c=await t.request({method:"eth_getTransactionByBlockHashAndIndex",params:[n,E(a)]},{dedupe:!0}):c=await t.request({method:"eth_getTransactionByBlockNumberAndIndex",params:[p||r,E(a)]},{dedupe:!!p}),!c)throw new U({blockHash:n,blockNumber:e,blockTag:r,hash:i,index:a});return(((s=(u=(d=t.chain)==null?void 0:d.formatters)==null?void 0:u.transaction)==null?void 0:s.format)||X)(c)}async function G(t,{hash:n}){var i,a,r;const e=await t.request({method:"eth_getTransactionReceipt",params:[n]},{dedupe:!0});if(!e)throw new L({hash:n});return(((r=(a=(i=t.chain)==null?void 0:i.formatters)==null?void 0:a.transactionReceipt)==null?void 0:r.format)||Y)(e)}async function Ft(t,n){var k;const{account:e,allowFailure:o=!0,batchSize:i,blockNumber:a,blockTag:r,multicallAddress:p,stateOverride:c}=n,l=n.contracts,d=i??(typeof((k=t.batch)==null?void 0:k.multicall)=="object"&&t.batch.multicall.batchSize||1024);let u=p;if(!u){if(!t.chain)throw new Error("client chain not configured. multicallAddress is required.");u=wt({blockNumber:a,chain:t.chain,contract:"multicall3"})}const s=[[]];let f=0,b=0;for(let m=0;m<l.length;m++){const{abi:h,address:B,args:w,functionName:N}=l[m];try{const g=J({abi:h,args:w,functionName:N});b+=(g.length-2)/2,d>0&&b>d&&s[f].length>0&&(f++,b=(g.length-2)/2,s[f]=[]),s[f]=[...s[f],{allowFailure:!0,callData:g,target:B}]}catch(g){const I=O(g,{abi:h,address:B,args:w,docsPath:"/docs/contract/multicall",functionName:N,sender:e});if(!o)throw I;s[f]=[...s[f],{allowFailure:!0,callData:"0x",target:B}]}}const y=await Promise.allSettled(s.map(m=>R(t,yt,"readContract")({abi:gt,account:e,address:u,args:[m],blockNumber:a,blockTag:r,functionName:"aggregate3",stateOverride:c}))),C=[];for(let m=0;m<y.length;m++){const h=y[m];if(h.status==="rejected"){if(!o)throw h.reason;for(let w=0;w<s[m].length;w++)C.push({status:"failure",error:h.reason,result:void 0});continue}const B=h.value;for(let w=0;w<B.length;w++){const{returnData:N,success:g}=B[w],{callData:I}=s[m][w],{abi:T,address:_,functionName:v,args:A}=l[C.length];try{if(I==="0x")throw new Q;if(!g)throw new tt({data:N});const x=kt({abi:T,args:A,data:N,functionName:v});C.push(o?{result:x,status:"success"}:x)}catch(x){const M=O(x,{abi:T,address:_,args:A,docsPath:"/docs/contract/multicall",functionName:v});if(!o)throw M;C.push({error:M,result:void 0,status:"failure"})}}}if(C.length!==l.length)throw new et("multicall results mismatch");return C}function _t(t,{emitOnBegin:n=!1,emitMissed:e=!1,onBlockNumber:o,onError:i,poll:a,pollingInterval:r=t.pollingInterval}){const p=typeof a<"u"?a:!(t.transport.type==="webSocket"||t.transport.type==="ipc"||t.transport.type==="fallback"&&(t.transport.transports[0].config.type==="webSocket"||t.transport.transports[0].config.type==="ipc"));let c;return p?(()=>{const u=S(["watchBlockNumber",t.uid,n,e,r]);return $(u,{onBlockNumber:o,onError:i},s=>at(async()=>{var f;try{const b=await R(t,Rt,"getBlockNumber")({cacheTime:0});if(c){if(b===c)return;if(b-c>1&&e)for(let y=c+1n;y<b;y++)s.onBlockNumber(y,c),c=y}(!c||b>c)&&(s.onBlockNumber(b,c),c=b)}catch(b){(f=s.onError)==null||f.call(s,b)}},{emitOnBegin:n,interval:r}))})():(()=>{const u=S(["watchBlockNumber",t.uid,n,e]);return $(u,{onBlockNumber:o,onError:i},s=>{let f=!0,b=()=>f=!1;return(async()=>{try{const y=(()=>{if(t.transport.type==="fallback"){const k=t.transport.transports.find(m=>m.config.type==="webSocket"||m.config.type==="ipc");return k?k.value:t.transport}return t.transport})(),{unsubscribe:C}=await y.subscribe({params:["newHeads"],onData(k){var h;if(!f)return;const m=nt((h=k.result)==null?void 0:h.number);s.onBlockNumber(m,c),c=m},onError(k){var m;(m=s.onError)==null||m.call(s,k)}});b=C,f||b()}catch(y){i==null||i(y)}})(),()=>b()})})()}async function At(t,{confirmations:n=1,hash:e,onReplaced:o,pollingInterval:i=t.pollingInterval,retryCount:a=6,retryDelay:r=({count:c})=>~~(1<<c)*200,timeout:p=18e4}){const c=S(["waitForTransactionReceipt",t.uid,e]);let l,d,u,s=!1,f,b;const{promise:y,resolve:C,reject:k}=rt(),m=p?setTimeout(()=>{b(),f(),k(new st({hash:e}))},p):void 0;return f=$(c,{onReplaced:o,resolve:C,reject:k},h=>{b=R(t,_t,"watchBlockNumber")({emitMissed:!0,emitOnBegin:!0,poll:!0,pollingInterval:i,async onBlockNumber(B){const w=g=>{clearTimeout(m),b(),g(),f()};let N=B;if(!s)try{if(u){if(n>1&&(!u.blockNumber||N-u.blockNumber+1n<n))return;w(()=>h.resolve(u));return}if(l||(s=!0,await q(async()=>{l=await R(t,K,"getTransaction")({hash:e}),l.blockNumber&&(N=l.blockNumber)},{delay:r,retryCount:a}),s=!1),u=await R(t,G,"getTransactionReceipt")({hash:e}),n>1&&(!u.blockNumber||N-u.blockNumber+1n<n))return;w(()=>h.resolve(u))}catch(g){if(g instanceof U||g instanceof L){if(!l){s=!1;return}try{d=l,s=!0;const I=await q(()=>R(t,ot,"getBlock")({blockNumber:N,includeTransactions:!0}),{delay:r,retryCount:a,shouldRetry:({error:v})=>v instanceof ct});s=!1;const T=I.transactions.find(({from:v,nonce:A})=>v===d.from&&A===d.nonce);if(!T||(u=await R(t,G,"getTransactionReceipt")({hash:T.hash}),n>1&&(!u.blockNumber||N-u.blockNumber+1n<n)))return;let _="replaced";T.to===d.to&&T.value===d.value&&T.input===d.input?_="repriced":T.from===T.to&&T.value===0n&&(_="cancelled"),w(()=>{var v;(v=h.onReplaced)==null||v.call(h,{reason:_,replacedTransaction:d,transaction:T,transactionReceipt:u}),h.resolve(u)})}catch(I){w(()=>h.reject(I))}}else w(()=>h.reject(g))}}})}),y}function V(t){return typeof t=="number"?t:t==="wei"?0:Math.abs(it[t])}async function xt(t,n){const{allowFailure:e=!0,chainId:o,contracts:i,...a}=n,r=t.getClient({chainId:o});return F(r,Ft,"multicall")({allowFailure:e,contracts:i,...a})}async function Et(t,n){var p;const{allowFailure:e=!0,blockNumber:o,blockTag:i,...a}=n,r=n.contracts;try{const c={};for(const[s,f]of r.entries()){const b=f.chainId??t.state.chainId;c[b]||(c[b]=[]),(p=c[b])==null||p.push({contract:f,index:s})}const l=()=>Object.entries(c).map(([s,f])=>xt(t,{...a,allowFailure:e,blockNumber:o,blockTag:i,chainId:Number.parseInt(s),contracts:f.map(({contract:b})=>b)})),d=(await Promise.all(l())).flat(),u=Object.values(c).flatMap(s=>s.map(({index:f})=>f));return d.reduce((s,f,b)=>(s&&(s[u[b]]=f),s),[])}catch(c){if(c instanceof ut)throw c;const l=()=>r.map(d=>j(t,{...d,blockNumber:o,blockTag:i}));return e?(await Promise.allSettled(l())).map(d=>d.status==="fulfilled"?{result:d.value,status:"success"}:{error:d.reason,result:void 0,status:"failure"}):await Promise.all(l())}}async function Pt(t,n){const{address:e,blockNumber:o,blockTag:i,chainId:a,token:r,unit:p="ether"}=n;if(r)try{return await H(t,{balanceAddress:e,chainId:a,symbolType:"string",tokenAddress:r})}catch(s){if(s.name==="ContractFunctionExecutionError"){const f=await H(t,{balanceAddress:e,chainId:a,symbolType:"bytes32",tokenAddress:r}),b=W(lt(f.symbol,{dir:"right"}));return{...f,symbol:b}}throw s}const c=t.getClient({chainId:a}),d=await F(c,dt,"getBalance")(o?{address:e,blockNumber:o}:{address:e,blockTag:i}),u=t.chains.find(s=>s.id===a)??c.chain;return{decimals:u.nativeCurrency.decimals,formatted:Z(d,V(p)),symbol:u.nativeCurrency.symbol,value:d}}async function H(t,n){const{balanceAddress:e,chainId:o,symbolType:i,tokenAddress:a,unit:r}=n,p={abi:[{type:"function",name:"balanceOf",stateMutability:"view",inputs:[{type:"address"}],outputs:[{type:"uint256"}]},{type:"function",name:"decimals",stateMutability:"view",inputs:[],outputs:[{type:"uint8"}]},{type:"function",name:"symbol",stateMutability:"view",inputs:[],outputs:[{type:i}]}],address:a},[c,l,d]=await Et(t,{allowFailure:!1,contracts:[{...p,functionName:"balanceOf",args:[e],chainId:o},{...p,functionName:"decimals",chainId:o},{...p,functionName:"symbol",chainId:o}]}),u=Z(c??"0",V(r??l));return{decimals:l,formatted:u,symbol:d,value:c}}async function z(t,n){const{chainId:e,timeout:o=0,...i}=n,a=t.getClient({chainId:e}),p=await F(a,At,"waitForTransactionReceipt")({...i,timeout:o});if(p.status==="reverted"){const l=await F(a,K,"getTransaction")({hash:p.transactionHash}),u=await F(a,Tt,"call")({...l,data:l.input,gasPrice:l.type!=="eip1559"?l.gasPrice:void 0,maxFeePerGas:l.type==="eip1559"?l.maxFeePerGas:void 0,maxPriorityFeePerGas:l.type==="eip1559"?l.maxPriorityFeePerGas:void 0}),s=u!=null&&u.data?W(`0x${u.data.substring(138)}`):"unknown reason";throw new Error(s)}return{...p,chainId:a.chain.id}}async function Dt(t,n){const{account:e,chainId:o,connector:i,...a}=n;let r;return typeof e=="object"&&(e==null?void 0:e.type)==="local"?r=t.getClient({chainId:o}):r=await ft(t,{account:e??void 0,chainId:o,connector:i}),await F(r,bt,"writeContract")({...a,...e?{account:e}:{},chain:o?{id:o}:null})}function St(t){return{mutationFn(n){return Dt(t,n)},mutationKey:["writeContract"]}}function $t(t={}){const{mutation:n}=t,e=pt(t),o=St(e),{mutate:i,mutateAsync:a,...r}=mt({...n,...o});return{...r,writeContract:i,writeContractAsync:a}}async function Ot(t,n){let e;try{e=await z(t,n)}catch{await ht(3e3),e=await z(t,n)}return e}const qt=()=>{const{writeContractAsync:t}=$t(),n=async({classId:a,wallet:r},p)=>{const c=await j(P,{abi:D,address:a,functionName:p});if(!await j(P,{abi:D,address:a,functionName:"hasRole",args:[c,r]})){const d=await t({abi:D,address:a,functionName:"grantRole",args:[c,r]});console.log(`Granted ${p} to ${r} in class ${a}. Transaction hash: ${d}`)}},e=async({classId:a,wallet:r})=>(await i({wallet:r}),n({classId:a,wallet:r},"UPDATER_ROLE")),o=async({classId:a,wallet:r})=>(await i({wallet:r}),n({classId:a,wallet:r},"MINTER_ROLE")),i=async({wallet:a})=>{const r=await Pt(P,{address:a});if(r.value<=0n)throw new Error("Insufficient OP-ETH balance");return r};return{checkAndGrantUpdater:e,checkAndGrantMinter:o,assertPositiveWalletBalance:i}};export{qt as a,z as b,Pt as g,$t as u,Ot as w};
