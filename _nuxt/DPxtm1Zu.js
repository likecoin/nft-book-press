import{a_ as ke,b6 as _e,bk as he,bx as ve,bn as ie,b7 as ge,b0 as Se,b8 as w,b9 as L,ba as le,b1 as xe,b3 as s,aX as a,bo as Ie,cN as we,cO as Y,aT as r,br as $,aS as j,b4 as o,bs as Ce,bi as re,aW as l,bt as Ee,bI as B,aY as P,bu as Te,aV as K,aU as p,cP as Ue,bg as Le,cM as $e,bf as Be}from"./CfseOdbi.js";import{_ as Ne}from"./-gN7atBo.js";import{_ as Re}from"./Cs0rOM-S.js";import{_ as De}from"./Vz5hS-_V.js";import{_ as Pe}from"./Du4xQxEZ.js";import{_ as Ae}from"./YhmgSYdO.js";import{u as ze}from"./B3l6Zn9z.js";import{u as Ve}from"./CLNw9kjo.js";import"./W06PnaAv.js";import"./DkdshRd_.js";import"./CS540GWc.js";(function(){try{var h=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},N=new h.Error().stack;N&&(h._sentryDebugIds=h._sentryDebugIds||{},h._sentryDebugIds[N]="aa67fd37-e8f0-4455-9e85-f913342b0b60",h._sentryDebugIdIdentifier="sentry-dbid-aa67fd37-e8f0-4455-9e85-f913342b0b60")}catch{}})();const Oe={key:1},He={class:"flex items-center gap-2"},Fe=["href"],Ye=["href"],tt=ke({__name:"index",setup(h){const{LIKER_LAND_URL:N,LIKE_CO_API:b,BOOK3_URL:A}=_e().public,M=Ve(),G=he(),z=ve(),R=ze(),{token:v,wallet:se}=ie(G),{bookUser:f,isUpdatingBookUserProfile:ce,userLikerInfo:C,isFetchingUserLikerInfo:ue}=ie(R),W=ge(),de=Se(),m=w(""),c=w(!1),g=w({}),D=w([]),X=w([]),S=w(!0),q=L(()=>{var e,t;return(e=C.value)!=null&&e.user?Ie((t=C.value)==null?void 0:t.user):""});le(f,e=>{S.value=(e==null?void 0:e.isEnableNotificationEmails)||!1}),le(c,e=>{e&&(m.value="")});const V=L(()=>{var e,t;return!!((e=f.value)!=null&&e.notificationEmail&&((t=f.value)!=null&&t.isEmailVerified))});xe(async()=>{await Promise.all([J(),Z(),ee(),R.lazyFetchBookUserProfile()]),k.value&&await Q()});const k=L(()=>{var e;return(e=g.value)==null?void 0:e.isReady}),fe=L(()=>D.value.map(e=>{let t=e.type;switch(t){case"connectedWallet":t="royalties";break;case"channelCommission":t="channel";break}return{...e,type:t,amount:Y(e.amount,e.currency),amountTotal:Y(e.amountTotal,e.currency),currency:we(e.currency),timestamp:new Date(e.timestamp).toLocaleString()}})),me=L(()=>X.value.map(e=>{const{id:t,amount:_,currency:n,status:x,arrivalTs:E,createdTs:O}=e;return{id:t,amount:Y(_,n),status:x,createdTs:new Date(O*1e3).toLocaleString(),arrivalTs:E?new Date(E*1e3).toLocaleString():""}}));async function J(){try{c.value=!0;const e=await $fetch(`${b}/likernft/book/user/commissions/list`,{headers:{authorization:`Bearer ${v.value}`}});D.value=(e==null?void 0:e.commissions)||[],new Set(D.value.filter(n=>n.classId).map(n=>n.classId)).forEach(n=>M.lazyFetchClassMetadataById(n)),new Set(D.value.filter(n=>n.collectionId).map(n=>n.collectionId)).forEach(n=>z.lazyFetchCollectionById(n))}catch(e){console.error(e),m.value=e.toString()}finally{c.value=!1}}async function Q(){try{c.value=!0;const e=await $fetch(`${b}/likernft/book/user/payouts/list`,{headers:{authorization:`Bearer ${v.value}`}});X.value=(e==null?void 0:e.payouts)||[]}catch(e){console.error(e),m.value=e.toString()}finally{c.value=!1}}async function Z(){try{await R.fetchUserLikerInfo({nocache:!0})}catch(e){console.error(e),m.value=e.toString()}}async function ee(){var e;try{await te(),(e=g.value)!=null&&e.hasAccount&&!k.value&&(await $fetch(`${b}/likernft/book/user/connect/refresh`,{method:"POST",headers:{authorization:`Bearer ${v.value}`}})).isReady&&(g.value.isReady=!0,await te())}catch(t){console.error(t),m.value=t.toString()}finally{c.value=!1}}async function te(){try{c.value=!0;const e=await $fetch(`${b}/likernft/book/user/connect/status?wallet=${se.value}`,{headers:{authorization:`Bearer ${v.value}`}});g.value=e||{}}catch(e){console.error(e),m.value=e.toString()}finally{c.value=!1}}async function oe(){try{c.value=!0;const t=(await $fetch(`${b}/likernft/book/user/connect/login`,{method:"POST",headers:{authorization:`Bearer ${v.value}`}})).url;if(t)window.open(t);else throw new Error("CANNOT_GET_STRIPE_CONNECT_RUL")}catch(e){console.error(e),m.value=e.toString()}finally{c.value=!1}}async function pe(){try{c.value=!0;const t=(await $fetch(`${b}/likernft/book/user/connect/new`,{method:"POST",headers:{authorization:`Bearer ${v.value}`}})).url;if(t)window.open(t);else throw new Error("CANNOT_GET_STRIPE_CONNECT_RUL")}catch(e){console.error(e),m.value=e.toString()}finally{c.value=!1}}async function ye(){if(V.value)try{await R.updateBookUserProfile({isEnableNotificationEmails:S.value}),W.add({icon:"i-heroicons-check-circle",title:"User profile updated"})}catch(e){console.error(e),W.add({icon:"i-heroicons-exclamation-circle",title:"Unable to update user profile",description:e.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}})}}return(e,t)=>{const _=Ce,n=Le,x=Ue,E=Ne,O=Te,H=Re,T=Ee,I=$e,F=De,ae=Pe,be=Ae;return r(),s(be,null,{default:a(()=>{var ne;return[o(m)?(r(),s(_,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${o(m)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:t[0]||(t[0]=i=>m.value="")},null,8,["title"])):$("",!0),o(k)?$("",!0):(r(),s(_,{key:1,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"soft",title:"You need to have a Stripe Express account to use the auto-payout service of Liker Land Bookstore.",description:"A Stripe Express account is separated from any full-featured Stripe account. If you have a full-featured Stripe account, you must also register again here to create a Stripe Express account under Liker Land."})),o(G).isAuthenticated?(r(),j(re,{key:2},[l(T,{ui:{header:{base:"flex justify-between items-center"},footer:{base:"text-center"}}},B({header:a(()=>[t[2]||(t[2]=p("h1",{class:"text-center font-bold font-mono"}," Book Sales Affiliation Program ",-1)),l(x,{text:"Refresh Liker ID",popper:{placement:"left"}},{default:a(()=>[l(n,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:o(ue),onClick:Z},null,8,["disabled"])]),_:1})]),default:a(()=>{var i;return[(i=o(C))!=null&&i.user?(r(),s(H,{key:0,label:"Your affiliation channel ID",size:"xl"},B({default:a(()=>[l(E,{placeholder:"Affiliation ID",value:o(q),disabled:""},null,8,["value"])]),_:2},[o(k)?{name:"help",fn:a(()=>[t[4]||(t[4]=P(" Append ")),l(O,{class:"font-mono"},{default:a(()=>[P(" ?from="+K(o(q)),1)]),_:1}),t[5]||(t[5]=P(" in any bookstore page to earn commission from book sales. "))]),key:"1"}:{name:"help",fn:a(()=>[t[3]||(t[3]=P(" Please setup your stripe account below to participate in the book affiliation program. "))]),key:"0"}]),1024)):(r(),j("p",Oe," You have not setup your channel ID yet. "))]}),_:2},[(ne=o(C))!=null&&ne.user?void 0:{name:"footer",fn:a(()=>[l(n,{label:"Setup your ID",size:"lg",rel:"noopener",target:"_blank",to:`${o(A)}/account`},null,8,["to"])]),key:"0"}]),1024),l(T,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{header:a(()=>[t[6]||(t[6]=p("h1",{class:"text-center font-bold font-mono"}," Stripe Connect Payout Account Status ",-1)),l(x,{text:"Refresh Status",popper:{placement:"left"}},{default:a(()=>[l(n,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:o(c),onClick:ee},null,8,["disabled"])]),_:1})]),footer:a(()=>{var i;return[o(c)?(r(),s(n,{key:0,label:"Loading",size:"lg",loading:!0,onClick:oe})):o(k)?(r(),s(n,{key:1,label:"Login to Stripe account",size:"lg",onClick:oe})):(i=o(C))!=null&&i.user?(r(),s(n,{key:3,label:"Setup Stripe Payment Recipient Account",size:"lg",onClick:pe})):(r(),s(n,{key:2,label:"Setup your ID",size:"lg",rel:"noopener",target:"_blank",to:`${o(A)}/account`},null,8,["to"]))]}),default:a(()=>{var i;return[l(F,{columns:[{key:"initiated",label:"Setup Initiated"},{key:"completed",label:"Setup Completed"}],rows:[{initiated:((i=o(g))==null?void 0:i.hasAccount)||!1,completed:o(k)||!1}],ui:{th:{base:"text-center"},td:{base:"text-center"}}},{"initiated-data":a(({row:d})=>[d.initiated?(r(),s(I,{key:0,label:"Yes",color:"green",variant:"outline"})):(r(),s(I,{key:1,label:"No",color:"red",variant:"outline"}))]),"completed-data":a(({row:d})=>{var u;return[d.completed?(r(),s(I,{key:0,label:((u=o(g))==null?void 0:u.notificationEmail)||"Yes",color:"green",variant:"outline"},null,8,["label"])):(r(),s(I,{key:1,label:"No",color:"red",variant:"outline"}))]}),_:1},8,["rows"])]}),_:1}),o(k)?(r(),j(re,{key:0},[l(T,{ui:{header:{base:"flex justify-between items-center"},body:{base:"flex flex-col gap-6"},footer:{base:"text-center"}}},B({header:a(()=>[t[7]||(t[7]=p("h1",{class:"text-center font-bold font-mono"}," User Setting ",-1))]),default:a(()=>{var i,d;return[l(H,{label:"Liker ID Email"},{default:a(()=>{var u,y;return[l(E,{value:(u=o(f))==null?void 0:u.notificationEmail,label:"Liker ID Email",disabled:"",ui:{base:"font-mono"}},B({_:2},[(y=o(f))!=null&&y.notificationEmail?{name:"trailing",fn:a(()=>{var U;return[(U=o(f))!=null&&U.isEmailVerified?(r(),s(I,{key:0,label:"Verified",color:"green",size:"xs",ui:{rounded:"rounded-full"}})):(r(),s(I,{key:1,label:"Unverified",color:"amber",variant:"outline",size:"xs",ui:{rounded:"rounded-full"}}))]}),key:"0"}:void 0]),1032,["value"])]}),_:1}),l(H,{label:"Email Notification Settings"},B({default:a(()=>[p("div",He,[o(V)?(r(),s(ae,{key:0,modelValue:o(S),"onUpdate:modelValue":t[1]||(t[1]=u=>Be(S)?S.value=u:null)},null,8,["modelValue"])):(r(),s(ae,{key:1,"model-value":!1,disabled:!0})),t[8]||(t[8]=p("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-200"}," Receive email notifications about commissions ",-1))])]),_:2},[!((i=o(f))!=null&&i.notificationEmail)||!((d=o(f))!=null&&d.isEmailVerified)?{name:"help",fn:a(()=>{var u,y;return[(u=o(f))!=null&&u.notificationEmail?(y=o(f))!=null&&y.isEmailVerified?$("",!0):(r(),s(_,{key:1,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"subtle",title:"Email is not verified.",description:"To enable email notifications, please verify your Liker ID email."})):(r(),s(_,{key:0,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"subtle",title:"Email is not setup yet.",description:"To enable email notifications, please setup your Liker ID email."}))]}),key:"0"}:void 0]),1024)]}),_:2},[o(V)?{name:"footer",fn:a(()=>{var i;return[l(n,{label:"Update",disabled:((i=o(f))==null?void 0:i.isEnableNotificationEmails)===o(S),loading:o(ce),onClick:ye},null,8,["disabled","loading"])]}),key:"0"}:void 0]),1024),l(T,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{header:a(()=>[t[9]||(t[9]=p("h1",{class:"text-center font-bold font-mono"}," Book Sales Commission History ",-1)),l(x,{text:"Refresh Status",popper:{placement:"left"}},{default:a(()=>[l(n,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:o(c),onClick:J},null,8,["disabled"])]),_:1})]),default:a(()=>[l(F,{columns:[{key:"timestamp",label:"Timestamp"},{key:"type",label:"Commission Type"},{key:"amount",label:"Commission"},{key:"classId",label:"Book Id"},{key:"collectionId",label:"Book Collection Id"},{key:"currency",label:"Currency"},{key:"amountTotal",label:"Sale Amount"}],rows:o(fe),ui:{th:{base:"text-center"},td:{base:"text-center"}}},{"classId-data":a(({row:i})=>{var d;return[p("a",{href:`${o(A)}/store/${i.classId}`,target:"_blank"},K((d=o(M).getClassMetadataById(i.classId))==null?void 0:d.name),9,Fe)]}),"collectionId-data":a(({row:i})=>{var d,u,y,U;return[p("a",{href:`${o(N)}/nft/collection/${i.collectionId}`,target:"_blank"},K(((u=(d=o(z).getCollectionById(i.collectionId))==null?void 0:d.name)==null?void 0:u.zh)||((U=(y=o(z).getCollectionById(i.collectionId))==null?void 0:y.name)==null?void 0:U.en)),9,Ye)]}),_:1},8,["rows"])]),_:1}),l(T,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{header:a(()=>[t[10]||(t[10]=p("h1",{class:"text-center font-bold font-mono"}," Commission Payout History ",-1)),l(x,{text:"Refresh Status",popper:{placement:"left"}},{default:a(()=>[l(n,{icon:"i-heroicons-arrow-path",variant:"outline",disabled:o(c),onClick:Q},null,8,["disabled"])]),_:1})]),default:a(()=>[l(F,{columns:[{key:"createdTs",label:"Created"},{key:"amount",label:"Payout Amount"},{key:"status",label:"Status"},{key:"arrivalTs",label:"Arrived"},{key:"details",label:"Payout Details"}],rows:o(me),ui:{th:{base:"text-center"},td:{base:"text-center"}}},{"details-data":a(({row:i})=>[l(n,{label:"Details",size:"sm",color:"gray",to:o(de)({name:"nft-book-store-user-payouts-payoutId",params:{payoutId:i.id}})},null,8,["to"])]),_:1},8,["rows"])]),_:1})],64)):$("",!0)],64)):$("",!0)]}),_:1})}}});export{tt as default};
