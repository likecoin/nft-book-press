import{a_ as Ze,a$ as Ge,b6 as Ke,bl as Xe,bk as He,bn as G,b9 as E,b8 as r,ba as z,bb as Ye,b1 as Je,aS as M,aT as v,b3 as B,br as k,aW as l,b4 as n,bs as Qe,bi as ae,aU as i,aX as c,bj as et,bt as tt,bF as le,c0 as ot,bA as nt,aV as h,aY as se,bg as at,bf as K,bJ as lt,bK as st,bh as it,aQ as rt}from"./BYo2dXVR.js";import{_ as ut}from"./1ixNJkj9.js";import{_ as ct}from"./OKnbDGbn.js";import{_ as dt}from"./52qwCRfV.js";import{_ as mt}from"./D8C1ekd1.js";import{_ as _t}from"./7JmTsn_8.js";import{_ as ft}from"./CVozDPS3.js";import{p as pt,c as bt,E as gt,_ as vt,a as ht,v as yt}from"./DX7Xantt.js";import{_ as xt}from"./90fTm4zi.js";import{f as kt,U as wt,b as Ct,M as ie,D as Et}from"./CJ75jTLm.js";import{u as Mt}from"./Dz-AFHmF.js";import{u as Ut}from"./ibPcj1w0.js";import{g as Pt}from"./CEvvEfZ2.js";import{u as St}from"./Bh4K2e_-.js";(function(){try{var f=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},I=new f.Error().stack;I&&(f._sentryDebugIds=f._sentryDebugIds||{},f._sentryDebugIds[I]="a51163f3-6d93-4673-abf7-c19ed93f8a9c",f._sentryDebugIdIdentifier="sentry-dbid-a51163f3-6d93-4673-abf7-c19ed93f8a9c")}catch{}})();function F(f=""){return f.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function Vt(f){return pt.sanitize(f)}const It={class:"pb-[40px]"},At={class:"flex flex-col gap-[12px]"},Dt={class:"flex items-center justify-between"},Lt=["textContent"],Nt={class:"flex items-center gap-2"},$t=["textContent"],Tt=["textContent"],zt={class:"flex flex-col gap-2"},Bt=["onClick"],Ft=["onClick"],jt={class:"flex items-center gap-2 mb-3"},Wt={class:"space-y-3"},Rt={class:"space-y-3 w-full"},qt={key:0,class:"grid grid-cols-2 gap-4 w-full"},Ot=["textContent"],Zt=["textContent"],Gt=["textContent"],Kt={class:"flex justify-center items-center mt-2"},Xt={class:"flex justify-center items-center"},Ht={class:"flex justify-between items-center w-full"},Yt=["textContent"],Jt={key:0,class:"mt-[24px] flex flex-col gap-[12px]"},Qt={class:"w-full flex justify-center"},eo={class:"space-y-3"},to={class:"flex justify-between items-center"},oo=["textContent"],no=1*1024*1024,ao=Ze({__name:"NewNFTBook",props:{isNewClassPage:{type:Boolean,default:!1},classId:{type:String,default:""},editionIndex:{type:[String,Number],default:void 0},isEditMode:{type:Boolean,default:!1}},emits:["submit"],setup(f,{emit:I}){const{t:a}=Ge(),{LIKE_CO_API:X}=Ke().public,re=Xe(),A=He(),H=Mt(),{wallet:y}=G(re),{newBookListing:ue,updateEditionPrice:ce,uploadSignImages:de}=A,{fetchStripeConnectStatusByWallet:me}=H,{getStripeConnectStatusByWallet:_e}=G(H),{token:fe}=G(A),pe=Ut(),{getBalanceOf:be}=St(),ge=I,x=E(()=>V.editionIndex),{lazyFetchClassMetadataById:Y}=pe,p=r(""),_=r(!1),ve=r({en:"e.g.: This edition includes EPUB and PDF ebook files.",zh:"例：此版本包含 EPUB 及 PDF 電子書檔"}),b=E(()=>V.classId),j=r(1),J=r(!1),w=r(!0),m=r([{price:-1,deliveryMethod:"auto",autoMemo:"",stock:100,name:a("prices.standard_edition"),nameEn:"Standard Edition",nameZh:"標準版",description:"",isAllowCustomPrice:w.value,isListed:!0,enableCustomMessagePage:!1}]),he=E(()=>m.value.length>1),ye=r(["like1rclg677y2jqt8x4ylj0kjlqjjmnn6w63uflpgr"]),xe=r([]),ke=r(""),we=r(""),U=r(!1),P=r(""),W=r(!1),R=r(!0),Ce=r(null),D=r(null),Ee=r(Number(Et)),Me=r(0),Ue=r(0),Pe=r(0),Se=r(["bold","italic","strikeThrough","title","-","unorderedList","orderedList","-","code","link","=","preview"]),S=E(()=>V.isEditMode),Ve=E(()=>S.value?a("common.save"):a("common.submit")),L=r(!0),Q=E(()=>{var o,e;return(e=(o=Ce.value)==null?void 0:o.contentMetadata)==null?void 0:e.inLanguage});z(_,o=>{o&&(p.value="")},{immediate:!0}),bt({markdownItConfig(o){o.options.html=!1}});const V=f;Ye({title:()=>a("seo_titles.new_book_listing"),ogTitle:()=>a("seo_titles.new_book_listing")}),Je(async()=>{try{_.value=!0;const o=y.value?await be(b.value,y.value):0;if(Pe.value=Number(o)||0,S.value||x.value!==void 0){if(y.value)try{await me(y.value),_e.value(y.value).isReady&&(U.value=!0,P.value=y.value)}catch(t){console.error(t)}const e=await $fetch(`${X}/likernft/book/store/${b.value}`,{headers:{authorization:`Bearer ${fe.value}`}});if(e){if((e==null?void 0:e.ownerWallet)!==y.value)throw new Error("NOT_OWNER_OF_NFT_CLASS");if(x.value!==void 0)if(e.prices.length){const t=e.prices.find(d=>d.index.toString()===x.value);if(!t)throw new Error("Edition not found");m.value=[{price:t.price,deliveryMethod:t.isAutoDeliver?"auto":"manual",autoMemo:t.autoMemo,stock:t.stock,name:e.inLanguage==="en"?t.name.en:t.name.zh,nameEn:t.name.en,nameZh:t.name.zh,description:e.inLanguage==="en"?t.description.en:t.description.zh,isAllowCustomPrice:t.isAllowCustomPrice,isListed:!t.isUnlisted,oldIsAutoDeliver:t.isAutoDeliver,oldStock:t.stock,enableCustomMessagePage:t.enableCustomMessagePage||!1}],w.value=t.isAllowCustomPrice}else throw new Error("No prices found");else m.value[0].price=kt;Me.value=e.prices.reduce((t,d)=>d.index.toString()!==x.value?t+d.stock:t,0),Ue.value=e.prices.reduce((t,d)=>d.index.toString()!==x.value&&!d.isAutoDeliver?t+d.stock:t,0)}else throw new Error(a("errors.nft_class_not_found"))}}catch(o){console.error(o)}finally{_.value=!1}}),z(w,o=>{m.value.forEach(e=>{e.isAllowCustomPrice=o})}),z(_,o=>{o&&(p.value="")}),z(b,async o=>{if(o){const e=await Y(o),t=e==null?void 0:e.contentFingerprints;t&&Ie(t)&&(J.value=!0)}},{immediate:!0});function Ie(o){const t=Pt().API_GET_ARWEAVE_V2_LINK;return o.some(d=>!!d.startsWith(t)||d.includes("?key="))}function Ae(o,e="signatureImage"){if(!(o!=null&&o.length))return;const t=o[0];if(t.type!=="image/png"){p.value=a("errors.png_only");return}if(t.size>no){p.value=a("errors.file_size_limit");return}e==="signatureImage"?D.value=t:console.warn(`Unknown upload key: ${e}`)}function De(){j.value+=1,m.value.push({index:yt(),price:Ct,deliveryMethod:"auto",autoMemo:"",stock:100,name:Q.value==="en"?`Tier ${j.value}`:"增訂版",nameEn:`Tier ${j.value}`,nameZh:"增訂版",description:"",isAllowCustomPrice:!0,isListed:!0,enableCustomMessagePage:!1})}function Le(o){m.value.splice(o,1)}function Ne(o){P.value=o,W.value=!0}function N(o){const e=Q.value==="en";return o.map(t=>({name:e?{en:t.name,zh:t.nameZh}:{en:t.nameEn,zh:t.name},description:e?{en:F(t.description),zh:F("")}:{en:F(""),zh:F(t.description)},priceInDecimal:Math.round(Number(t.price)*100),price:Number(t.price),stock:t.deliveryMethod==="auto"?0:Number(t.stock),isAutoDeliver:t.deliveryMethod==="auto",isAllowCustomPrice:t.isAllowCustomPrice,isUnlisted:!t.isListed,autoMemo:t.deliveryMethod==="auto"&&t.autoMemo||"",enableCustomMessagePage:t.enableCustomMessagePage||!1}))}function $e(o){const e=[];return o.forEach(t=>{t.price!==0&&t.price<ie&&e.push({path:"price",message:a("errors.price_validation",{minPrice:ie})}),(!t.name.en||!t.name.zh)&&e.push({path:"name",message:a("errors.product_name_required")})}),e.length>0?(p.value=e.map(t=>t.message).join(`
`),!1):!0}async function Te(){try{const o=N(m.value);if(!$e(o))return;if(S.value?await ze():V.isNewClassPage?await ee():(await fetch(`${X}/likernft/book/store/${b.value}`)).ok?await Be():await ee(),D.value){const e=new FormData;D.value&&e.append("signImage",D.value),await de(e,b.value)}ge("submit")}catch{}}async function ee(){try{if(!b.value)throw new Error(a("errors.nft_class_id_required"));if(ke.value)throw new Error(a("errors.add_moderator_wallet"));if(we.value)throw new Error(a("errors.add_notification_email"));_.value=!0;const o=await Y(b.value),e=(o==null?void 0:o.nft_meta_collection_id)||"";if(!e.includes("nft_book")&&!e.includes("book_nft"))throw new Error(a("errors.not_nft_book_collection"));const t=N(m.value),d=U.value&&P.value?{[P.value]:100}:null,q=m.value.some(g=>g.enableCustomMessagePage);await ue(b.value,{defaultPaymentCurrency:"USD",connectedWallets:d,moderatorWallets:ye.value,notificationEmails:xe.value,prices:t,mustClaimToView:!0,enableCustomMessagePage:q,hideDownload:J.value})}catch(o){const e=o.data||o;console.error(e),p.value=e}finally{W.value=!1,_.value=!1}}async function ze(){try{if(!S.value)throw new Error(a("errors.missing_edition_data"));const e=N(m.value)[0];_.value=!0,await ce(b.value,x.value,{price:e})}catch(o){const e=o.data||o;console.error(e),p.value=e}finally{_.value=!1}}async function Be(){try{_.value=!0;const e=N(m.value)[0];await A.addEditionPrice(b.value.toString(),(x.value||0).toString(),{price:e})}catch(o){console.error(o)}finally{_.value=!1}}function Fe(o){const e=m.value[o];e.deliveryMethod="manual",e.enableCustomMessagePage=!0}return(o,e)=>{const t=Qe,d=ut,q=ct,g=dt,te=mt,O=nt,oe=ot,$=_t,ne=ft,je=vt,Z=tt,T=at,We=xt,Re=lt,qe=st,Oe=it;return v(),M("div",It,[n(p)?(v(),B(t,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${n(p)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:e[0]||(e[0]=s=>p.value="")},null,8,["title"])):k("",!0),n(A).isAuthenticated?(v(),M(ae,{key:1},[i("ul",At,[l(Z,{ui:{body:{base:"space-y-5 relative"},base:"overflow-visible border-none !border-transparent"}},{default:c(()=>[(v(!0),M(ae,null,et(n(m),(s,C)=>(v(),M("li",{key:s.index},[l(Z,{ui:{body:{base:"flex flex-col gap-[20px]"},base:"overflow-visible border-[4px]"}},{header:c(()=>[i("div",Dt,[i("h3",{class:"font-bold font-mono",textContent:h(`${n(a)("nft_book_form.edition_number",{number:C+1})} - ${s.name||n(a)("nft_book_form.product_name_placeholder")}`)},null,8,Lt),i("div",Nt,[i("p",{class:"text-sm",textContent:h(n(a)("nft_book_form.pause_selling"))},null,8,$t),l(d,{modelValue:s.isListed,"onUpdate:modelValue":u=>s.isListed=u},null,8,["modelValue","onUpdate:modelValue"]),i("p",{class:"text-sm",textContent:h(n(a)("nft_book_form.selling"))},null,8,Tt)])])]),default:c(()=>[l(g,{label:n(a)("nft_book_form.unit_price_label")},{default:c(()=>[l(q,{modelValue:s.price,"onUpdate:modelValue":u=>s.price=u,options:n(wt),"value-attribute":"value"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:2},1032,["label"]),l(g,{label:n(a)("nft_book_form.copies_label")},{default:c(()=>[i("div",zt,[i("div",{class:le(["border-2 rounded-lg p-4 cursor-pointer transition-all duration-200",s.deliveryMethod==="auto"?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"]),onClick:u=>s.deliveryMethod="auto"},[l(te,{modelValue:s.deliveryMethod,"onUpdate:modelValue":u=>s.deliveryMethod=u,value:"auto",name:`deliveryMethod-${C}`,label:n(a)("nft_book_form.unlimited")},null,8,["modelValue","onUpdate:modelValue","name","label"])],10,Bt),i("div",{class:le(["border-2 rounded-lg p-4 cursor-pointer transition-all duration-200",s.deliveryMethod==="manual"?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"]),onClick:u=>Fe(C)},[i("div",jt,[l(te,{modelValue:s.deliveryMethod,"onUpdate:modelValue":u=>s.deliveryMethod=u,value:"manual",name:`deliveryMethod-${C}`,label:n(a)("nft_book_form.limited")},null,8,["modelValue","onUpdate:modelValue","name","label"]),l(oe,{text:n(a)("nft_book_form.manual_delivery_tooltip")},{default:c(()=>[l(O,{name:"i-heroicons-question-mark-circle"})]),_:1},8,["text"])]),i("div",Wt,[l(g,{label:n(a)("nft_book_form.stock")},{default:c(()=>[l($,{modelValue:s.stock,"onUpdate:modelValue":u=>s.stock=u,type:"number",step:"1",min:1,max:n(Ee),placeholder:"100"},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1032,["label"])])],10,Ft)])]),_:2},1032,["label"]),l(g,{label:n(a)("nft_book_form.enable_custom_message_page")},{default:c(()=>[i("div",Rt,[l(ne,{modelValue:s.enableCustomMessagePage,"onUpdate:modelValue":u=>s.enableCustomMessagePage=u,label:n(a)("nft_book_form.add_custom_message_page")},null,8,["modelValue","onUpdate:modelValue","label"]),s.enableCustomMessagePage?(v(),M("div",qt,[l(g,{label:n(a)("nft_book_form.auto_delivery_memo")},{default:c(()=>[l($,{modelValue:s.autoMemo,"onUpdate:modelValue":u=>s.autoMemo=u,placeholder:n(a)("nft_book_form.memo_placeholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"]),l(g,{ui:{label:{base:"w-full flex justify-between items-center"}}},{label:c(()=>[i("p",{class:"block",textContent:h(n(a)("nft_book_form.autograph_image"))},null,8,Ot),i("span",{class:"text-gray-500 text-[12px] block",textContent:h(n(a)("nft_book_form.image_requirements"))},null,8,Zt)]),default:c(()=>[l($,{type:"file",accept:"image/png",onChange:e[1]||(e[1]=u=>Ae(u,"signatureImage"))})]),_:1})])):k("",!0)])]),_:2},1032,["label"]),l(g,{ui:{container:"space-y-2"}},{label:c(()=>[se(h(n(a)("nft_book_form.product_name"))+" ",1),l(je,{"image-style":{width:"250px"}},{image:c(()=>e[6]||(e[6]=[i("img",{src:ht,class:"object-cover",alt:""},null,-1)])),default:c(()=>[l(O,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:c(()=>[l($,{modelValue:s.name,"onUpdate:modelValue":u=>s.name=u,placeholder:n(a)("nft_book_form.product_name_placeholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),i("span",{class:"block text-[14px] text-[#374151] mt-[8px]",textContent:h(n(a)("nft_book_form.description_optional"))},null,8,Gt),l(n(gt),{modelValue:s.description,"onUpdate:modelValue":u=>s.description=u,language:"en-US","editor-id":`en-${C}`,placeholder:n(ve).en,toolbars:n(Se),sanitize:n(Vt),style:{height:"200px",width:"100%",marginTop:"0px"}},null,8,["modelValue","onUpdate:modelValue","editor-id","placeholder","toolbars","sanitize"])]),_:2},1024)]),_:2},1024),i("div",Kt,[n(he)?(v(),B(T,{key:0,label:n(a)("common.delete"),color:"gray","leading-icon":"i-heroicons-trash",onClick:u=>Le(C)},null,8,["label","onClick"])):k("",!0)])]))),128))]),_:1})]),i("div",Xt,[V.isNewClassPage&&n(m).length<2?(v(),B(T,{key:0,ui:{rounded:"rounded-full"},color:"gray",icon:"i-heroicons-plus-solid",label:n(a)("nft_book_form.add_edition"),onClick:De},null,8,["label"])):k("",!0)]),l(Z,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"12px"}}},{default:c(()=>[i("div",Ht,[i("h3",{class:"font-bold font-mono",textContent:h(n(a)("nft_book_form.settings"))},null,8,Yt),l(T,{color:"gray",variant:"ghost",icon:n(L)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",onClick:e[2]||(e[2]=()=>{L.value=!n(L)})},null,8,["icon"])]),n(L)?(v(),M("div",Jt,[l(g,{class:"flex items-center"},{default:c(()=>[l(oe,{class:"flex items-center gap-2",text:n(a)("nft_book_form.accept_tipping_tooltip")},{default:c(()=>[l(ne,{modelValue:n(w),"onUpdate:modelValue":e[3]||(e[3]=s=>K(w)?w.value=s:null),name:"isAllowCustomPrice",label:n(a)("nft_book_form.accept_tipping")},null,8,["modelValue","label"]),l(O,{name:"i-heroicons-question-mark-circle"})]),_:1},8,["text"])]),_:1}),n(S)?(v(),B(We,{key:0,"is-stripe-connect-checked":n(U),"onUpdate:isStripeConnectChecked":e[4]||(e[4]=s=>K(U)?U.value=s:null),"is-using-default-account":n(R),"onUpdate:isUsingDefaultAccount":e[5]||(e[5]=s=>K(R)?R.value=s:null),"stripe-connect-wallet":n(P),"should-disable-setting":n(W),"login-address":n(y),onSave:Ne},null,8,["is-stripe-connect-checked","is-using-default-account","stripe-connect-wallet","should-disable-setting","login-address"])):k("",!0)])):k("",!0)]),_:1}),i("div",Qt,[l(T,{label:n(Ve),loading:n(_),size:"lg",disabled:n(_),onClick:Te},null,8,["label","loading","disabled"])])],64)):k("",!0),l(Oe,{"model-value":!!n(_),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:c(()=>[i("div",eo,[i("div",to,[l(Re,{variant:"soft"},{default:c(()=>[se(h(n(a)("common.loading")),1)]),_:1}),i("p",{class:"text-xs text-gray-500",textContent:h(n(a)("nft_book_form.loading_progress_text"))},null,8,oo)]),l(qe,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),yo=rt(ao,[["__scopeId","data-v-3450bedc"]]);export{yo as _};
