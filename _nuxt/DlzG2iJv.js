import{ep as F,eq as $,er as G,es as H,et as M,eu as x,ev as P,ew as W,dW as T,ex as O,ey as z,ez as V,eA as q,eB as Y,eC as J,e0 as I,e2 as K,e6 as L,eD as Q,e8 as U,e9 as X,eb as Z}from"./BjTv2_7R.js";import{e as ee}from"./BewDPqUu.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},r=new e.Error().stack;r&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[r]="f1f155c8-7a15-498a-a978-f12151b9f8d9",e._sentryDebugIdIdentifier="sentry-dbid-f1f155c8-7a15-498a-a978-f12151b9f8d9")}catch{}})();const te=new Map,re=new Map;function ae(e){const r=(n,a)=>({clear:()=>a.delete(n),get:()=>a.get(n),set:c=>a.set(n,c)}),t=r(e,te),o=r(e,re);return{clear:()=>{t.clear(),o.clear()},promise:t,response:o}}async function ne(e,{cacheKey:r,cacheTime:t=Number.POSITIVE_INFINITY}){const o=ae(r),n=o.response.get();if(n&&t>0&&new Date().getTime()-n.created.getTime()<t)return n.data;let a=o.promise.get();a||(a=e(),o.promise.set(a));try{const c=await a;return o.response.set({created:new Date,data:c}),c}finally{o.promise.clear()}}const oe=e=>`blockNumber.${e}`;async function se(e,{cacheTime:r=e.cacheTime}={}){const t=await ne(()=>e.request({method:"eth_blockNumber"}),{cacheKey:oe(e.uid),cacheTime:r});return BigInt(t)}async function S(e,{blockHash:r,blockNumber:t,blockTag:o,hash:n,index:a}){var d,s,u;const c=o||"latest",p=t!==void 0?F(t):void 0;let i=null;if(n?i=await e.request({method:"eth_getTransactionByHash",params:[n]},{dedupe:!0}):r?i=await e.request({method:"eth_getTransactionByBlockHashAndIndex",params:[r,F(a)]},{dedupe:!0}):i=await e.request({method:"eth_getTransactionByBlockNumberAndIndex",params:[p||c,F(a)]},{dedupe:!!p}),!i)throw new $({blockHash:r,blockNumber:t,blockTag:c,hash:n,index:a});return(((u=(s=(d=e.chain)==null?void 0:d.formatters)==null?void 0:s.transaction)==null?void 0:u.format)||G)(i)}async function A(e,{hash:r}){var n,a,c;const t=await e.request({method:"eth_getTransactionReceipt",params:[r]},{dedupe:!0});if(!t)throw new H({hash:r});return(((c=(a=(n=e.chain)==null?void 0:n.formatters)==null?void 0:a.transactionReceipt)==null?void 0:c.format)||M)(t)}function ce(e,{emitOnBegin:r=!1,emitMissed:t=!1,onBlockNumber:o,onError:n,poll:a,pollingInterval:c=e.pollingInterval}){const p=typeof a<"u"?a:!(e.transport.type==="webSocket"||e.transport.type==="ipc"||e.transport.type==="fallback"&&(e.transport.transports[0].config.type==="webSocket"||e.transport.transports[0].config.type==="ipc"));let i;return p?(()=>{const s=x(["watchBlockNumber",e.uid,r,t,c]);return P(s,{onBlockNumber:o,onError:n},u=>W(async()=>{var w;try{const f=await T(e,se,"getBlockNumber")({cacheTime:0});if(i){if(f===i)return;if(f-i>1&&t)for(let m=i+1n;m<f;m++)u.onBlockNumber(m,i),i=m}(!i||f>i)&&(u.onBlockNumber(f,i),i=f)}catch(f){(w=u.onError)==null||w.call(u,f)}},{emitOnBegin:r,interval:c}))})():(()=>{const s=x(["watchBlockNumber",e.uid,r,t]);return P(s,{onBlockNumber:o,onError:n},u=>{let w=!0,f=()=>w=!1;return(async()=>{try{const m=(()=>{if(e.transport.type==="fallback"){const g=e.transport.transports.find(y=>y.config.type==="webSocket"||y.config.type==="ipc");return g?g.value:e.transport}return e.transport})(),{unsubscribe:C}=await m.subscribe({params:["newHeads"],onData(g){var b;if(!w)return;const y=O((b=g.result)==null?void 0:b.number);u.onBlockNumber(y,i),i=y},onError(g){var y;(y=u.onError)==null||y.call(u,g)}});f=C,w||f()}catch(m){n==null||n(m)}})(),()=>f()})})()}async function ie(e,{confirmations:r=1,hash:t,onReplaced:o,pollingInterval:n=e.pollingInterval,retryCount:a=6,retryDelay:c=({count:i})=>~~(1<<i)*200,timeout:p=18e4}){const i=x(["waitForTransactionReceipt",e.uid,t]);let l,d,s,u=!1,w,f;const{promise:m,resolve:C,reject:g}=z(),y=p?setTimeout(()=>{f(),w(),g(new V({hash:t}))},p):void 0;return w=P(i,{onReplaced:o,resolve:C,reject:g},b=>{f=T(e,ce,"watchBlockNumber")({emitMissed:!0,emitOnBegin:!0,poll:!0,pollingInterval:n,async onBlockNumber(j){const N=v=>{clearTimeout(y),f(),v(),w()};let B=j;if(!u)try{if(s){if(r>1&&(!s.blockNumber||B-s.blockNumber+1n<r))return;N(()=>b.resolve(s));return}if(l||(u=!0,await q(async()=>{l=await T(e,S,"getTransaction")({hash:t}),l.blockNumber&&(B=l.blockNumber)},{delay:c,retryCount:a}),u=!1),s=await T(e,A,"getTransactionReceipt")({hash:t}),r>1&&(!s.blockNumber||B-s.blockNumber+1n<r))return;N(()=>b.resolve(s))}catch(v){if(v instanceof $||v instanceof H){if(!l){u=!1;return}try{d=l,u=!0;const R=await q(()=>T(e,Y,"getBlock")({blockNumber:B,includeTransactions:!0}),{delay:c,retryCount:a,shouldRetry:({error:k})=>k instanceof J});u=!1;const h=R.transactions.find(({from:k,nonce:E})=>k===d.from&&E===d.nonce);if(!h||(s=await T(e,A,"getTransactionReceipt")({hash:h.hash}),r>1&&(!s.blockNumber||B-s.blockNumber+1n<r)))return;let _="replaced";h.to===d.to&&h.value===d.value&&h.input===d.input?_="repriced":h.from===h.to&&h.value===0n&&(_="cancelled"),N(()=>{var k;(k=b.onReplaced)==null||k.call(b,{reason:_,replacedTransaction:d,transaction:h,transactionReceipt:s}),b.resolve(s)})}catch(R){N(()=>b.reject(R))}}else N(()=>b.reject(v))}}})}),m}async function D(e,r){const{chainId:t,timeout:o=0,...n}=r,a=e.getClient({chainId:t}),p=await I(a,ie,"waitForTransactionReceipt")({...n,timeout:o});if(p.status==="reverted"){const l=await I(a,S,"getTransaction")({hash:p.transactionHash}),s=await I(a,ee,"call")({...l,data:l.input,gasPrice:l.type!=="eip1559"?l.gasPrice:void 0,maxFeePerGas:l.type==="eip1559"?l.maxFeePerGas:void 0,maxPriorityFeePerGas:l.type==="eip1559"?l.maxPriorityFeePerGas:void 0}),u=s!=null&&s.data?K(`0x${s.data.substring(138)}`):"unknown reason";throw new Error(u)}return{...p,chainId:a.chain.id}}async function ue(e,r){const{account:t,chainId:o,connector:n,...a}=r;let c;return typeof t=="object"&&(t==null?void 0:t.type)==="local"?c=e.getClient({chainId:o}):c=await L(e,{account:t??void 0,chainId:o,connector:n}),await I(c,Q,"writeContract")({...a,...t?{account:t}:{},chain:o?{id:o}:null})}function le(e){return{mutationFn(r){return ue(e,r)},mutationKey:["writeContract"]}}function de(e={}){const{mutation:r}=e,t=U(e),o=le(t),{mutate:n,mutateAsync:a,...c}=X({...r,...o});return{...c,writeContract:n,writeContractAsync:a}}async function be(e,r){let t;try{t=await D(e,r)}catch{await Z(3e3),t=await D(e,r)}return t}export{D as a,de as u,be as w};
