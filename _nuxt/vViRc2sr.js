import{a_ as te,bl as re,b6 as ne,bn as ue,b8 as o,b9 as P,ba as ee,b1 as ce,dv as he,aS as k,aT as b,aW as i,b4 as t,bf as se,aX as S,aU as f,cL as Ie,aY as Y,aV as $,bO as Ne,bh as Se,cQ as Fe,aQ as xe,b3 as H,bt as Te,cs as Ce,bg as de,br as j,a$ as pe,bb as ke,bs as $e,bm as Re,b0 as Ue,dw as Me,b2 as ae,dx as De,bc as le,bi as Ee,bj as Be,cv as Ve,dy as Le}from"./BXDK4RbP.js";import{u as me,b as Ae,v as Oe,c as ie,d as Pe,f as Ke,a as qe,_ as ze,e as je}from"./DHy7X_TF.js";import{a as Ge,u as We}from"./BQgXZL-e.js";import{a as Ye,u as He}from"./C6bB8XuL.js";import{_ as Je}from"./BJqIYAeC.js";import{_ as _e}from"./BkeRDD7n.js";import{_ as Qe}from"./BTt62awH.js";import{_ as Xe}from"./BePgjmyU.js";import"./BnVSo1zI.js";import"./BNK4rP4b.js";import"./DD-YIR54.js";import"./CF17O8i8.js";import"./CfTBjYca.js";import"./BCCmrpBr.js";import"./BM4CTzcJ.js";import"./BNKzJH8P.js";import"./BBmPVJsy.js";import"./B0wQKgSe.js";import"./D1kBxfn2.js";import"./C1BiHrWg.js";import"./DSf69RRT.js";import"./DJ3uH8ug.js";(function(){try{var F=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},u=new F.Error().stack;u&&(F._sentryDebugIds=F._sentryDebugIds||{},F._sentryDebugIds[u]="d91ecb0a-eb19-4dd8-800f-877ddf615037",F._sentryDebugIdIdentifier="sentry-dbid-d91ecb0a-eb19-4dd8-800f-877ddf615037")}catch{}})();const Ze={class:"space-y-3"},et={class:"flex justify-between items-center"},tt={class:"text-xs text-gray-500"},at=te({__name:"RegisterISCN",emits:["handleSubmit","submit","formValidChange"],setup(F,{expose:u,emit:r}){const x=re(),{getFileType:R}=ie(),{LIKE_EVM_NFT_TARGET_ADDRESS:T}=ne().public,{wallet:y,signer:h}=ue(x),{initIfNecessary:m}=x,{assertPositiveWalletBalance:a,waitForTransactionReceipt:C}=Ye(),{stripHtmlTags:M,formatLanguage:K}=ie(),{showErrorToast:D}=me(),{LIKE_NFT_CONTRACT_ADDRESS:g}=ne().public,w=o({type:"Book",title:"",description:"",isbn:"",publisher:"",publicationDate:"",author:{name:"",description:""},license:"All Rights Reserved",customLicense:"",contentFingerprints:[{url:""}],downloadableUrls:[{url:"",type:"",fileName:""}],language:"",bookInfoUrl:"",tags:[],coverUrl:""}),c=o(""),U=o(""),E=r,{payload:G}=Ae({iscnFormData:w}),{writeContractAsync:W}=He(),q=P(()=>Oe(w.value)),s=P(()=>{var e;return!((e=q.value)!=null&&e.length)});ee(s,e=>{E("formValidChange",e)},{immediate:!0}),ce(()=>{const e=p();e&&(w.value=e)});const p=()=>{var _,N,L,A,z,J;const e=he();if(!e)return null;const I={type:"Book",title:((_=e.epubMetadata)==null?void 0:_.title)||"",description:M(((N=e.epubMetadata)==null?void 0:N.description)||""),isbn:"",publisher:"",publicationDate:new Date().toISOString().split("T")[0],author:{name:((L=e.epubMetadata)==null?void 0:L.author)||"",description:""},license:"All Rights Reserved",contentFingerprints:[],downloadableUrls:[],coverUrl:(A=e.epubMetadata)!=null&&A.thumbnailArweaveId?`ar://${e.epubMetadata.thumbnailArweaveId}`:"",language:K(((z=e.epubMetadata)==null?void 0:z.language)||"zh"),tags:((J=e.epubMetadata)==null?void 0:J.tags)||[]};return I.downloadableUrls=e.fileRecords.filter(d=>d.fileType==="application/pdf"||d.fileType==="application/epub+zip").map(d=>({url:d.arweaveKey?d.arweaveLink:`ar://${d.arweaveId}`,type:R(d.fileType),fileName:d.fileName})),I.contentFingerprints=[...new Set(e.fileRecords.map(d=>{const Q=d.arweaveKey?d.arweaveLink:`ar://${d.arweaveId}`;return d.fileType==="application/epub+zip"||d.fileType==="application/pdf"?Q:`ar://${d.arweaveId}`}).filter(Boolean))].map(d=>({url:d})),I},B=async()=>{if(c.value="checking",!s.value){D(q.value.join(", "));return}w.value.contentFingerprints.length&&await V()},V=async()=>{if(c.value="loading",await m(),!y.value||!h.value){U.value="MISSING_SIGNER",c.value="";return}try{c.value="signing";const e=Ke(G.value),I={name:e.name,description:e.description,...e,symbol:"BOOK",image:(e==null?void 0:e.thumbnailUrl)||"",external_link:(e==null?void 0:e.url)||"",nft_meta_collection_id:"nft_book",nft_meta_collection_name:"NFT Book",nft_meta_collection_description:"NFT Book by Liker Land",recordTimestamp:new Date().toISOString()};await a({wallet:y.value});const _=await W({address:g,abi:Ge,functionName:"newBookNFTWithRoyalty",args:[{creator:y.value,updaters:[y.value,T],minters:[y.value,T],config:{name:I.name,symbol:"BOOK",metadata:JSON.stringify(I),max_supply:Fe}},500]}),N=await C({hash:_});if(console.log(N),!N||N.status!=="success")throw new Error("INVALID_RECEIPT");if(!N.logs[0].address)throw new Error("INVALID_CLASS_ID");const L=N.logs[0].address;c.value="success",E("submit",{iscnId:L,txHash:_})}catch(e){console.error(e),D(`'SIGNING_ERROR':${e}`),c.value=""}finally{c.value=""}};return u({onSubmit:B}),(e,I)=>{const _=Pe,N=Ie,L=Ne,A=Se;return b(),k("div",null,[i(_,{modelValue:t(w),"onUpdate:modelValue":I[0]||(I[0]=z=>se(w)?w.value=z:null)},null,8,["modelValue"]),i(A,{"model-value":!!t(c),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:S(()=>[f("div",Ze,[f("div",et,[i(N,{variant:"soft"},{default:S(()=>[Y($(t(c)),1)]),_:1}),f("p",tt,$(e.$t("notifications.iscn_registration_complete")),1)]),i(L,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),nt=xe(at,[["__scopeId","data-v-1eece739"]]),st={class:"font-bold font-mono"},ot=te({__name:"ISCNInfoCard",props:{iscnId:{},iscnOwner:{},iscnData:{},showEditButton:{type:Boolean}},emits:["edit"],setup(F){const{OPENSEA_URL:u}=ne().public;return(r,x)=>{const R=de,T=Je,y=_e,h=Te;return b(),H(h,{ui:{body:{base:"space-y-4"}}},{header:S(()=>[f("h2",st,$(r.$t("iscn.information")),1)]),default:S(()=>[i(T,{label:r.$t("iscn.owner"),class:"text-left"},{default:S(()=>[i(R,{label:r.iscnOwner,to:`${t(u)}/${encodeURIComponent(r.iscnOwner)}`,target:"_blank",variant:"link",padded:!1},null,8,["label","to"])]),_:1},8,["label"]),i(T,{label:r.$t("common.title")},{default:S(()=>{var m,a;return[i(y,{value:(a=(m=r.iscnData)==null?void 0:m.contentMetadata)==null?void 0:a.name,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1},8,["label"]),i(T,{label:r.$t("common.description")},{default:S(()=>{var m,a;return[i(y,{value:(a=(m=r.iscnData)==null?void 0:m.contentMetadata)==null?void 0:a.description,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1},8,["label"]),Ce(r.$slots,"actions",{},()=>[r.showEditButton?(b(),H(R,{key:0,label:r.$t("iscn.edit_metadata"),onClick:x[0]||(x[0]=m=>r.$emit("edit"))},null,8,["label"])):j("",!0)])]),_:3})}}}),lt={class:"flex flex-col items-stretch grow space-y-4"},it=te({__name:"MintNFT",props:{iscnId:{type:String,default:""}},emits:["submit","formValidChange","loadingChange"],setup(F,{expose:u,emit:r}){const{getClassOwner:x,getClassMetadata:R,checkNFTClassIsBookNFT:T}=We(),y=o(1),h=o(""),m=o(!1),a=o(""),C=o(null),M=o(""),K=o(null),D=P(()=>{var s;return(s=C.value)==null?void 0:s["@id"]}),g=o(!1),w=o(!1),c=r;ee(m,s=>{c("loadingChange",s),s&&(h.value="")},{immediate:!0}),ee(w,s=>{c("formValidChange",s)},{immediate:!0});const{t:U}=pe();ke({title:()=>U("seo.mint_nft_book_title"),ogTitle:()=>U("seo.mint_nft_book_title")});const E=F;ee(()=>E.iscnId,async s=>{s&&await G(E.iscnId)},{immediate:!0});async function G(s){if(s)try{if(m.value=!0,!await T(s))throw new Error("Invalid NFT Class ID");const[B,V]=await Promise.all([R(s),x(s)]);if(!B)throw new Error("Invalid NFT Class ID");C.value={contentMetadata:B,owner:V,"@id":s},a.value=V,M.value=s,y.value=3}catch(p){console.error(p),h.value=p.toString()}finally{m.value=!1}}function W(){var s;(s=K.value)==null||s.startNFTMintFlow()}function q({classId:s,nftMintCount:p}={}){M.value=s||"",c("submit",{classId:s||"",nftMintCount:p})}return u({startNFTMintFlow:W}),(s,p)=>{const B=$e,V=ot,e=qe,I=ze;return b(),k("div",lt,[t(h)?(b(),H(B,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${t(h)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:p[0]||(p[0]=_=>h.value="")},null,8,["title"])):j("",!0),i(V,{"iscn-id":t(D),"iscn-owner":t(a),"iscn-data":t(C),"show-edit-button":!0,onEdit:p[1]||(p[1]=_=>g.value=!0)},null,8,["iscn-id","iscn-owner","iscn-data"]),i(e,{ref_key:"liteMintNFTRef",ref:K,"iscn-data":t(C),"should-show-submit":!1,onFormValidChange:p[2]||(p[2]=_=>w.value=_),onSubmit:q},null,8,["iscn-data"]),i(I,{modelValue:t(g),"onUpdate:modelValue":p[3]||(p[3]=_=>se(g)?g.value=_:null),"class-id":t(M)},null,8,["modelValue","class-id"])])}}}),rt={class:"w-full"},ut={class:"justify-evenly items-center flex space-x-4 relative"},ct={class:"text-sm font-semibold"},dt={class:"mt-6 p-4 border rounded-lg bg-gray-100 text-center flex flex-col gap-[24px]"},pt={key:0},mt={key:1},_t={key:2},ft={key:3},vt={class:"flex gap-2 justify-center mt-4"},bt={key:0,class:"flex flex-col justify-center px-[12px] mt-[16px]"},gt={class:"flex flex-col items-center gap-4 py-4"},wt={class:"flex flex-col items-center"},yt={key:0},ht={class:"flex items-center"},It={key:0,class:"flex flex-col items-center gap-2 w-full max-w-md"},jt=te({__name:"index",setup(F){var Q,oe;const{t:u}=pe(),r=re(),{wallet:x,signer:R}=ue(r),{initIfNecessary:T}=r,y=Re(),h=Ue(),{showErrorToast:m}=me(),a=o(0),C=o(),M=o(),K=o(),D=o(!1),g=o(""),w=o(""),c=o(((Q=y.query.iscn_id)==null?void 0:Q.toString())||""),U=o(((oe=y.query.class_id)==null?void 0:oe.toString())||""),E=o([]),G=o(""),W=o(!1),q=o(!1),s=o(!1),p=P(()=>!!w.value),B=P(()=>{switch(a.value){case 0:return"Start Upload";case 1:return"Register ISCN";case 2:return"Mint NFT";default:return"Next"}}),V=P(()=>{var l;return((l=E.value)==null?void 0:l.length)>0}),e=P(()=>a.value===0?V.value:a.value<3),I=P(()=>a.value===0?G.value!=="":a.value===2?s.value:!1),_=[{title:u("publish_steps.upload_files"),description:"Upload your book file"},{title:u("publish_steps.register_iscn"),description:"Register ISCN"},{title:u("publish_steps.mint_nft"),description:"Mint NFT"},{title:u("publish_steps.new_book_publish"),description:"Publish new book"}];ce(()=>{var n;let l=null;try{const O=sessionStorage.getItem(Me);O&&(l=JSON.parse(O))}catch(O){console.error(O)}c.value?(g.value=c.value,A({iscnId:c.value})):U.value?z({classId:U.value}):l!=null&&l.epubMetadata&&(l!=null&&l.fileRecords)&&(w.value=(n=l==null?void 0:l.epubMetadata)==null?void 0:n.title)});const N=async()=>{if((!x.value||!R.value)&&await T(),!x.value||!R.value){m(u("auth.login_required"));return}try{if(a.value===0&&C.value){await C.value.onSubmit();return}if(a.value===1){if(!W.value){m("Please fill in all required fields");return}await M.value.onSubmit();return}if(a.value===2){if(!q.value){m("Please fill in all required fields");return}await K.value.startNFTMintFlow();return}a.value<_.length-1&&a.value++}catch(l){console.error("Error during form submission:",l)}},L=l=>{Le(l),a.value=1},A=async l=>{const{iscnId:n}=l;n&&await ae(h({query:{iscn_id:n}}),{replace:!0}),De(),a.value=2,await le(),c.value=n},z=async l=>{const{classId:n,nftMintCount:O}=l;n&&(U.value=n,await ae(h({query:{class_id:n,count:O}}),{replace:!0}),a.value=3,await le())},J=async()=>{await ae(h({name:"nft-book-store"}))},d=async()=>{g.value&&await A({iscnId:g.value})};return(l,n)=>{const O=Ve,fe=je,ve=nt,be=it,ge=Qe,X=de,we=_e,ye=Xe;return b(),H(ye,{class:"flex flex-col items-stretch grow space-y-4"},{default:S(()=>[f("div",rt,[f("div",ut,[n[8]||(n[8]=f("div",{class:"absolute w-full h-[1px] bg-gray-300 top-[50%] left-0 z-[-1]"},null,-1)),(b(),k(Ee,null,Be(_,(v,Z)=>f("div",{key:Z,class:"flex items-center space-x-2 bg-white p-2 rounded-lg"},[i(O,{size:Z===t(a)?"lg":"md",text:(Z+1).toString(),ui:{background:Z===t(a)?"bg-primary-100":"bg-gray-200"}},null,8,["size","text","ui"]),f("p",ct,$(v.title),1)])),64))]),f("div",dt,[t(a)===0?(b(),k("div",pt,[i(fe,{ref_key:"uploadFormRef",ref:C,onFileUploadStatus:n[0]||(n[0]=v=>G.value=v),onFileReady:n[1]||(n[1]=v=>E.value=v),onSubmit:L},null,512)])):t(a)===1?(b(),k("div",mt,[i(ve,{ref_key:"registerISCN",ref:M,onFormValidChange:n[2]||(n[2]=v=>W.value=v),onSubmit:A},null,512)])):t(a)===2?(b(),k("div",_t,[i(be,{ref_key:"mintNFT",ref:K,"iscn-id":t(c),onLoadingChange:n[3]||(n[3]=v=>s.value=v),onFormValidChange:n[4]||(n[4]=v=>q.value=v),onSubmit:z},null,8,["iscn-id"])])):t(a)===3?(b(),k("div",ft,[i(ge,{ref:"newNFTBook",class:"p-0 flex flex-col text-left gap-[24px]","is-new-class-page":!0,"class-id":t(U),onSubmit:J},null,8,["class-id"])])):j("",!0),f("div",vt,[t(e)?(b(),H(X,{key:0,disabled:t(I),onClick:N},{default:S(()=>[Y($(t(B)),1)]),_:1},8,["disabled"])):j("",!0)])]),t(a)===0?(b(),k("div",bt,[n[9]||(n[9]=f("div",{class:"w-full bg-gray-300 h-[1px]"},null,-1)),f("div",gt,[f("div",wt,[t(p)?(b(),k("div",yt,[Y($(t(u)("publish_steps.continue_last_register"))+" ",1),i(X,{variant:"ghost",class:"text-primary-500 font-semibold",onClick:n[5]||(n[5]=v=>a.value=1)},{default:S(()=>[Y($(t(w)),1)]),_:1})])):j("",!0),f("div",ht,[f("span",null,$(t(u)("publish_steps.already_have_iscn")),1),i(X,{variant:"ghost",onClick:n[6]||(n[6]=v=>D.value=!t(D))},{default:S(()=>[Y($(t(u)("publish_steps.here")),1)]),_:1})])]),t(D)?(b(),k("div",It,[i(we,{modelValue:t(g),"onUpdate:modelValue":n[7]||(n[7]=v=>se(g)?g.value=v:null),placeholder:t(u)("publish_steps.enter_iscn_id")},null,8,["modelValue","placeholder"]),i(X,{disabled:!t(g),onClick:d},{default:S(()=>[Y($(t(u)("common.confirm")),1)]),_:1},8,["disabled"])])):j("",!0)])])):j("",!0)])]),_:1})}}});export{jt as default};
