import{a_ as Q,bj as se,b3 as le,bl as ie,b5 as s,b6 as L,b7 as H,b0 as re,dv as ge,aS as k,aT as b,aW as i,bd as n,bc as ee,aX as N,aU as m,cJ as ye,aY as j,aV as X,bM as we,bf as Ie,cO as Ne,cT as Se,aQ as Fe,b1 as W,br as xe,cq as Ce,be as ue,bp as q,b8 as Te,bq as he,bk as ke,a$ as Me,dw as Ue,dx as De,b9 as ne,bg as Re,bh as Ee,ct as Be,dy as $e}from"./Dm55n_q7.js";import{u as ce,b as Ve,v as Le,c as oe,d as Ae,f as Oe,a as Pe,_ as qe,e as Ke}from"./B-28eQ3j.js";import{a as ze,b as je,u as Ge}from"./FexUiCd7.js";import{a as We,u as Je,b as Ye}from"./BLL8ThKJ.js";import{_ as He}from"./BNRh5wRg.js";import{_ as de}from"./BeJGAGuW.js";import{_ as Xe}from"./IaGHmeEz.js";import{_ as Qe}from"./BrbWWaox.js";import"./Di6iiB0e.js";import"./DGf9HjKN.js";import"./9FAC0F-8.js";import"./p9-vOCy2.js";import"./DZymGoW7.js";import"./fT9ZkxWj.js";import"./BZ3sWSG7.js";import"./BdiLvJkd.js";import"./Dbnh4rXa.js";import"./C4DGkdUg.js";import"./ClRMv8VZ.js";import"./vDgaBV0F.js";import"./ClLRtDMI.js";import"./BfIUIP0I.js";import"./HVbWzK8H.js";(function(){try{var T=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},S=new T.Error().stack;S&&(T._sentryDebugIds=T._sentryDebugIds||{},T._sentryDebugIds[S]="12b0a445-c332-4e8b-9dee-a8cf7fa6b1eb",T._sentryDebugIdIdentifier="sentry-dbid-12b0a445-c332-4e8b-9dee-a8cf7fa6b1eb")}catch{}})();const Ze={class:"space-y-3"},et={class:"flex justify-between items-center"},tt=Q({__name:"RegisterISCN",emits:["handleSubmit","submit","formValidChange"],setup(T,{expose:S,emit:f}){const I=se(),{getFileType:D}=oe(),{LIKE_EVM_NFT_TARGET_ADDRESS:F}=le().public,{wallet:g,signer:w}=ie(I),{initIfNecessary:a}=I,{assertPositiveWalletBalance:y}=We(),{stripHtmlTags:M,formatLanguage:R}=oe(),{showErrorToast:U}=ce(),p=s({type:"Book",title:"",description:"",isbn:"",publisher:"",publicationDate:"",author:{name:"",description:""},license:"All Rights Reserved",customLicense:"",contentFingerprints:[{url:""}],downloadableUrls:[{url:"",type:"",fileName:""}],language:"",bookInfoUrl:"",tags:[],coverUrl:""}),c=s(""),h=s(""),x=f,{payload:A}=Ve({iscnFormData:p}),{writeContractAsync:K}=Je(),O=L(()=>Le(p.value)),P=L(()=>{var e;return!((e=O.value)!=null&&e.length)});H(P,e=>{x("formValidChange",e)},{immediate:!0}),re(()=>{const e=o();e&&(p.value=e)});const o=()=>{var C,r,B,z,$,G;const e=ge();if(!e)return null;const _={type:"Book",title:((C=e.epubMetadata)==null?void 0:C.title)||"",description:M(((r=e.epubMetadata)==null?void 0:r.description)||""),isbn:"",publisher:"",publicationDate:new Date().toISOString().split("T")[0],author:{name:((B=e.epubMetadata)==null?void 0:B.author)||"",description:""},license:"All Rights Reserved",contentFingerprints:[],downloadableUrls:[],coverUrl:(z=e.epubMetadata)!=null&&z.thumbnailArweaveId?`ar://${e.epubMetadata.thumbnailArweaveId}`:"",language:R((($=e.epubMetadata)==null?void 0:$.language)||"zh"),tags:((G=e.epubMetadata)==null?void 0:G.tags)||[]};return _.downloadableUrls=e.fileRecords.filter(u=>u.fileType==="application/pdf"||u.fileType==="application/epub+zip").map(u=>({url:u.arweaveKey?u.arweaveLink:`ar://${u.arweaveId}`,type:D(u.fileType),fileName:u.fileName})),_.contentFingerprints=[...new Set(e.fileRecords.map(u=>{const Z=u.arweaveKey?u.arweaveLink:`ar://${u.arweaveId}`;return u.fileType==="application/epub+zip"||u.fileType==="application/pdf"?Z:`ar://${u.arweaveId}`}).filter(Boolean))].map(u=>({url:u})),_},d=async()=>{if(c.value="checking",!P.value){U(O.value.join(", "));return}p.value.contentFingerprints.length&&await E()},E=async()=>{if(c.value="loading",await a(),!g.value||!w.value){h.value="MISSING_SIGNER",c.value="";return}try{c.value="signing";const e=Oe(A.value),_={name:e.name,description:e.description,...e,symbol:"BOOK",image:(e==null?void 0:e.thumbnailUrl)||"",external_link:(e==null?void 0:e.url)||"",nft_meta_collection_id:"nft_book",nft_meta_collection_name:"NFT Book",nft_meta_collection_description:"NFT Book by Liker Land",recordTimestamp:new Date().toISOString()};await y({wallet:g.value});const C=await K({address:je,abi:ze,functionName:"newBookNFTWithRoyalty",args:[{creator:g.value,updaters:[g.value,F],minters:[g.value,F],config:{name:_.name,symbol:"BOOK",metadata:JSON.stringify(_),max_supply:Ne}},500]}),r=await Ye(Se,{hash:C});if(console.log(r),!r||r.status!=="success")throw new Error("INVALID_RECEIPT");if(!r.logs[0].address)throw new Error("INVALID_CLASS_ID");const B=r.logs[0].address;c.value="success",x("submit",{iscnId:B,txHash:C})}catch(e){console.error(e),U(`'SIGNING_ERROR':${e}`),c.value=""}finally{c.value=""}};return S({onSubmit:d}),(e,_)=>{const C=Ae,r=ye,B=we,z=Ie;return b(),k("div",null,[i(C,{modelValue:n(p),"onUpdate:modelValue":_[0]||(_[0]=$=>ee(p)?p.value=$:null)},null,8,["modelValue"]),i(z,{"model-value":!!n(c),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:N(()=>[m("div",Ze,[m("div",et,[i(r,{variant:"soft"},{default:N(()=>[j(X(n(c)),1)]),_:1}),_[1]||(_[1]=m("p",{class:"text-xs text-gray-500"}," 請勿關閉此視窗，直到 ISCN 註冊完成。 ",-1))]),i(B,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),at=Fe(tt,[["__scopeId","data-v-0e79e752"]]),nt=Q({__name:"ISCNInfoCard",props:{iscnId:{},iscnOwner:{},iscnData:{},showEditButton:{type:Boolean}},emits:["edit"],setup(T){const{OPENSEA_URL:S}=le().public;return(f,I)=>{const D=ue,F=He,g=de,w=xe;return b(),W(w,{ui:{body:{base:"space-y-4"}}},{header:N(()=>I[1]||(I[1]=[m("h2",{class:"font-bold font-mono"}," ISCN Information ",-1)])),default:N(()=>[i(F,{label:"Owner",class:"text-left"},{default:N(()=>[i(D,{label:f.iscnOwner,to:`${n(S)}/${encodeURIComponent(f.iscnOwner)}`,target:"_blank",variant:"link",padded:!1},null,8,["label","to"])]),_:1}),i(F,{label:"Title"},{default:N(()=>{var a,y;return[i(g,{value:(y=(a=f.iscnData)==null?void 0:a.contentMetadata)==null?void 0:y.name,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1}),i(F,{label:"Description"},{default:N(()=>{var a,y;return[i(g,{value:(y=(a=f.iscnData)==null?void 0:a.contentMetadata)==null?void 0:y.description,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1}),Ce(f.$slots,"actions",{},()=>[f.showEditButton?(b(),W(D,{key:0,label:"Edit ISCN Metadata",onClick:I[0]||(I[0]=a=>f.$emit("edit"))})):q("",!0)])]),_:3})}}}),ot={class:"flex flex-col items-stretch grow space-y-4"},st=Q({__name:"MintNFT",props:{iscnId:{type:String,default:""}},emits:["submit","formValidChange","loadingChange"],setup(T,{expose:S,emit:f}){const{getClassOwner:I,getClassMetadata:D,checkNFTClassIsBookNFT:F}=Ge(),g=s(1),w=s(""),a=s(!1),y=s(""),M=s(null),R=s(""),U=s(null),p=L(()=>{var o;return(o=M.value)==null?void 0:o["@id"]}),c=s(!1),h=s(!1),x=f;H(a,o=>{x("loadingChange",o),o&&(w.value="")},{immediate:!0}),H(h,o=>{x("formValidChange",o)},{immediate:!0}),Te({title:"Mint Liker Land NFT Book",ogTitle:"Mint Liker Land NFT Book"});const A=T;H(()=>A.iscnId,async o=>{o&&await K(A.iscnId)},{immediate:!0});async function K(o){if(o)try{if(a.value=!0,!await F(o))throw new Error("Invalid NFT Class ID");const[E,e]=await Promise.all([D(o),I(o)]);if(!E)throw new Error("Invalid NFT Class ID");M.value={contentMetadata:E,owner:e,"@id":o},y.value=e,R.value=o,g.value=3}catch(d){console.error(d),w.value=d.toString()}finally{a.value=!1}}function O(){var o;(o=U.value)==null||o.startNFTMintFlow()}function P({classId:o,nftMintCount:d}={}){R.value=o||"",x("submit",{classId:o||"",nftMintCount:d})}return S({startNFTMintFlow:O}),(o,d)=>{const E=he,e=nt,_=Pe,C=qe;return b(),k("div",ot,[n(w)?(b(),W(E,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${n(w)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:d[0]||(d[0]=r=>w.value="")},null,8,["title"])):q("",!0),i(e,{"iscn-id":n(p),"iscn-owner":n(y),"iscn-data":n(M),"show-edit-button":!0,onEdit:d[1]||(d[1]=r=>c.value=!0)},null,8,["iscn-id","iscn-owner","iscn-data"]),i(_,{ref_key:"liteMintNFTRef",ref:U,"iscn-data":n(M),"should-show-submit":!1,onFormValidChange:d[2]||(d[2]=r=>h.value=r),onSubmit:P},null,8,["iscn-data"]),i(C,{modelValue:n(c),"onUpdate:modelValue":d[3]||(d[3]=r=>ee(c)?c.value=r:null),"class-id":n(R)},null,8,["modelValue","class-id"])])}}}),lt={class:"w-full"},it={class:"justify-evenly items-center flex space-x-4 relative"},rt={class:"text-sm font-semibold"},ut={class:"mt-6 p-4 border rounded-lg bg-gray-100 text-center flex flex-col gap-[24px]"},ct={key:0},dt={key:1},pt={key:2},mt={key:3},ft={class:"flex gap-2 justify-center mt-4"},_t={key:0,class:"flex flex-col justify-center px-[12px] mt-[16px]"},vt={class:"flex flex-col items-center gap-4 py-4"},bt={class:"flex flex-col items-center"},gt={key:0},yt={class:"flex items-center"},wt={key:0,class:"flex flex-col items-center gap-2 w-full max-w-md"},zt=Q({__name:"index",setup(T){var te,ae;const S=se(),{wallet:f,signer:I}=ie(S),{initIfNecessary:D}=S,F=ke(),g=Me(),{showErrorToast:w}=ce(),a=s(0),y=s(),M=s(),R=s(),U=s(!1),p=s(""),c=s(""),h=s(((te=F.query.iscn_id)==null?void 0:te.toString())||""),x=s(((ae=F.query.class_id)==null?void 0:ae.toString())||""),A=s([]),K=s(""),O=s(!1),P=s(!1),o=s(!1),d=L(()=>!!c.value),E=L(()=>{switch(a.value){case 0:return"Start Upload";case 1:return"Register ISCN";case 2:return"Mint NFT";default:return"Next"}}),e=L(()=>{var l;return((l=A.value)==null?void 0:l.length)>0}),_=L(()=>a.value===0?e.value:a.value<3),C=L(()=>a.value===0?K.value!=="":a.value===2?o.value:!1),r=[{title:"上傳檔案",description:"Upload your book file"},{title:"註冊 ISCN",description:"Register ISCN"},{title:"鑄造區塊鏈書",description:"Mint NFT"},{title:"新書發佈",description:"Publish new book"}];re(()=>{var t;let l=null;try{const V=sessionStorage.getItem(Ue);V&&(l=JSON.parse(V))}catch(V){console.error(V)}h.value?(p.value=h.value,$({iscnId:h.value})):x.value?G({classId:x.value}):l!=null&&l.epubMetadata&&(l!=null&&l.fileRecords)&&(c.value=(t=l==null?void 0:l.epubMetadata)==null?void 0:t.title)});const B=async()=>{if((!f.value||!I.value)&&await D(),!f.value||!I.value){w("Please login first");return}try{if(a.value===0&&y.value){await y.value.onSubmit();return}if(a.value===1){if(!O.value){w("Please fill in all required fields");return}await M.value.onSubmit();return}if(a.value===2){if(!P.value){w("Please fill in all required fields");return}await R.value.startNFTMintFlow();return}a.value<r.length-1&&a.value++}catch(l){console.error("Error during form submission:",l)}},z=l=>{$e(l),a.value=1},$=async l=>{const{iscnId:t}=l;t&&g.replace({query:{iscn_id:t}}),De(),a.value=2,await ne(),h.value=t},G=async l=>{const{classId:t,nftMintCount:V}=l;t&&(x.value=t,g.replace({query:{class_id:t,count:V}}),a.value=3,await ne())},u=()=>{g.push({name:"nft-book-store"})},Z=async()=>{p.value&&await $({iscnId:p.value})};return(l,t)=>{const V=Be,pe=Ke,me=at,fe=st,_e=Xe,J=ue,ve=de,be=Qe;return b(),W(be,{class:"flex flex-col items-stretch grow space-y-4"},{default:N(()=>[m("div",lt,[m("div",it,[t[8]||(t[8]=m("div",{class:"absolute w-full h-[1px] bg-gray-300 top-[50%] left-0 z-[-1]"},null,-1)),(b(),k(Re,null,Ee(r,(v,Y)=>m("div",{key:Y,class:"flex items-center space-x-2 bg-white p-2 rounded-lg"},[i(V,{size:Y===n(a)?"lg":"md",text:(Y+1).toString(),ui:{background:Y===n(a)?"bg-primary-100":"bg-gray-200"}},null,8,["size","text","ui"]),m("p",rt,X(v.title),1)])),64))]),m("div",ut,[n(a)===0?(b(),k("div",ct,[i(pe,{ref_key:"uploadFormRef",ref:y,onFileUploadStatus:t[0]||(t[0]=v=>K.value=v),onFileReady:t[1]||(t[1]=v=>A.value=v),onSubmit:z},null,512)])):n(a)===1?(b(),k("div",dt,[i(me,{ref_key:"registerISCN",ref:M,onFormValidChange:t[2]||(t[2]=v=>O.value=v),onSubmit:$},null,512)])):n(a)===2?(b(),k("div",pt,[i(fe,{ref_key:"mintNFT",ref:R,"iscn-id":n(h),onLoadingChange:t[3]||(t[3]=v=>o.value=v),onFormValidChange:t[4]||(t[4]=v=>P.value=v),onSubmit:G},null,8,["iscn-id"])])):n(a)===3?(b(),k("div",mt,[i(_e,{ref:"newNFTBook",class:"p-0 flex flex-col text-left gap-[24px]","is-new-class-page":!0,"class-id":n(x),onSubmit:u},null,8,["class-id"])])):q("",!0),m("div",ft,[n(_)?(b(),W(J,{key:0,disabled:n(C),onClick:B},{default:N(()=>[j(X(n(E)),1)]),_:1},8,["disabled"])):q("",!0)])]),n(a)===0?(b(),k("div",_t,[t[13]||(t[13]=m("div",{class:"w-full bg-gray-300 h-[1px]"},null,-1)),m("div",vt,[m("div",bt,[n(d)?(b(),k("div",gt,[t[9]||(t[9]=j(" 繼續上次的註冊: ")),i(J,{variant:"ghost",class:"text-primary-500 font-semibold",onClick:t[5]||(t[5]=v=>a.value=1)},{default:N(()=>[j(X(n(c)),1)]),_:1})])):q("",!0),m("div",yt,[t[11]||(t[11]=m("span",null,"已經有 ISCN ID 了？ 按",-1)),i(J,{variant:"ghost",onClick:t[6]||(t[6]=v=>U.value=!n(U))},{default:N(()=>t[10]||(t[10]=[j(" 這裡 ")])),_:1,__:[10]})])]),n(U)?(b(),k("div",wt,[i(ve,{modelValue:n(p),"onUpdate:modelValue":t[7]||(t[7]=v=>ee(p)?p.value=v:null),placeholder:"輸入 ISCN ID"},null,8,["modelValue"]),i(J,{disabled:!n(p),onClick:Z},{default:N(()=>t[12]||(t[12]=[j(" 確認 ")])),_:1,__:[12]},8,["disabled"])])):q("",!0)])])):q("",!0)])]),_:1})}}});export{zt as default};
