import{n as Ze,T as He,q as Ge,v as Ke,s as he,M as Qe,u as Xe,r as s,a4 as ge,C as k,y as Ye,z as Je,h as eo,o as m,B as p,w as a,a5 as oo,F as l,N as E,d as O,c as ae,b as o,a as r,t as ye,G as _,b8 as _e,H as we,I as lo,a6 as j,a7 as to,Z as ao,a3 as no,Q as io,a8 as so,K as ro,a9 as uo,_ as co}from"./D6SWFTK-.js";import{_ as mo}from"./BEp4rydo.js";import{_ as po}from"./DvoYa4fO.js";import{_ as fo}from"./D4Z_PGOe.js";import{_ as bo}from"./DR5WqLUx.js";import{j as vo,u as ke,p as ho,_ as go}from"./D-D-Slrt.js";import{a as yo,_ as _o}from"./Dyu6Qreo.js";import{v as wo,_ as ko}from"./CE7E45wN.js";import{_ as xo}from"./DAfnJqEB.js";import{_ as Co}from"./CblZZMOj.js";import{_ as Vo,a as Uo,b as Po}from"./CjrOg59K.js";import{_ as Io}from"./C7Hg6kHG.js";import{u as Eo}from"./CWThljpF.js";import"./BIJ64lMo.js";import"./Cm-uwJtc.js";import"./rnCUIJWp.js";import"./BGIwxqcm.js";import"./CQvrgNF2.js";(function(){try{var N=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},L=new Error().stack;L&&(N._sentryDebugIds=N._sentryDebugIds||{},N._sentryDebugIds[L]="fc6d369c-5499-4d74-9e89-ac1eb5a448b7",N._sentryDebugIdIdentifier="sentry-dbid-fc6d369c-5499-4d74-9e89-ac1eb5a448b7")}catch{}})();const So={class:"font-bold font-mono"},Do={class:"flex justify-center items-center"},To={class:"flex justify-center items-center"},No={class:"flex gap-2"},Mo={class:"flex justify-end items-center"},Ao={class:"flex justify-between items-center w-full"},$o={key:0,class:"mt-[24px] flex flex-col gap-[12px]"},Fo={class:"flex gap-2"},Ro={class:"flex justify-end items-center"},Bo={class:"grid md:grid-cols-2 gap-4"},Oo=Ze({__name:"new",setup(N){const{LCD_URL:L}=He().public,X=Ge(),ne=Ke(),ie=Eo(),{initIfNecessary:xe}=X,{wallet:V,signer:Y}=he(X),{newBookListing:Ce,updateEditionPrice:Ve}=ne,{fetchStripeConnectStatusByWallet:Ue}=ie,{getStripeConnectStatusByWallet:Pe}=he(ie),se=Qe(),S=Xe(),J=s(S.params.editingClassId||S.query.class_id||""),re=s(S.params.editionIndex),D=s(""),b=s(!1),ue=s({en:"e.g.: This edition includes EPUB and PDF ebook files.",zh:"例：此版本包含 EPUB 及 PDF 電子書檔"}),U=s(J||""),ee=s(1),z=s(""),W=s(!0),M=s(!1),q=s(!1),Z=s(""),w=s([{price:ge,deliveryMethod:"auto",autoMemo:"Thank you for your support. It means a lot to me.",stock:Number(S.query.count||1),nameEn:"Standard Edition",nameZh:"標準版",descriptionEn:"",descriptionZh:"",hasShipping:!1,isPhysicalOnly:!1,isAllowCustomPrice:!1,isUnlisted:!1}]),A=s([]),$=k(()=>w.value.length>1),de=k(()=>$.value?"edition":"book"),H=s(["like1rclg677y2jqt8x4ylj0kjlqjjmnn6w63uflpgr"]),G=s([]),v=s(""),h=s(""),F=s(!1),R=s(""),oe=s(!1),le=s(!0),ce=s(["bold","italic","strikeThrough","title","-","unorderedList","orderedList","-","code","link","=","preview"]),T=k(()=>!!(S.params.editingClassId&&re.value)),Ie=k(()=>T.value?"Edit Current Edition":"New NFT Book Listing"),Ee=k(()=>T.value?"Save Changes":"Submit"),K=s(!1),Se=k(()=>[{key:"wallet",label:"Wallet",sortable:!0},{key:"remove",label:"",sortable:!1}]),De=k(()=>H.value.map((n,e)=>({index:e,wallet:n,walletLink:oo(n)}))),Te=k(()=>G.value.map((n,e)=>({index:e,email:n}))),Ne=k(()=>w.value.some(n=>n.deliveryMethod==="auto"&&n.stock>0));vo({markdownItConfig(n){n.options.html=!1}}),Ye({title:"New Book Listing",ogTitle:"New Book Listing"}),Je(async()=>{try{b.value=!0;try{await Ue(V.value)}catch(n){console.error(n)}Pe.value(V.value).isReady&&(F.value=!0,R.value=V.value)}catch(n){console.error(n)}finally{b.value=!1}}),eo(b,n=>{n&&(D.value="")});function B(n,e,P){var f,u;w.value[P][e]=(f=n.target)==null?void 0:f.value,e==="price"&&Number((u=n.target)==null?void 0:u.value)===0&&(w.value[P].isAllowCustomPrice=!0)}function Me(){ee.value+=1,w.value.push({index:wo(),price:ge,deliveryMethod:"auto",autoMemo:"",stock:1,nameEn:`Tier ${ee.value}`,nameZh:`級別 ${ee.value}`,descriptionEn:"",descriptionZh:"",hasShipping:!1,isPhysicalOnly:!1,isAllowCustomPrice:!0,isUnlisted:!1})}function Ae(n){w.value.splice(n,1)}function $e(n){A.value=n}function Fe(){v.value&&(H.value.push(v.value),v.value="")}function Re(){h.value&&(G.value.push(h.value),h.value="")}function Be(n){R.value=n,oe.value=!0}function me(n=""){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function pe(n){return ho.sanitize(n)}function fe(n){return n.map(e=>({name:{en:e.nameEn,zh:e.nameZh},description:{en:me(e.descriptionEn),zh:me(e.descriptionZh)},priceInDecimal:Math.round(Number(e.price)*100),price:Number(e.price),stock:Number(e.stock),isAutoDeliver:!e.isPhysicalOnly&&e.deliveryMethod==="auto",isAllowCustomPrice:e.isAllowCustomPrice??!0,isUnlisted:e.isUnlisted??!1,autoMemo:e.deliveryMethod==="auto"&&e.autoMemo||"",hasShipping:e.hasShipping||!1,isPhysicalOnly:e.isPhysicalOnly||!1}))}async function Oe(){var n,e,P;try{if(!U.value)throw new Error("Please input NFT class ID");if(v.value)throw new Error('Please press "Add" button to add moderator wallet');if(h.value)throw new Error('Please press "Add" button to add notification email');b.value=!0;const f=await $fetch(`${L}/cosmos/nft/v1beta1/classes/${U.value}`),u=((P=(e=(n=f==null?void 0:f.class)==null?void 0:n.data)==null?void 0:e.metadata)==null?void 0:P.nft_meta_collection_id)||"";if(!u.includes("nft_book")&&!u.includes("book_nft"))throw new Error("NFT Class not in NFT BOOK meta collection");const d=fe(w.value);if(d.find(c=>c.price!==0&&c.price<j))throw new Error(`Price of each edition must be at least $${j} or $0 (free)`);const te=F.value&&R.value?{[R.value]:100}:null,g=A.value.length?A.value.map(c=>({name:{en:c.name.en,zh:c.name.zh},priceInDecimal:c.priceInDecimal,price:c.priceInDecimal/100})):void 0;if(d.some(c=>c.isAutoDeliver)&&!confirm(`NFT Book Press - Reminder
Once you choose automatic delivery, you can't switch it back to manual delivery.  Are you sure?`))return;const Q=d.filter(c=>c.isAutoDeliver).reduce((c,x)=>c+x.stock,0);let I;if(Q>0){if((!V.value||!Y.value)&&await xe(),!V.value||!Y.value)throw new Error("Unable to connect to wallet");I=await uo([U.value],[Z.value],Q,Y.value,V.value)}await Ce(U.value,{tableOfContents:z.value,defaultPaymentCurrency:"USD",connectedWallets:te,moderatorWallets:H.value,notificationEmails:G.value,prices:d,shippingRates:g,mustClaimToView:W.value,enableCustomMessagePage:M.value,hideDownload:q.value,autoDeliverNFTsTxHash:I}),se.push({name:"nft-book-store"})}catch(f){const u=f.data||f;console.error(u),D.value=u}finally{oe.value=!1,b.value=!1}}async function je(){try{if(!T.value)throw new Error("Unable to submit edit: Missing edition index or class ID");const e=fe(w.value)[0];if(!e||e.price===void 0)throw new Error("Please input price of edition");if(e.price!==0&&e.price<j)throw new Error(`Price of each edition must be at least $${j} or $0 (free)`);if(!e.stock&&e.stock!==0)throw new Error("Please input stock of edition");if(e.stock<0)throw new Error("Stock cannot be negative");if(!e.name.en||!e.name.zh)throw new Error("Please input product name");b.value=!0,await Ve(J.value,re.value,{price:e}),se.push({name:"nft-book-store"})}catch(n){const e=n.data||n;console.error(e),D.value=e}finally{b.value=!1}}function Le(){return T.value?je():Oe()}function ze(n){n==="manual"&&(M.value=!0)}return(n,e)=>{const P=ao,f=no,u=mo,d=po,te=fo,g=io,Q=bo,I=so,c=go,x=yo,be=ko,y=ro,We=xo,ve=_o,qe=Co;return m(),p(qe,{class:"pb-[40px]"},{default:a(()=>[l(D)?(m(),p(P,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${l(D)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:e[0]||(e[0]=t=>D.value="")},null,8,["title"])):E("",!0),l(b)?(m(),p(f,{key:1,animation:"carousel"},{indicator:a(()=>e[12]||(e[12]=[O(" Loading... ")])),_:1})):E("",!0),l(ne).isAuthenticated?(m(),ae(we,{key:2},[o(g,{ui:{body:{base:"space-y-4"}}},{header:a(()=>[r("h2",So,ye(l(Ie)),1)]),default:a(()=>[o(d,{label:"NFT Class ID"},{default:a(()=>[l(T)?(m(),p(u,{key:1,value:l(J),readonly:!0},null,8,["value"])):(m(),p(u,{key:0,modelValue:l(U),"onUpdate:modelValue":e[1]||(e[1]=t=>_(U)?U.value=t:null),class:"font-mono",placeholder:"likenft...."},null,8,["modelValue"]))]),_:1}),o(d,{label:"Table Of Content / 章節目錄"},{default:a(()=>[o(te,{modelValue:l(z),"onUpdate:modelValue":e[2]||(e[2]=t=>_(z)?z.value=t:null)},null,8,["modelValue"])]),_:1})]),_:1}),(m(),p(_e(l($)?"ul":"div"),{class:"flex flex-col gap-[12px]"},{default:a(()=>[(m(!0),ae(we,null,lo(l(w),(t,C)=>(m(),p(_e(l($)?"li":"div"),{key:t.index},{default:a(()=>[o(g,{ui:{body:{base:"space-y-5 border-[4px] relative"},base:"overflow-visible border-[2px]"}},{default:a(()=>[o(g,{ui:{body:{base:"flex flex-col gap-[20px]"},base:"overflow-visible"}},{header:a(()=>e[13]||(e[13]=[r("h3",{class:"font-bold font-mono"}," Pricing and Availability ",-1)])),default:a(()=>[o(d,{label:`Unit Price in USD (Minimum ${l(j)}, or 0 for free) / 版本定價（美金）`},{default:a(()=>[o(u,{value:t.price,type:"number",step:"0.01",min:0,onInput:i=>B(i,"price",C)},null,8,["value","onInput"])]),_:2},1032,["label"]),o(d,{label:`Total number of NFT ${l($)?"edition":"ebook"} for sale / 此定價的銷售數量`},{default:a(()=>[o(u,{value:t.stock,type:"number",step:"1",min:0,max:Number(l(S).query.count)||void 0,onInput:i=>B(i,"stock",C)},null,8,["value","max","onInput"])]),_:2},1032,["label"]),o(Q,{modelValue:t.deliveryMethod,"onUpdate:modelValue":i=>t.deliveryMethod=i,disabled:t.isPhysicalOnly,legend:`Delivery method of this ${l(de)} / 自動或手動發書`,options:l(to),onChange:ze},null,8,["modelValue","onUpdate:modelValue","disabled","legend","options"]),t.deliveryMethod==="auto"?(m(),p(d,{key:0},{label:a(()=>[O(ye(`Memo of this ${l(de)} / 自動發書留言`)+" ",1),o(c,null,{image:a(()=>e[14]||(e[14]=[r("img",{src:Vo,class:"object-cover",alt:""},null,-1)])),default:a(()=>[o(I,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:a(()=>[o(u,{value:t.autoMemo,onInput:i=>B(i,"autoMemo",C)},null,8,["value","onInput"])]),_:2},1024)):(m(),p(d,{key:1,label:"Is Physical only good / 只含實體書"},{default:a(()=>[o(x,{modelValue:t.isPhysicalOnly,"onUpdate:modelValue":i=>t.isPhysicalOnly=i,name:"isPhysicalOnly",label:"This edition does not contain digital file/NFT"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)),o(d,null,{label:a(()=>[e[16]||(e[16]=O(" Allow custom price / 開啟打賞功能 ")),o(c,{"image-style":{width:"300px"}},{image:a(()=>e[15]||(e[15]=[r("img",{src:Uo,class:"object-cover",alt:""},null,-1)])),default:a(()=>[o(I,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:a(()=>[o(x,{modelValue:t.isAllowCustomPrice,"onUpdate:modelValue":i=>t.isAllowCustomPrice=i,name:"isAllowCustomPrice",label:"Allow user to pay more than defined price"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(d,{label:"Unlist Edition / 暫時下架"},{default:a(()=>[o(x,{modelValue:t.isUnlisted,"onUpdate:modelValue":i=>t.isUnlisted=i,name:"isUnlisted",label:"Pause selling of this Edition"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),o(g,{ui:{body:{base:"flex flex-col gap-[20px]"},base:"overflow-visible"}},{header:a(()=>e[17]||(e[17]=[r("h3",{class:"font-bold font-mono"}," Product Information ",-1)])),default:a(()=>[o(d,{label:"Product Name",ui:{container:"space-y-2"}},{label:a(()=>[e[19]||(e[19]=O(" Product Name / 產品名稱（英文） ")),o(c,{"image-style":{width:"250px"}},{image:a(()=>e[18]||(e[18]=[r("img",{src:Io,class:"object-cover",alt:""},null,-1)])),default:a(()=>[o(I,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:a(()=>[o(u,{placeholder:"Product name in English",value:t.nameEn,onInput:i=>B(i,"nameEn",C)},null,8,["value","onInput"]),e[20]||(e[20]=r("span",{class:"block text-[14px] text-[#374151] mt-[8px]"},"Description (Optional) / 描述（選填）",-1)),o(l(ke),{modelValue:t.descriptionEn,"onUpdate:modelValue":i=>t.descriptionEn=i,language:"en-US","editor-id":`en-${C}`,placeholder:l(ue).en,toolbars:l(ce),sanitize:pe,style:{height:"200px",width:"100%",marginTop:"0px"}},null,8,["modelValue","onUpdate:modelValue","editor-id","placeholder","toolbars"])]),_:2},1024),o(d,{ui:{container:"space-y-2 my-[20px]"}},{label:a(()=>[e[22]||(e[22]=O(" 產品名稱（中文） ")),o(c,{"image-style":{width:"250px"}},{image:a(()=>e[21]||(e[21]=[r("img",{src:Po,class:"object-cover",alt:""},null,-1)])),default:a(()=>[o(I,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:a(()=>[o(u,{placeholder:"產品中文名字",value:t.nameZh,onInput:i=>B(i,"nameZh",C)},null,8,["value","onInput"]),e[23]||(e[23]=r("span",{class:"block text-[14px] text-[#374151] mt-[8px]"},"描述 (選填)",-1)),o(l(ke),{modelValue:t.descriptionZh,"onUpdate:modelValue":i=>t.descriptionZh=i,language:"en-US","editor-id":`zh-${C}`,placeholder:l(ue).zh,toolbars:l(ce),sanitize:pe,style:{height:"200px",width:"100%",marginTop:"0px"}},null,8,["modelValue","onUpdate:modelValue","editor-id","placeholder","toolbars"])]),_:2},1024)]),_:2},1024),o(be,{modelValue:t.hasShipping,"onUpdate:modelValue":i=>t.hasShipping=i,"is-show-physical-goods-checkbox":!0,"is-show-setting-modal-button":!0,"shipping-info":l(A)},null,8,["modelValue","onUpdate:modelValue","shipping-info"]),r("div",Do,[l($)?(m(),p(y,{key:0,label:"Delete",color:"red",onClick:i=>Ae(C)},null,8,["onClick"])):E("",!0)])]),_:2},1024)]),_:2},1024))),128))]),_:1})),r("div",To,[l(T)?E("",!0):(m(),p(y,{key:0,ui:{rounded:"rounded-full"},color:"gray",icon:"i-heroicons-plus-solid",label:"Add Edition",onClick:Me}))]),o(We,{"is-stripe-connect-checked":l(F),"onUpdate:isStripeConnectChecked":e[3]||(e[3]=t=>_(F)?F.value=t:null),"is-using-default-account":l(le),"onUpdate:isUsingDefaultAccount":e[4]||(e[4]=t=>_(le)?le.value=t:null),"stripe-connect-wallet":l(R),"should-disable-setting":l(oe),"login-address":l(V),onSave:Be},null,8,["is-stripe-connect-checked","is-using-default-account","stripe-connect-wallet","should-disable-setting","login-address"]),o(g,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""}}},{header:a(()=>[e[24]||(e[24]=r("h4",{class:"text-sm font-bold font-mono"}," Email to receive sales notifications / 欲收到銷售通知的電郵 ",-1)),r("div",No,[o(u,{modelValue:l(h),"onUpdate:modelValue":e[5]||(e[5]=t=>_(h)?h.value=t:null),placeholder:"abc@example.com"},null,8,["modelValue"]),o(y,{label:"Add",variant:l(h)?"outline":"solid",color:l(h)?"primary":"gray",disabled:!l(h),onClick:Re},null,8,["variant","color","disabled"])])]),default:a(()=>[o(ve,{columns:[{key:"email",label:"Email",sortable:!0},{key:"action"}],rows:l(Te)},{"email-data":a(({row:t})=>[o(y,{label:t.email,to:`mailto:${t.email}`,variant:"link",padded:!1},null,8,["label","to"])]),"action-data":a(({row:t})=>[r("div",Mo,[o(y,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>l(G).splice(t.index,1)},null,8,["onClick"])])]),_:1},8,["rows"])]),_:1}),o(g,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"12px"}}},{default:a(()=>[r("div",Ao,[e[25]||(e[25]=r("h3",{class:"font-bold font-mono"}," Advanced Settings ",-1)),o(y,{color:"gray",variant:"ghost",icon:l(K)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",onClick:e[6]||(e[6]=()=>{K.value=!l(K)})},null,8,["icon"])]),l(K)?(m(),ae("div",$o,[o(be,{"is-show-physical-goods-checkbox":!1,"is-show-setting-modal-button":!0,"shipping-info":l(A),onUpdateShippingRates:$e},null,8,["shipping-info"]),l(Ne)?(m(),p(d,{key:0,label:"Auto deliver NFT start ID (optional)",ui:{label:{base:"font-mono font-bold"}}},{default:a(()=>[o(u,{modelValue:l(Z),"onUpdate:modelValue":e[7]||(e[7]=t=>_(Z)?Z.value=t:null),class:"font-mono",placeholder:"MY-NFT-PREFIX-000"},null,8,["modelValue"])]),_:1})):E("",!0),o(g,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"",base:"space-y-8"}}},{header:a(()=>[e[26]||(e[26]=r("h4",{class:"text-sm font-bold font-mono"}," Share sales data to wallets / 分享銷售數據給特定地址 ",-1)),r("div",Fo,[o(u,{modelValue:l(v),"onUpdate:modelValue":e[8]||(e[8]=t=>_(v)?v.value=t:null),class:"font-mono",placeholder:"like1..."},null,8,["modelValue"]),o(y,{label:"Add",variant:l(v)?"outline":"solid",color:l(v)?"primary":"gray",disabled:!l(v),onClick:Fe},null,8,["variant","color","disabled"])])]),default:a(()=>[o(ve,{columns:l(Se),rows:l(De)},{"wallet-data":a(({row:t})=>[o(y,{class:"font-mono",label:t.wallet,to:t.walletLink,variant:"link",padded:!1},null,8,["label","to"])]),"remove-data":a(({row:t})=>[r("div",Ro,[o(y,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>l(H).splice(t.index,1)},null,8,["onClick"])])]),_:1},8,["columns","rows"])]),_:1}),o(g,{ui:{body:{base:"space-y-8"}}},{header:a(()=>e[27]||(e[27]=[r("h3",{class:"font-bold font-mono"}," DRM Options / 數位版權管理選項 ",-1)])),default:a(()=>[r("div",Bo,[o(d,{label:"Force NFT claim before view",ui:{label:{base:"font-mono font-bold"}}},{default:a(()=>[o(x,{modelValue:l(W),"onUpdate:modelValue":e[9]||(e[9]=t=>_(W)?W.value=t:null),name:"mustClaimToView",label:"Must claim NFT to view"},null,8,["modelValue"])]),_:1}),o(d,{label:"Disable File Download",ui:{label:{base:"font-mono font-bold"}}},{default:a(()=>[o(x,{modelValue:l(q),"onUpdate:modelValue":e[10]||(e[10]=t=>_(q)?q.value=t:null),name:"hideDownload",label:"Disable Download"},null,8,["modelValue"])]),_:1}),o(d,{label:"Insert cutomized message page in eBook",ui:{label:{base:"font-mono font-bold"}}},{default:a(()=>[o(x,{modelValue:l(M),"onUpdate:modelValue":e[11]||(e[11]=t=>_(M)?M.value=t:null),name:"enableCustomMessagePage",label:"Enable custom message page"},null,8,["modelValue"])]),_:1})])]),_:1})])):E("",!0)]),_:1}),o(y,{label:l(Ee),loading:l(b),size:"lg",disabled:l(b),onClick:Le},null,8,["label","loading","disabled"])],64)):E("",!0)]),_:1})}}}),nl=co(Oo,[["__scopeId","data-v-25d69d0c"]]);export{nl as default};
//# sourceMappingURL=x4IYHZAm.js.map
