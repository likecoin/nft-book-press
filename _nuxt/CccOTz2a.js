import{_ as re}from"./DzLi5s9U.js";import{a_ as ce,a$ as ie,b7 as ue,by as _e,bz as me,b6 as de,b0 as be,bk as pe,b8 as S,ba as n,b9 as i,bh as fe,b1 as ke,bb as ye,b3 as b,aT as u,aX as l,aW as _,bi as D,b4 as o,bj as ve,bA as ge,aY as C,aV as v,aU as P,bv as he,bd as q,bq as xe,aS as we,bB as I,b2 as Se,bC as Ce,bD as Ie,bE as Ue,bF as $e,bn as Be}from"./Bm-IVQXy.js";import{_ as Re}from"./eXK-QAli.js";import{_ as Le}from"./By4zMR4m.js";import{_ as Te}from"./CJZdjB35.js";import{_ as Ve}from"./BuTWThA6.js";import{u as Ne}from"./BhEP3np7.js";import"./BKYXZsm5.js";import"./CHUa3QAq.js";import"./5y732Oo6.js";(function(){try{var c=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new c.Error().stack;t&&(c._sentryDebugIds=c._sentryDebugIds||{},c._sentryDebugIds[t]="3c9caeaa-b4b9-4313-8d38-181bc561247d",c._sentryDebugIdIdentifier="sentry-dbid-3c9caeaa-b4b9-4313-8d38-181bc561247d")}catch{}})();const Ae={class:"flex px-3 py-3.5 border-b border-gray-200"},De=["src","alt"],Pe=["textContent"],Xe=ce({__name:"latest-books",setup(c){const{t}=ie(),{BOOK3_URL:g,LIKE_CO_API:E}=ue().public,j=_e(),K=Ne(),M=me(),O=de(),W=be(),z=pe(),{wallet:U}=S(O),{userLikerInfo:$}=S(j),{isAuthenticated:h}=S(M),B=n(()=>[{label:t("latest_books.latest_releases"),key:"latest"},{label:t("latest_books.best_sellers"),key:"bestselling"}]),m=i(""),p=i(!1),R=i([]),L=i([]),f=i(0),d=i(z.query.q||""),x=n(()=>$.value?.user?Ie($.value?.user):""),w=n(()=>p.value&&x.value),F=n(()=>[{key:"image",label:t("table.cover"),sortable:!1},{key:"className",label:t("latest_books.book_name"),sortable:!0},{key:"author",label:t("common.author"),sortable:!0},{key:"priceInUSD",label:t("common.price"),sortable:!0},{key:"url",label:w.value?t("latest_books.affiliation_link"):t("common.link"),sortable:!1}]),T=n(()=>B.value[f.value]?.key||"latest"),H=n(()=>T.value==="latest"?R.value:L.value),V=n(()=>H.value.map(e=>{const a=e.name||e.title,r=e.thumbnailUrl||e.imageUrl,k=e.author?.name||e.author;return{className:a,image:r?Ue($e(r)):void 0,author:k,priceInUSD:`US$${e.minPrice||e.prices?.[0]?.price||0}`,url:`${g}/store/${e.classId}?from=${x.value}&utm_source=bookpress&utm_medium=list_${T.value}`}})),X=n(()=>{if(!d.value)return V.value;const e=d.value.toLowerCase();return V.value.filter(a=>[a.className,a.author].some(r=>r&&r.toLowerCase().includes(e)))});fe({title:()=>t("seo.latest_books_title"),ogTitle:()=>t("seo.latest_books_title")}),ke(async()=>{if(await Promise.all([Y().catch(e=>{m.value=e}),G().catch(e=>{m.value=e})]),h.value)try{await N()}catch(e){console.error(e)}});async function Y(){const e=await $fetch(`${E}/likernft/book/store/list?chain=base&limit=100`);R.value=e?.list||[]}async function G(){const e=await $fetch(`${g}/api/store/products?tag=bestselling`);L.value=e?.records||[]}async function N(){if(!U.value){p.value=!1;return}try{const e=await K.fetchStripeConnectStatusByWallet(U.value);p.value=e?.isReady}catch(e){console.error(e),p.value=!1}}function J(){I("latest_books_click_affiliation_setup"),Se(W({name:"settings"}))}function Q(e){I("latest_books_click_table_row"),window.open(e.url,"_blank")}function Z(e,a){e.stopPropagation(),I("latest_books_click_copy_button"),Ce(a)}return ye(h,()=>{h.value&&Be(()=>{N()})}),(e,a)=>{const r=re,k=ve,ee=Re,A=ge,te=he,oe=xe,ae=Le,se=Te,ne=Ve;return u(),b(ne,null,{default:l(()=>[_(r,{title:o(t)("latest_books.title")},null,8,["title"]),o(m)?(u(),b(k,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${o(m)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:a[0]||(a[0]=y=>m.value="")},null,8,["title"])):D("",!0),o(w)?(u(),b(A,{key:2},{default:l(()=>[C(v(o(t)("latest_books_extended.append_text")),1),_(ee,{class:"font-mono"},{default:l(()=>[C(" ?from="+v(o(x)),1)]),_:1}),C(v(o(t)("latest_books_extended.append_suffix")),1)]),_:1})):(u(),b(k,{key:1,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"soft",title:o(t)("latest_books.join_affiliation"),description:o(t)("latest_books.affiliation_description"),actions:[{label:o(t)("common.setup"),color:"orange",variant:"outline",click:J}]},null,8,["title","description","actions"])),_(se,{modelValue:o(f),"onUpdate:modelValue":a[2]||(a[2]=y=>q(f)?f.value=y:null),class:"w-full",items:o(B)},{item:l(({item:y})=>[(u(),b(A,{key:y.key,ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{default:l(()=>[P("div",Ae,[_(te,{modelValue:o(d),"onUpdate:modelValue":a[1]||(a[1]=s=>q(d)?d.value=s:null),placeholder:o(t)("latest_books.filter_placeholder")},null,8,["modelValue","placeholder"])]),_(ae,{columns:o(F),rows:o(X),onSelect:Q},{"image-data":l(({row:s})=>[s.image?(u(),we("img",{key:0,src:s.image,alt:s.className,class:"w-12 h-12 object-cover rounded-lg"},null,8,De)):D("",!0)]),"className-data":l(({row:s})=>[P("div",{class:"max-w-[20vw] whitespace-normal",textContent:v(s.className)},null,8,Pe)]),"url-data":l(({row:s})=>[_(oe,{label:o(t)("common.copy"),disabled:!o(w),onClick:le=>Z(le,s.url)},null,8,["label","disabled","onClick"])]),_:1},8,["columns","rows"])]),_:1}))]),_:1},8,["modelValue","items"])]),_:1})}}});export{Xe as default};
