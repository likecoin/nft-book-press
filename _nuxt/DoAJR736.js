import{_ as G}from"./DzLi5s9U.js";import{_ as Q}from"./BDfKDI31.js";import{a_ as X,a$ as Y,bt as J,bk as Z,b0 as ee,b9 as b,ba as R,bh as te,b1 as oe,b3 as g,aT as w,aX as s,aW as n,b4 as t,bi as T,aU as S,bw as ne,bd as v,bv as ae,bA as le,bx as re,bq as se,aY as B,aV as V,cb as ie,cc as ce,b2 as ue}from"./Bm-IVQXy.js";import{_ as _e}from"./C9B8-UsT.js";import{_ as de}from"./By4zMR4m.js";import{_ as he}from"./BuTWThA6.js";import{_ as be}from"./KtZcInvk.js";import{p as me}from"./CUxdmJDi.js";import"./BKYXZsm5.js";import"./CHUa3QAq.js";(function(){try{var _=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new _.Error().stack;o&&(_._sentryDebugIds=_._sentryDebugIds||{},_._sentryDebugIds[o]="d11af995-d0a9-40d3-9a66-72c89c9c797e",_._sentryDebugIdIdentifier="sentry-dbid-d11af995-d0a9-40d3-9a66-72c89c9c797e")}catch{}})();const pe={class:"flex justify-center"},fe={class:"font-bold font-mono"},ke={class:"flex items-center gap-2"},U="key,url",Ce=X({__name:"batch-short-links",setup(_){const{t:o}=Y(),m=J(),I=Z(),$=ee(),D=[{label:"Bitly",value:"bitly"},{label:"Short.io",value:"shortio"}],d=b(I.query.provider||"bitly"),L=R(()=>d.value==="shortio"),p=b(""),f=b(I.query.title_prefix||o("batch_short_links.default_title_prefix")),c=b(""),q=`${U}
example01,https://example01.com,
example02,https://example02.com,`,h=b(""),P=R(()=>{switch(d.value){case"bitly":return o("batch_short_links.bitly_token");case"shortio":return o("batch_short_links.shortio_api_key");default:return""}}),k=b([]);te({title:"Batch Create Book Short Links",ogTitle:"Batch Create Book Short Links"}),oe(()=>{try{const l=sessionStorage.getItem("nft_book_press_batch_shorten_url");l&&(c.value=l,sessionStorage.removeItem("nft_book_press_batch_shorten_url"))}catch(l){console.error(l)}});async function A({url:l,key:e}){try{const a=await $fetch("https://api-ssl.bitly.com/v4/bitlinks",{method:"POST",headers:{Authorization:`Bearer ${h.value}`},body:{long_url:l,domain:"bit.ly",title:[f.value,e].join(" - "),tags:["nft-book-press"]}});if(!a)throw new Error(o("batch_short_links.bitly_no_data"));return a.link}catch(a){return console.error(a),m.add({icon:"i-heroicons-exclamation-circle",title:a.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}}),"error"}}async function j({url:l,key:e}){try{const a=await $fetch("https://api.short.io/links/public",{method:"POST",headers:{Authorization:h.value},body:{allowDuplicates:!0,domain:p.value,originalURL:l,title:[f.value,e].join(" - "),tags:["nft-book-press"]}});if(!a)throw new Error(o("batch_short_links.shortio_no_data"));return a.shortURL}catch(a){return console.error(a),m.add({icon:"i-heroicons-exclamation-circle",title:a.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}}),"error"}}async function E(){let l=[];try{let e=c.value;e.includes(U)||(e=`${U}
${e}`),l=me(e,{columns:!0,skip_empty_lines:!0})}catch(e){console.error(e),m.add({icon:"i-heroicons-exclamation-circle",title:e.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}});return}try{for(const{key:e,url:a}of l){let u="";switch(d.value){case"bitly":u=await A({url:a,key:e});break;case"shortio":u=await j({url:a,key:e});break;default:break}k.value.push({key:e,url:u,destination:a})}}catch(e){console.error(e),m.add({icon:"i-heroicons-exclamation-circle",title:e.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}})}}function N(){ie({data:k.value,fileName:"shortened_links.csv",fileType:"csv"})}async function O(){sessionStorage.setItem("nft_book_press_batch_qrcode",ce(k.value)),await ue($({name:"batch-qrcode"}))}function z(l){if(!l?.length)return;const e=l[0];if(!e)return;const a=new FileReader;a.onload=u=>{const i=u.target?.result;typeof i=="string"&&(c.value=i)},a.readAsText(e)}return(l,e)=>{const a=G,u=Q,i=ne,x=ae,F=re,W=_e,C=le,y=se,H=de,K=he,M=be;return w(),g(M,null,{default:s(()=>[n(a,{title:t(o)("batch_short_links.page_title")},null,8,["title"]),n(K,null,{default:s(()=>[n(i,{label:t(o)("batch_short_links.provider_label"),required:!0},{default:s(()=>[n(u,{modelValue:t(d),"onUpdate:modelValue":e[0]||(e[0]=r=>v(d)?d.value=r:null),options:D},null,8,["modelValue"])]),_:1},8,["label"]),n(i,{label:t(P),required:!0},{default:s(()=>[n(x,{modelValue:t(h),"onUpdate:modelValue":e[1]||(e[1]=r=>v(h)?h.value=r:null),class:"font-mono",autocomplete:!1},null,8,["modelValue"])]),_:1},8,["label"]),t(L)?(w(),g(i,{key:0,label:t(o)("batch_short_links.shortio_domain"),required:!0},{default:s(()=>[n(x,{modelValue:t(p),"onUpdate:modelValue":e[2]||(e[2]=r=>v(p)?p.value=r:null),class:"font-mono",placeholder:"link.liker.land",autocomplete:!1},null,8,["modelValue"])]),_:1},8,["label"])):T("",!0),n(i,{label:t(o)("batch_short_links.title_prefix")},{default:s(()=>[n(x,{modelValue:t(f),"onUpdate:modelValue":e[3]||(e[3]=r=>v(f)?f.value=r:null),hint:t(o)("batch_short_links.optional")},null,8,["modelValue","hint"])]),_:1},8,["label"]),n(C,{ui:{body:{base:"space-y-2"}}},{default:s(()=>[n(i,{label:t(o)("batch_short_links.upload_csv")},{default:s(()=>[n(x,{type:"file",accept:"csv",onChange:z})]),_:1},8,["label"]),n(F,{class:"print:hidden",label:t(o)("batch_short_links.or_divider")},null,8,["label"]),n(i,{label:t(o)("batch_short_links.input_csv")},{default:s(()=>[n(W,{modelValue:t(c),"onUpdate:modelValue":e[4]||(e[4]=r=>v(c)?c.value=r:null),class:"font-mono",placeholder:q,resize:!0},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),S("div",pe,[n(y,{label:t(o)("batch_short_links.start"),size:"lg",disabled:!t(c)||!t(h)||t(L)&&!t(p),onClick:E},null,8,["label","disabled"])]),t(k).length?(w(),g(C,{key:1,ui:{header:{base:"flex justify-between items-center gap-2"},body:{padding:""}}},{header:s(()=>[S("h3",fe,V(t(o)("batch_short_links.results")),1),S("div",ke,[n(y,{label:t(o)("batch_short_links.download_csv"),variant:"outline",onClick:N},null,8,["label"]),n(y,{label:t(o)("batch_short_links.convert_to_qr"),variant:"outline",onClick:O},null,8,["label"])])]),default:s(()=>[n(H,{columns:[{key:"key",label:t(o)("batch_short_links.key_column")},{key:"url",label:t(o)("batch_short_links.url_column")},{key:"destination",label:t(o)("batch_short_links.destination_column")}],rows:t(k)},{"url-data":s(({row:r})=>[n(y,{class:"font-mono",to:r.url,target:"_blank",rel:"noopener",variant:"link",padded:!1},{default:s(()=>[B(V(r.url),1)]),_:2},1032,["to"])]),"destination-data":s(({row:r})=>[n(y,{class:"font-mono",to:r.destination,target:"_blank",rel:"noopener",variant:"link",padded:!1},{default:s(()=>[B(V(r.destination),1)]),_:2},1032,["to"])]),_:1},8,["columns","rows"])]),_:1})):T("",!0)]),_:1})]),_:1})}}});export{Ce as default};
