import{_ as le}from"./BAS2LMTG.js";import{n as re,T as ie,v as ce,q as ue,M as me,u as de,s as C,r,C as l,y as _e,z as fe,h as pe,o as i,B as p,w as s,U as ke,V as be,W as ye,D as ve,b as c,F as a,N as P,d as I,t as q,a as E,G as K,c as ge,X as x,Y as he,Z as we,$ as Se,Q as Le,K as Ce}from"./D6SWFTK-.js";import{_ as Ie}from"./BEp4rydo.js";import{_ as xe}from"./Dyu6Qreo.js";import{_ as Be}from"./D0W9f-1Z.js";import{_ as Ue}from"./CblZZMOj.js";import{u as Re}from"./Db50pQ1v.js";import{u as $e}from"./CWThljpF.js";import"./BEr8OvV9.js";import"./BIJ64lMo.js";(function(){try{var u=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},m=new Error().stack;m&&(u._sentryDebugIds=u._sentryDebugIds||{},u._sentryDebugIds[m]="18ae30a0-114b-4811-a82f-0042314b6222",u._sentryDebugIdIdentifier="sentry-dbid-18ae30a0-114b-4811-a82f-0042314b6222")}catch{}})();const Ae={class:"flex px-3 py-3.5 border-b border-gray-200"},Ne=["src","alt"],Te=["textContent"],ze=re({__name:"latest-books",setup(u){const{LIKER_LAND_URL:m,LIKE_CO_API:B}=ie().public,M=Re(),F=$e(),W=ce(),j=ue(),z=me(),O=de(),{wallet:U}=C(j),{userLikerInfo:R}=C(M),{isAuthenticated:w}=C(W),$=[{label:"Latest Releases",key:"latest"},{label:"Best Sellers",key:"bestselling"}],d=r(""),k=r(!1),A=r([]),N=r([]),b=r(0),_=r(O.query.q||""),S=l(()=>{var e,t;return(e=R.value)!=null&&e.user?ke((t=R.value)==null?void 0:t.user):""}),L=l(()=>k.value&&S.value),G=l(()=>[{key:"image",label:"Cover",sortable:!1},{key:"className",label:"Book Name",sortable:!0},{key:"author",label:"Author",sortable:!0},{key:"priceInUSD",label:"Price",sortable:!0},{key:"url",label:L.value?"Affiliation Link":"Link",sortable:!1}]),T=l(()=>$[b.value].key),H=l(()=>T.value==="latest"?A.value:N.value),V=l(()=>H.value.map(e=>{var v,f,g;const t=e.name||e.title,n=e.thumbnailUrl||e.imageUrl,y=((v=e.author)==null?void 0:v.name)||e.author;return{className:t,image:n?be(ye(n)):void 0,author:y,priceInUSD:`US$${e.minPrice||((g=(f=e.prices)==null?void 0:f[0])==null?void 0:g.price)||0}`,url:`${m}/nft/class/${e.classId}?from=${S.value}&utm_source=bookpress&utm_medium=list_${T.value}`}})),J=l(()=>{if(!_.value)return V.value;const e=_.value.toLowerCase();return V.value.filter(t=>[t.className,t.author].some(n=>n&&n.toLowerCase().includes(e)))});_e({title:"Latest Books",ogTitle:"Latest Books"}),fe(async()=>{if(await Promise.all([Q().catch(e=>{d.value=e}),X().catch(e=>{d.value=e})]),w.value)try{await D()}catch(e){console.error(e)}});async function Q(){const e=await $fetch(`${B}/likernft/book/store/list?limit=100`);A.value=(e==null?void 0:e.list)||[]}async function X(){const e=await $fetch(`${m}/api/bookstore/products?tag=bestselling`);N.value=(e==null?void 0:e.records)||[]}async function D(){if(!U.value){k.value=!1;return}try{const e=await F.fetchStripeConnectStatusByWallet(U.value);k.value=e==null?void 0:e.isReady}catch(e){console.error(e),k.value=!1}}function Y(){x("latest_books_click_affiliation_setup"),z.push({name:"nft-book-store-user"})}function Z(e){x("latest_books_click_table_row"),window.open(e.url,"_blank")}function ee(e,t){e.stopPropagation(),x("latest_books_click_copy_button"),he(t)}return pe(w,()=>{w.value&&ve(()=>{D()})}),(e,t)=>{const n=le,y=we,v=Se,f=Le,g=Ie,te=Ce,oe=xe,ae=Be,se=Ue;return i(),p(se,null,{default:s(()=>[c(n,{title:"Latest Books on Liker Land Bookstore"}),a(d)?(i(),p(y,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${a(d)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:t[0]||(t[0]=h=>d.value="")},null,8,["title"])):P("",!0),a(L)?(i(),p(f,{key:2},{default:s(()=>[t[3]||(t[3]=I(" Append ")),c(v,{class:"font-mono"},{default:s(()=>[I(" ?from="+q(a(S)),1)]),_:1}),t[4]||(t[4]=I(" in any bookstore page to earn commission from book sales. "))]),_:1})):(i(),p(y,{key:1,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"soft",title:"Join Our Affiliation Program!",description:"Setup your Liker ID and Stripe Connect Account to participate in sales affiliation program on Liker Land Bookstore.",actions:[{label:"Setup",color:"orange",variant:"outline",click:Y}]},null,8,["actions"])),c(ae,{modelValue:a(b),"onUpdate:modelValue":t[2]||(t[2]=h=>K(b)?b.value=h:null),class:"w-full",items:$},{item:s(({item:h})=>[(i(),p(f,{key:h.key,ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{default:s(()=>[E("div",Ae,[c(g,{modelValue:a(_),"onUpdate:modelValue":t[1]||(t[1]=o=>K(_)?_.value=o:null),placeholder:"Filter books by name or author"},null,8,["modelValue"])]),c(oe,{columns:a(G),rows:a(J),onSelect:Z},{"image-data":s(({row:o})=>[o.image?(i(),ge("img",{key:0,src:o.image,alt:o.className,class:"w-12 h-12 object-cover rounded-lg"},null,8,Ne)):P("",!0)]),"className-data":s(({row:o})=>[E("div",{class:"max-w-[20vw] whitespace-normal",textContent:q(o.className)},null,8,Te)]),"url-data":s(({row:o})=>[c(te,{label:"Copy",disabled:!a(L),onClick:ne=>ee(ne,o.url)},null,8,["disabled","onClick"])]),_:1},8,["columns","rows"])]),_:2},1024))]),_:1},8,["modelValue"])]),_:1})}}});export{ze as default};
//# sourceMappingURL=f-KldTj-.js.map
