import{a$ as te,b9 as P,ba as y,cf as Z,a_ as se,bz as re,bb as ie,b1 as ce,b3 as U,aT as C,aX as u,aU as m,bi as ue,aW as p,aV as k,b4 as a,aY as de,bq as me,bj as fe,c9 as pe,bo as J,bf as _e,aS as be,cg as K,bd as ee,bA as ge}from"./DumGTjYM.js";import{_ as he}from"./CxGu1Oix.js";import{_ as ve}from"./CojZis71.js";import{_ as ye}from"./BJWYKlaQ.js";import{_ as ke}from"./MzQChZ3W.js";import{_ as xe}from"./W3ygKMn8.js";import{u as Ce}from"./BsnhX1RH.js";import"./BMjTwTvZ.js";import"./BgVieAPN.js";import"./BxZXZrCg.js";(function(){try{var c=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},f=new c.Error().stack;f&&(c._sentryDebugIds=c._sentryDebugIds||{},c._sentryDebugIds[f]="c1da989f-f01f-4e95-a230-e8251b7d09a4",c._sentryDebugIdIdentifier="sentry-dbid-c1da989f-f01f-4e95-a230-e8251b7d09a4")}catch{}})();function Se(){const{t:c}=te(),f=Ce(),d=P({page:1,limit:100,total:0}),r=P({column:null,direction:null}),M=[{label:"25",value:25},{label:"50",value:50},{label:"100",value:100},{label:"200",value:200}],g=P([]),R=y(()=>g.value.length>0),b=y(()=>g.value.length),D=y(()=>[{key:"readerEmail",label:c("table.reader_email")},{key:"readerWallet",label:c("table.reader_wallet")},{key:"firstPurchaseTime",label:c("table.first_purchase")},{key:"lastPurchaseTime",label:c("table.last_purchase")},{key:"lifetimeValue",label:c("table.lifetime_value")},{key:"hasMessage",label:c("table.has_message")}]),j=y(()=>{const e=D.value.map(o=>({key:o.key,label:o.label,sortable:!0})),n=Object.values(f.booksInfo).map(o=>({key:`book_${o.classId}`,label:o.name?.slice(0,1)||o.classId.slice(0,1),sortable:!0}));return[...e,...n]}),N=y(()=>{const e=[...f.readers];return!r.value.column||!r.value.direction?e.sort((n,o)=>o.lifetimeValue-n.lifetimeValue):e.sort((n,o)=>{const s=n[r.value.column],l=o[r.value.column];let i=0;if(r.value.column.includes("Time")){const _=new Date(s).getTime(),v=new Date(l).getTime();i=_-v}else typeof s=="string"&&typeof l=="string"?i=s.localeCompare(l):typeof s=="number"&&typeof l=="number"?i=s-l:typeof s=="boolean"&&typeof l=="boolean"?i=(s?1:0)-(l?1:0):s==null&&l==null?i=0:s==null?i=-1:l==null?i=1:i=String(s).localeCompare(String(l));return r.value.direction==="desc"?-i:i})}),x=y(()=>{d.value.total=f.readers.length;const e=(d.value.page-1)*d.value.limit,n=e+d.value.limit;return N.value.slice(e,n)}),B=y(()=>Math.ceil(d.value.total/d.value.limit));function L(e){g.value=e}function O(){g.value=[]}function S(e,n="zh-TW"){if(!e)return"-";const o=new Date(e);return isNaN(o.getTime())?"-":o.toLocaleDateString(n,{year:"numeric",month:"2-digit",day:"2-digit"})}function w(e,n=2){return typeof e!="number"||isNaN(e)?"0.00":`${e.toFixed(n)}`}function E(e,n){r.value.column=e,r.value.direction=n}function A(e){const n=Math.ceil(d.value.total/d.value.limit);d.value.page=Math.max(1,Math.min(e,n))}function Y(e){d.value.limit=e,d.value.page=1}function V(e,n=6,o=4){return e?e.length<=n+o?e:`${e.slice(0,n)}...${e.slice(-o)}`:""}function F(e){return e?`https://opensea.io/${e}`:""}function q(e,n,o){return e===o?n==="asc"?"i-heroicons-bars-arrow-up-20-solid":"i-heroicons-bars-arrow-down-20-solid":"i-heroicons-arrows-up-down-20-solid"}function X(e,n){return n.split(".").reduce((o,s)=>o?.[s],e)}function $(e){const n=String(e);return n.includes(",")||n.includes('"')||n.includes(`
`)?`"${n.replace(/"/g,'""')}"`:n}function h(e,n){return[e.join(","),...n.map(s=>s.map(l=>$(l)).join(","))].join(`
`)}function G(e,n){const o=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),l=URL.createObjectURL(o);s.setAttribute("href",l),s.setAttribute("download",n),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(l)}function W(e,n,o){if(e.length===0)return;const s=n.map(v=>v.label),l=e.map(v=>n.map(I=>{const T=X(v,I.key);return I.formatter?I.formatter(T):T})),i=h(s,l),_=o||`export_${new Date().toISOString().split("T")[0]}.csv`;G(i,_)}function H(){if(!R.value)return;const e=[{key:"readerEmail",label:c("table.reader_email")},{key:"readerWallet",label:c("table.reader_wallet")},{key:"firstPurchaseTime",label:c("table.first_purchase"),formatter:S},{key:"lastPurchaseTime",label:c("table.last_purchase"),formatter:S},{key:"lifetimeValue",label:`${c("table.lifetime_value")} (USD)`,formatter:o=>w(o)},{key:"hasMessage",label:c("table.has_message"),formatter:o=>o?"Y":"N"},...Object.values(f.booksInfo).map(o=>({key:`purchasedBooks.${o.classId}`,label:o.name||o.classId,formatter:s=>s?"Y":"N"}))],n=`readers_export_${new Date().toISOString().split("T")[0]}.csv`;W(g.value,e,n)}return{ordersStore:f,sortedReaders:N,paginatedReaders:x,columns:j,totalPages:B,pagination:Z(d),sortState:Z(r),selectedRows:g,hasSelection:R,selectionCount:b,baseColumnsConfig:D,setSortState:E,setPage:A,setPageSize:Y,onSelect:L,clearSelection:O,formatDate:S,formatCurrency:w,shortenWallet:V,getWalletLink:F,getSortIcon:q,pageSizeOptions:M,exportToCSV:W,exportReadersToCSV:H}}const we={class:"flex justify-between items-center"},Ve=["textContent"],$e={class:"flex gap-2"},Ie={class:"flex justify-between items-center"},Te=["textContent"],Ue={class:"flex items-center gap-2"},Pe=["textContent"],Re={class:"w-full flex justify-start"},De={key:1,class:"text-gray-400"},je=["textContent"],Ne=["textContent"],We=["textContent"],ze={class:"flex justify-center w-full"},Me={class:"flex justify-center w-full"},Be={class:"flex justify-end items-center"},Je=se({__name:"index",setup(c){const{t:f}=te(),d=re(),{ordersStore:r,paginatedReaders:M,columns:g,pagination:R,sortState:b,selectedRows:D,hasSelection:j,selectionCount:N,setSortState:x,setPage:B,setPageSize:L,onSelect:O,clearSelection:S,formatDate:w,formatCurrency:E,shortenWallet:A,getWalletLink:Y,getSortIcon:V,baseColumnsConfig:F,pageSizeOptions:q,exportReadersToCSV:X}=Se(),$=P(100),h=P(1);ie(h,l=>{B(l)}),ce(async()=>{d.isAuthenticated&&await G()});async function G(){await r.fetchReaders()}async function W(){await r.fetchReaders(!0),S()}function H(l){L(l),h.value=1}function e(l){const i=b.value;i.column===l?i.direction==="asc"?x(l,"desc"):i.direction==="desc"?x(null,null):x(l,"asc"):x(l,"asc")}function n(){X()}function o(l){window.open(`mailto:${l}`,"_self")}function s(l){window.open(Y(l),"_blank")}return(l,i)=>{const _=me,v=fe,I=he,T=ve,Q=_e,ae=ye,ne=ke,oe=ge,le=xe;return C(),U(le,{class:"space-y-6"},{default:u(()=>[m("div",we,[m("h1",{class:"text-lg font-bold font-mono",textContent:k(a(f)("menu.readers_list"))},null,8,Ve),m("div",$e,[p(_,{icon:"i-hugeicons-csv-02",color:a(j)?"primary":"gray",disabled:!a(j),variant:"outline",onClick:n},{default:u(()=>[de(k(a(f)("common.export_csv",{length:a(N)})),1)]),_:1},8,["color","disabled"]),p(_,{icon:"i-heroicons-arrow-path",variant:"outline",color:"gray",disabled:a(r).isLoading,loading:a(r).isLoading,onClick:W},null,8,["disabled","loading"])])]),a(r).error?(C(),U(v,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:a(r).error,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:i[0]||(i[0]=t=>a(r).clearError())},null,8,["title"])):ue("",!0),p(oe,{ui:{body:{padding:"!p-0"}}},{header:u(()=>[m("div",Ie,[m("h3",{class:"font-medium",textContent:k(a(f)("readers.total_readers",{count:a(r).isLoading?"...":a(r).readers.length}))},null,8,Te),m("div",Ue,[m("span",{class:"text-sm text-gray-500",textContent:k(a(f)("common.page_size"))},null,8,Pe),p(I,{modelValue:a($),"onUpdate:modelValue":i[1]||(i[1]=t=>ee($)?$.value=t:null),options:a(q),size:"sm",onChange:H},null,8,["modelValue","options"])])])]),footer:u(()=>[m("div",Be,[p(ne,{modelValue:a(h),"onUpdate:modelValue":i[2]||(i[2]=t=>ee(h)?h.value=t:null),"page-count":a(R).limit,total:a(r).readers.length,max:7,"show-last":"","show-first":""},null,8,["modelValue","page-count","total"])])]),default:u(()=>[p(ae,{"model-value":a(D),rows:a(M),columns:a(g),loading:a(r).isLoading,progress:{color:"primary",animation:"carousel"},ui:{th:{base:"text-left text-nowrap whitespace-nowrap"},td:{base:"text-right"},tr:{base:"cursor-default [&>td]:pointer-events-none [&>td>*]:pointer-events-auto [&>td>input]:pointer-events-auto hover:bg-gray-50 dark:hover:bg-gray-800/30 transition-colors duration-200",selected:"bg-gray-50 dark:bg-gray-800/50",active:""}},"onUpdate:modelValue":a(O)},pe({"readerEmail-data":u(({row:t})=>[m("div",Re,[p(_,{label:t.readerEmail,variant:"link",size:"sm",onClick:K(z=>o(t.readerEmail),["stop"])},null,8,["label","onClick"])])]),"readerWallet-data":u(({row:t})=>[t.readerWallet?(C(),U(_,{key:0,class:"font-mono",label:a(A)(t.readerWallet),variant:"link",size:"sm",onClick:K(z=>s(t.readerWallet),["stop"])},null,8,["label","onClick"])):(C(),be("span",De,"-"))]),"firstPurchaseTime-data":u(({row:t})=>[m("span",{class:"text-sm",textContent:k(a(w)(t.firstPurchaseTime))},null,8,je)]),"lastPurchaseTime-data":u(({row:t})=>[m("span",{class:"text-sm",textContent:k(a(w)(t.lastPurchaseTime))},null,8,Ne)]),"lifetimeValue-data":u(({row:t})=>[m("span",{class:"font-medium",textContent:k(`$${a(E)(t.lifetimeValue)}`)},null,8,We)]),"hasMessage-data":u(({row:t})=>[m("div",ze,[p(Q,{color:t.hasMessage?"green":"gray",label:t.hasMessage?"Y":"N",variant:"soft"},null,8,["color","label"])])]),_:2},[J(a(F),t=>({name:`${t.key}-header`,fn:u(()=>[t.key!=="lifetimeValue"?(C(),U(_,{key:0,color:"gray",variant:"ghost",label:t.label,"trailing-icon":a(V)(a(b).column,a(b).direction,t.key),onClick:()=>e(t.key)},null,8,["label","trailing-icon","onClick"])):(C(),U(T,{key:1,text:"USD"},{default:u(()=>[p(_,{color:"gray",variant:"ghost",label:t.label,"trailing-icon":a(V)(a(b).column,a(b).direction,t.key),onClick:()=>e(t.key)},null,8,["label","trailing-icon","onClick"])]),_:2},1024))])})),J(Object.values(a(r).booksInfo),t=>({name:`book_${t.classId}-header`,fn:u(()=>[p(T,{text:t.name||t.classId,class:"cursor-help"},{default:u(()=>[p(_,{color:"gray",variant:"ghost",label:t.name?.slice(0,1)||t.classId.slice(0,1),"trailing-icon":a(V)(a(b).column,a(b).direction,`book_${t.classId}`),onClick:()=>e(`book_${t.classId}`)},null,8,["label","trailing-icon","onClick"])]),_:2},1032,["text"])])})),J(Object.values(a(r).booksInfo),t=>({name:`book_${t.classId}-data`,fn:u(({row:z})=>[m("div",Me,[p(Q,{color:z[`book_${t.classId}`]?"green":"gray",label:z[`book_${t.classId}`]?"Y":"N",variant:"soft"},null,8,["color","label"])])])}))]),1032,["model-value","rows","columns","loading","onUpdate:modelValue"])]),_:1})]),_:1})}}});export{Je as default};
