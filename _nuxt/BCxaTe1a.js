import{_ as re}from"./CqvhB5OJ.js";import{a_ as ie,a$ as ce,b6 as ue,bk as me,bl as _e,b0 as be,bm as de,bn as C,b8 as c,b9 as r,bb as fe,b1 as pe,ba as ke,b3 as f,aX as n,bo as ye,bp as ve,bq as ge,aT as u,aW as m,br as P,b4 as a,bs as he,bt as we,aY as U,bu as Se,aV as q,bf as E,aU as K,bg as xe,aS as Ie,bv as B,b2 as Ce,bw as Ue,bc as Be}from"./CfseOdbi.js";import{_ as Le}from"./-gN7atBo.js";import{_ as Re}from"./Vz5hS-_V.js";import{_ as $e}from"./CMPxrW4j.js";import{_ as Te}from"./YhmgSYdO.js";import{u as Ve}from"./B3l6Zn9z.js";import{u as Ne}from"./C1nflsXw.js";import"./Jm4E6K-K.js";import"./W06PnaAv.js";(function(){try{var i=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new i.Error().stack;o&&(i._sentryDebugIds=i._sentryDebugIds||{},i._sentryDebugIds[o]="30f3fb20-7b74-4487-9587-deff09884156",i._sentryDebugIdIdentifier="sentry-dbid-30f3fb20-7b74-4487-9587-deff09884156")}catch{}})();const Ae={class:"flex px-3 py-3.5 border-b border-gray-200"},De=["src","alt"],Pe=["textContent"],Xe=ie({__name:"latest-books",setup(i){const{t:o}=ce(),{BOOK3_URL:w,LIKE_CO_API:j}=ue().public,M=Ve(),O=Ne(),W=me(),z=_e(),F=be(),H=de(),{wallet:L}=C(z),{userLikerInfo:R}=C(M),{isAuthenticated:S}=C(W),$=[{label:o("latest_books.latest_releases"),key:"latest"},{label:o("latest_books.best_sellers"),key:"bestselling"}],_=c(""),p=c(!1),T=c([]),V=c([]),k=c(0),b=c(H.query.q||""),x=r(()=>{var e,t;return(e=R.value)!=null&&e.user?ye((t=R.value)==null?void 0:t.user):""}),I=r(()=>p.value&&x.value),X=r(()=>[{key:"image",label:"Cover",sortable:!1},{key:"className",label:o("latest_books.book_name"),sortable:!0},{key:"author",label:o("common.author"),sortable:!0},{key:"priceInUSD",label:o("common.price"),sortable:!0},{key:"url",label:I.value?o("latest_books.affiliation_link"):o("common.link"),sortable:!1}]),N=r(()=>$[k.value].key),Y=r(()=>N.value==="latest"?T.value:V.value),A=r(()=>Y.value.map(e=>{var v,d,g;const t=e.name||e.title,l=e.thumbnailUrl||e.imageUrl,y=((v=e.author)==null?void 0:v.name)||e.author;return{className:t,image:l?ve(ge(l)):void 0,author:y,priceInUSD:`US$${e.minPrice||((g=(d=e.prices)==null?void 0:d[0])==null?void 0:g.price)||0}`,url:`${w}/store/${e.classId}?from=${x.value}&utm_source=bookpress&utm_medium=list_${N.value}`}})),G=r(()=>{if(!b.value)return A.value;const e=b.value.toLowerCase();return A.value.filter(t=>[t.className,t.author].some(l=>l&&l.toLowerCase().includes(e)))});fe({title:"Latest Books",ogTitle:"Latest Books"}),pe(async()=>{if(await Promise.all([J().catch(e=>{_.value=e}),Q().catch(e=>{_.value=e})]),S.value)try{await D()}catch(e){console.error(e)}});async function J(){const e=await $fetch(`${j}/likernft/book/store/list?limit=100`);T.value=(e==null?void 0:e.list)||[]}async function Q(){const e=await $fetch(`${w}/api/store/products?tag=bestselling`);V.value=(e==null?void 0:e.records)||[]}async function D(){if(!L.value){p.value=!1;return}try{const e=await O.fetchStripeConnectStatusByWallet(L.value);p.value=e==null?void 0:e.isReady}catch(e){console.error(e),p.value=!1}}function Z(){B("latest_books_click_affiliation_setup"),Ce(F({name:"nft-book-store-user"}))}function ee(e){B("latest_books_click_table_row"),window.open(e.url,"_blank")}function te(e,t){e.stopPropagation(),B("latest_books_click_copy_button"),Ue(t)}return ke(S,()=>{S.value&&Be(()=>{D()})}),(e,t)=>{const l=re,y=he,v=Se,d=we,g=Le,oe=xe,ae=Re,se=$e,ne=Te;return u(),f(ne,null,{default:n(()=>[m(l,{title:a(o)("latest_books.title")},null,8,["title"]),a(_)?(u(),f(y,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${a(_)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:t[0]||(t[0]=h=>_.value="")},null,8,["title"])):P("",!0),a(I)?(u(),f(d,{key:2},{default:n(()=>[t[3]||(t[3]=U(" Append ")),m(v,{class:"font-mono"},{default:n(()=>[U(" ?from="+q(a(x)),1)]),_:1}),t[4]||(t[4]=U(" in any bookstore page to earn commission from book sales. "))]),_:1,__:[3,4]})):(u(),f(y,{key:1,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"soft",title:a(o)("latest_books.join_affiliation"),description:a(o)("latest_books.affiliation_description"),actions:[{label:a(o)("common.setup"),color:"orange",variant:"outline",click:Z}]},null,8,["title","description","actions"])),m(se,{modelValue:a(k),"onUpdate:modelValue":t[2]||(t[2]=h=>E(k)?k.value=h:null),class:"w-full",items:$},{item:n(({item:h})=>[(u(),f(d,{key:h.key,ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{default:n(()=>[K("div",Ae,[m(g,{modelValue:a(b),"onUpdate:modelValue":t[1]||(t[1]=s=>E(b)?b.value=s:null),placeholder:a(o)("latest_books.filter_placeholder")},null,8,["modelValue","placeholder"])]),m(ae,{columns:a(X),rows:a(G),onSelect:ee},{"image-data":n(({row:s})=>[s.image?(u(),Ie("img",{key:0,src:s.image,alt:s.className,class:"w-12 h-12 object-cover rounded-lg"},null,8,De)):P("",!0)]),"className-data":n(({row:s})=>[K("div",{class:"max-w-[20vw] whitespace-normal",textContent:q(s.className)},null,8,Pe)]),"url-data":n(({row:s})=>[m(oe,{label:a(o)("common.copy"),disabled:!a(I),onClick:le=>te(le,s.url)},null,8,["label","disabled","onClick"])]),_:1},8,["columns","rows"])]),_:2},1024))]),_:1},8,["modelValue"])]),_:1})}}});export{Xe as default};
