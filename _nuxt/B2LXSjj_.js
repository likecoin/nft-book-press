import{_ as M}from"./_xqkQBDk.js";import{_ as Q}from"./Q37Pn4Iu.js";import{_ as G}from"./fSYI2djn.js";import{_ as X}from"./E4GXFPh-.js";import{a_ as Y,b3 as J,bk as Z,a$ as ee,b4 as f,b5 as I,b7 as te,b0 as oe,b1 as g,aX as a,aT as S,aW as t,bp as L,aU as V,bb as v,bc as l,br as ne,ba as re,bd as ae,aY as B,aV as R,bH as le,bI as se}from"./BjoCzWI2.js";import{_ as ie}from"./DmTm9tLn.js";import{_ as ue}from"./DOx9Xdc8.js";import{_ as de}from"./DddVZUKs.js";import{_ as ce}from"./Q_4PWqM0.js";import{p as me}from"./CUxdmJDi.js";import"./Zk_lbjmT.js";import"./wnw-1H5d.js";(function(){try{var m=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new m.Error().stack;i&&(m._sentryDebugIds=m._sentryDebugIds||{},m._sentryDebugIds[i]="813e23c7-38c8-42e5-81c6-d26424280701",m._sentryDebugIdIdentifier="sentry-dbid-813e23c7-38c8-42e5-81c6-d26424280701")}catch{}})();const _e={class:"flex justify-center"},pe={class:"flex items-center gap-2"},w="key,url",Ce=Y({__name:"batch-short-links",setup(m){const i=J(),x=Z(),T=ee(),D=[{label:"Bitly",value:"bitly"},{label:"Short.io",value:"shortio"}],_=f(x.query.provider||"bitly"),U=I(()=>_.value==="shortio"),b=f(""),h=f(x.query.title_prefix||"NFT Book Press"),u=f(""),P=`${w}
example01,https://example01.com,
example02,https://example02.com,`,p=f(""),$=I(()=>{switch(_.value){case"bitly":return"Bitly Access Token";case"shortio":return"Short.io API Key";default:return""}}),y=f([]);te({title:"Batch Create Book Short Links",ogTitle:"Batch Create Book Short Links"}),oe(()=>{try{const n=sessionStorage.getItem("nft_book_press_batch_shorten_url");n&&(u.value=n,sessionStorage.removeItem("nft_book_press_batch_shorten_url"))}catch(n){console.error(n)}});async function A({url:n,key:e}){try{const o=await $fetch("https://api-ssl.bitly.com/v4/bitlinks",{method:"POST",headers:{Authorization:`Bearer ${p.value}`},body:{long_url:n,domain:"bit.ly",title:[h.value,e].join(" - "),tags:["nft-book-press"]}});if(!o)throw new Error("No data returned from Bitly");return o.link}catch(o){return console.error(o),i.add({icon:"i-heroicons-exclamation-circle",title:o.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}}),"error"}}async function N({url:n,key:e}){try{const o=await $fetch("https://api.short.io/links/public",{method:"POST",headers:{Authorization:p.value},body:{allowDuplicates:!0,domain:b.value,originalURL:n,title:[h.value,e].join(" - "),tags:["nft-book-press"]}});if(!o)throw new Error("No data returned from Short.io");return o.shortURL}catch(o){return console.error(o),i.add({icon:"i-heroicons-exclamation-circle",title:o.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}}),"error"}}async function q(){let n=[];try{let e=u.value;e.includes(w)||(e=`${w}
${e}`),n=me(e,{columns:!0,skip_empty_lines:!0})}catch(e){console.error(e),i.add({icon:"i-heroicons-exclamation-circle",title:e.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}});return}try{for(const{key:e,url:o}of n){let d="";switch(_.value){case"bitly":d=await A({url:o,key:e});break;case"shortio":d=await N({url:o,key:e});break;default:break}y.value.push({key:e,url:d,destination:o})}}catch(e){console.error(e),i.add({icon:"i-heroicons-exclamation-circle",title:e.toString(),timeout:0,color:"red",ui:{title:"text-red-400 dark:text-red-400"}})}}function O(){le({data:y.value,fileName:"shortened_links.csv",fileType:"csv"})}function j(){sessionStorage.setItem("nft_book_press_batch_qrcode",se(y.value)),T.push({name:"batch-qrcode"})}function E(n){if(!n)return;const[e]=n,o=new FileReader;o.onload=d=>{var c;const s=(c=d.target)==null?void 0:c.result;typeof s=="string"&&(u.value=s)},o.readAsText(e)}return(n,e)=>{const o=M,d=Q,s=G,c=X,F=re,z=ie,C=ne,k=ae,K=ue,H=de,W=ce;return S(),g(W,null,{default:a(()=>[t(o,{title:"Batch Create Book Short Links"}),t(H,null,{default:a(()=>[t(s,{label:"Short Link Provider",required:!0},{default:a(()=>[t(d,{modelValue:l(_),"onUpdate:modelValue":e[0]||(e[0]=r=>v(_)?_.value=r:null),options:D},null,8,["modelValue"])]),_:1}),t(s,{label:l($),required:!0},{default:a(()=>[t(c,{modelValue:l(p),"onUpdate:modelValue":e[1]||(e[1]=r=>v(p)?p.value=r:null),class:"font-mono",autocomplete:!1},null,8,["modelValue"])]),_:1},8,["label"]),l(U)?(S(),g(s,{key:0,label:"Short.io Domain",required:!0},{default:a(()=>[t(c,{modelValue:l(b),"onUpdate:modelValue":e[2]||(e[2]=r=>v(b)?b.value=r:null),class:"font-mono",placeholder:"link.liker.land",autocomplete:!1},null,8,["modelValue"])]),_:1})):L("",!0),t(s,{label:"Title Prefix"},{default:a(()=>[t(c,{modelValue:l(h),"onUpdate:modelValue":e[3]||(e[3]=r=>v(h)?h.value=r:null),hint:"Optional"},null,8,["modelValue"])]),_:1}),t(C,{ui:{body:{base:"space-y-2"}}},{default:a(()=>[t(s,{label:"Upload CSV file"},{default:a(()=>[t(c,{type:"file",accept:"csv",onChange:E})]),_:1}),t(F,{class:"print:hidden",label:"OR"}),t(s,{label:"Input CSV content"},{default:a(()=>[t(z,{modelValue:l(u),"onUpdate:modelValue":e[4]||(e[4]=r=>v(u)?u.value=r:null),class:"font-mono",placeholder:P,resize:!0},null,8,["modelValue"])]),_:1})]),_:1}),V("div",_e,[t(k,{label:"Start",size:"lg",disabled:!l(u)||!l(p)||l(U)&&!l(b),onClick:q},null,8,["disabled"])]),l(y).length?(S(),g(C,{key:1,ui:{header:{base:"flex justify-between items-center gap-2"},body:{padding:""}}},{header:a(()=>[e[5]||(e[5]=V("h3",{class:"font-bold font-mono"}," Results ",-1)),V("div",pe,[t(k,{label:"Download CSV",variant:"outline",onClick:O}),t(k,{label:"Convert to QR Codes",variant:"outline",onClick:j})])]),default:a(()=>[t(K,{columns:[{key:"key",label:"Key"},{key:"url",label:"URL"},{key:"destination",label:"Destination"}],rows:l(y)},{"url-data":a(({row:r})=>[t(k,{class:"font-mono",to:r.url,target:"_blank",rel:"noopener",variant:"link",padded:!1},{default:a(()=>[B(R(r.url),1)]),_:2},1032,["to"])]),"destination-data":a(({row:r})=>[t(k,{class:"font-mono",to:r.destination,target:"_blank",rel:"noopener",variant:"link",padded:!1},{default:a(()=>[B(R(r.destination),1)]),_:2},1032,["to"])]),_:1},8,["rows"])]),_:1})):L("",!0)]),_:1})]),_:1})}}});export{Ce as default};
