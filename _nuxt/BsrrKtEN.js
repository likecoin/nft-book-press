import{O as v,ej as L,r as h,s as k,eg as B,P as b,R as g,h as p}from"./CXvzJBqc.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new Error().stack;a&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[a]="06069e5a-6e1a-4ae4-8daf-6b2ce758d7ef",t._sentryDebugIdIdentifier="sentry-dbid-06069e5a-6e1a-4ae4-8daf-6b2ce758d7ef")}catch{}})();async function $(t){const{LIKE_CO_API:a}=v().public,o=`${a}/users/id/${t}/min`;return await $fetch(o)}async function m(t,{nocache:a=!1}={}){const{LIKE_CO_API:o}=v().public,u=a?`?ts=${Math.round(new Date().getTime()/1e3)}`:"",i=`${o}/users/addr/${t}/min${u}`;return await $fetch(i)}const U=L("liker",()=>{const t=h({}),a=k(()=>Object.entries(t.value).reduce((e,[n,l])=>(e[l.likeWallet]=n,e[l.evmWallet]=n,e),{})),o=k(()=>e=>t.value[e]||null),u=k(()=>e=>o.value(a.value[e])),i=k(()=>e=>{const n=B(e);return o.value(n)});async function c(e){try{const l=await $(e);if(!l)throw new Error("Missing data in `fetchLikerInfoById`");return t.value[e]=l,l}catch{return null}}async function r(e){return t.value[e]?t.value[e]:await c(e)}async function y(e,{nocache:n=!1}={}){try{const f=await m(e,{nocache:n});if(!f)throw new Error("Missing data in `fetchLikerInfoByWallet`");return t.value[f.user]=f,f}catch{return null}}async function I(e){const n=a.value[e];return n?r(n):await y(e)}async function d(e){const n=B(e);return await r(n)}return{likerInfoMapById:t,likerIdMapByWallet:a,getLikerInfoById:o,getLikerInfoByWallet:u,getChannelInfoById:i,fetchLikerInfoById:c,lazyFetchLikerInfoById:r,fetchLikerInfoByWallet:y,lazyFetchLikerInfoByWallet:I,lazyFetchChannelInfoById:d}}),W=L("user",()=>{const{LIKE_CO_API:t}=v().public,a=b(),{token:o,isAuthenticated:u,wallet:i}=g(a),c=U(),r=h(null),y=h(!1),I=k(()=>u.value&&i.value?c.getLikerInfoByWallet(i.value):null),d=h(!1);async function e(){const s=await $fetch(`${t}/likernft/book/user/profile`,{headers:{authorization:`Bearer ${o.value}`}});return r.value=s,r.value}async function n(){if(r.value)return r.value;try{return await e()}catch(s){s.message!=="USER_NOT_FOUND"&&console.error(s)}}async function l(s){try{return y.value=!0,await $fetch(`${t}/likernft/book/user/profile`,{method:"POST",body:s,headers:{authorization:`Bearer ${o.value}`}}),r.value={...r.value,...s},r.value}finally{y.value=!1}}async function f({nocache:s=!1}={}){if(!u.value)return null;try{return d.value=!0,await c.fetchLikerInfoByWallet(i.value,{nocache:s})}finally{d.value=!1}}async function w(){return u.value?I.value?I.value:await f():null}return p(u,()=>{u.value?(w(),n()):r.value=null}),{bookUser:r,isUpdatingBookUserProfile:y,userLikerInfo:I,isFetchingUserLikerInfo:d,fetchBookUserProfile:e,lazyFetchBookUserProfile:n,updateBookUserProfile:l,fetchUserLikerInfo:f,lazyFetchUserLikerInfo:w}});export{U as a,W as u};
//# sourceMappingURL=BsrrKtEN.js.map
