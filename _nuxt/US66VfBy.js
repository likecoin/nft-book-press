import{_ as le}from"./_xqkQBDk.js";import{a_ as re,bh as ie,bi as ce,bj as ue,a$ as me,bk as de,bl as I,b4 as i,b5 as l,b7 as _e,b0 as fe,b6 as be,b1 as b,aX as s,bm as pe,bn as ke,bo as ye,aT as c,aW as u,bp as P,bc as a,bq as ve,br as ge,aY as x,bs as he,aV as q,bb as E,aU as K,bd as Se,aS as we,bt as C,bu as Le,b8 as Ie}from"./BjoCzWI2.js";import{_ as xe}from"./E4GXFPh-.js";import{_ as Ce}from"./DOx9Xdc8.js";import{_ as Be}from"./CHC8BpZF.js";import{_ as Ue}from"./DddVZUKs.js";import{u as Re}from"./laR2faq0.js";import{u as $e}from"./D_l-FOBp.js";import"./Zk_lbjmT.js";import"./wnw-1H5d.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},m=new r.Error().stack;m&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[m]="1421a43f-b613-455d-bb92-f0a5a567df10",r._sentryDebugIdIdentifier="sentry-dbid-1421a43f-b613-455d-bb92-f0a5a567df10")}catch{}})();const Ae={class:"flex px-3 py-3.5 border-b border-gray-200"},Te=["src","alt"],Ne=["textContent"],Oe=re({__name:"latest-books",setup(r){const{LIKER_LAND_URL:m,LIKE_CO_API:B}=ie().public,j=Re(),M=$e(),W=ce(),F=ue(),O=me(),z=de(),{wallet:U}=I(F),{userLikerInfo:R}=I(j),{isAuthenticated:S}=I(W),$=[{label:"Latest Releases",key:"latest"},{label:"Best Sellers",key:"bestselling"}],d=i(""),p=i(!1),A=i([]),T=i([]),k=i(0),_=i(z.query.q||""),w=l(()=>{var e,t;return(e=R.value)!=null&&e.user?pe((t=R.value)==null?void 0:t.user):""}),L=l(()=>p.value&&w.value),H=l(()=>[{key:"image",label:"Cover",sortable:!1},{key:"className",label:"Book Name",sortable:!0},{key:"author",label:"Author",sortable:!0},{key:"priceInUSD",label:"Price",sortable:!0},{key:"url",label:L.value?"Affiliation Link":"Link",sortable:!1}]),N=l(()=>$[k.value].key),J=l(()=>N.value==="latest"?A.value:T.value),V=l(()=>J.value.map(e=>{var v,f,g;const t=e.name||e.title,n=e.thumbnailUrl||e.imageUrl,y=((v=e.author)==null?void 0:v.name)||e.author;return{className:t,image:n?ke(ye(n)):void 0,author:y,priceInUSD:`US$${e.minPrice||((g=(f=e.prices)==null?void 0:f[0])==null?void 0:g.price)||0}`,url:`${m}/nft/class/${e.classId}?from=${w.value}&utm_source=bookpress&utm_medium=list_${N.value}`}})),X=l(()=>{if(!_.value)return V.value;const e=_.value.toLowerCase();return V.value.filter(t=>[t.className,t.author].some(n=>n&&n.toLowerCase().includes(e)))});_e({title:"Latest Books",ogTitle:"Latest Books"}),fe(async()=>{if(await Promise.all([Y().catch(e=>{d.value=e}),G().catch(e=>{d.value=e})]),S.value)try{await D()}catch(e){console.error(e)}});async function Y(){const e=await $fetch(`${B}/likernft/book/store/list?limit=100`);A.value=(e==null?void 0:e.list)||[]}async function G(){const e=await $fetch(`${m}/api/bookstore/products?tag=bestselling`);T.value=(e==null?void 0:e.records)||[]}async function D(){if(!U.value){p.value=!1;return}try{const e=await M.fetchStripeConnectStatusByWallet(U.value);p.value=e==null?void 0:e.isReady}catch(e){console.error(e),p.value=!1}}function Q(){C("latest_books_click_affiliation_setup"),O.push({name:"nft-book-store-user"})}function Z(e){C("latest_books_click_table_row"),window.open(e.url,"_blank")}function ee(e,t){e.stopPropagation(),C("latest_books_click_copy_button"),Le(t)}return be(S,()=>{S.value&&Ie(()=>{D()})}),(e,t)=>{const n=le,y=ve,v=he,f=ge,g=xe,te=Se,oe=Ce,ae=Be,se=Ue;return c(),b(se,null,{default:s(()=>[u(n,{title:"Latest Books on Liker Land Bookstore"}),a(d)?(c(),b(y,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${a(d)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:t[0]||(t[0]=h=>d.value="")},null,8,["title"])):P("",!0),a(L)?(c(),b(f,{key:2},{default:s(()=>[t[3]||(t[3]=x(" Append ")),u(v,{class:"font-mono"},{default:s(()=>[x(" ?from="+q(a(w)),1)]),_:1}),t[4]||(t[4]=x(" in any bookstore page to earn commission from book sales. "))]),_:1,__:[3,4]})):(c(),b(y,{key:1,icon:"i-heroicons-exclamation-circle",color:"orange",variant:"soft",title:"Join Our Affiliation Program!",description:"Setup your Liker ID and Stripe Connect Account to participate in sales affiliation program on Liker Land Bookstore.",actions:[{label:"Setup",color:"orange",variant:"outline",click:Q}]},null,8,["actions"])),u(ae,{modelValue:a(k),"onUpdate:modelValue":t[2]||(t[2]=h=>E(k)?k.value=h:null),class:"w-full",items:$},{item:s(({item:h})=>[(c(),b(f,{key:h.key,ui:{header:{base:"flex justify-between items-center"},body:{padding:""},footer:{base:"text-center"}}},{default:s(()=>[K("div",Ae,[u(g,{modelValue:a(_),"onUpdate:modelValue":t[1]||(t[1]=o=>E(_)?_.value=o:null),placeholder:"Filter books by name or author"},null,8,["modelValue"])]),u(oe,{columns:a(H),rows:a(X),onSelect:Z},{"image-data":s(({row:o})=>[o.image?(c(),we("img",{key:0,src:o.image,alt:o.className,class:"w-12 h-12 object-cover rounded-lg"},null,8,Te)):P("",!0)]),"className-data":s(({row:o})=>[K("div",{class:"max-w-[20vw] whitespace-normal",textContent:q(o.className)},null,8,Ne)]),"url-data":s(({row:o})=>[u(te,{label:"Copy",disabled:!a(L),onClick:ne=>ee(ne,o.url)},null,8,["disabled","onClick"])]),_:1},8,["columns","rows"])]),_:2},1024))]),_:1},8,["modelValue"])]),_:1})}}});export{Oe as default};
