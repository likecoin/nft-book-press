import{a_ as X,b6 as te,b7 as Q,b8 as ae,b9 as n,ba as O,bb as j,b1 as oe,bc as _e,aS as E,aT as v,aW as w,b4 as l,bd as me,aX as G,aU as g,be as fe,aY as be,aV as Y,bf as ve,bg as ge,aQ as we,a$ as se,bh as ne,b3 as H,bi as J,bj as ye,b0 as he,bk as Ie,b2 as W,bl as Ne,bm as Z,bn as Se,bo as Fe,bp as Te,bq as ke,br as xe}from"./DKQfXkmP.js";import{u as ie,a as Ce,v as Re,b as ee,_ as De,f as Me,c as Ue,d as Be}from"./Br8u-4wy.js";import{L as Ee,u as Le}from"./CBAIrppT.js";import{D as $e}from"./LMRE0rPC.js";import{u as Ae,a as Ve}from"./BD1AgBKd.js";import{_ as Oe}from"./DQA7KcMa.js";import{_ as Pe}from"./DkKLLjWz.js";import{_ as Ke}from"./C9oTDVtx.js";import"./BUZ_eXdg.js";import"./KfUHJoSC.js";import"./CLRWOvdN.js";import"./Bi1j8ZlZ.js";import"./D39WzfFX.js";import"./Qp-aIGUz.js";import"./BXFcqHP3.js";import"./1ucbcvnE.js";import"./CtJ2k79u.js";import"./B6UX-ISL.js";import"./BzhPE6u9.js";import"./Dm4IUlup.js";import"./CkmEsEx1.js";import"./Cmasbhyi.js";import"./DC62CDPd.js";(function(){try{var y=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new y.Error().stack;i&&(y._sentryDebugIds=y._sentryDebugIds||{},y._sentryDebugIds[i]="b07104a8-620c-4fba-81f9-799942e9af98",y._sentryDebugIdIdentifier="sentry-dbid-b07104a8-620c-4fba-81f9-799942e9af98")}catch{}})();const qe={class:"space-y-3"},ze={class:"flex justify-between items-center"},We={class:"text-xs text-gray-500"},je=X({__name:"RegisterISCN",emits:["handleSubmit","submit","formValidChange"],setup(y,{expose:i,emit:k}){const x=te(),{getFileType:L}=ee(),{LIKE_EVM_NFT_TARGET_ADDRESS:$}=Q().public,{wallet:m,signer:p}=ae(x),{initIfNecessary:S}=x,{assertPositiveWalletBalance:o,waitForTransactionReceipt:F}=Ae(),{stripHtmlTags:C,formatLanguage:R}=ee(),{showErrorToast:D}=ie(),{LIKE_NFT_CONTRACT_ADDRESS:A}=Q().public,r=n({type:"Book",title:"",description:"",isbn:"",publisher:"",publicationDate:"",author:{name:"",description:""},license:"All Rights Reserved",customLicense:"",contentFingerprints:[{url:""}],downloadableUrls:[{url:"",type:"",fileName:""}],language:"",bookInfoUrl:"",tags:[],coverUrl:""}),c=n(""),V=n(""),M=k,{payload:s}=Ce({iscnFormData:r}),{writeContractAsync:u}=Ve(),h=O(()=>Re(r.value)),I=O(()=>{var t;return!((t=h.value)!=null&&t.length)});j(I,t=>{M("formValidChange",t)},{immediate:!0}),oe(()=>{const t=P();t&&(r.value=t)});const P=()=>{var f,d,T,U,B,a;const t=_e();if(!t)return null;const _={type:"Book",title:((f=t.epubMetadata)==null?void 0:f.title)||"",description:C(((d=t.epubMetadata)==null?void 0:d.description)||""),isbn:"",publisher:"",publicationDate:new Date().toISOString().split("T")[0],author:{name:((T=t.epubMetadata)==null?void 0:T.author)||"",description:""},license:"All Rights Reserved",contentFingerprints:[],downloadableUrls:[],coverUrl:(U=t.epubMetadata)!=null&&U.thumbnailArweaveId?`ar://${t.epubMetadata.thumbnailArweaveId}`:"",language:R(((B=t.epubMetadata)==null?void 0:B.language)||"zh"),tags:((a=t.epubMetadata)==null?void 0:a.tags)||[]};return _.downloadableUrls=t.fileRecords.filter(e=>e.fileType==="application/pdf"||e.fileType==="application/epub+zip").map(e=>({url:e.arweaveKey?e.arweaveLink:`ar://${e.arweaveId}`,type:L(e.fileType),fileName:e.fileName})),_.contentFingerprints=[...new Set(t.fileRecords.map(e=>{const b=e.arweaveKey?e.arweaveLink:`ar://${e.arweaveId}`;return e.fileType==="application/epub+zip"||e.fileType==="application/pdf"?b:`ar://${e.arweaveId}`}).filter(Boolean))].map(e=>({url:e})),_},z=async()=>{if(c.value="checking",!I.value){D(h.value.join(", "));return}r.value.contentFingerprints.length&&await K()},K=async()=>{if(c.value="loading",await S(),!m.value||!p.value){V.value="MISSING_SIGNER",c.value="";return}try{c.value="signing";const t=Me(s.value),_={name:t.name,description:t.description,...t,symbol:"BOOK",image:(t==null?void 0:t.thumbnailUrl)||"",external_link:(t==null?void 0:t.url)||"",nft_meta_collection_id:"nft_book",nft_meta_collection_name:"NFT Book",nft_meta_collection_description:"NFT Book by Liker Land",recordTimestamp:new Date().toISOString()};await o({wallet:m.value});const f=await u({address:A,abi:Ee,functionName:"newBookNFTWithRoyalty",args:[{creator:m.value,updaters:[m.value,$],minters:[m.value,$],config:{name:_.name,symbol:"BOOK",metadata:JSON.stringify(_),max_supply:$e}},500]}),d=await F({hash:f});if(console.log(d),!d||d.status!=="success")throw new Error("INVALID_RECEIPT");if(!d.logs[0].address)throw new Error("INVALID_CLASS_ID");const T=d.logs[0].address;c.value="success",M("submit",{iscnId:T,txHash:f})}catch(t){console.error(t),D(`'SIGNING_ERROR':${t}`),c.value=""}finally{c.value=""}};return i({onSubmit:z}),(t,_)=>{const f=De,d=fe,T=ve,U=ge;return v(),E("div",null,[w(f,{modelValue:l(r),"onUpdate:modelValue":_[0]||(_[0]=B=>me(r)?r.value=B:null)},null,8,["modelValue"]),w(U,{"model-value":!!l(c),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:G(()=>[g("div",qe,[g("div",ze,[w(d,{variant:"soft"},{default:G(()=>[be(Y(l(c)),1)]),_:1}),g("p",We,Y(t.$t("notifications.iscn_registration_complete")),1)]),w(T,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),Ge=we(je,[["__scopeId","data-v-1eece739"]]),Ye={class:"flex flex-col items-stretch grow space-y-4"},He=X({__name:"MintNFT",props:{iscnId:{type:String,default:""}},emits:["submit","loadingChange"],setup(y,{expose:i,emit:k}){const{getClassOwner:x,getClassMetadata:L,checkNFTClassIsBookNFT:$}=Le(),m=n(1),p=n(""),S=n(!1),o=n(""),F=n(null),C=n(""),R=n(null),D=k;j(S,s=>{D("loadingChange",s),s&&(p.value="")},{immediate:!0});const{t:A}=se();ne({title:()=>A("seo.mint_nft_book_title"),ogTitle:()=>A("seo.mint_nft_book_title")});const r=y;j(()=>r.iscnId,async s=>{s&&await c(r.iscnId)},{immediate:!0});async function c(s){if(s)try{if(S.value=!0,!await $(s))throw new Error("Invalid NFT Class ID");const[h,I]=await Promise.all([L(s),x(s)]);if(!h)throw new Error("Invalid NFT Class ID");F.value={contentMetadata:h,owner:I,"@id":s},o.value=I,C.value=s,m.value=3}catch(u){console.error(u),p.value=u.toString()}finally{S.value=!1}}function V(){var s;(s=R.value)==null||s.startNFTMintFlow()}function M({classId:s,nftMintCount:u}={}){C.value=s||"",D("submit",{classId:s||"",nftMintCount:u})}return i({startNFTMintFlow:V}),(s,u)=>{const h=Oe,I=Ue;return v(),E("div",Ye,[l(p)?(v(),H(h,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${l(p)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:u[0]||(u[0]=P=>p.value="")},null,8,["title"])):J("",!0),w(I,{ref_key:"liteMintNFTRef",ref:R,"iscn-data":l(F),"should-show-submit":!1,onSubmit:M},null,8,["iscn-data"])])}}}),Je={class:"w-full"},Xe={class:"justify-evenly items-center flex space-x-4 relative"},Qe={class:"text-sm font-semibold"},Ze={class:"mt-6 p-4 border rounded-lg bg-gray-100 text-center flex flex-col gap-[24px]"},et={key:0},tt={key:1},at={key:2},ot={key:3},st={class:"flex gap-2 justify-center mt-4"},xt=X({__name:"new-book",setup(y){var U,B;const{t:i}=se(),k=te(),{wallet:x,signer:L}=ae(k),{initIfNecessary:$}=k,m=ye(),p=he(),{showErrorToast:S}=ie(),o=n(0),F=n(),C=n(),R=n(),D=n(""),A=n(""),r=n(((U=m.query.iscn_id)==null?void 0:U.toString())||""),c=n(((B=m.query.class_id)==null?void 0:B.toString())||""),V=n([]),M=n(""),s=n(!1),u=n(!1);ne({title:()=>i("seo_titles.publish_nft_book"),ogTitle:()=>i("seo_titles.publish_nft_book")});const h=O(()=>{switch(o.value){case 0:return i("publish_button.upload_files");case 1:return i("publish_button.metadata");case 2:return i("publish_button.mint_nft");default:return i("publish_button.publish_now")}}),I=O(()=>{var a;return((a=V.value)==null?void 0:a.length)>0}),P=O(()=>o.value===0?I.value:o.value<3),z=O(()=>o.value===0?M.value!=="":o.value===2?u.value:!1),K=[{title:i("publish_steps.upload_files"),description:"Upload your book file"},{title:i("publish_steps.register_iscn"),description:"Register ISCN"},{title:i("publish_steps.mint_nft"),description:"Mint NFT"},{title:i("publish_steps.new_book_publish"),description:"Publish new book"}];oe(()=>{var e;let a=null;try{const b=sessionStorage.getItem(Ie);b&&(a=JSON.parse(b))}catch(b){console.error(b)}r.value?(D.value=r.value,f({iscnId:r.value})):c.value?d({classId:c.value}):a!=null&&a.epubMetadata&&(a!=null&&a.fileRecords)&&(A.value=(e=a==null?void 0:a.epubMetadata)==null?void 0:e.title)});const t=async()=>{if((!x.value||!L.value)&&await $(),!x.value||!L.value){S(i("auth.login_required"));return}try{if(o.value===0&&F.value){await F.value.onSubmit();return}if(o.value===1){if(!s.value){S("Please fill in all required fields");return}await C.value.onSubmit();return}if(o.value===2){await R.value.startNFTMintFlow();return}o.value<K.length-1&&o.value++}catch(a){console.error("Error during form submission:",a)}},_=a=>{xe(a),o.value=1},f=async a=>{const{iscnId:e}=a;e&&await W(p({query:{iscn_id:e}}),{replace:!0}),Ne(),o.value=2,await Z(),r.value=e},d=async a=>{const{classId:e,nftMintCount:b}=a;e&&(c.value=e,await W(p({query:{class_id:e,count:b}}),{replace:!0}),o.value=3,await Z())},T=async()=>{await W(p({name:"my-books"}))};return(a,e)=>{const b=Te,le=Be,re=Ge,ce=He,ue=Pe,de=ke,pe=Ke;return v(),H(pe,{class:"flex flex-col items-stretch grow space-y-4"},{default:G(()=>[g("div",Je,[g("div",Xe,[e[4]||(e[4]=g("div",{class:"absolute w-full h-[1px] bg-gray-300 top-[50%] left-0 z-[-1]"},null,-1)),(v(),E(Se,null,Fe(K,(N,q)=>g("div",{key:q,class:"flex items-center space-x-2 bg-white p-2 rounded-lg"},[w(b,{size:q===l(o)?"lg":"md",text:(q+1).toString(),ui:{background:q===l(o)?"bg-primary-100":"bg-gray-200"}},null,8,["size","text","ui"]),g("p",Qe,Y(N.title),1)])),64))]),g("div",Ze,[l(o)===0?(v(),E("div",et,[w(le,{ref_key:"uploadFormRef",ref:F,onFileUploadStatus:e[0]||(e[0]=N=>M.value=N),onFileReady:e[1]||(e[1]=N=>V.value=N),onSubmit:_},null,512)])):l(o)===1?(v(),E("div",tt,[w(re,{ref_key:"registerISCN",ref:C,onFormValidChange:e[2]||(e[2]=N=>s.value=N),onSubmit:f},null,512)])):l(o)===2?(v(),E("div",at,[w(ce,{ref_key:"mintNFT",ref:R,"iscn-id":l(r),onLoadingChange:e[3]||(e[3]=N=>u.value=N),onSubmit:d},null,8,["iscn-id"])])):l(o)===3?(v(),E("div",ot,[w(ue,{ref:"newNFTBook",class:"p-0 flex flex-col text-left gap-[24px]","is-new-class-page":!0,"class-id":l(c),onSubmit:T},null,8,["class-id"])])):J("",!0),g("div",st,[l(P)?(v(),H(de,{key:0,disabled:l(z),label:l(h),onClick:t},null,8,["disabled","label"])):J("",!0)])])])]),_:1})}}});export{xt as default};
