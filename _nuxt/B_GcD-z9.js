import{a_ as no,a$ as io,b6 as so,bl as ro,bk as uo,bn as oe,b9 as b,b8 as u,c4 as co,bM as _e,bN as mo,ba as K,bb as _o,b1 as po,c3 as pe,aS as T,aT as p,b3 as P,br as E,aW as i,b4 as e,bs as fo,bi as fe,aU as d,aX as r,bf as N,aV as y,bt as vo,bP as ve,bj as bo,bH as ho,bQ as te,bR as go,aY as be,bD as yo,bg as ko,b_ as wo,bO as xo,bh as So,aQ as Co}from"./BU2plOUQ.js";import{_ as Eo}from"./v3T_JdcC.js";import{_ as Uo}from"./C5VjYte5.js";import{a as Vo,_ as Po}from"./DskqK9nD.js";import{p as Io,c as Mo,_ as Ao,E as Do}from"./B1PfCkWf.js";import{_ as To}from"./CGupM6R4.js";import{_ as No}from"./DBNRLu9m.js";import{_ as $o,v as Lo}from"./B98Hz88p.js";import{_ as zo}from"./EITO7elg.js";import{_ as Bo}from"./DToEW33F.js";import{u as Ro}from"./vPIDxxs0.js";import{u as jo}from"./BQqSbh4N.js";import{g as Oo}from"./Ce6f8wgp.js";import{u as Fo}from"./REcQhwkh.js";(function(){try{var h=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},j=new h.Error().stack;j&&(h._sentryDebugIds=h._sentryDebugIds||{},h._sentryDebugIds[j]="fce3060c-ae18-4b8d-8577-b595ec895c7d",h._sentryDebugIdIdentifier="sentry-dbid-fce3060c-ae18-4b8d-8577-b595ec895c7d")}catch{}})();function X(h=""){return h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function Wo(h){return Io.sanitize(h)}const Zo={class:"pb-[40px]"},qo={class:"font-bold font-mono"},Go={class:"font-bold font-mono"},Ho={class:"block text-[14px] text-[#374151] mt-[8px]"},Ko={class:"flex flex-col gap-2"},Xo={class:"space-y-2"},Qo={key:0,class:"pl-8 space-y-2"},Yo={class:"space-y-2"},Jo={key:0,class:"pl-8 space-y-2"},et={class:"text-gray-500 text-[12px]"},ot={class:"flex flex-col gap-2"},tt={class:"flex justify-center items-center"},lt={class:"flex justify-center items-center"},at={class:"flex justify-between items-center w-full"},nt={class:"font-bold font-mono"},it={key:0,class:"mt-[24px] flex flex-col gap-[12px]"},st={class:"text-sm font-bold font-mono"},rt={class:"flex gap-2"},ut={class:"flex justify-end items-center"},dt={class:"text-sm font-bold font-mono"},ct={class:"flex gap-2"},mt={class:"flex justify-end items-center"},_t={class:"w-full flex justify-center"},pt={class:"space-y-3"},ft={class:"flex justify-between items-center"},vt={class:"text-xs text-gray-500"},bt=1*1024*1024,ht=no({__name:"NewNFTBook",props:{isNewClassPage:{type:Boolean,default:!1},classId:{type:String,default:""},editionIndex:{type:[String,Number],default:void 0},isEditMode:{type:Boolean,default:!1}},emits:["submit"],setup(h,{emit:j}){const{t:a}=io(),{LIKE_CO_API:le}=so().public,he=ro(),O=uo(),ae=Ro(),{wallet:U}=oe(he),{newBookListing:ge,updateEditionPrice:ye,uploadSignImages:ke}=O,{fetchStripeConnectStatusByWallet:we}=ae,{getStripeConnectStatusByWallet:xe}=oe(ae),{token:Se}=oe(O),Ce=jo(),{getNFTClassConfig:Ee,getBalanceOf:Ue}=Fo(),Ve=j,V=b(()=>R.editionIndex),{lazyFetchClassMetadataById:ne}=Ce,k=u(""),_=u(!1),Pe=u({en:"e.g.: This edition includes EPUB and PDF ebook files.",zh:"例：此版本包含 EPUB 及 PDF 電子書檔"}),f=b(()=>R.classId),$=u(1),L=u(!1),I=u(!0),g=u([{price:_e,deliveryMethod:"auto",autoMemo:"Thank you for your support. It means a lot to me.",stock:co,name:a("prices.standard_edition"),nameEn:"Standard Edition",nameZh:"標準版",descriptionEn:"",descriptionZh:"",hasShipping:!1,isPhysicalOnly:!1,isAllowCustomPrice:I.value,isUnlisted:!1}]),M=u([]),F=b(()=>g.value.length>1),W=u(["like1rclg677y2jqt8x4ylj0kjlqjjmnn6w63uflpgr"]),Z=u([]),w=u(""),x=u(""),z=u(!1),B=u(""),Q=u(!1),Y=u(!0),Ie=u(null),q=u(null),Me=b(()=>S.value||V.value!==void 0?J.value-ie.value:J.value),Ae=b(()=>Math.max(re.value-se.value,0)),ie=u(0),se=u(0),J=u(pe),re=u(0),De=u(["bold","italic","strikeThrough","title","-","unorderedList","orderedList","-","code","link","=","preview"]),S=b(()=>R.isEditMode),Te=b(()=>S.value?a("nft_book_form.edit_title"):a("nft_book_form.page_title")),Ne=b(()=>S.value?a("common.save"):a("common.submit")),G=u(!1),$e=b(()=>[{key:"wallet",label:a("common.wallet"),sortable:!0},{key:"remove",label:"",sortable:!1}]),Le=b(()=>W.value.map((t,o)=>({index:o,wallet:t,walletLink:mo(t)}))),ze=b(()=>Z.value.map((t,o)=>({index:o,email:t}))),ue=b(()=>{var t,o;return(o=(t=Ie.value)==null?void 0:t.contentMetadata)==null?void 0:o.inLanguage});K(_,t=>{t&&(k.value="")},{immediate:!0}),Mo({markdownItConfig(t){t.options.html=!1}});const R=h;_o({title:()=>a("seo_titles.new_book_listing"),ogTitle:()=>a("seo_titles.new_book_listing")}),po(async()=>{try{_.value=!0;const[t,o]=await Promise.all([Ee(f.value),U.value?Ue(f.value,U.value):0]);if(J.value=Number(t==null?void 0:t.max_supply)||pe,re.value=Number(o)||0,S.value||V.value!==void 0){if(U.value)try{await we(U.value),xe.value(U.value).isReady&&(z.value=!0,B.value=U.value)}catch(s){console.error(s)}const l=await $fetch(`${le}/likernft/book/store/${f.value}`,{headers:{authorization:`Bearer ${Se.value}`}});if(l){if(M.value=(l==null?void 0:l.shippingRates)||[],(l==null?void 0:l.ownerWallet)!==U.value)throw new Error("NOT_OWNER_OF_NFT_CLASS");if(V.value!==void 0)if(l.prices.length){const s=l.prices.find(m=>m.index.toString()===V.value);if(!s)throw new Error("Edition not found");g.value=[{price:s.price,deliveryMethod:s.isAutoDeliver?"auto":"manual",autoMemo:s.autoMemo,stock:s.stock,name:l.inLanguage==="en"?s.name.en:s.name.zh,nameEn:s.name.en,nameZh:s.name.zh,descriptionEn:s.description.en,descriptionZh:s.description.zh,hasShipping:s.hasShipping,isPhysicalOnly:s.isPhysicalOnly,isAllowCustomPrice:s.isAllowCustomPrice,isUnlisted:s.isUnlisted,oldIsAutoDeliver:s.isAutoDeliver,oldStock:s.stock}],I.value=s.isAllowCustomPrice}else throw new Error("No prices found");ie.value=l.prices.reduce((s,m)=>m.index.toString()!==V.value?s+m.stock:s,0),se.value=l.prices.reduce((s,m)=>m.index.toString()!==V.value&&!m.isAutoDeliver?s+m.stock:s,0)}else throw new Error(a("errors.nft_class_not_found"))}}catch(t){console.error(t)}finally{_.value=!1}}),K(I,t=>{g.value.forEach(o=>{o.isAllowCustomPrice=t})}),K(_,t=>{t&&(k.value="")}),K(f,async t=>{if(t){const o=await ne(t),l=o==null?void 0:o.contentFingerprints;l&&Be(l)&&(L.value=!0)}},{immediate:!0});function Be(t){const l=Oo().API_GET_ARWEAVE_V2_LINK;return t.some(s=>!!s.startsWith(l)||s.includes("?key="))}function Re(t,o="signatureImage"){if(!(t!=null&&t.length))return;const l=t[0];if(l.type!=="image/png"){k.value=a("errors.png_only");return}if(l.size>bt){k.value=a("errors.file_size_limit");return}o==="signatureImage"?q.value=l:console.warn(`Unknown upload key: ${o}`)}function je(t){t.stock=Math.min(Ae.value,t.stock)}function Oe(){$.value+=1,g.value.push({index:Lo(),price:_e,deliveryMethod:"auto",autoMemo:"",stock:1,name:ue.value==="en"?`Tier ${$.value}`:`級別 ${$.value}`,nameEn:`Tier ${$.value}`,nameZh:`級別 ${$.value}`,descriptionEn:"",descriptionZh:"",hasShipping:!1,isPhysicalOnly:!1,isAllowCustomPrice:!0,isUnlisted:!1})}function Fe(t){g.value.splice(t,1)}function We(t){M.value=t}function Ze(){w.value&&(W.value.push(w.value),w.value="")}function qe(){x.value&&(Z.value.push(x.value),x.value="")}function Ge(t){B.value=t,Q.value=!0}function H(t){const o=ue.value==="en";return t.map(l=>({name:o?{en:l.name,zh:l.nameZh}:{en:l.nameEn,zh:l.name},description:o?{en:X(l.description),zh:X(l.descriptionZh)}:{en:X(l.descriptionEn),zh:X(l.description)},priceInDecimal:Math.round(Number(l.price)*100),price:Number(l.price),stock:Number(l.stock),isAutoDeliver:!l.isPhysicalOnly&&l.deliveryMethod==="auto",isAllowCustomPrice:l.isAllowCustomPrice,isUnlisted:l.isUnlisted??!1,autoMemo:l.deliveryMethod==="auto"&&l.autoMemo||"",hasShipping:l.hasShipping||!1,isPhysicalOnly:l.isPhysicalOnly||!1}))}function He(t){const o=[];return t.forEach(l=>{(!l.name.en||!l.name.zh)&&o.push({path:"name",message:a("errors.product_name_required")}),l.hasShipping&&!M.value.length&&o.push({path:"shipping",message:a("errors.shipping_rates_required")})}),o.length>0?(k.value=o.map(l=>l.message).join(`
`),!1):!0}async function Ke(){try{const t=H(g.value);if(!He(t))return;if(S.value?await Xe():R.isNewClassPage?await de():(await fetch(`${le}/likernft/book/store/${f.value}`)).ok?await Qe():await de(),q.value){const o=new FormData;q.value&&o.append("signImage",q.value),await ke(o,f.value)}Ve("submit")}catch{}}async function de(){try{if(!f.value)throw new Error(a("errors.nft_class_id_required"));if(w.value)throw new Error(a("errors.add_moderator_wallet"));if(x.value)throw new Error(a("errors.add_notification_email"));_.value=!0;const t=await ne(f.value),o=(t==null?void 0:t.nft_meta_collection_id)||"";if(!o.includes("nft_book")&&!o.includes("book_nft"))throw new Error(a("errors.not_nft_book_collection"));const l=H(g.value);if(l.find(v=>v.price!==0&&v.price<te))throw new Error(a("errors.price_validation",{minPrice:te}));const s=z.value&&B.value?{[B.value]:100}:null,m=M.value.length?M.value.map(v=>({name:{en:v.name.en,zh:v.name.zh},priceInDecimal:v.priceInDecimal,price:v.priceInDecimal/100})):void 0,A=g.value.some(v=>v.deliveryMethod==="manual");await ge(f.value,{defaultPaymentCurrency:"USD",connectedWallets:s,moderatorWallets:W.value,notificationEmails:Z.value,prices:l,shippingRates:m,mustClaimToView:!0,enableCustomMessagePage:A,hideDownload:L.value})}catch(t){const o=t.data||t;console.error(o),k.value=o}finally{Q.value=!1,_.value=!1}}async function Xe(){try{if(!S.value)throw new Error(a("errors.missing_edition_data"));const o=H(g.value)[0];_.value=!0,await ye(f.value,V.value,{price:o})}catch(t){const o=t.data||t;console.error(o),k.value=o}finally{_.value=!1}}async function Qe(){try{_.value=!0;const o=H(g.value)[0];await O.addEditionPrice(f.value.toString(),(V.value||0).toString(),{price:o})}catch(t){console.error(t)}finally{_.value=!1}}return(t,o)=>{const l=fo,s=Eo,m=Uo,A=Vo,v=Ao,D=vo,Ye=To,Je=yo,ce=No,eo=$o,C=ko,me=Po,oo=zo,to=wo,lo=xo,ao=So;return p(),T("div",Zo,[e(k)?(p(),P(l,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${e(k)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:o[0]||(o[0]=n=>k.value="")},null,8,["title"])):E("",!0),e(O).isAuthenticated?(p(),T(fe,{key:1},[i(D,{ui:{body:{base:"space-y-4"}}},{header:r(()=>[d("h2",qo,y(e(Te)),1)]),default:r(()=>[i(m,{label:e(a)("nft_book_form.nft_class_id")},{default:r(()=>[i(s,{"model-value":e(f),disabled:"",class:"font-mono"},null,8,["model-value"])]),_:1},8,["label"]),i(m,{class:"flex items-center"},{default:r(()=>[i(v,{"tool-tip-text":e(a)("nft_book_form.drm_tooltip")},{default:r(()=>[i(A,{modelValue:e(L),"onUpdate:modelValue":o[1]||(o[1]=n=>N(L)?L.value=n:null),name:"hideDownload",disabled:!0,label:e(a)("nft_book_form.drm_label")},null,8,["modelValue","label"])]),_:1},8,["tool-tip-text"])]),_:1}),i(m,null,{default:r(()=>[i(A,{modelValue:e(I),"onUpdate:modelValue":o[2]||(o[2]=n=>N(I)?I.value=n:null),name:"isAllowCustomPrice",label:e(a)("nft_book_form.accept_tipping")},null,8,["modelValue","label"])]),_:1})]),_:1}),(p(),P(ve(e(F)?"ul":"div"),{class:"flex flex-col gap-[12px]"},{default:r(()=>[i(D,{ui:{body:{base:"space-y-5 relative"},base:"overflow-visible border-none !border-transparent"}},{default:r(()=>[(p(!0),T(fe,null,bo(e(g),(n,ee)=>(p(),P(ve(e(F)?"li":"div"),{key:n.index},{default:r(()=>[i(D,{ui:{body:{base:"flex flex-col gap-[20px]"},base:"overflow-visible border-[4px]"}},ho({default:r(()=>[i(m,{label:e(a)("nft_book_form.unit_price_label",{minPrice:e(te)})},{default:r(()=>[i(Ye,{modelValue:n.price,"onUpdate:modelValue":c=>n.price=c,options:e(go),"value-attribute":"value"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:2},1032,["label"]),i(m,{label:e(a)("nft_book_form.copies_label")},{default:r(()=>[i(s,{modelValue:n.stock,"onUpdate:modelValue":c=>n.stock=c,type:"number",step:"1",min:0,max:e(Me)},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1032,["label"]),i(m,{label:e(a)("new_nft_book.product_name"),ui:{container:"space-y-2"}},{label:r(()=>[be(y(e(a)("nft_book_form.product_name"))+" ",1),i(v,{"image-style":{width:"250px"}},{image:r(()=>o[9]||(o[9]=[d("img",{src:Bo,class:"object-cover",alt:""},null,-1)])),default:r(()=>[i(Je,{name:"i-heroicons-question-mark-circle"})]),_:1})]),default:r(()=>[i(s,{modelValue:n.name,"onUpdate:modelValue":c=>n.name=c,placeholder:e(a)("nft_book_form.product_name_placeholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),d("span",Ho,y(e(a)("nft_book_form.description_optional")),1),i(e(Do),{modelValue:n.descriptionEn,"onUpdate:modelValue":c=>n.descriptionEn=c,language:"en-US","editor-id":`en-${ee}`,placeholder:e(Pe).en,toolbars:e(De),sanitize:e(Wo),style:{height:"200px",width:"100%",marginTop:"0px"}},null,8,["modelValue","onUpdate:modelValue","editor-id","placeholder","toolbars","sanitize"])]),_:2},1032,["label"]),d("div",Ko,[d("div",Xo,[i(ce,{modelValue:n.deliveryMethod,"onUpdate:modelValue":c=>n.deliveryMethod=c,value:"auto",disabled:e(S)&&n.oldIsAutoDeliver,name:"deliveryMethod",label:e(a)("nft_book_form.auto_delivery")},null,8,["modelValue","onUpdate:modelValue","disabled","label"]),n.deliveryMethod==="auto"?(p(),T("div",Qo,[i(m,{label:e(a)("nft_book_form.delivery_memo")},{default:r(()=>[i(s,{modelValue:n.autoMemo,"onUpdate:modelValue":c=>n.autoMemo=c,placeholder:e(a)("nft_book_form.memo_placeholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),_:2},1032,["label"])])):E("",!0)]),d("div",Yo,[i(ce,{modelValue:n.deliveryMethod,"onUpdate:modelValue":c=>n.deliveryMethod=c,value:"manual",disabled:e(S)&&n.oldIsAutoDeliver,name:"deliveryMethod",label:e(a)("nft_book_form.manual_delivery"),onClick:c=>je(n)},null,8,["modelValue","onUpdate:modelValue","disabled","label","onClick"]),n.deliveryMethod==="manual"?(p(),T("div",Jo,[i(m,null,{label:r(()=>[d("p",null,y(e(a)("nft_book_form.autograph_image")),1),d("span",et,y(e(a)("nft_book_form.image_requirements")),1)]),default:r(()=>[i(s,{type:"file",accept:"image/png",onChange:o[3]||(o[3]=c=>Re(c,"signatureImage"))})]),_:1})])):E("",!0)])]),i(m,null,{default:r(()=>[i(A,{modelValue:n.isUnlisted,"onUpdate:modelValue":c=>n.isUnlisted=c,name:"isUnlisted",label:e(a)("nft_book_form.pause_selling")},null,8,["modelValue","onUpdate:modelValue","label"])]),_:2},1024),d("div",ot,[i(A,{modelValue:n.hasShipping,"onUpdate:modelValue":c=>n.hasShipping=c,name:"hasShipping",disabled:e(S)&&!n.hasShipping,label:e(a)("nft_book_form.includes_shipping")},null,8,["modelValue","onUpdate:modelValue","disabled","label"]),n.hasShipping?(p(),P(eo,{key:0,"is-show-physical-goods-checkbox":!1,"is-show-setting-modal-button":!0,"shipping-info":e(M),onUpdateShippingRates:We},null,8,["shipping-info"])):E("",!0)])]),_:2},[e(F)?{name:"header",fn:r(()=>[d("h3",Go,y(e(a)("nft_book_form.edition_number",{number:ee+1})),1)]),key:"0"}:void 0]),1024),d("div",tt,[e(F)?(p(),P(C,{key:0,label:e(a)("common.delete"),color:"red",onClick:c=>Fe(ee)},null,8,["label","onClick"])):E("",!0)])]),_:2},1024))),128))]),_:1})]),_:1})),d("div",lt,[R.isNewClassPage?(p(),P(C,{key:0,ui:{rounded:"rounded-full"},color:"gray",icon:"i-heroicons-plus-solid",label:e(a)("nft_book_form.add_edition"),onClick:Oe},null,8,["label"])):E("",!0)]),i(D,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"12px"}}},{default:r(()=>[d("div",at,[d("h3",nt,y(e(a)("nft_book_form.advanced_settings")),1),i(C,{color:"gray",variant:"ghost",icon:e(G)?"i-heroicons-chevron-up":"i-heroicons-chevron-down",onClick:o[4]||(o[4]=()=>{G.value=!e(G)})},null,8,["icon"])]),e(G)?(p(),T("div",it,[i(D,{ui:{header:{base:"flex justify-between items-center"},body:{padding:""}}},{header:r(()=>[d("h4",st,y(e(a)("nft_book_form.notification_email_header")),1),d("div",rt,[i(s,{modelValue:e(x),"onUpdate:modelValue":o[5]||(o[5]=n=>N(x)?x.value=n:null),placeholder:"abc@example.com"},null,8,["modelValue"]),i(C,{label:e(a)("common.add"),variant:e(x)?"outline":"solid",color:e(x)?"primary":"gray",disabled:!e(x),onClick:qe},null,8,["label","variant","color","disabled"])])]),default:r(()=>[i(me,{columns:[{key:"email",label:e(a)("common.email"),sortable:!0},{key:"action"}],rows:e(ze)},{"email-data":r(({row:n})=>[i(C,{label:n.email,to:`mailto:${n.email}`,variant:"link",padded:!1},null,8,["label","to"])]),"action-data":r(({row:n})=>[d("div",ut,[i(C,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>e(Z).splice(n.index,1)},null,8,["onClick"])])]),_:1},8,["columns","rows"])]),_:1}),e(S)?(p(),P(oo,{key:0,"is-stripe-connect-checked":e(z),"onUpdate:isStripeConnectChecked":o[6]||(o[6]=n=>N(z)?z.value=n:null),"is-using-default-account":e(Y),"onUpdate:isUsingDefaultAccount":o[7]||(o[7]=n=>N(Y)?Y.value=n:null),"stripe-connect-wallet":e(B),"should-disable-setting":e(Q),"login-address":e(U),onSave:Ge},null,8,["is-stripe-connect-checked","is-using-default-account","stripe-connect-wallet","should-disable-setting","login-address"])):E("",!0),i(D,{ui:{header:{base:"flex justify-between items-center"},body:{padding:"",base:"space-y-8"}}},{header:r(()=>[d("h4",dt,y(e(a)("nft_book_form.share_sales_data")),1),d("div",ct,[i(s,{modelValue:e(w),"onUpdate:modelValue":o[8]||(o[8]=n=>N(w)?w.value=n:null),class:"font-mono",placeholder:"0x..."},null,8,["modelValue"]),i(C,{label:e(a)("common.add"),variant:e(w)?"outline":"solid",color:e(w)?"primary":"gray",disabled:!e(w),onClick:Ze},null,8,["label","variant","color","disabled"])])]),default:r(()=>[i(me,{columns:e($e),rows:e(Le)},{"wallet-data":r(({row:n})=>[i(C,{class:"font-mono",label:n.wallet,to:n.walletLink,variant:"link",padded:!1},null,8,["label","to"])]),"remove-data":r(({row:n})=>[d("div",mt,[i(C,{icon:"i-heroicons-x-mark",variant:"soft",color:"red",onClick:()=>e(W).splice(n.index,1)},null,8,["onClick"])])]),_:1},8,["columns","rows"])]),_:1})])):E("",!0)]),_:1}),d("div",_t,[i(C,{label:e(Ne),loading:e(_),size:"lg",disabled:e(_),onClick:Ke},null,8,["label","loading","disabled"])])],64)):E("",!0),i(ao,{"model-value":!!e(_),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:r(()=>[d("div",pt,[d("div",ft,[i(to,{variant:"soft"},{default:r(()=>[be(y(e(a)("common.loading")),1)]),_:1}),d("p",vt,y(e(a)("nft_book_form.loading_progress_text")),1)]),i(lo,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),Dt=Co(ht,[["__scopeId","data-v-4b14718f"]]);export{Dt as _};
