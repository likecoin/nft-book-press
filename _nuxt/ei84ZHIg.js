import{a_ as X,bj as le,bh as Z,bl as ie,b4 as s,b5 as E,b6 as H,b0 as re,dv as ye,aS as D,aT as f,aW as l,bc as a,bb as ee,aX as N,aU as p,cJ as we,aY as z,aV as Q,bM as Ne,be as Se,cO as Ce,cT as xe,aQ as Fe,b1 as j,br as ke,bp as V,cq as he,bd as ue,b7 as Te,bq as Re,bk as Ue,a$ as De,dw as Me,dx as Le,b8 as oe,bf as $e,bg as Ee,ct as Be,dy as Ve}from"./BjTv2_7R.js";import{u as ce,b as Ae,v as Oe,c as se,d as Pe,f as Ke,a as qe,_ as ze,e as je}from"./BjxyXjyK.js";import{a as Ge,b as We,u as Je}from"./BewDPqUu.js";import{u as Ye,a as He}from"./DlzG2iJv.js";import{_ as Qe}from"./BV38tAeI.js";import{_ as de}from"./DqHvtBG2.js";import{_ as Xe}from"./BN6ONtyW.js";import{_ as Ze}from"./DaNSWct6.js";import"./Bhj8vQ8q.js";import"./rRDHaQBe.js";import"./DaLB-Nz-.js";import"./D4e-xYJ-.js";import"./DZymGoW7.js";import"./CEePLGwB.js";import"./CO4DjxkN.js";import"./CffGS_HO.js";import"./72ce5njb.js";import"./DfnCb5iJ.js";import"./DcYmqLSk.js";import"./BxbEXhwv.js";import"./B1c4RQjt.js";import"./B3vpTcTz.js";import"./DvRvX-rE.js";(function(){try{var T=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},C=new T.Error().stack;C&&(T._sentryDebugIds=T._sentryDebugIds||{},T._sentryDebugIds[C]="6d987226-c4cb-4763-b3bf-6d8c43e27523",T._sentryDebugIdIdentifier="sentry-dbid-6d987226-c4cb-4763-b3bf-6d8c43e27523")}catch{}})();const et={class:"space-y-3"},tt={class:"flex justify-between items-center"},nt=X({__name:"RegisterISCN",emits:["handleSubmit","submit","formValidChange"],setup(T,{expose:C,emit:R}){const c=le(),{getFileType:U}=se(),{LIKE_EVM_NFT_TARGET_ADDRESS:x}=Z().public,{wallet:_,signer:S}=ie(c),{initIfNecessary:F}=c,{stripHtmlTags:n,formatLanguage:m}=se(),{showErrorToast:M}=ce(),w=s({type:"Book",title:"",description:"",isbn:"",publisher:"",publicationDate:"",author:{name:"",description:""},license:"All Rights Reserved",customLicense:"",contentFingerprints:[{url:""}],downloadableUrls:[{url:"",type:"",fileName:""}],language:"",bookInfoUrl:"",tags:[],coverUrl:""}),v=s(""),g=s(""),L=R,{payload:k}=Ae({iscnFormData:w}),{writeContractAsync:$}=Ye(),A=E(()=>Oe(w.value)),O=E(()=>{var e;return!((e=A.value)!=null&&e.length)});H(O,e=>{L("formValidChange",e)},{immediate:!0}),re(()=>{const e=K();e&&(w.value=e)});const K=()=>{var h,I,y,q,P,W;const e=ye();if(!e)return null;const d={type:"Book",title:((h=e.epubMetadata)==null?void 0:h.title)||"",description:n(((I=e.epubMetadata)==null?void 0:I.description)||""),isbn:"",publisher:"",publicationDate:new Date().toISOString().split("T")[0],author:{name:((y=e.epubMetadata)==null?void 0:y.author)||"",description:""},license:"All Rights Reserved",contentFingerprints:[],downloadableUrls:[],coverUrl:(q=e.epubMetadata)!=null&&q.thumbnailArweaveId?`ar://${e.epubMetadata.thumbnailArweaveId}`:"",language:m(((P=e.epubMetadata)==null?void 0:P.language)||"zh"),tags:((W=e.epubMetadata)==null?void 0:W.tags)||[]};return d.downloadableUrls=e.fileRecords.filter(u=>u.fileType==="application/pdf"||u.fileType==="application/epub+zip").map(u=>({url:u.arweaveKey?u.arweaveLink:`ar://${u.arweaveId}`,type:U(u.fileType),fileName:u.fileName})),d.contentFingerprints=[...new Set(e.fileRecords.map(u=>{const G=u.arweaveKey?u.arweaveLink:`ar://${u.arweaveId}`;return u.fileType==="application/epub+zip"||u.fileType==="application/pdf"?G:`ar://${u.arweaveId}`}).filter(Boolean))].map(u=>({url:u})),d},o=async()=>{if(v.value="checking",!O.value){M(A.value.join(", "));return}w.value.contentFingerprints.length&&await r()},r=async()=>{if(v.value="loading",await F(),!_.value||!S.value){g.value="MISSING_SIGNER",v.value="";return}try{v.value="signing";const e=Ke(k.value),d={name:e.name,description:e.description,...e,symbol:"BOOK",image:(e==null?void 0:e.thumbnailUrl)||"",external_link:(e==null?void 0:e.url)||"",nft_meta_collection_id:"nft_book",nft_meta_collection_name:"NFT Book",nft_meta_collection_description:"NFT Book by Liker Land",recordTimestamp:new Date().toISOString()},h=await $({address:We,abi:Ge,functionName:"newBookNFTWithRoyalty",args:[{creator:_.value,updaters:[_.value,x],minters:[_.value,x],config:{name:d.name,symbol:"BOOK",metadata:JSON.stringify(d),max_supply:Ce}},500]}),I=await He(xe,{hash:h});if(console.log(I),!I||I.status!=="success")throw new Error("INVALID_RECEIPT");if(!I.logs[0].address)throw new Error("INVALID_CLASS_ID");const y=I.logs[0].address;v.value="success",L("submit",{iscnId:y,txHash:h})}catch(e){console.error(e),M(`'SIGNING_ERROR':${e}`),v.value=""}finally{v.value=""}};return C({onSubmit:o}),(e,d)=>{const h=Pe,I=we,y=Ne,q=Se;return f(),D("div",null,[l(h,{modelValue:a(w),"onUpdate:modelValue":d[0]||(d[0]=P=>ee(w)?w.value=P:null)},null,8,["modelValue"]),l(q,{"model-value":!!a(v),"prevent-close":!0,ui:{base:"p-4 gap-2"}},{default:N(()=>[p("div",et,[p("div",tt,[l(I,{variant:"soft"},{default:N(()=>[z(Q(a(v)),1)]),_:1}),d[1]||(d[1]=p("p",{class:"text-xs text-gray-500"}," 請勿關閉此視窗，直到 ISCN 註冊完成。 ",-1))]),l(y,{animation:"carousel",color:"primary",class:"w-full"})])]),_:1},8,["model-value"])])}}}),at=Fe(nt,[["__scopeId","data-v-e5210b79"]]),ot=X({__name:"ISCNInfoCard",props:{iscnId:{},iscnOwner:{},iscnData:{},showEditButton:{type:Boolean}},emits:["edit"],setup(T){const{APP_LIKE_CO_URL:C,LIKER_LAND_URL:R}=Z().public;return(c,U)=>{const x=ue,_=Qe,S=de,F=ke;return f(),j(F,{ui:{body:{base:"space-y-4"}}},{header:N(()=>U[1]||(U[1]=[p("h2",{class:"font-bold font-mono"}," ISCN Information ",-1)])),default:N(()=>[c.iscnId?(f(),j(_,{key:0,label:"ISCN ID",class:"text-left"},{default:N(()=>[l(x,{class:"font-mono",label:c.iscnId,to:`${a(C)}/view/${encodeURIComponent(c.iscnId)}`,target:"_blank",variant:"link",padded:!1},null,8,["label","to"])]),_:1})):V("",!0),l(_,{label:"Owner",class:"text-left"},{default:N(()=>[l(x,{label:c.iscnOwner,to:`${a(R)}/${encodeURIComponent(c.iscnOwner)}`,target:"_blank",variant:"link",padded:!1},null,8,["label","to"])]),_:1}),l(_,{label:"Title"},{default:N(()=>{var n,m;return[l(S,{value:(m=(n=c.iscnData)==null?void 0:n.contentMetadata)==null?void 0:m.name,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1}),l(_,{label:"Description"},{default:N(()=>{var n,m;return[l(S,{value:(m=(n=c.iscnData)==null?void 0:n.contentMetadata)==null?void 0:m.description,readonly:!0,variant:"none",padded:!1},null,8,["value"])]}),_:1}),he(c.$slots,"actions",{},()=>[c.showEditButton?(f(),j(x,{key:0,label:"Edit ISCN Metadata",onClick:U[0]||(U[0]=n=>c.$emit("edit"))})):V("",!0)])]),_:3})}}}),st={class:"flex flex-col items-stretch grow space-y-4"},lt=X({__name:"MintNFT",props:{iscnId:{type:String,default:""}},emits:["submit","formValidChange","loadingChange"],setup(T,{expose:C,emit:R}){const{getClassOwner:c,getClassMetadata:U,checkNFTClassIsBookNFT:x}=Je(),_=s(1),S=s(""),F=s(!1),n=s(""),m=s(null),M=s(""),w=s(null),v=E(()=>{var o;return(o=m.value)==null?void 0:o["@id"]}),g=s(!1),L=s(!1),k=R;H(F,o=>{k("loadingChange",o),o&&(S.value="")},{immediate:!0}),H(L,o=>{k("formValidChange",o)},{immediate:!0}),Te({title:"Mint Liker Land NFT Book",ogTitle:"Mint Liker Land NFT Book"});const $=T;H(()=>$.iscnId,async o=>{o&&await A($.iscnId)},{immediate:!0});async function A(o){if(o)try{if(F.value=!0,o.startsWith("0x")){if(!await x(o))throw new Error("Invalid NFT Class ID");const[e,d]=await Promise.all([U(o),c(o)]);if(!e)throw new Error("Invalid NFT Class ID");m.value={contentMetadata:e,owner:d,"@id":o},n.value=d,M.value=o,_.value=3}}catch(r){console.error(r),S.value=r.toString()}finally{F.value=!1}}function O(){var o;(o=w.value)==null||o.startNFTMintFlow()}function K({classId:o,nftMintCount:r}={}){M.value=o||"",k("submit",{classId:o||"",nftMintCount:r})}return C({startNFTMintFlow:O}),(o,r)=>{const e=Re,d=ot,h=qe,I=ze;return f(),D("div",st,[a(S)?(f(),j(e,{key:0,icon:"i-heroicons-exclamation-triangle",color:"red",variant:"soft",title:`${a(S)}`,"close-button":{icon:"i-heroicons-x-mark-20-solid",color:"red",variant:"link",padded:!1},onClose:r[0]||(r[0]=y=>S.value="")},null,8,["title"])):V("",!0),l(d,{"iscn-id":a(v),"iscn-owner":a(n),"iscn-data":a(m),"show-edit-button":!0,onEdit:r[1]||(r[1]=y=>g.value=!0)},null,8,["iscn-id","iscn-owner","iscn-data"]),l(h,{ref_key:"liteMintNFTRef",ref:w,"iscn-data":a(m),"should-show-submit":!1,onFormValidChange:r[2]||(r[2]=y=>L.value=y),onSubmit:K},null,8,["iscn-data"]),l(I,{modelValue:a(g),"onUpdate:modelValue":r[3]||(r[3]=y=>ee(g)?g.value=y:null),"class-id":a(M)},null,8,["modelValue","class-id"])])}}}),it={class:"w-full"},rt={class:"justify-evenly items-center flex space-x-4 relative"},ut={class:"text-sm font-semibold"},ct={class:"mt-6 p-4 border rounded-lg bg-gray-100 text-center flex flex-col gap-[24px]"},dt={key:0},pt={key:1},mt={key:2},ft={key:3},_t={class:"flex gap-2 justify-center mt-4"},vt={key:0,class:"flex flex-col justify-center px-[12px] mt-[16px]"},bt={class:"flex flex-col items-center gap-4 py-4"},gt={class:"flex flex-col items-center"},It={key:0},yt={class:"flex items-center"},wt={key:0,class:"flex flex-col items-center gap-2 w-full max-w-md"},Nt=["href"],Gt=X({__name:"index",setup(T){var ne,ae;const C=le(),{wallet:R,signer:c}=ie(C),{initIfNecessary:U}=C,x=Ue(),_=De(),{APP_LIKE_CO_URL:S}=Z().public,{showErrorToast:F}=ce(),n=s(0),m=s(),M=s(),w=s(),v=s(!1),g=s(""),L=s(""),k=s(((ne=x.query.iscn_id)==null?void 0:ne.toString())||""),$=s(((ae=x.query.class_id)==null?void 0:ae.toString())||""),A=s([]),O=s(""),K=s(!1),o=s(!1),r=s(!1),e=E(()=>!!L.value),d=E(()=>{switch(n.value){case 0:return"Start Upload";case 1:return"Register ISCN";case 2:return"Mint NFT";default:return"Next"}}),h=E(()=>{var i;return((i=A.value)==null?void 0:i.length)>0}),I=E(()=>n.value===0?h.value:n.value<3),y=E(()=>n.value===0?O.value!=="":n.value===2?r.value:!1),q=E(()=>`${S}/search?owner=${R.value}`),P=[{title:"上傳檔案",description:"Upload your book file"},{title:"註冊 ISCN",description:"Register ISCN"},{title:"鑄造區塊鏈書",description:"Mint NFT"},{title:"新書發佈",description:"Publish new book"}];re(()=>{var t;let i=null;try{const B=sessionStorage.getItem(Me);B&&(i=JSON.parse(B))}catch(B){console.error(B)}k.value?(g.value=k.value,G({iscnId:k.value})):$.value?te({classId:$.value}):i!=null&&i.epubMetadata&&(i!=null&&i.fileRecords)&&(L.value=(t=i==null?void 0:i.epubMetadata)==null?void 0:t.title)});const W=async()=>{if((!R.value||!c.value)&&await U(),!R.value||!c.value){F("Please login first");return}try{if(n.value===0&&m.value){await m.value.onSubmit();return}if(n.value===1){if(!K.value){F("Please fill in all required fields");return}await M.value.onSubmit();return}if(n.value===2){if(!o.value){F("Please fill in all required fields");return}await w.value.startNFTMintFlow();return}n.value<P.length-1&&n.value++}catch(i){console.error("Error during form submission:",i)}},u=i=>{Ve(i),n.value=1},G=async i=>{const{iscnId:t}=i;t&&_.replace({query:{iscn_id:t}}),Le(),n.value=2,await oe(),k.value=t},te=async i=>{const{classId:t,nftMintCount:B}=i;t&&($.value=t,_.replace({query:{class_id:t,count:B}}),n.value=3,await oe())},pe=()=>{_.push({name:"nft-book-store"})},me=async()=>{g.value&&await G({iscnId:g.value})};return(i,t)=>{const B=Be,fe=je,_e=at,ve=lt,be=Xe,J=ue,ge=de,Ie=Ze;return f(),j(Ie,{class:"flex flex-col items-stretch grow space-y-4"},{default:N(()=>[p("div",it,[p("div",rt,[t[8]||(t[8]=p("div",{class:"absolute w-full h-[1px] bg-gray-300 top-[50%] left-0 z-[-1]"},null,-1)),(f(),D($e,null,Ee(P,(b,Y)=>p("div",{key:Y,class:"flex items-center space-x-2 bg-white p-2 rounded-lg"},[l(B,{size:Y===a(n)?"lg":"md",text:(Y+1).toString(),ui:{background:Y===a(n)?"bg-primary-100":"bg-gray-200"}},null,8,["size","text","ui"]),p("p",ut,Q(b.title),1)])),64))]),p("div",ct,[a(n)===0?(f(),D("div",dt,[l(fe,{ref_key:"uploadFormRef",ref:m,onFileUploadStatus:t[0]||(t[0]=b=>O.value=b),onFileReady:t[1]||(t[1]=b=>A.value=b),onSubmit:u},null,512)])):a(n)===1?(f(),D("div",pt,[l(_e,{ref_key:"registerISCN",ref:M,onFormValidChange:t[2]||(t[2]=b=>K.value=b),onSubmit:G},null,512)])):a(n)===2?(f(),D("div",mt,[l(ve,{ref_key:"mintNFT",ref:w,"iscn-id":a(k),onLoadingChange:t[3]||(t[3]=b=>r.value=b),onFormValidChange:t[4]||(t[4]=b=>o.value=b),onSubmit:te},null,8,["iscn-id"])])):a(n)===3?(f(),D("div",ft,[l(be,{ref:"newNFTBook",class:"p-0 flex flex-col text-left gap-[24px]","is-new-class-page":!0,"class-id":a($),onSubmit:pe},null,8,["class-id"])])):V("",!0),p("div",_t,[a(I)?(f(),j(J,{key:0,disabled:a(y),onClick:W},{default:N(()=>[z(Q(a(d)),1)]),_:1},8,["disabled"])):V("",!0)])]),a(n)===0?(f(),D("div",vt,[t[13]||(t[13]=p("div",{class:"w-full bg-gray-300 h-[1px]"},null,-1)),p("div",bt,[p("div",gt,[a(e)?(f(),D("div",It,[t[9]||(t[9]=z(" 繼續上次的註冊: ")),l(J,{variant:"ghost",class:"text-primary-500 font-semibold",onClick:t[5]||(t[5]=b=>n.value=1)},{default:N(()=>[z(Q(a(L)),1)]),_:1})])):V("",!0),p("div",yt,[t[11]||(t[11]=p("span",null,"已經有 ISCN ID 了？ 按",-1)),l(J,{variant:"ghost",onClick:t[6]||(t[6]=b=>v.value=!a(v))},{default:N(()=>t[10]||(t[10]=[z(" 這裡 ")])),_:1,__:[10]})])]),a(v)?(f(),D("div",wt,[l(ge,{modelValue:a(g),"onUpdate:modelValue":t[7]||(t[7]=b=>ee(g)?g.value=b:null),placeholder:"輸入 ISCN ID"},null,8,["modelValue"]),l(J,{disabled:!a(g),onClick:me},{default:N(()=>t[12]||(t[12]=[z(" 確認 ")])),_:1,__:[12]},8,["disabled"]),p("a",{href:a(q),target:"_blank",class:"text-primary-500"}," or 找到你的 ISCN ",8,Nt)])):V("",!0)])])):V("",!0)])]),_:1})}}});export{Gt as default};
